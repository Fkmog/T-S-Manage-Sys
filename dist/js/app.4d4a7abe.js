(()=>{var e={35358:(e,t,o)=>{var n={"./af":25177,"./af.js":25177,"./ar":61509,"./ar-dz":41488,"./ar-dz.js":41488,"./ar-kw":58676,"./ar-kw.js":58676,"./ar-ly":42353,"./ar-ly.js":42353,"./ar-ma":24496,"./ar-ma.js":24496,"./ar-sa":82682,"./ar-sa.js":82682,"./ar-tn":89756,"./ar-tn.js":89756,"./ar.js":61509,"./az":95533,"./az.js":95533,"./be":28959,"./be.js":28959,"./bg":47777,"./bg.js":47777,"./bm":54903,"./bm.js":54903,"./bn":61290,"./bn-bd":17357,"./bn-bd.js":17357,"./bn.js":61290,"./bo":31545,"./bo.js":31545,"./br":11470,"./br.js":11470,"./bs":44429,"./bs.js":44429,"./ca":7306,"./ca.js":7306,"./cs":56464,"./cs.js":56464,"./cv":73635,"./cv.js":73635,"./cy":64226,"./cy.js":64226,"./da":93601,"./da.js":93601,"./de":77853,"./de-at":26111,"./de-at.js":26111,"./de-ch":54697,"./de-ch.js":54697,"./de.js":77853,"./dv":60708,"./dv.js":60708,"./el":54691,"./el.js":54691,"./en-au":53872,"./en-au.js":53872,"./en-ca":28298,"./en-ca.js":28298,"./en-gb":56195,"./en-gb.js":56195,"./en-ie":66584,"./en-ie.js":66584,"./en-il":65543,"./en-il.js":65543,"./en-in":9033,"./en-in.js":9033,"./en-nz":79402,"./en-nz.js":79402,"./en-sg":43004,"./en-sg.js":43004,"./eo":32934,"./eo.js":32934,"./es":97650,"./es-do":20838,"./es-do.js":20838,"./es-mx":17730,"./es-mx.js":17730,"./es-us":56575,"./es-us.js":56575,"./es.js":97650,"./et":3035,"./et.js":3035,"./eu":3508,"./eu.js":3508,"./fa":119,"./fa.js":119,"./fi":90527,"./fi.js":90527,"./fil":95995,"./fil.js":95995,"./fo":52477,"./fo.js":52477,"./fr":85498,"./fr-ca":26435,"./fr-ca.js":26435,"./fr-ch":37892,"./fr-ch.js":37892,"./fr.js":85498,"./fy":37071,"./fy.js":37071,"./ga":41734,"./ga.js":41734,"./gd":70217,"./gd.js":70217,"./gl":77329,"./gl.js":77329,"./gom-deva":32124,"./gom-deva.js":32124,"./gom-latn":93383,"./gom-latn.js":93383,"./gu":95050,"./gu.js":95050,"./he":11713,"./he.js":11713,"./hi":43861,"./hi.js":43861,"./hr":26308,"./hr.js":26308,"./hu":90609,"./hu.js":90609,"./hy-am":17160,"./hy-am.js":17160,"./id":74063,"./id.js":74063,"./is":89374,"./is.js":89374,"./it":88383,"./it-ch":21827,"./it-ch.js":21827,"./it.js":88383,"./ja":23827,"./ja.js":23827,"./jv":89722,"./jv.js":89722,"./ka":41794,"./ka.js":41794,"./kk":27088,"./kk.js":27088,"./km":96870,"./km.js":96870,"./kn":84451,"./kn.js":84451,"./ko":63164,"./ko.js":63164,"./ku":98174,"./ku.js":98174,"./ky":78474,"./ky.js":78474,"./lb":79680,"./lb.js":79680,"./lo":15867,"./lo.js":15867,"./lt":45766,"./lt.js":45766,"./lv":69532,"./lv.js":69532,"./me":58076,"./me.js":58076,"./mi":41848,"./mi.js":41848,"./mk":30306,"./mk.js":30306,"./ml":73739,"./ml.js":73739,"./mn":99053,"./mn.js":99053,"./mr":86169,"./mr.js":86169,"./ms":73386,"./ms-my":92297,"./ms-my.js":92297,"./ms.js":73386,"./mt":77075,"./mt.js":77075,"./my":72264,"./my.js":72264,"./nb":22274,"./nb.js":22274,"./ne":8235,"./ne.js":8235,"./nl":92572,"./nl-be":43784,"./nl-be.js":43784,"./nl.js":92572,"./nn":54566,"./nn.js":54566,"./oc-lnc":69330,"./oc-lnc.js":69330,"./pa-in":29849,"./pa-in.js":29849,"./pl":94418,"./pl.js":94418,"./pt":79834,"./pt-br":48303,"./pt-br.js":48303,"./pt.js":79834,"./ro":24457,"./ro.js":24457,"./ru":82271,"./ru.js":82271,"./sd":1221,"./sd.js":1221,"./se":33478,"./se.js":33478,"./si":17538,"./si.js":17538,"./sk":5784,"./sk.js":5784,"./sl":46637,"./sl.js":46637,"./sq":86794,"./sq.js":86794,"./sr":45719,"./sr-cyrl":3322,"./sr-cyrl.js":3322,"./sr.js":45719,"./ss":56e3,"./ss.js":56e3,"./sv":41011,"./sv.js":41011,"./sw":40748,"./sw.js":40748,"./ta":11025,"./ta.js":11025,"./te":11885,"./te.js":11885,"./tet":28861,"./tet.js":28861,"./tg":86571,"./tg.js":86571,"./th":55802,"./th.js":55802,"./tk":59527,"./tk.js":59527,"./tl-ph":29231,"./tl-ph.js":29231,"./tlh":31052,"./tlh.js":31052,"./tr":85096,"./tr.js":85096,"./tzl":79846,"./tzl.js":79846,"./tzm":81765,"./tzm-latn":97711,"./tzm-latn.js":97711,"./tzm.js":81765,"./ug-cn":48414,"./ug-cn.js":48414,"./uk":16618,"./uk.js":16618,"./ur":57777,"./ur.js":57777,"./uz":57609,"./uz-latn":72475,"./uz-latn.js":72475,"./uz.js":57609,"./vi":21135,"./vi.js":21135,"./x-pseudo":64051,"./x-pseudo.js":64051,"./yo":82218,"./yo.js":82218,"./zh-cn":52648,"./zh-cn.js":52648,"./zh-hk":1632,"./zh-hk.js":1632,"./zh-mo":31541,"./zh-mo.js":31541,"./zh-tw":50304,"./zh-tw.js":50304};function r(e){var t=a(e);return o(t)}function a(e){if(!o.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}r.keys=function(){return Object.keys(n)},r.resolve=a,e.exports=r,r.id=35358},18082:(e,t,o)=>{"use strict";var n=o(69492),r=o(25026),a=o(29990),s=o(19129),i=(o(23792),o(3362),o(69085),o(9391),o(76031),o(53751)),l=o(20641);function c(e,t,o,n,r,a){var s=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.bF)(s)])}o(23288),o(33110),o(79432);var u=o(18987);const d={name:"App",data:function(){return{gap_time:0,beforeUnload_time:0}},methods:{beforeunloadHandler:function(){this.beforeUnload_time=(new Date).getTime()},unloadHandler:function(){this.gap_time=(new Date).getTime()-this.beforeUnload_time,this.gap_time<=5&&u.A.remove("Admin-Token")}},unmounted:function(){var e=this;window.removeEventListener("beforeunload",(function(){return e.beforeunloadHandler()})),window.removeEventListener("unload",(function(){return e.unloadHandler()}))},mounted:function(){var e=this;window.addEventListener("beforeunload",(function(){return e.beforeunloadHandler()})),window.addEventListener("unload",(function(){return e.unloadHandler()}))},created:function(){var e=this;sessionStorage.getItem("store")&&this.$store.replaceState(Object.assign({},this.$store.state,JSON.parse(sessionStorage.getItem("store")))),window.addEventListener("beforeunload",(function(){sessionStorage.setItem("store",JSON.stringify(e.$store.state))}))}};var h=o(66262);const f=(0,h.A)(d,[["render",c]]),m=f;var p=o(88178),b=o(57354),g=(o(2892),o(66278)),k=o(86400),v=o.n(k);const I=(0,g.y$)({state:{},mutations:{},actions:{},modules:{userInfo:{namespaced:!0,state:{userName:"",userId:Number,roleInfo:[],identity:[]},getters:{},mutations:{setUserName:function(e,t){e.userName=t},setUserId:function(e,t){e.userId=t},setRoleInfo:function(e,t){e.roleInfo=t},setIdentity:function(e,t){e.identity=t}},actions:{},modules:{}},major:{namespaced:!0,state:{majorName:"",majorId:"",programId:""},getters:{},mutations:{setMajorName:function(e,t){e.majorName=t},setMajorId:function(e,t){e.majorId=t},setProgramId:function(e,t){e.programId=t}},actions:{},modules:{}},currentInfo:{namespaced:!0,state:{departmentName:"",departmentId:"",schoolName:"",schoolId:"",year:"",opendrawer:!1,currentVersionValue:1,role:{},isTeacher:!1,identity:"",teacherSideClassInfo:{},adminSideClassInfo:{},respondClassInfo:{}},getters:{changeIsTeacher:function(e){return"教师"==e.role.roleName?e.identity="教师":"学院管理员"==e.role.roleName?e.identity="学院管理员":"课程负责人"==e.role.roleName?e.identity="课程负责人":"web管理员"==e.role.roleName&&(e.identity="web管理员"),e.identity}},mutations:{setDepartmentName:function(e,t){e.departmentName=t},setDepartmentId:function(e,t){e.departmentId=t},setSchoolName:function(e,t){e.schoolName=t},setSchoolId:function(e,t){e.schoolId=t},setYear:function(e,t){e.year=t},setOpenDrawer:function(e,t){e.opendrawer=t},setRole:function(e,t){e.role=t},setIdentity:function(e,t){e.identity=t},setTeacherSideClassInfo:function(e,t){e.teacherSideClassInfo=t},setadminSideClassInfo:function(e,t){e.adminSideClassInfo=t},setRespondClassInfo:function(e,t){e.respondClassInfo=t},setCurrentVersionValue:function(e,t){e.currentVersionValue=t}},actions:{},modules:{}},course:{namespaced:!0,state:{courseName:"",courseId:"",detailId:Number,baseCourseVersionName:"",baseCourseVersionFlag:"",baseCourseVersionId:"",baseCourseCourseId:"",baseCourseCourseName:"",baseCourseCourseCode:"",baseCourseCourseType:"",baseCourseCourseNature:"",baseCourseCredit:"",baseCourseCourseYear:"",baseCourseRemark:"",baseCourseDetailId:"",baseCourseKeyword:"",basecoursePaperAnalysisId:""},getters:{},mutations:{setbaseCourseDetailId:function(e,t){e.baseCourseDetailId=t},setCourseName:function(e,t){e.courseName=t},setCourseId:function(e,t){e.courseId=t},setDetailId:function(e,t){e.detailId=t},setbaseCourseVersionName:function(e,t){e.baseCourseVersionName=t},setbaseCourseVersionFlag:function(e,t){e.baseCourseVersionFlag=t},setbaseCourseVersionId:function(e,t){e.baseCourseVersionId=t},setbaseCourseCourseId:function(e,t){e.baseCourseCourseId=t},setbaseCourseCourseName:function(e,t){e.baseCourseCourseName=t},setbaseCourseCourseCode:function(e,t){e.baseCourseCourseCode=t},setbaseCourseCourseType:function(e,t){e.baseCourseCourseType=t},setbaseCourseCourseNature:function(e,t){e.baseCourseCourseNature=t},setbaseCourseCredit:function(e,t){e.baseCourseCredit=t},setbaseCourseCourseYear:function(e,t){e.baseCourseCourseYear=t},setbaseCourseRemark:function(e,t){e.baseCourseRemark=t},setbaseCourseKeyword:function(e,t){e.baseCourseKeyword=t},setbasecoursePaperAnalysisId:function(e,t){e.basecoursePaperAnalysisId=t}},actions:{},modules:{}},baseCourseDetailProgram:{namespaced:!0,state:{majorNum:"0",majorProgramId:Number,bcdmId:"",classId:"",courseCode:""},getters:{},mutations:{setmajorNum:function(e,t){e.majorNum=t},setmajorProgramId:function(e,t){e.majorProgramId=t},setmajorbcdmId:function(e,t){e.bcdmId=t},setmajorclassId:function(e,t){e.classId=t},setmajorcourseCode:function(e,t){e.courseCode=t}},actions:{},modules:{}},navInfo:{namespaced:!0,state:{activeDisplay1:0,activeDisplay2:0,activeDisplay3:0,activeDisplay4:0},getters:{},mutations:{setActiveDisplay1:function(e,t){e.activeDisplay1=t},setActiveDisplay2:function(e,t){e.activeDisplay2=t},setActiveDisplay3:function(e,t){e.activeDisplay3=t},setActiveDisplay4:function(e,t){e.activeDisplay4=t}},actions:{},modules:{}},user:v(),reviewInfo:{namespaced:!0,state:{message:"",checkState:""},getters:{},mutations:{setmessage:function(e,t){e.message=t},setcheckState:function(e,t){e.checkState=t}},actions:{},modules:{}}}});var y=o(75220),C=o(90033),A=function(e){return(0,l.Qi)("data-v-985c3190"),e=e(),(0,l.jt)(),e},F={class:"submenu"},w={class:"numSelectedTeacher"},S={layout:"row",flex:"",class:"md-padding"},_={class:"pagination-container",flex:""},E={class:"no-program"},N=A((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","margin-top":"100px","font-size":"22px"}}," 没有学生 ",-1)})),V=A((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center",color:"grey","font-size":"13px","margin-top":"30px"}}," 请先点击右上角圆形按钮添加学生 ",-1)})),x=[N,V],T={class:"no-program"},j=A((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","margin-top":"100px","font-size":"22px"}}," 未创建培养方案 ",-1)})),L=A((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center",color:"grey","font-size":"13px","margin-top":"30px"}}," 请先创建培养方案 ",-1)})),D=[j,L];function B(e,t,o,n,r,a){var s=(0,l.g2)("el-button"),c=(0,l.g2)("el-col"),u=(0,l.g2)("Delete"),d=(0,l.g2)("el-icon"),h=(0,l.g2)("el-row"),f=(0,l.g2)("HeaderSearch"),m=(0,l.g2)("addBtn"),p=(0,l.g2)("el-table-column"),b=(0,l.g2)("el-table");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bo)((0,l.Lk)("div",null,[(0,l.bo)((0,l.Lk)("div",F,[(0,l.bF)(h,null,{default:(0,l.k6)((function(){return[(0,l.bF)(c,{span:2,class:"columnstyle"},{default:(0,l.k6)((function(){return[(0,l.bF)(s,{onClick:t[0]||(t[0]=function(e){return a.toggleSelection()}),class:"clearSelected",link:""},{default:(0,l.k6)((function(){return[(0,l.eW)("取消选择")]})),_:1})]})),_:1}),(0,l.bF)(c,{span:16,class:"columnstyle"},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",w,"已选中 "+(0,C.v_)(r.numSelected)+" 位学生",1)]})),_:1}),(0,l.bF)(c,{span:4,class:"columnstyle"},{default:(0,l.k6)((function(){return[(0,l.bF)(s,{onClick:t[1]||(t[1]=function(e){return a.deleteStudent()}),class:"submenudeleteButton",link:""},{default:(0,l.k6)((function(){return[(0,l.bF)(d,null,{default:(0,l.k6)((function(){return[(0,l.bF)(u)]})),_:1})]})),_:1})]})),_:1})]})),_:1})],512),[[i.aG,r.closeShow]]),(0,l.bo)((0,l.bF)(f,{msg:"搜索学生名称",onSearchValue:a.getSearchValue},null,8,["onSearchValue"]),[[i.aG,!r.closeShow]]),(0,l.bF)(m,{onClick:a.goAddStudent},null,8,["onClick"]),(0,l.bo)((0,l.Lk)("div",S,[(0,l.bF)(b,{class:"studentsTable",data:r.studentsTable,ref:"multipleTable",style:{width:"40%"},"header-cell-style":{"padding-left":"40px","font-size":"14.4px",height:"48px","font-weight":"bold",color:"black"},"cell-style":{"padding-left":"40px","font-size":"16px",height:"60px"},onSelectionChange:a.handleSelectionChange},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{width:"100",type:"selection"}),(0,l.bF)(p,{prop:"studentNumber",label:"学号",width:"200"}),(0,l.bF)(p,{prop:"studentName",label:"姓名"})]})),_:1},8,["data","onSelectionChange"]),(0,l.Lk)("div",_,[(0,l.bF)(h,{type:"flex",justify:"center",align:"middle"},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(s,{onClick:t[2]||(t[2]=function(e){return a.loadmoreCourse()})},{default:(0,l.k6)((function(){return[(0,l.eW)("加载更多")]})),_:1},512),[[i.aG,r.showLoadmore&&r.hasProgram&&r.hasStudent]])]})),_:1})])],512),[[i.aG,r.hasStudent]]),(0,l.bo)((0,l.Lk)("div",E,x,512),[[i.aG,!r.hasStudent]])],512),[[i.aG,r.hasProgram]]),(0,l.bo)((0,l.Lk)("div",T,D,512),[[i.aG,!r.hasProgram]])],64)}var $=o(23772),O=(o(51629),o(44114),o(26099),o(23500),o(54119)),M=(o(16280),o(76918),o(34782),o(27495),o(25440),o(91250)),U="Admin-Token";function W(){return u.A.get(U)}const R={401:"认证失败，无法访问系统资源",403:"当前操作没有权限",404:"访问资源不存在",default:"系统未知错误，请反馈给管理员"};var P=o(77918),G=o(20163),z={show:!1};function Y(e){for(var t="",o=0,n=Object.keys(e);o<n.length;o++){var r=n[o],a=e[r],s=encodeURIComponent(r)+"=";if(null!==a&&""!==a&&"undefined"!==typeof a)if("object"===(0,O.A)(a))for(var i=0,l=Object.keys(a);i<l.length;i++){var c=l[i];if(null!==a[c]&&""!==a[c]&&"undefined"!==typeof a[c]){var u=r+"["+c+"]",d=encodeURIComponent(u)+"=";t+=d+encodeURIComponent(a[c])+"&"}}else t+=s+encodeURIComponent(a)+"&"}return t}M.A.defaults.headers["Content-Type"]="application/json;charset=utf-8";var X=M.A.create({baseURL:"https://jxjk.hdu.edu.cn/prod-api/",timeout:2e4});X.interceptors.request.use((function(e){var t=!1===(e.headers||{}).isToken,o=!1===(e.headers||{}).repeatSubmit,n=(W(),void 0===u.A.get("first-Login")||!1===u.A.get("first-Login"));if("/login"===e.url&&!n)return e;if(W()&&!t&&(e.headers["Authorization"]="Bearer "+W()),"get"===e.method&&e.params){var r=e.url+"?"+Y(e.params);r=r.slice(0,-1),e.params={},e.url=r}if(!o&&("post"===e.method||"put"===e.method))e.url,"object"===(0,O.A)(e.data)?JSON.stringify(e.data):e.data,(new Date).getTime();return e}),(function(e){console.log(e),Promise.reject(e)})),X.interceptors.response.use((function(e){if("application/octet-stream"===e.headers["content-type"])return e.data;var t=e.status||200,o=R[t]||e.data.msg||R["default"];return"blob"===e.request.responseType||"arraybuffer"===e.request.responseType?e.data:401===t?(z.show||(z.show=!0,P.s.confirm("登录状态已过期，您可以继续留在该页面，或者重新登录","",{confirmButtonText:"重新登录",cancelButtonText:"取消",type:"warning"}).then((function(){z.show=!1,u.A.remove("Admin-Token"),fb.replace({path:"/login"})}))["catch"]((function(){z.show=!1}))),Promise.reject("无效的会话，或者会话已过期，请重新登录。")):500===t?Promise.reject(new Error(o)):204===t?e.status:404===t?Promise.reject(new Error(o)):e.data}),(function(e){if(console.log("error",e),401!==e.response.status)return 404===e.response.status||422===e.response.status?Promise.reject(e.response):400===e.response.status?"用户不存在/密码错误"==e.response.data.msg?((0,G.nk)({type:"error",message:"密码错误",duration:1500}),Promise.reject(e.response.data)):((0,G.nk)({type:"error",message:e.response.data.msg,duration:1500}),Promise.reject(e)):Promise.reject(e.response);if("用户不存在/密码错误"==e.response.data.msg)return(0,G.nk)({type:"error",message:"密码错误",duration:1500}),Promise.reject(e.response.data);if("UNAUTHORIZED"==e.response.data.code){if(z.show)return Promise.reject(e.response.data);z.show=!0,P.s.confirm("登录状态已过期，您可以继续留在该页面，或者重新登录","",{confirmButtonText:"重新登录",cancelButtonText:"取消",type:"warning"}).then((function(){z.show=!1,u.A.remove("Admin-Token"),fb.replace({path:"/login"})}))["catch"]((function(){z.show=!1}))}else(0,G.nk)({type:"error",message:e.response.data.msg,duration:1500})}));const Q=X;var K={class:"Block"},J={class:"bar"},H={class:"searchBlock"},q={class:"searchLine"};function Z(e,t,o,n,r,a){var s=(0,l.g2)("Search"),c=(0,l.g2)("el-icon"),u=(0,l.g2)("el-input");return(0,l.uX)(),(0,l.CE)("div",K,[(0,l.Lk)("div",J,[(0,l.Lk)("div",H,[(0,l.bF)(c,{class:"iconSearch",size:"24px",color:"rgb(137, 137, 137)"},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1}),(0,l.Lk)("div",q,[(0,l.bF)(u,{ref:"searchInput",class:(0,C.C4)(["searchInput",r.active?"activeInput":""]),modelValue:r.keyword,"onUpdate:modelValue":t[0]||(t[0]=function(e){return r.keyword=e}),placeholder:o.msg,onFocus:t[1]||(t[1]=function(e){return r.active=!0}),onBlur:t[2]||(t[2]=function(e){return a.inputBlur()}),clearable:"",onClear:t[3]||(t[3]=function(e){return a.clearInput()}),onKeyup:(0,i.jR)(a.sendMessage,["enter"])},null,8,["class","modelValue","placeholder","onKeyup"])])]),(0,l.RG)(e.$slots,"rightTime",{class:"rightSlot"},void 0,!0),(0,l.RG)(e.$slots,"assignBtn",{class:"assignBtn"},void 0,!0),(0,l.RG)(e.$slots,"status",{class:"status"},void 0,!0)])])}var ee=o(48548);const te={name:"HeaderSearch",props:{msg:String,value:{type:String,default:""}},components:{Search:ee.vji},data:function(){return{keyword:this.value,active:!1}},watch:{keyword:function(e){this.$emit("SearchValue",e)},value:function(e){var t=this;this.keyword=e,""!==this.keyword&&this.$nextTick((function(){t.$refs.searchInput.focus()}))}},mounted:function(){var e=this;console.log(this.keyword,""===this.keyword),""!==this.keyword&&this.$nextTick((function(){e.$refs.searchInput.focus()}))},methods:{sendMessage:function(){this.$emit("SearchValue",this.keyword)},inputBlur:function(){""===this.keyword?this.active=!1:this.active=!0},clearInput:function(){this.keyword="",this.inputBlur()}}},oe=(0,h.A)(te,[["render",Z],["__scopeId","data-v-7bb06d81"]]),ne=oe;var re={class:"addBtnBlock"};function ae(e,t,o,n,r,a){var s=(0,l.g2)("el-button");return(0,l.uX)(),(0,l.CE)("div",re,[(0,l.bF)(s,{class:"addBtn",color:"#626aef",plain:"",type:"primary"},{default:(0,l.k6)((function(){return[(0,l.eW)("+ ")]})),_:1})])}const se={name:"addBtn",components:{Plus:ee.FWt}},ie=(0,h.A)(se,[["render",ae],["__scopeId","data-v-60c55a4a"]]),le=ie;var ce=o(50953),ue=o(94650),de=o(91361),he=o(82298),fe=o(3671),me=o(21857),pe=o(92066),be=o(12085),ge=o(80514),ke=o(54588);function ve(e,t){return Q({url:"/program/"+e+"/"+t,method:"get"})}function Ie(e){return Q({url:"/program/"+e,method:"get"})}function ye(e,t,o,n){return Q({url:"/program/add",method:"POST",data:{majorId:e,departmentId:t,schoolId:o,enrollyear:n}})}function Ce(e){return Q({url:"/program/edit",method:"POST",data:e})}function Ae(e,t,o,n){return Q({url:"/program/listCoreBaseCourse",method:"GET",params:{departmentId:e,programId:t,programIndicatorId:o,schoolId:n}})}function Fe(e,t,o,n){return Q({url:"/program/list",method:"get",params:{schoolId:e,departmentId:t,selectKeyWord:o,enrollyear:n}})}const we={name:"Student",components:(0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)({request:Q,ElTooltip:ue.R7,ElIcon:de.tk,ElInput:he.WK,ElForm:fe.US,ElButton:me.S2,ElTable:pe.Up,ElMessage:G.nk,ElMessageBox:P.s,Back:ee.kcb,FolderChecked:ee.KHk,InfoFilled:ee.N_H,Loading:ee.Rhj,Search:ee.vji,Close:ee.bm,Plus:ee.FWt,Delete:ee.epd,ElDialog:be.kZ,ref:ce.KR,reactive:ce.Kh},"Delete",ee.epd),"Edit",ee.ffu),"HeaderSearch",ne),"addBtn",le),"MoreFilled",ee.yGC),"ElDropdown",ge.dW),"ArrowDown",ee.yd$),"Document",ee.yoT),"ElTag",ke.u),computed:{yearChange:function(){return this.$store.state.currentInfo.year}},watch:{yearChange:{deep:!0,handler:function(e){this.checkCurrentProgram()}}},methods:{checkCurrentProgram:function(){var e=this;console.log("year has changed"),ve(this.majorId,this.$store.state.currentInfo.year).then((function(t){console.log("res",t),"操作成功"==t.msg&&"SUCCESS"===t.code&&(e.hasProgram=!0,e.programId=t.data.programId,e.$store.commit("major/setProgramId",e.programId)),console.log("current programId:",e.programId),e.getStudents(e.pageSize,e.pageNum)}))["catch"]((function(t){console.log("e",t),"PROGRAM_NOT_FIND"==t.code&&(e.hasProgram=!1)}))},getSearchValue:function(e){this.keyword=e,this.getStudents(this.pageSize,this.pageNum)},toggleSelection:function(e){var t=this;e?e.forEach((function(e){t.$refs.multipleTable.toggleRowSelection(e)})):(this.$refs.multipleTable.clearSelection(),1==this.clickState&&(this.clickState=0,this.closeShow=!this.closeShow))},deleteStudent:function(){console.log("delete student"),P.s.confirm("是否确认删除学生信息","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){console.log("delete!")}))["catch"]((function(){}))},handleSelectionChange:function(e){var t=[];this.multipleSelection=e,console.log("选中的信息：",e),e.forEach((function(e){var o=e.studentId;t.push(o)})),this.numSelected=this.multipleSelection.length,1!=this.clickState&&(this.closeShow=!this.closeShow,this.clickState=1),1==this.clickState&&0==this.numSelected&&(this.clickState=0,this.closeShow=!this.closeShow),this.studentId=t,console.log("studentId:",this.studentId)},loadmoreCourse:function(){this.result.total-this.pageSize>=20?(this.pageSize+=20,this.getStudents(this.pageSize,this.pageNum)):(this.pageSize+=this.result.total-this.pageSize,this.getStudents(this.pageSize,this.pageNum))},goAddStudent:function(){console.log("go add student"),this.$router.push("/baseAddStudent")},getStudents:function(e,t){var o=this,n=[];return Q({url:"/student/listByProgram",method:"get",params:{pageSize:e,pageNum:t,programId:this.programId,schoolId:this.schoolId,departmentId:this.departmentId,selectKeyWord:this.keyword}}).then((function(t){console.log("student:",t),t.total?(o.hasStudent=!0,o.hasNoStudent=!1,t.rows.forEach((function(e){e.studentName=e.studentName,e.studentNumber=e.studentNumber,n.push(e)})),o.studentsTable=n,o.result=t,e>=t.total&&(o.showLoadmore=!1)):(o.hasStudent=!1,o.hasNoStudent=!0,o.showLoadmore=!1)}))["catch"]((function(e){console.log("e",e)}))}},data:function(){return{keyword:"",studentId:[],schoolId:"",departmentId:"",closeShow:!1,clickState:0,numSelected:0,multipleSelection:[],result:{},pageSize:20,pageNum:1,showLoadmore:!0,hasProgram:!1,hasNoProgram:!1,hasStudent:!1,hasNoStudent:!1,programId:"",studentsTable:[]}},mounted:function(){this.departmentId=this.$store.state.currentInfo.departmentId,this.schoolId=this.$store.state.currentInfo.schoolId,this.majorId=this.$store.state.major.majorId,this.programId=this.$store.state.major.programId,this.checkCurrentProgram()}},Se=(0,h.A)(we,[["render",B],["__scopeId","data-v-985c3190"]]),_e=Se;var Ee=function(e){return(0,l.Qi)("data-v-28d4b034"),e=e(),(0,l.jt)(),e},Ne={key:0,layout:"column",flex:"",class:"ng-scope layout-column flex"},Ve={class:"submenu"},xe=Ee((function(){return(0,l.Lk)("span",{class:"displayCenter"},"可直接从excel拷贝；可拖动列的顺序；学院最多可添加2000个学生",-1)})),Te={layout:"row",flex:"",class:"md-padding"},je={class:"hot-table-container",layout:"column",flex:"","layout-align":"start center"};function Le(e,t,o,n,r,a){var s=(0,l.g2)("Back"),i=(0,l.g2)("el-icon"),c=(0,l.g2)("el-tooltip"),u=(0,l.g2)("el-divider"),d=(0,l.g2)("DocumentChecked"),h=(0,l.g2)("el-button"),f=(0,l.g2)("InfoFilled"),m=(0,l.g2)("el-row"),p=(0,l.g2)("hot-column"),b=(0,l.g2)("hot-table");return r.isRouterAlive?((0,l.uX)(),(0,l.CE)("div",Ne,[(0,l.Lk)("div",Ve,[(0,l.bF)(m,{class:"toolbar"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{content:"返回"},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{size:22,style:{cursor:"pointer"},class:"button-back",onClick:a.goTeacher},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1},8,["onClick"])]})),_:1}),(0,l.bF)(u,{class:"divider",direction:"vertical"}),(0,l.bF)(c,{content:"保存",disabled:!a.isValid()},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{"aria-label":"保存",onClick:a.save,link:"",disabled:!a.isValid()},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{size:22},{default:(0,l.k6)((function(){return[(0,l.bF)(d)]})),_:1})]})),_:1},8,["onClick","disabled"])]})),_:1},8,["disabled"]),(0,l.bF)(i,{size:22,class:"button-back"},{default:(0,l.k6)((function(){return[(0,l.bF)(f)]})),_:1}),xe]})),_:1})]),(0,l.Lk)("div",Te,[(0,l.Lk)("div",je,[(0,l.bF)(b,{settings:r.hotSettings,data:r.db.items,"onUpdate:data":t[0]||(t[0]=function(e){return r.db.items=e}),width:"450",style:{"line-height":"100px","text-align":"center",margin:"auto"},class:"hotTable"},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{data:"studentNumber",title:"学号",width:"200",height:"20"}),(0,l.bF)(p,{data:"studentName",title:"姓名",width:"200",height:"20"})]})),_:1},8,["settings","data"])])])])):(0,l.Q3)("",!0)}var De=o(42751),Be=o(66874),$e=o(1426);o(68525);(function(e){function t(e,t){/.+@.+/.test(e)?t(!0):t(!1)}e.validators.registerValidator("emailcheck",t)})($e.Ay);o(4188),o(19830);const Oe={name:"addStudent",data:function(){var e=this;return{firstActivities:!0,departmentId:"",schoolId:"",programId:"",isRouterAlive:!0,dirty:!1,saving:!1,count:0,localres:{},postData:{students:[]},db:{items:[]},fromCourseBatchAdd:!1,hotSettings:{licenseKey:"non-commercial-and-evaluation",colHeaders:!0,rowHeaders:!0,minSpareRows:1,preventOverflow:"horizontal",manualColumnMove:!0,contextMenu:{items:{row_above:{name:"在上方插入行"},row_below:{name:"在下方插入行"},remove_row:{name:"删除行"}}},afterChange:function(t,o){"loadData"!==o?(0==e.count?(e.dirty=!1,console.log("console:",e.count),console.log("different",e.dirty)):(e.dirty=!0,e.firstActivities=!1,console.log("console:",e.count),console.log("different",e.dirty)),e.count++,console.log("console:",e.count)):console.log("same")}}}},components:{ref:ce.KR,onMounted:l.sV,reactive:ce.Kh,HotTable:De.sH,HotColumn:De.gQ,registerAllModules:Be.um,ElTooltip:ue.R7,ElIcon:de.tk,ElInput:he.WK,Handsontable:$e.Ay,Back:ee.kcb,FolderChecked:ee.KHk,InfoFilled:ee.N_H,Loading:ee.Rhj,Download:ee.f5X,UploadFilled:ee.m8m,DocumentAdd:ee.pT5,ElMessage:G.nk,ElMessageBox:P.s,DocumentChecked:ee.Fmj},methods:{activate:function(){this.departmentId=this.$store.state.currentInfo.departmentId,this.schoolId=this.$store.state.currentInfo.schoolId,this.programId=this.$store.state.major.programId},isValid:function(){if(this.firstActivities)return!1;var e=this.toPostData();return!!e},isNotDirty:function(){this.dirty=!1},save:function(){this.saving=!0;var e=this.isValid();if(e){if(!this.postData.students||this.postData.students.length<=0)return console.log("学生姓名或者学号为空");var t=[];this.postData.students.forEach((function(e){t.push(e)})),console.log("studentList:",t);var o=this;this.addTeacher(t).then((function(e){console.log("res:",e),o.firstActivities=!0,"SUCCESS"==e.code&&((0,G.nk)({type:"success",message:"新建成功",duration:1500}),o.isNotDirty(),o.goBackandClean())}))["catch"]((function(e){500==e.status?(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500}):409===e.status?(0,G.nk)({type:"error",message:"新建失败,教师已存在",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500}),o.isNotDirty(),o.goBackandClean()}))}else this.saving=!1},toPostData:function(){var e=this;this.postData.students.length=0;var t=this.postData.students,o=!0;return this.db.items.forEach((function(n){if(n.studentNumber=n.studentNumber,n.studentName=n.studentName,!n.studentNumber||!n.studentName)return n.studentNumber||n.studentName?void(o=!1):void 0;var r={studentNumber:n.studentNumber,programId:e.programId,studentName:n.studentName,departmentId:e.departmentId,schoolId:e.schoolId};t.push(r)})),o},goBackandClean:function(){this.db.items=[],this.postData.students=[],console.log("datas:",this.db.items,this.postData.students),this.reload()},reload:function(){this.isRouterAlive=!1,this.count=0,this.$nextTick((function(){this.isRouterAlive=!0}))},goTeacher:function(){var e=this;console.log("goteacher:"+this.saving+this.dirty),1==this.dirty||0==this.saving&&1==this.dirty?P.s.confirm("数据还未保存，是否仍然关闭？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.$router.push({path:"/student"})}))["catch"]((function(){})):this.$router.push({path:"/student"})},addTeacher:function(e){var t;return console.log("postData:",e),Q({url:"/student/addStudents",method:"post",data:e}).then((function(e){return t=e,t}))}},mounted:function(){this.activate()}},Me=(0,h.A)(Oe,[["render",Le],["__scopeId","data-v-28d4b034"]]),Ue=Me;o(52675),o(89463),o(62010);var We=function(e){return(0,l.Qi)("data-v-3ac2874c"),e=e(),(0,l.jt)(),e},Re={class:"content"},Pe={class:"body-check"},Ge={key:0,class:"noAttribute"},ze=We((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","margin-top":"100px","font-size":"22px"}}," 未创建毕业要求 ",-1)})),Ye=We((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center",color:"grey","font-size":"13px","margin-top":"30px"}}," 请先创建毕业要求 ",-1)})),Xe=[ze,Ye],Qe={key:1,class:"card"},Ke={class:"attribute"},Je={class:"two-digits"},He={class:"num-title"},qe={class:"num-wrap"},Ze={class:"title-text"},et=We((function(){return(0,l.Lk)("section",{class:"rotate-bar"},null,-1)})),tt={class:"attribute-content"},ot={class:"name"},nt={class:"desc"},rt={class:"attribute-detail"},at={class:"detail-num"},st={class:"detail-content"},it={class:"name"},lt={class:"desc"},ct={class:"support-course",style:{margin:"30px 0 30px 120px"}},ut={class:"support-head"},dt=We((function(){return(0,l.Lk)("span",{style:{color:"grey","font-size":"14px"}},"支撑课程",-1)})),ht={class:"penIcon"},ft={class:"methods",style:{margin:"20px 0 20px 100px"}},mt={class:"no-program"},pt=We((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","margin-top":"100px","font-size":"22px"}}," 未创建培养方案 ",-1)})),bt=We((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center",color:"grey","font-size":"13px","margin-top":"30px"}}," 请先创建培养方案 ",-1)})),gt=[pt,bt],kt={style:{display:"flex","flex-direction":"row"}},vt={style:{"margin-top":"35px"}},It={class:"dialog-footer"};function yt(e,t,o,n,r,a){var s=this,c=(0,l.g2)("EditPen"),u=(0,l.g2)("el-icon"),d=(0,l.g2)("el-tooltip"),h=(0,l.g2)("el-col"),f=(0,l.g2)("el-row"),m=(0,l.g2)("Edit"),p=(0,l.g2)("el-input"),b=(0,l.g2)("DocumentChecked"),g=(0,l.g2)("Close"),k=(0,l.g2)("Plus"),v=(0,l.g2)("el-button"),I=(0,l.g2)("el-autocomplete"),y=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)("div",Re,[(0,l.bo)((0,l.Lk)("div",Pe,[r.hasAttribute?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",Ge,Xe)),r.hasAttribute?((0,l.uX)(),(0,l.CE)("div",Qe,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.requirements,(function(e,t){return(0,l.uX)(),(0,l.CE)("div",{class:"graduate-attribute",key:e.id},[(0,l.Lk)("div",Ke,[(0,l.Lk)("div",Je,[(0,l.Lk)("section",He,[(0,l.Lk)("section",qe,[(0,l.Lk)("span",Ze,(0,C.v_)(e.serialNum),1)]),et])]),(0,l.Lk)("div",tt,[(0,l.Lk)("div",ot,(0,C.v_)(e.name),1),(0,l.Lk)("div",nt,(0,C.v_)(e.description),1)])]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.programIndicators,(function(o,n){return(0,l.uX)(),(0,l.CE)("div",{key:o.id},[(0,l.Lk)("div",rt,[(0,l.Lk)("div",at,(0,C.v_)(o.serialNum),1),(0,l.Lk)("div",st,[(0,l.Lk)("div",it,(0,C.v_)(o.name),1),(0,l.Lk)("div",lt,(0,C.v_)(o.description),1)])]),(0,l.Lk)("div",ct,[(0,l.Lk)("div",ut,[dt,(0,l.Lk)("div",ht,[(0,l.bF)(d,{effect:"dark",content:"编辑",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"pen-icon",onClick:function(r){return a.editSupportCourse(e,o,t,n)}},{default:(0,l.k6)((function(){return[(0,l.bF)(c)]})),_:2},1032,["onClick"])]})),_:2},1024)])]),(0,l.Lk)("div",ft,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.coreBaseCourses,(function(e){return(0,l.uX)(),(0,l.Wv)(f,{key:e.id,style:{"margin-top":"20px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{span:8,class:"method-weight"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.courseName),1)]})),_:2},1024),(0,l.bF)(d,{effect:"dark",content:"权重",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{span:8,class:"method-desc",style:{"margin-left":"80px"}},{default:(0,l.k6)((function(){return[(0,l.eW)("（ "+(0,C.v_)(e.weight)+"% ）",1)]})),_:2},1024)]})),_:2},1024)]})),_:2},1024)})),128))])])])})),128))])})),128))])):(0,l.Q3)("",!0)],512),[[i.aG,r.hasProgram]]),(0,l.bo)((0,l.Lk)("div",mt,gt,512),[[i.aG,r.noProgram]]),(0,l.Lk)("div",null,[(0,l.bF)(y,{modelValue:r.dialogFormVisible,"onUpdate:modelValue":t[6]||(t[6]=function(e){return r.dialogFormVisible=e}),title:"设置支撑课程",width:"640px","show-close":!1,"align-center":!0},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",It,[(0,l.bF)(v,{onClick:t[4]||(t[4]=function(e){return a.cancelAddCoreBaseCourse(r.dialogDetail)})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(v,{type:"primary",onClick:t[5]||(t[5]=function(e){return a.confirmAddCoreBaseCourse(r.dialogDetail)})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(f,{style:{"margin-bottom":"10px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{span:7,style:{"font-weight":"bold","font-size":"16px"}},{default:(0,l.k6)((function(){return[(0,l.eW)(" 毕业要求"+(0,C.v_)(r.dialogDetail.serialNum)+"："+(0,C.v_)(r.dialogDetail.name),1)]})),_:1}),(0,l.bF)(h,{span:17,style:{"font-size":"16px"}},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(r.dialogDetail.description),1)]})),_:1})]})),_:1}),(0,l.bF)(f,{style:{"margin-bottom":"20px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{span:6,style:{"font-weight":"bold","font-size":"16px"}},{default:(0,l.k6)((function(){return[(0,l.eW)("指标点"+(0,C.v_)(r.dialogDetail.programIndicators[r.index2].serialNum)+"："+(0,C.v_)(r.dialogDetail.programIndicators[r.index2].name),1)]})),_:1}),(0,l.bF)(h,{span:17},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(r.dialogDetail.programIndicators.description),1)]})),_:1})]})),_:1}),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.dialogDetail.programIndicators,(function(e){return(0,l.uX)(),(0,l.Wv)(h,{key:e.id},{default:(0,l.k6)((function(){return[(0,l.bF)(f,null,{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.coreBaseCourses,(function(t,o){return(0,l.uX)(),(0,l.Wv)(h,{class:"coreBaseCourse",key:t.id,style:{"margin-top":"20px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(f,null,{default:(0,l.k6)((function(){return[(0,l.bF)(h,{span:1}),(0,l.bo)((0,l.bF)(h,{span:4,class:"showWeight"},{default:(0,l.k6)((function(){return[(0,l.bF)(f,null,{default:(0,l.k6)((function(){return[(0,l.bF)(h,{span:12},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(t.weight)+"% ",1)]})),_:2},1024),(0,l.bF)(h,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"edit-icon",onClick:function(e){return a.editWeight(t)}},{default:(0,l.k6)((function(){return[(0,l.bF)(m)]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1536),[[i.aG,!t.isEditWeight]]),(0,l.bo)((0,l.bF)(h,{span:4,class:"editWeight"},{default:(0,l.k6)((function(){return[(0,l.bF)(f,null,{default:(0,l.k6)((function(){return[(0,l.bF)(h,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{modelValue:t.weight,"onUpdate:modelValue":function(e){return t.weight=e}},null,8,["modelValue","onUpdate:modelValue"])]})),_:2},1024),(0,l.bF)(h,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"edit-icon",onClick:function(e){return a.saveWeight(t)}},{default:(0,l.k6)((function(){return[(0,l.bF)(b)]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1536),[[i.aG,t.isEditWeight]]),(0,l.bF)(h,{span:16,style:{"font-size":"16px"}},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(t.courseName),1)]})),_:2},1024),(0,l.bF)(h,{span:3},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"close-icon",onClick:function(t){return a.deleteCourse(e,o)}},{default:(0,l.k6)((function(){return[(0,l.bF)(g)]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1024)})),128))]})),_:2},1024)]})),_:2},1024)})),128)),(0,l.bo)((0,l.bF)(v,{class:"add-support-button",style:{color:"#6573c0","margin-top":"30px"},text:"",onClick:t[0]||(t[0]=function(e){return s.newCoreCourse=!0})},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{size:18,color:"#586dbe"},{default:(0,l.k6)((function(){return[(0,l.bF)(k)]})),_:1}),(0,l.eW)(" 新增支撑课程 ")]})),_:1},512),[[i.aG,!r.newCoreCourse]]),(0,l.bo)((0,l.Lk)("div",kt,[(0,l.bF)(I,{"popper-class":"el-autocomplete-suggestion","popper-append-to-body":!1,modelValue:r.searchValue,"onUpdate:modelValue":t[1]||(t[1]=function(e){return r.searchValue=e}),"fetch-suggestions":a.querySearch,placeholder:"选择课程（筛选可输入文字）",style:{width:"680px","margin-left":"20px","margin-top":"30px"},"fit-input-width":!0,onSelect:t[2]||(t[2]=function(e){return a.addCoreBaseCourse(r.searchValue,r.index1,r.index2)})},null,8,["modelValue","fetch-suggestions"]),(0,l.Lk)("div",vt,[(0,l.bF)(u,{class:"autocomplete-icon",onClick:t[3]||(t[3]=function(e){return s.newCoreCourse=!1})},{default:(0,l.k6)((function(){return[(0,l.bF)(g)]})),_:1})])],512),[[i.aG,r.newCoreCourse]])]})),_:1},8,["modelValue"])])])}o(2008),o(48980),o(25276),o(54554);const Ct={name:"Achieve",components:{EditPen:ee.EDh,addBtn:le,DocumentChecked:ee.Fmj,Plus:ee.FWt,Delete:ee.epd,Close:ee.bm,Edit:ee.ffu},data:function(){return{hasProgram:!1,noProgram:!1,hasAttribute:Boolean,currentMajorId:"",currentMajorName:"",currentSchoolId:"",currentYear:"",currentDepartmentId:"",dialogFormVisible:!1,formLabelWidth:"120px",addProgramForm:{major:"",enrollyear:""},totalInfo:[],requirements:null,programId:"",dialogDetail:[],index1:Number,index2:Number,newCoreCourse:!1,searchValue:"",allCoreBaseCourse:[],programIndicatorId:"",temp:[]}},mounted:function(){this.currentMajorId=this.$store.state.major.majorId,this.currentMajorName=this.$store.state.major.majorName,this.currentSchoolId=this.$store.state.currentInfo.schoolId,this.currentDepartmentId=this.$store.state.currentInfo.departmentId,this.currentYear=this.$store.state.currentInfo.year,this.addProgramForm.major=this.currentMajorName,this.addProgramForm.enrollyear=this.$store.state.currentInfo.year,this.checkProgram()},computed:{yearChange:function(){return this.$store.state.currentInfo.year}},watch:{yearChange:{deep:!0,handler:function(e){this.checkProgram()}}},methods:{goEdit:function(){this.$router.push({path:"/edit",query:{programId:this.programId}})},editSupportCourse:function(e,t,o,n){this.dialogFormVisible=!0,this.index1=o,this.index2=n,console.log("index1",this.index1),console.log("index2",this.index2),console.log("attribute",e),this.dialogDetail=JSON.parse(JSON.stringify(e));var r=JSON.parse(JSON.stringify(e.programIndicators));this.dialogDetail.programIndicators=r,console.log("a",r),console.log("1dialogDetail",this.dialogDetail);var a=JSON.parse(JSON.stringify(t));this.programIndicatorId=this.dialogDetail.programIndicators[n].id,null===this.dialogDetail.programIndicators[n].coreBaseCourses&&(this.dialogDetail.programIndicators[n].coreBaseCourses=[]),this.getCoreBaseCourseList(),console.log("dialogDetail",this.dialogDetail),this.temp=JSON.parse(JSON.stringify(a)),console.log("temp",this.temp)},checkProgram:function(){var e=this;ve(this.currentMajorId,this.$store.state.currentInfo.year).then((function(t){console.log("checkProgram",t),"未查到"==t.msg&&"SUCCESS"==t.code&&(e.hasProgram=!1,e.noProgram=!0,e.$store.commit("major/setProgramId","")),"操作成功"==t.msg&&"SUCCESS"==t.code&&(e.noProgram=!1,e.hasProgram=!0,e.programId=t.data.programId,e.$store.commit("major/setProgramId",e.programId),null===t.data.graduateAttributes?(e.hasAttribute=!1,console.log(e.hasAttribute)):(e.requirements=t.data.graduateAttributes,e.requirements.forEach((function(e){e.programIndicators.forEach((function(e){null===e.coreBaseCourses&&(e.coreBaseCourses=[])}))}))),e.totalInfo=t.data,console.log("requirements",e.requirements),null!==e.requirements&&0==e.requirements.length&&(e.hasAttribute=!1),null!==e.requirements&&(e.hasAttribute=!0)),console.log(e.hasAttribute)}))["catch"]((function(t){"资源不存在"==t.msg&&"PROGRAM_NOT_FIND"==t.code&&(e.hasProgram=!1,e.noProgram=!0,e.$store.commit("major/setProgramId",""))}))},getCoreBaseCourseList:function(){var e=this;Ae(this.currentDepartmentId,this.programId,this.programIndicatorId,this.currentSchoolId).then((function(t){"SUCCESS"==t.code&&(e.allCoreBaseCourse=t.data,console.log("allCoreBaseCourse",e.allCoreBaseCourse))}))},querySearch:function(e,t){var o=this.allCoreBaseCourse,n=e?o.filter(this.createStateFilter(e)):o;n.forEach((function(e){e.value=e.courseName})),console.log("result后",n),t(n),clearTimeout(this.timeout),this.timeout=setTimeout((function(){t(n)}),3e3*Math.random())},createStateFilter:function(e){return function(t){return-1!==t.value.toLowerCase().indexOf(e.toLowerCase())}},addCoreBaseCourse:function(e,t,o){var n=this;try{console.log(e,t,o);var r={};r.courseName=e;var a=this.allCoreBaseCourse.findIndex((function(e){return e.courseName===r.courseName}));r.courseId=this.allCoreBaseCourse[a].courseId,r.bcdmId=this.allCoreBaseCourse[a].bcdmId,r.id=Number,this.allCoreBaseCourse.forEach((function(t){(t.value=e)&&(r.id=t.courseId)})),r.weight=0,r.achievement=Number,r.isEditWeight=!1,this.requirements[t].programIndicators[o].coreBaseCourses.forEach((function(t){if(console.log("item",t,t.courseName==e),t.courseName==e)throw G.nk.error(e+"已存在"),n.newCoreCourse=!1,n.searchValue="","true"})),this.dialogDetail.programIndicators[o].coreBaseCourses.push(r),this.newCoreCourse=!1,this.searchValue="",console.log("requirements.programIndicators",this.requirements[t].programIndicators[o],"dialogDetail",this.dialogDetail,"newCoreBaseCourse",r)}catch(s){if("true"==s)return}},confirmAddCoreBaseCourse:function(e){var t=this;console.log("@",e,this.index2);var o=e.programIndicators[this.index2];console.log("temp",o),this.requirements[this.index1].programIndicators[this.index2]=o;var n=0,r=!1,a=!1;0==o.coreBaseCourses.length&&(r=!0,a=!1,n=100),0==!o.coreBaseCourses.length&&(r=!1,o.coreBaseCourses.forEach((function(e){n+=Number(e.weight),"0"==e.weight&&(a=!0)}))),1==r&&G.nk.error("请为指标点选择支撑课程"),1==a&&G.nk.error("权重范围在1%-100%"),100!==n&&G.nk.error("权重之和必须为100%"),100==n&&0==r&&0==a&&Ce(this.totalInfo).then((function(e){console.log("confirmAddCoreBaseCourse",e),"SUCCESS"==e.code&&((0,G.nk)({type:"success",message:"新建成功",duration:1500}),t.dialogFormVisible=!1)}))},cancelAddCoreBaseCourse:function(e){console.log("dialogDetail",e),this.requirements[this.index1].programIndicators[this.index2]=this.temp,this.dialogFormVisible=!1},editWeight:function(e){e.isEditWeight=!0},saveWeight:function(e){Number(e.weight)>100||Number(e.weight)<=0?G.nk.error("权重范围在1%-100%"):e.isEditWeight=!1},deleteCourse:function(e,t){this.temp=JSON.parse(JSON.stringify(e)),e.coreBaseCourses.splice(t,1),this.requirements[this.index1].programIndicators[this.index2]=e}}},At=(0,h.A)(Ct,[["render",yt],["__scopeId","data-v-3ac2874c"]]),Ft=At;var wt=function(e){return(0,l.Qi)("data-v-7f9280d4"),e=e(),(0,l.jt)(),e},St={class:"rightSlot"},_t={class:"selectionBar"},Et={class:"submenu"},Nt={class:"numSelectedCourse"},Vt={layout:"row",flex:"",class:"md-padding"},xt={class:"el-table-container"},Tt={class:"dialog-footer"},jt={class:"no-program"},Lt={layout:"row",flex:"",class:"md-padding"},Dt=wt((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","margin-top":"100px","font-size":"22px"}}," 没有课程 ",-1)})),Bt=wt((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center",color:"grey","font-size":"13px","margin-top":"30px"}}," 请先点击右上角圆形按钮添加课程 ",-1)})),$t={style:{"margin-top":"7px",width:"150px"}},Ot=wt((function(){return(0,l.Lk)("div",{style:{width:"1px"}},null,-1)})),Mt={class:"drawerBlock",flex:""},Ut={style:{flex:"auto"},class:"drawerFooter"},Wt={class:"pagination-container",flex:""},Rt={class:"no-program"},Pt=wt((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","margin-top":"100px","font-size":"22px"}}," 未创建培养方案 ",-1)})),Gt=wt((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center",color:"grey","margin-top":"30px","font-size":"13px"}}," 请先创建培养方案 ",-1)})),zt=[Pt,Gt];function Yt(e,t,o,n,r,a){var s=this,c=(0,l.g2)("el-option"),u=(0,l.g2)("el-select"),d=(0,l.g2)("HeaderSearch"),h=(0,l.g2)("el-button"),f=(0,l.g2)("el-col"),m=(0,l.g2)("MoreFilled"),p=(0,l.g2)("el-icon"),b=(0,l.g2)("Delete"),g=(0,l.g2)("el-dropdown-item"),k=(0,l.g2)("el-dropdown-menu"),v=(0,l.g2)("el-dropdown"),I=(0,l.g2)("el-row"),y=(0,l.g2)("addBtn"),A=(0,l.g2)("el-table-column"),F=(0,l.g2)("el-table"),w=(0,l.g2)("el-input"),S=(0,l.g2)("el-form-item"),_=(0,l.g2)("el-form"),E=(0,l.g2)("el-dialog"),N=(0,l.g2)("Plus"),V=(0,l.g2)("el-tag"),x=(0,l.g2)("el-tooltip"),T=(0,l.g2)("el-drawer");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bo)((0,l.Lk)("div",null,[(0,l.bo)((0,l.Lk)("div",null,[(0,l.bo)((0,l.Lk)("div",null,[(0,l.bF)(d,{msg:"搜索课程名称",onSearchValue:a.getSearchValueformProgram,value:r.keywordforProgrameCourse},{rightTime:(0,l.k6)((function(){return[(0,l.Lk)("div",St,[(0,l.Lk)("div",_t,[(0,l.bF)(u,{modelValue:r.option1.value,"onUpdate:modelValue":t[0]||(t[0]=function(e){return r.option1.value=e}),class:"selecter",placeholder:"更新时间⬇",onChange:a.selectionOption1},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.option1,(function(e){return(0,l.uX)(),(0,l.Wv)(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue","onChange"]),(0,l.bF)(u,{modelValue:r.option2.value,"onUpdate:modelValue":t[1]||(t[1]=function(e){return r.option2.value=e}),class:"selecter",placeholder:"全部",onChange:a.selectionOption2},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.option2,(function(e){return(0,l.uX)(),(0,l.Wv)(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue","onChange"])])])]})),_:1},8,["onSearchValue","value"])],512),[[i.aG,!r.closeShow]]),(0,l.bo)((0,l.Lk)("div",Et,[(0,l.bF)(I,{class:"rowStyle"},{default:(0,l.k6)((function(){return[(0,l.bF)(f,{span:2},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{onClick:t[2]||(t[2]=function(e){return s.toggleSelection()}),style:{float:"right"},class:"clearSelected"},{default:(0,l.k6)((function(){return[(0,l.eW)("取消选择")]})),_:1})]})),_:1}),(0,l.bF)(f,{span:16},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",Nt,"已选中 "+(0,C.v_)(r.numSelected)+" 门课程",1)]})),_:1}),(0,l.bF)(f,{span:4},{default:(0,l.k6)((function(){return[(0,l.bF)(v,{class:"dropdownstyle"},{dropdown:(0,l.k6)((function(){return[(0,l.bF)(k,null,{default:(0,l.k6)((function(){return[(0,l.bF)(g,{onClick:t[3]||(t[3]=function(e){return s.deleteBaseCourse()})},{default:(0,l.k6)((function(){return[(0,l.bF)(p,null,{default:(0,l.k6)((function(){return[(0,l.bF)(b)]})),_:1}),(0,l.eW)("  删除课程 ")]})),_:1})]})),_:1})]})),default:(0,l.k6)((function(){return[(0,l.bF)(p,{class:"dropdownIcon"},{default:(0,l.k6)((function(){return[(0,l.bF)(m)]})),_:1})]})),_:1})]})),_:1})]})),_:1})],512),[[i.aG,r.closeShow]]),(0,l.Lk)("div",Vt,[(0,l.bF)(y,{onClick:t[4]||(t[4]=function(e){return s.drawerShow()})}),(0,l.Lk)("div",xt,[(0,l.bF)(F,{data:r.drawertableData,ref:"multipleTable",style:{width:"1135px"},"header-cell-style":{"padding-left":"20px","font-size":"14.4px",height:"48px","font-weight":"bold",color:"black"},"cell-style":{"padding-left":"20px","font-size":"16px",height:"60px","text-overflow":"ellipsis","white-space":"nowrap",cursor:"pointer"},"row-key":a.rowKey,onRowClick:a.goBaseCourseDetail,onSelectionChange:a.handleSelectionChange},{default:(0,l.k6)((function(){return[(0,l.bF)(A,{type:"selection",width:"55","column-key":"select","reserve-selection":!0}),(0,l.bF)(A,{prop:"courseName",label:"课程名",width:"180"}),(0,l.bF)(A,{prop:"courseCode",label:"课程号",width:"180"}),(0,l.bF)(A,{prop:"courseType",label:"课程类型",width:"180"}),(0,l.bF)(A,{prop:"courseNature",label:"课程性质",width:"180"}),(0,l.bF)(A,{prop:"credit",label:"学分",width:"180"}),(0,l.bF)(A,{prop:"versionName",label:"版本",width:"180"})]})),_:1},8,["data","row-key","onRowClick","onSelectionChange"])])]),(0,l.bF)(E,{modelValue:r.dialogFormVisible1,"onUpdate:modelValue":t[13]||(t[13]=function(e){return r.dialogFormVisible1=e}),title:"修改基础课程"},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",Tt,[(0,l.bF)(h,{onClick:t[12]||(t[12]=function(e){return r.dialogFormVisible1=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(h,{type:"primary",onClick:a.editBaseCourse},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1},8,["onClick"])])]})),default:(0,l.k6)((function(){return[(0,l.bF)(_,{model:r.preform},{default:(0,l.k6)((function(){return[(0,l.bF)(S,{label:"课程名称","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bF)(w,{modelValue:r.preform.courseName,"onUpdate:modelValue":t[5]||(t[5]=function(e){return r.preform.courseName=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(S,{label:"课程代码","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bF)(w,{modelValue:r.preform.courseCode,"onUpdate:modelValue":t[6]||(t[6]=function(e){return r.preform.courseCode=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(S,{label:"学分","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bF)(w,{modelValue:r.preform.credit,"onUpdate:modelValue":t[7]||(t[7]=function(e){return r.preform.credit=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(S,{label:"课程性质","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{modelValue:r.preform.courseNature,"onUpdate:modelValue":t[8]||(t[8]=function(e){return r.preform.courseNature=e}),placeholder:"请选择课程性质"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{label:"专业任选",value:"0"}),(0,l.bF)(c,{label:"还未确定",value:"1"})]})),_:1},8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(S,{label:"课程类型","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{modelValue:r.preform.courseType,"onUpdate:modelValue":t[9]||(t[9]=function(e){return r.preform.courseType=e}),placeholder:"请选择课程类型"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{label:"学科基础课",value:"0"}),(0,l.bF)(c,{label:"还未确定",value:"1"})]})),_:1},8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(S,{label:"学年","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{modelValue:r.preform.courseYear,"onUpdate:modelValue":t[10]||(t[10]=function(e){return r.preform.courseYear=e}),placeholder:"请选择学年"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{label:"2022",value:"0"}),(0,l.bF)(c,{label:"2023",value:"1"})]})),_:1},8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(S,{label:"备注","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bF)(w,{modelValue:r.preform.remark,"onUpdate:modelValue":t[11]||(t[11]=function(e){return r.preform.remark=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"])]})),_:1},8,["model"])]})),_:1},8,["modelValue"])],512),[[i.aG,r.hasCourse]]),(0,l.bo)((0,l.Lk)("div",jt,[(0,l.Lk)("div",Lt,[(0,l.bF)(y,{onClick:t[14]||(t[14]=function(e){return s.drawerShow()})})]),Dt,Bt],512),[[i.aG,!r.hasCourse]]),(0,l.bF)(T,{modelValue:r.drawer,"onUpdate:modelValue":t[19]||(t[19]=function(e){return r.drawer=e}),direction:r.direction,size:"690","show-close":!0},{header:(0,l.k6)((function(o){var n=o.titleId,m=o.titleClass;return[(0,l.bF)(I,{id:n,class:(0,C.C4)(m)},{default:(0,l.k6)((function(){return[(0,l.bF)(I,{style:{width:"100%"}},{default:(0,l.k6)((function(){return[(0,l.bF)(f,{span:17},{default:(0,l.k6)((function(){return[(0,l.bF)(I,{style:{width:"200px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{class:"searchIndrawer",msg:"搜索课程名称",onSearchValue:a.getSearchValue,value:e.keyward},null,8,["onSearchValue","value"])]})),_:1})]})),_:1}),(0,l.bF)(f,{span:6},{default:(0,l.k6)((function(){return[(0,l.bF)(I,null,{default:(0,l.k6)((function(){return[(0,l.bF)(u,{modelValue:r.currentVersion,"onUpdate:modelValue":t[15]||(t[15]=function(e){return r.currentVersion=e}),onChange:t[16]||(t[16]=function(e){return a.getCourseByYear(r.currentVersion)})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.versions,(function(e){return(0,l.uX)(),(0,l.Wv)(c,{key:e.versionId,label:e.label,value:e.versionId},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1})]})),_:1})]})),_:1}),(0,l.bF)(I,{class:"drawersubmenu"},{default:(0,l.k6)((function(){return[(0,l.bF)(f,{span:16},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",$t," 已选中 "+(0,C.v_)(r.drawernumSelected-r.programInfoCourseCount)+" 节基础课程 ",1)]})),_:1}),(0,l.bF)(f,{span:1},{default:(0,l.k6)((function(){return[Ot]})),_:1}),(0,l.bF)(f,{span:3,class:"drawerdeleteButton"},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(h,{onClick:t[17]||(t[17]=function(e){return s.getBCMId()})},{default:(0,l.k6)((function(){return[(0,l.bF)(p,null,{default:(0,l.k6)((function(){return[(0,l.bF)(N,{class:"iconSize"})]})),_:1})]})),_:1},512),[[i.aG,r.drawernumSelected-r.programInfoCourseCount]])]})),_:1})]})),_:1})]})),_:2},1032,["id","class"])]})),default:(0,l.k6)((function(){return[(0,l.Lk)("div",Mt,[(0,l.Lk)("div",null,[(0,l.bF)(F,{data:r.tableData,ref:"drawermultipleTable",style:{cursor:"pointer"},width:"645",onSelectionChange:a.drawerchandleSelectionChange,"row-key":a.rowKey},{default:(0,l.k6)((function(){return[(0,l.bF)(A,{width:"55",type:"selection",selectable:a.selectable,"reserve-selection":!0,"column-key":"select"},null,8,["selectable"]),(0,l.bF)(A,{prop:"courseName",label:"课程名",width:"180"}),(0,l.bF)(A,{prop:"courseCode",label:"课程号",width:"130"}),(0,l.bF)(A,{prop:"respondentName",label:"课程负责人",width:"120"}),(0,l.bF)(A,{label:"课程大纲",width:"150"},{default:(0,l.k6)((function(e){return[(0,l.bo)((0,l.bF)(V,{type:"prime"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(r.currentVersionName),1)]})),_:2},1536),[[i.aG,e.row.versionId]]),(0,l.bF)(x,{content:"添加课程大纲"},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(V,{type:"danger",onClick:(0,i.D$)((function(t){return a.addBaseCourseDetail(e.row)}),["stop"])},{default:(0,l.k6)((function(){return[(0,l.eW)(" 无课程大纲 ")]})),_:2},1032,["onClick"]),[[i.aG,!e.row.versionId]])]})),_:2},1024)]})),_:1})]})),_:1},8,["data","onSelectionChange","row-key"])])]),(0,l.Lk)("div",Ut,[(0,l.Lk)("div",Wt,[(0,l.bF)(I,{type:"flex",justify:"center",align:"middle",class:"loadmorestyle"},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(h,{disabled:r.loadmoreDisabled,link:"",plain:"",onClick:t[18]||(t[18]=function(e){return a.loadmoreCourse()})},{default:(0,l.k6)((function(){return[(0,l.eW)("加载更多")]})),_:1},8,["disabled"]),[[i.aG,r.showLoadmore]])]})),_:1})])])]})),_:1},8,["modelValue","direction"])],512),[[i.aG,r.hasProgram]]),(0,l.bo)((0,l.Lk)("div",Rt,zt,512),[[i.aG,!r.hasProgram]])],64)}var Xt=o(14048),Qt=o(3604),Kt=o(30388),Jt=(o(74423),o(26910),o(58940),o(21699),o(42762),o(88205)),Ht=o(5728);function qt(){return Q({url:"system/dict/data/school/type",method:"get"})}const Zt={name:"Courses",components:{HeaderSearch:ne,ElIcon:de.tk,ElButton:me.S2,ElTable:pe.Up,ElMessage:G.nk,ElMessageBox:P.s,ElDialog:be.kZ,ElSelect:Jt.AV,ElOption:Jt.P9,Back:ee.kcb,FolderChecked:ee.KHk,InfoFilled:ee.N_H,Loading:ee.Rhj,Search:ee.vji,Close:ee.bm,Plus:ee.FWt,Delete:ee.epd,Edit:ee.ffu,addBtn:le,ElTag:ke.u,ElCheckbox:Ht.dI,Document:ee.yoT,ElDropdown:ge.dW,MoreFilled:ee.yGC,CircleCloseFilled:ee.BZj},data:function(){return{loadmoreDisabled:Boolean,currentVersionName:"",courseTypeSource:[],courseNatureSource:[],keyword:"",keywordforProgrameCourse:"",showLoadmore:!0,hasProgram:Boolean,hasCourse:Boolean,checkList:(0,ce.KR)([" "]),programeInfo:[],programInfoCourseId:[0,0],programInfoCourseCount:0,deleteProgrameInfo:[{bcdmId:0,courseId:0,detailId:0,groupId:0,programId:0}],programeCourseInfo:[{courseId:0,versionId:0}],drawer:!1,direction:"ltr",drawercloseShow:(0,ce.KR)(!1),drawermultipleSelection:[],drawernumSelected:0,drawerclickState:0,drawercourseId:[],drawerCourseIndex:[],drawerresult:(0,ce.Kh)({}),drawertableData:[{courseName:"",courseCode:"",courseType:"",courseNature:"",credit:"",courseYear:"",remark:""}],origintableData:[{courseName:"",courseCode:"",courseType:"",courseNature:"",credit:"",courseYear:"",remark:""}],departmentId:"",schoolId:"",majorId:Number,majorName:"",programId:"",closeShow:(0,ce.KR)(!1),multipleSelection:[],numSelected:0,clickState:0,dialogFormVisible:(0,ce.KR)(!1),dialogFormVisible1:(0,ce.KR)(!1),formLabelWidth:"140px",form:(0,ce.Kh)({courseName:"",courseCode:"",courseType:"",courseNature:"",credit:"",courseYear:"",remark:""}),preform:(0,ce.Kh)({courseName:"",courseCode:"",courseType:"",courseNature:"",credit:"",courseYear:"",remark:""}),tableData:[{courseName:"",courseCode:"",courseType:"",courseNature:"",credit:"",courseYear:"",remark:""}],pageSize:(0,ce.KR)(20),pageNum:(0,ce.KR)(1),searchItems:{programId:"",courseId:"",courseName:""},sortBy:{option1:"",option2:""},searchCourseId:[0,0],currentVersion:"",currentVersionValue:1,currentVersionId:"",versions:[],versionLabel:[],result:(0,ce.Kh)({}),option1:[{value:"更新时间",label:"更新时间⬇"},{value:"创建时间",label:"创建时间⬇"},{value:"名称",label:"名称"}],option2:[{value:"全部",label:"全部"},{value:"已完成设置",label:"已完成设置"},{value:"未完成设置",label:"未完成设置"},{value:"回收站",label:"回收站"}]}},methods:{drawerClose:function(){this.$refs.drawermultipleTable.clearSelection(),this.drawer=!1},getSearchValueformProgram:function(e){console.log("searching for class"),this.keywordforProgrameCourse=e,sessionStorage.removeItem("courseSearchForm"),this.getProgramCourse()},getDict:function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){var o;return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:o=e,1,e.versions=[],e.versionLabel=[],qt().then((function(t){return console.log("Dict:",t),t.course_nature.forEach((function(e){o.courseNatureSource.push(e.dictLabel)})),t.course_type.forEach((function(e){o.courseTypeSource.push(e.dictLabel)})),Q({url:"detail/versionList",method:"get"}).then((function(t){if(console.log("versionList:",t),"SUCCESS"==t.code&&t.data.length){o.hasVersion=!0,o.hasNoVersion=!1,t.data.forEach((function(e){var t={label:e.versionName,enrollYear:e.enrollYear,reviseYear:e.reviseYear,versionId:e.versionId};o.versions.push(t),o.versionLabel.push(e.versionName)})),o.currentVersionId=e.$store.state.course.baseCourseVersionId?e.$store.state.course.baseCourseVersionId:o.versions[0].versionId,console.log("baseCourseVersionId",e.$store.state.course.baseCourseVersionId,"that.versions[0].versionId",o.versions[0].versionId);var n,r=(0,Qt.A)(o.versions);try{for(r.s();!(n=r.n()).done;){var a=n.value;a["versionId"]==o.currentVersionId&&(console.log("find same "),o.currentVersion=a["label"],o.currentVersionName=a["label"])}}catch(err){r.e(err)}finally{r.f()}}else o.hasVersion=!1,o.hasNoVersion=!0,(0,G.nk)({type:"error",message:"没有版本信息，请先添加版本！",duration:1500})}))["catch"]((function(e){console.log("error:",e)}))}));case 5:case"end":return t.stop()}}),t)})))()},getSearchValue:function(e){this.keyword=e,this.getBaseCourse(this.pageSize,this.pageNum)},getSearchValueforClass:function(e){this.keyword=e,this.getBaseCourse(this.pageSize,this.pageNum)},rowKey:function(e){return e.courseId},addBaseCourseDetail:function(e){if(this.currentVersionId){var t,o=this,n=(0,Qt.A)(this.versions);try{for(n.s();!(t=n.n()).done;){var r=t.value;r["versionId"]==o.currentVersionId&&(console.log("find same "),o.currentVersion=r["label"],o.currentVersionName=r["label"])}}catch(err){n.e(err)}finally{n.f()}console.log("currentVersionName",this.currentVersionName);var a="是否确认添加课程大纲（版本："+this.currentVersion+" ）?";P.s.confirm(a,"",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){return console.log("versionId",o.currentVersionId,"CourseId",o.courseId),Q({url:"/detail",method:"post",data:{versionId:o.currentVersionId,courseId:e.courseId,departmentId:o.departmentId,schoolId:o.schoolId}}).then((function(e){console.log(e),"SUCCESS"==e.code&&((0,G.nk)({type:"success",message:"新建成功",duration:1500}),o.getBaseCourse(o.pageSize,o.pageNum))}))["catch"]((function(e){console.log("e",e),"UNPROCESSABLE ENTITY"==e.data.code&&"UNPROCESSABLE ENTIT"==e.data.msg?(0,G.nk)({type:"error",message:"没有选择课程大纲版本",duration:1500}):409===e.status?(0,G.nk)({type:"error",message:"新建失败,大纲版本已存在",duration:1500}):500===e.status?(0,G.nk)({type:"error",message:"新建出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500}),o.getBaseCourse(o.pageSize,o.pageNum)}))}))}else(0,G.nk)({type:"error",message:"请选择课程大纲！",duration:1500})},loadmoreCourse:function(){this.result.total-this.pageSize>=20?(this.pageSize+=20,this.getBaseCourse(this.pageSize,this.pageNum)):(this.pageSize+=this.result.total-this.pageSize,this.getBaseCourse(this.pageSize,this.pageNum))},goBaseCourseDetail:function(e,t){sessionStorage.setItem("courseSearchForm",this.keywordforProgrameCourse),console.log("row",e,"bcdmid",e.bcDetails[0].bcDetailProgramVoList[0].bcdmId),this.$store.commit("baseCourseDetailProgram/setmajorbcdmId",e.bcDetails[0].bcDetailProgramVoList[0].bcdmId),this.$store.commit("baseCourseDetailProgram/setmajorclassId",e.courseId),this.$store.commit("baseCourseDetailProgram/setmajorcourseCode",e.courseCode),this.$router.push("/courseDetail")},checkProgram:function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$store.state.major.programId?e.hasProgram=!0:e.hasProgram=!1,console.log("hasProgram",e.hasProgram);case 2:case"end":return t.stop()}}),t)})))()},drawerShow:function(){console.log("drawerShow:"),this.drawer=!0,this.getBaseCourse(this.pageSize,this.pageNum)},selectable:function(e,t){return e.remark?!e.remark:!!e.versionId||e.versionId},getDetail:function(e){var t=this,o="";return Q({url:"/detail/list?vesionId="+this.currentVersionId+"&courseId="+e,method:"get"}).then((function(e){return console.log("getDetail:",e),e.rows.forEach((function(e){e.versionId==t.currentVersionId&&(console.log("detailId",e.detailId),o=e.detailId)})),o}))},getCourseByYear:function(e){this.currentVersionId=e,this.$store.commit("course/setbaseCourseVersionId",this.currentVersionId);var t,o=(0,Qt.A)(this.versions);try{for(o.s();!(t=o.n()).done;){var n=t.value;n["versionId"]==this.currentVersionId&&(this.currentVersionName=n["label"])}}catch(err){o.e(err)}finally{o.f()}this.getBaseCourse(this.pageSize,this.pageNum)},getProgramCourse:function(){var e=this;e.drawertableData=[],e.origintableData=[];var t=[],o=[],n=[];return console.log("currentprogramId:",this.programId,"keyword:",this.keywordforProgrameCourse),Q({url:"/baseCourse/program",method:"get",params:{schoolId:e.schoolId,departmentId:e.departmentId,programId:e.programId,selectKeyWord:e.keywordforProgrameCourse}}).then((function(r){console.log("courseInPrograme:",r),console.log("department:",e.departmentId,"schoolId:",e.schoolId,"majorId:",e.majorId),r.total?r.rows.forEach((function(r){e.hasCourse=!0;var a="";a=r.courseId,r.courseName=r.courseName,r.courseCode=r.courseCode,r.courseType=e.courseTypeSource[r.courseType],r.courseNature=e.courseNatureSource[r.courseNature],r.versionId=r.bcDetails[0].versionId,r.versionName=r.bcDetails[0].versionName,t.push(r);var s={courseId:a};o.push(s),n.push(a)})):e.hasCourse=!1,e.drawertableData=t,e.origintableData=t,e.programeCourseInfo=o,e.programInfoCourseId=n,console.log("programeCourseInfo is ",e.programeCourseInfo),e.drawerresult=r}))["catch"]((function(t){console.log("e",t),e.hasCourse=!1}))},selectionOption1:function(e){console.log(e,(0,O.A)(e)),"更新时间"==e&&(this.sortBy.option1=e,this.drawertableData.sort((function(e,t){return parseInt(e.courseId)-parseInt(t.courseId)}))),"创建时间"==e&&(this.sortBy.option1=e,this.drawertableData.sort((function(e,t){return parseInt(t.courseId)-parseInt(e.courseId)}))),"名称"==e&&(this.sortBy.option1=e,this.drawertableData.sort((function(e,t){return e.courseName.localeCompare(t.courseName)}))),""==e&&(this.sortBy.option1="更新时间",this.drawertableData.sort((function(e,t){return parseInt(e.courseId)-parseInt(t.courseId)})))},selectionOption2:function(e){console.log(e,(0,O.A)(e));var t=this.origintableData,o=[];"全部"==e&&(this.drawertableData=t),"已完成设置"==e&&(this.drawertableData.forEach((function(e){"0"==e.status&&o.push(e)})),console.log("courseList",o),this.drawertableData=o),""==e&&this.drawertableData.sort((function(e,t){return parseInt(e.courseId)-parseInt(t.courseId)}))},cancelClick:function(){this.drawer=!1},addBaseCourse:function(){this.dialogFormVisible=!1,console.log(this.form);var e=this,t=this.formTopostData(this.form);return console.log("postData:",t),Q({url:"/baseCourse/add",method:"post",data:t}).then((function(t){"SUCCESS"==t.code&&((0,G.nk)({type:"success",message:"新建成功",duration:1500}),e.clearForm(),e.getBaseCourse(e.pageSize,e.pageNum))}))["catch"]((function(t){console.log("e",t),409===t.status?(0,G.nk)({type:"error",message:"新建失败,课程已存在",duration:1500}):500===t.status?(0,G.nk)({type:"error",message:"新建出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500}),e.clearForm(),e.getBaseCourse(e.pageSize,e.pageNum)}))},formTopostData:function(e){var t={};return t.departmentId=this.departmentId,t.schoolId=this.schoolId,t.majorId=this.majorId,t.courseName=e.courseName,t.courseCode=e.courseCode,t.courseType=e.courseType,t.courseNature=e.courseNature,t.credit=e.credit,t.courseYear=e.courseYear,t.remark=e.remark,t},clearForm:function(){this.form.courseId="",this.form.courseName="",this.form.courseCode="",this.form.courseType="",this.form.courseNature="",this.form.credit="",this.form.courseYear="",this.form.remark=""},postDataToform:function(e){this.preform.courseId=e.courseId,this.preform.courseName=e.courseName,this.preform.courseCode=e.courseCode,this.preform.courseType="学科基础课"==e.courseType?"0":"1",this.preform.courseNature="专业任选"==e.courseNature?"0":"1",this.preform.credit=e.credit,this.preform.courseYear="2022"==e.courseYear?"0":"1",this.preform.remark=e.remark},dataTransfrom:function(e){return e.courseName=e.courseName?"":e.courseName.trim(),e.courseCode=e.courseCode?"":e.courseCode.trim(),e.courseType="0"==e.courseType?"学科基础课":"还未确定",e.courseNature="0"==e.courseNature?"专业任选":"还未确定",e.credit=e.credit,e.courseYear="0"==e.courseYear?"2022":"2023",e.remark=e.remark?"":e.remark.trim(),e},deleteBaseCourse:function(){var e=this;P.s.confirm("是否确认将所选课程从培养方案中移除？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){return Q({url:"/baseCourse/program/remove",method:"delete",data:e.deleteProgrameInfo}).then((function(t){204==t&&((0,G.nk)({type:"success",message:"删除成功",duration:1500}),e.getProgramCourse(),e.$refs.multipleTable.clearSelection(),e.numSelected=0,1==e.clickState&&(e.clickState=0,e.closeShow=!e.closeShow))}))["catch"]((function(e){console.log("e",e),(0,G.nk)({type:"error",message:"删除失败",duration:1500})}))}))},getProgrameInfo:function(){this.getBaseCourseDictforProgram()},getBaseCourseDictforProgram:function(){var e=[],t=this;this.drawercourseId.forEach((function(o){var n="",r="";t.programInfoCourseId.includes(o)||t.getDetail(o).then((function(e){if(!e)return console.log("detailId is null");r=e})).then((function(){var a={bcmdId:n,detailId:r,programId:t.programId,courseId:o};e.push(a)})).then((function(){t.programeInfo=e,console.log("getBaseCourseDictforProgram:",t.programeInfo)}))}))},getBCMId:function(){var e=this;this.programeInfo.forEach((function(t){var o="";console.log("getBCMId:",t.detailId),e.getBaseCourse(e.pageSize,e.pageNum,e.majorId,t.detailId).then((function(e){console.log("BCMId: ",e),e?(console.log("bcdmId is :",e),o=e,t.bcmdId=o):console.log("bcdmId is null")}))}));var t,o=(0,Qt.A)(this.versions);try{for(o.s();!(t=o.n()).done;){var n=t.value;n["versionId"]==e.currentVersionId&&(console.log("find same "),e.currentVersion=n["label"],e.currentVersionName=n["label"])}}catch(err){o.e(err)}finally{o.f()}console.log("currentVersionName",this.currentVersionName);var r="是否确认将所选课程（课程大纲版本："+this.currentVersionName+"）添加到培养方案中 ？";P.s.confirm(r,"",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.addBaseCourseInProgram()}))},addBaseCourseInProgram:function(){var e=this;return Q({url:"/baseCourse/program/add",method:"post",data:this.programeInfo}).then((function(t){"SUCCESS"==t.code&&((0,G.nk)({type:"success",message:"新建成功",duration:1500}),e.drawercourseId=[],e.drawerCourseIndex=[],e.getProgramCourse(),e.getBaseCourse(e.pageSize,e.pageNum),e.$refs.drawermultipleTable.clearSelection(),1==e.drawerclickState&&(e.drawerclickState=0,e.drawercloseShow=!e.drawercloseShow))}))["catch"]((function(t){console.log("e",t),409===t.status?(0,G.nk)({type:"error",message:"新建失败,课程已存在",duration:1500}):500===t.status?(0,G.nk)({type:"error",message:"新建出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500}),e.drawercourseId=[],e.drawerCourseIndex=[],e.$refs.drawermultipleTable.clearSelection(),1==e.drawerclickState&&(e.drawerclickState=0,e.drawercloseShow=!e.drawercloseShow)}))},editTrigger:function(e){console.log("选中的信息：",e.courseId),this.postDataToform(e),this.dialogFormVisible1=!0},editBaseCourse:function(){this.dialogFormVisible1=!1;var e=this;return console.log("preform:",this.preform),Q({url:"/baseCourse/edit",method:"post",data:this.preform}).then((function(t){console.log("res:",t),"SUCCESS"==t.code&&((0,G.nk)({type:"success",message:"更新成功",duration:1500}),e.getBaseCourse(e.pageSize,e.pageNum))}))["catch"]((function(t){console.log("e",t),500===t.status?(0,G.nk)({type:"error",message:"更新出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500}),e.getBaseCourse(e.pageSize,e.pageNum)}))},handleSelectionChange:function(e){var t=this,o=[],n=[];this.multipleSelection=e,console.log("选中的信息：",e),e.forEach((function(e){var r=e.courseId,a=e.bcDetails[0].detailId,s={courseId:r,programId:t.programId,detailId:a};n.push(s),o.push(r)})),this.numSelected=this.multipleSelection.length,1!=this.clickState&&(this.closeShow=!this.closeShow,this.clickState=1),1==this.clickState&&0==this.numSelected&&(this.clickState=0,this.closeShow=!this.closeShow),this.courseId=o,this.deleteProgrameInfo=n,console.log("courseId:",this.courseId),console.log("deleteProgrameInfo:",this.deleteProgrameInfo)},drawerchandleSelectionChange:function(e){var t=[],o=[];this.drawermultipleSelection=e,console.log("选中的信息：",e),e.forEach((function(e){var n=e.courseId,r=e.index;t.push(n),o.push(r)})),this.drawernumSelected=this.drawermultipleSelection.length,1!=this.drawerclickState&&(this.drawercloseShow=!this.drawercloseShow,this.drawerclickState=1),1==this.drawerclickState&&0==this.drawernumSelected&&(this.drawerclickState=0,this.drawercloseShow=!this.drawercloseShow),this.drawercourseId=t,this.drawerCourseIndex=o,console.log("courseId:",this.drawercourseId,"courseIndex:",this.drawerCourseIndex),this.getBaseCourseDictforProgram()},toggleSelection:function(e){var t=this;e?e.forEach((function(e){t.$refs.multipleTable.toggleRowSelection(e)})):(this.$refs.multipleTable.clearSelection(),1==this.clickState&&(this.clickState=0,this.closeShow=!this.closeShow))},drawertoggleSelection:function(e){e||(this.$refs.drawermultipleTable.clearSelection(),1==this.drawerclickState&&(this.drawerclickState=0,this.drawercloseShow=!this.drawercloseShow))},getBaseCourse:function(e,t,o,n){var r=this;return(0,Kt.A)((0,Xt.A)().mark((function a(){var s,i,l,c,u;return(0,Xt.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(s=r,i=[],l="",c="",u=0,r.loadmoreDisabled=!0,r.programInfoCourseCount=0,!o){a.next=12;break}return l="/detailProgram/list",a.abrupt("return",Q({url:l+"?majorId="+r.majorId,method:"get"}).then((function(e){return s.loadmoreDisabled=!1,e.rows&&e.rows.forEach((function(e){e.detailId==n&&(c=e.bcdmId)})),c})));case 12:return l="/baseCourse/list",a.abrupt("return",Q({url:l,method:"get",params:{pageSize:e,pageNum:t,departmentId:s.departmentId,versionId:s.currentVersionId,schoolId:s.schoolId,selectKeyWord:s.keyword}}).then((function(t){s.loadmoreDisabled=!1,console.log("courseDetails:",t),console.log("department:",s.departmentId,"schoolId:",s.schoolId,"majorId:",s.majorId,"currentVersionId",s.currentVersionId),console.log("已经选择的课：",s.programeCourseInfo),t.rows.forEach((function(e){if(e.courseName=e.courseName,e.courseCode=e.courseCode,e.courseType=s.courseTypeSource[e.courseType],e.courseNature=s.courseNatureSource[e.courseNature],e.remark=!1,e.trueversionId=e.versionId,e.bcDetails.length){var t,o=(0,Qt.A)(e.bcDetails);try{for(o.s();!(t=o.n()).done;){var n=t.value;if(n.versionId==s.currentVersionId){e.versionId=!0;break}e.versionId=!1}}catch(err){o.e(err)}finally{o.f()}}e.respondentInfos&&e.respondentInfos.forEach((function(t){e.respondentName=t.respondentName})),e.index=u,i.push(e),u++})),s.hasProgram&&s.programeCourseInfo.forEach((function(e){try{i.forEach((function(t){if(!t.remark){if(e.courseId==t.courseId)throw s.programInfoCourseCount=s.programInfoCourseCount+1,t.remark=!0,new Error("remark");t.remark=!1}}))}catch(t){if("remark"!=t.message)throw t}})),s.tableData=i,s.result=t,e>=t.total?s.showLoadmore=!1:s.showLoadmore=!0})).then((function(){s.tableData.forEach((function(e){e.remark&&(console.log("course has selected!"),s.$refs.drawermultipleTable.toggleRowSelection(s.tableData[e.index],!0))}))})));case 14:case"end":return a.stop()}}),a)})))()},checkCurrentProgram:function(){var e=this;console.log("year has changed"),ve(this.majorId,this.$store.state.currentInfo.year).then((function(t){console.log("res",t),"操作成功"==t.msg&&"SUCCESS"===t.code&&(e.hasProgram=!0,e.programId=t.data.programId,e.$store.commit("major/setProgramId",e.programId)),e.getProgramCourse()}))["catch"]((function(t){console.log("e",t),"PROGRAM_NOT_FIND"==t.code&&(e.hasProgram=!1)}))},activate:function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.departmentId=e.$store.state.currentInfo.departmentId,e.schoolId=e.$store.state.currentInfo.schoolId,e.majorId=e.$store.state.major.majorId,e.majorName=e.$store.state.major.majorName,e.programId=e.$store.state.major.programId,e.currentVersionId=e.$store.state.course.baseCourseVersionId,e.checkCurrentProgram(),e.getDict(),console.log("schoolId+departmentId+majorId",e.schoolId,e.departmentId,e.majorId);case 9:case"end":return t.stop()}}),t)})))()}},mounted:function(){this.checkProgram(),this.hasProgram&&this.activate(),sessionStorage.getItem("courseSearchFlag")?(this.keywordforProgrameCourse=sessionStorage.getItem("courseSearchForm"),console.log("this.keywordforProgrameCourse",this.keywordforProgrameCourse),this.getSearchValueformProgram(this.keywordforProgrameCourse)):sessionStorage.removeItem("courseSearchForm")},computed:{yearChange:function(){return this.$store.state.currentInfo.year}},watch:{yearChange:{deep:!0,handler:function(e){this.checkCurrentProgram()}}}},eo=(0,h.A)(Zt,[["render",Yt],["__scopeId","data-v-7f9280d4"]]),to=eo;var oo=function(e){return(0,l.Qi)("data-v-64ecae92"),e=e(),(0,l.jt)(),e},no={class:"content"},ro={class:"body-check"},ao={class:"card"},so={class:"card-head"},io=oo((function(){return(0,l.Lk)("span",{class:"head-text",style:{color:"grey","font-size":"14px"}},"毕业要求",-1)})),lo={key:0,class:"noAttribute"},co=oo((function(){return(0,l.Lk)("span",null,"待添加",-1)})),uo=[co],ho={key:1},fo={class:"attribute"},mo={class:"two-digits"},po={class:"num-title"},bo={class:"num-wrap"},go={class:"title-text"},ko=oo((function(){return(0,l.Lk)("section",{class:"rotate-bar"},null,-1)})),vo={class:"attribute-content"},Io={class:"name"},yo={class:"desc"},Co={class:"detail-num"},Ao={class:"detail-content"},Fo={class:"name"},wo={class:"desc"},So={class:"no-program"},_o=oo((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","margin-top":"100px","font-size":"22px"}}," 未创建培养方案 ",-1)})),Eo=oo((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center",color:"grey","font-size":"13px","margin-top":"30px"}}," 请先点击右上角圆形按钮创建培养方案 ",-1)})),No={class:"dialog-footer"};function Vo(e,t,o,n,r,a){var s=this,c=(0,l.g2)("EditPen"),u=(0,l.g2)("el-icon"),d=(0,l.g2)("el-tooltip"),h=(0,l.g2)("addBtn"),f=(0,l.g2)("el-input"),m=(0,l.g2)("el-form-item"),p=(0,l.g2)("el-form"),b=(0,l.g2)("el-button"),g=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)("div",no,[(0,l.bo)((0,l.Lk)("div",ro,[(0,l.Lk)("div",ao,[(0,l.Lk)("div",so,[io,(0,l.bF)(d,{class:"box-item",effect:"dark",content:"编辑",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"edit-pen",onClick:t[0]||(t[0]=function(e){return a.goEdit()})},{default:(0,l.k6)((function(){return[(0,l.bF)(c)]})),_:1})]})),_:1})]),r.hasAttribute?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",lo,uo)),r.hasAttribute?((0,l.uX)(),(0,l.CE)("div",ho,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.requirements,(function(e){return(0,l.uX)(),(0,l.CE)("div",{class:"graduate-attribute",key:e.id},[(0,l.Lk)("div",fo,[(0,l.Lk)("div",mo,[(0,l.Lk)("section",po,[(0,l.Lk)("section",bo,[(0,l.Lk)("span",go,(0,C.v_)(e.serialNum),1)]),ko])]),(0,l.Lk)("div",vo,[(0,l.Lk)("div",Io,(0,C.v_)(e.name),1),(0,l.Lk)("div",yo,(0,C.v_)(e.description),1)])]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.programIndicators,(function(e){return(0,l.uX)(),(0,l.CE)("div",{class:"attribute-detail",key:e.id},[(0,l.Lk)("div",Co,(0,C.v_)(e.serialNum),1),(0,l.Lk)("div",Ao,[(0,l.Lk)("div",Fo,(0,C.v_)(e.name),1),(0,l.Lk)("div",wo,(0,C.v_)(e.description),1)])])})),128))])})),128))])):(0,l.Q3)("",!0)])],512),[[i.aG,r.hasProgram]]),(0,l.bo)((0,l.Lk)("div",So,[_o,Eo,(0,l.bF)(h,{onClick:t[1]||(t[1]=function(e){s.addProgramForm.enrollyear=s.$store.state.currentInfo.year,r.dialogFormVisible=!0})}),(0,l.bF)(g,{modelValue:r.dialogFormVisible,"onUpdate:modelValue":t[6]||(t[6]=function(e){return r.dialogFormVisible=e}),title:"创建培养方案",style:{width:"400px"}},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",No,[(0,l.bF)(b,{onClick:t[4]||(t[4]=function(e){return r.dialogFormVisible=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(b,{type:"primary",onClick:t[5]||(t[5]=function(e){return a.addProgram()})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(p,{model:r.addProgramForm,"label-position":"top",style:{"margin-left":"30px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{label:"专业","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bF)(f,{modelValue:r.addProgramForm.major,"onUpdate:modelValue":t[2]||(t[2]=function(e){return r.addProgramForm.major=e}),disabled:"",style:{width:"300px"}},null,8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(m,{label:"学年","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bF)(f,{modelValue:r.addProgramForm.enrollyear,"onUpdate:modelValue":t[3]||(t[3]=function(e){return r.addProgramForm.enrollyear=e}),disabled:"",style:{width:"300px"}},null,8,["modelValue"])]})),_:1},8,["label-width"])]})),_:1},8,["model"])]})),_:1},8,["modelValue"])],512),[[i.aG,r.noProgram]])])}const xo={name:"Goal",components:{EditPen:ee.EDh,addBtn:le},data:function(){return{hasProgram:!1,noProgram:!1,hasAttribute:Boolean,currentMajorId:Number,currentMajorName:"",currentSchoolId:"",currentYear:"",currentDepartmentId:"",dialogFormVisible:!1,formLabelWidth:"120px",addProgramForm:{major:"",enrollyear:""},requirements:[],programId:""}},mounted:function(){this.currentMajorId=this.$store.state.major.majorId,this.currentMajorName=this.$store.state.major.majorName,this.currentSchoolId=this.$store.state.currentInfo.schoolId,this.currentDepartmentId=this.$store.state.currentInfo.departmentId,this.currentYear=this.$store.state.currentInfo.year,this.addProgramForm.major=this.currentMajorName,this.addProgramForm.enrollyear=this.$store.state.currentInfo.year,this.checkProgram()},computed:{yearChange:function(){return this.$store.state.currentInfo.year}},watch:{yearChange:{deep:!0,handler:function(e){this.checkProgram()}}},methods:{goEdit:function(){this.$router.push({path:"/edit",query:{programId:this.programId}})},checkProgram:function(){var e=this;ve(this.currentMajorId,this.$store.state.currentInfo.year).then((function(t){console.log("checkProgram",t),"未查到"==t.msg&&"SUCCESS"===t.code&&(e.hasProgram=!1,e.noProgram=!0,e.$store.commit("major/setProgramId","")),"操作成功"==t.msg&&"SUCCESS"===t.code&&(e.noProgram=!1,e.hasProgram=!0,e.programId=t.data.programId,e.$store.commit("major/setProgramId",e.programId),e.requirements=t.data.graduateAttributes,null!==e.requirements&&0!=e.requirements.length||(e.hasAttribute=!1),null!==e.requirements&&e.requirements.length>0&&(e.hasAttribute=!0),console.log("requirements",e.requirements,e.hasAttribute))}))["catch"]((function(t){console.log("e",t),"资源不存在"==t.msg&&(e.noProgram=!0,e.hasProgram=!1)}))},addProgram:function(){var e=this;ye(this.currentMajorId,this.currentDepartmentId,this.currentSchoolId,this.addProgramForm.enrollyear).then((function(t){console.log("addProgram",t),e.dialogFormVisible=!1,e.checkProgram()}))}}},To=(0,h.A)(xo,[["render",Vo],["__scopeId","data-v-64ecae92"]]),jo=To;var Lo=function(e){return(0,l.Qi)("data-v-743f0846"),e=e(),(0,l.jt)(),e},Do={class:"content"},Bo={class:"head-block"},$o=Lo((function(){return(0,l.Lk)("div",{style:{"margin-top":"15px","margin-left":"20px",height:"30px","border-left":"1px solid rgb(189, 189, 189)"}},null,-1)})),Oo={class:"edit-body"},Mo={class:"card"},Uo={class:"num-title"},Wo={class:"num-wrap"},Ro={class:"title-text"},Po=Lo((function(){return(0,l.Lk)("section",{class:"rotate-bar"},null,-1)})),Go={class:"detail-num"},zo={class:"detail-content",style:{width:"700px"}};function Yo(e,t,o,n,r,a){var s=(0,l.g2)("Back"),c=(0,l.g2)("el-icon"),u=(0,l.g2)("el-tooltip"),d=(0,l.g2)("DocumentChecked"),h=(0,l.g2)("el-row"),f=(0,l.g2)("el-col"),m=(0,l.g2)("el-input"),p=(0,l.g2)("el-form-item"),b=(0,l.g2)("Plus"),g=(0,l.g2)("el-button"),k=(0,l.g2)("Delete"),v=(0,l.g2)("el-form");return(0,l.uX)(),(0,l.CE)("div",Do,[(0,l.Lk)("div",Bo,[(0,l.bF)(h,{style:{"margin-left":"30px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",onClick:t[0]||(t[0]=function(e){return a.backGoal()})},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1}),$o,(0,l.bF)(u,{class:"box-item",effect:"dark",content:"保存",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",onClick:t[1]||(t[1]=function(e){return a.save()}),style:{"margin-left":"20px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(d)]})),_:1})]})),_:1})]})),_:1})]),(0,l.Lk)("div",Oo,[(0,l.Lk)("div",Mo,[(0,l.bF)(v,{model:r.requirements,rules:r.rules,ref:"requirements","label-position":"top"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.requirements,(function(e,t){return(0,l.uX)(),(0,l.Wv)(f,{key:e.id},{default:(0,l.k6)((function(){return[(0,l.bF)(f,null,{default:(0,l.k6)((function(){return[(0,l.bF)(h,null,{default:(0,l.k6)((function(){return[(0,l.bF)(f,{span:2,class:"two-digits"},{default:(0,l.k6)((function(){return[(0,l.Lk)("section",Uo,[(0,l.Lk)("section",Wo,[(0,l.Lk)("span",Ro,(0,C.v_)(e.serialNum),1)]),Po])]})),_:2},1024),(0,l.bF)(f,{span:22},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{prop:"requirements."+t+".name",label:"简称",class:"title"},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{modelValue:e.name,"onUpdate:modelValue":function(t){return e.name=t},maxlength:"20","show-word-limit":"",placeholder:"简称"},null,8,["modelValue","onUpdate:modelValue"])]})),_:2},1032,["prop"]),(0,l.bF)(p,{label:"描述",class:"title",prop:"requirements."+t+".description",rules:r.rules.description},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{modelValue:e.description,"onUpdate:modelValue":function(t){return e.description=t},type:"textarea",autosize:"",maxlength:"1000",placeholder:"描述"},null,8,["modelValue","onUpdate:modelValue"])]})),_:2},1032,["prop","rules"])]})),_:2},1024)]})),_:2},1024),(0,l.bF)(f,null,{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.programIndicators,(function(e,t){return(0,l.uX)(),(0,l.CE)("div",{class:"attribute-detail",key:e.id},[(0,l.bF)(h,null,{default:(0,l.k6)((function(){return[(0,l.Lk)("div",Go,(0,C.v_)(e.serialNum),1),(0,l.Lk)("div",zo,[(0,l.bF)(p,{label:"简称",class:"title"},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{modelValue:e.name,"onUpdate:modelValue":function(t){return e.name=t},maxlength:"20","show-word-limit":"",placeholder:"简称"},null,8,["modelValue","onUpdate:modelValue"])]})),_:2},1024),(0,l.bF)(p,{label:"描述",class:"title",prop:"programIndicators."+t+".description"},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{modelValue:e.description,"onUpdate:modelValue":function(t){return e.description=t},autosize:"",type:"textarea",maxlength:"1000",placeholder:"描述"},null,8,["modelValue","onUpdate:modelValue"])]})),_:2},1032,["prop"])])]})),_:2},1024)])})),128)),(0,l.bF)(h,{class:"detail-Btn"},{default:(0,l.k6)((function(){return[(0,l.bF)(g,{style:{color:"#6573c0"},text:"",onClick:function(t){return a.addDetail(e)}},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{size:18,color:"#6573c0"},{default:(0,l.k6)((function(){return[(0,l.bF)(b)]})),_:1}),(0,l.eW)(" 新增指标点"+(0,C.v_)(a.newDetailId(e)),1)]})),_:2},1032,["onClick"]),(0,l.bo)((0,l.bF)(g,{type:"danger",text:"",onClick:function(t){return a.deleteDetail(e)}},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{size:18,color:"#ff0000"},{default:(0,l.k6)((function(){return[(0,l.bF)(k)]})),_:1}),(0,l.eW)(" 删除指标点"+(0,C.v_)(a.deleteDetailId(e)),1)]})),_:2},1032,["onClick"]),[[i.aG,0!=e.programIndicators.length]])]})),_:2},1024)]})),_:2},1024)]})),_:2},1024)]})),_:2},1024)})),128)),(0,l.bF)(h,{class:"attribute-Btn"},{default:(0,l.k6)((function(){return[(0,l.bF)(g,{style:{color:"#6573c0"},text:"",onClick:t[2]||(t[2]=function(e){return a.addAttribute()})},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{size:18,color:"#6573c0"},{default:(0,l.k6)((function(){return[(0,l.bF)(b)]})),_:1}),(0,l.eW)(" 新增毕业要求"+(0,C.v_)(r.attributeIdNew),1)]})),_:1}),(0,l.bo)((0,l.bF)(g,{type:"danger",text:"",onClick:t[3]||(t[3]=function(e){return a.deleteAttribute()})},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{size:18,color:"#ff0000"},{default:(0,l.k6)((function(){return[(0,l.bF)(k)]})),_:1}),(0,l.eW)(" 删除毕业要求"+(0,C.v_)(r.attributeIdDelete),1)]})),_:1},512),[[i.aG,r.canDelete]])]})),_:1})]})),_:1},8,["model","rules"])])])])}o(48598),o(38781);var Xo=o(2543),Qo=o.n(Xo);const Ko={name:"GoalEdit",components:{Back:ee.kcb,DocumentChecked:ee.Fmj,Plus:ee.FWt,Delete:ee.epd},data:function(){return{currentMajorId:"",currentSchoolId:"",currentDepartmentId:"",programId:"",programInfo:{},requirements:[],attributeIdDelete:"",attributeIdNew:"",hasDetail:!0,deteleArray:[],canDelete:!0,rules:{description:[]}}},mounted:function(){this.programId=this.$route.query.programId,this.currentMajorId=this.$store.state.major.majorId,this.currentMajorName=this.$store.state.major.majorName,this.currentSchoolId=this.$store.state.currentInfo.schoolId,this.currentDepartmentId=this.$store.state.currentInfo.departmentId,this.checkRequirement()},methods:{deleteDetailId:function(e){if(e.programIndicators.length>0)return e.programIndicators[e.programIndicators.length-1].serialNum},newDetailId:function(e){if(e.programIndicators.length>0){var t=e.programIndicators[e.programIndicators.length-1].serialNum.split(".");return t[1]=++t[1],t.join(".")}return e.serialNum+".1"},deleteAttributeId:function(){this.requirements&&this.requirements.length>0&&(this.attributeIdDelete=this.requirements[this.requirements.length-1].serialNum)},newAttributeId:function(){if(this.requirements&&this.requirements.length>0){var e=this.requirements[this.requirements.length-1].serialNum;this.attributeIdNew=++e}else this.attributeIdNew=1},backGoal:function(){var e=this;console.log(Qo().isEqual(this.programInfo.graduateAttributes,this.requirements)),Qo().isEqual(this.programInfo.graduateAttributes,this.requirements)?this.$router.push("/goal"):P.s.confirm("数据还未保存，是否仍然关闭？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.$router.push("/goal")}))["catch"]((function(){}))},checkRequirement:function(){var e=this;Ie(this.programId).then((function(t){e.programInfo=t.data,console.log("programInfo",e.programInfo),e.requirements=JSON.parse(JSON.stringify(t.data.graduateAttributes)),e.deleteAttributeId(),e.newAttributeId(),console.log("requirements",e.requirements)}))},addDetail:function(e){var t=new Object;if(t.name=null,t.description=null,t.achievement=null,console.log("attribute",e,e.programIndicators.length),e.programIndicators.length>0){t.serialNum=e.programIndicators[e.programIndicators.length-1].serialNum;var o=t.serialNum.split(".");o[1]=(++o[1]).toString(),console.log("parent",o),1==o[0].length&&1==o[1].length&&(t.id="0"+o[0]+"0"+o[1],console.log("id",t.id)),2==o[0].length&&1==o[1].length&&(t.id=o[0]+"0"+o[1],console.log("id",t.id)),1==o[0].length&&2==o[1].length&&(t.id="0"+o[0]+o[1],console.log("id",t.id)),2==o[0].length&&2==o[1].length&&(t.id=o[0]+o[1],console.log("id",t.id)),t.serialNum=o.join("."),this.requirements[o[0]-1].programIndicators.push(t)}else{t.serialNum=e.serialNum+".1";var n=t.serialNum.split(".");n[0]<=9?t.id="0"+n[0]+"0"+n[1]:t.id=n[0]+"0"+n[1];var r=Number(e.serialNum);this.requirements[r-1].programIndicators.push(t)}},deleteDetail:function(e){P.s.confirm("是否确认删除指标点"+this.deleteDetailId(e)+"?","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.programIndicators.pop()}))},addAttribute:function(){var e=new Object;e.name=null,e.description=null,e.programIndicators=[],console.log("!!!"),null!==this.requirements&&this.requirements.length>0?(0==this.requirements.length?e.serialNum="1":(e.serialNum=this.requirements[this.requirements.length-1].serialNum,++e.serialNum,e.serialNum=e.serialNum.toString()),console.log("@",e.serialNum,(0,O.A)(e.serialNum)),Number(e.serialNum)<=9?e.id="0"+e.serialNum:e.id=e.serialNum+"",this.requirements.push(e)):(e.id="01",e.serialNum="1",this.requirements=[],this.requirements.push(e)),this.canDelete=!0,this.deleteAttributeId(),this.newAttributeId(),console.log("addAttribute",e),console.log("requirements",this.requirements)},deleteAttribute:function(){var e=this;this.requirements.length>0&&P.s.confirm("是否确认删除毕业要求"+this.attributeIdDelete+"?","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.requirements.pop(),0==e.requirements.length&&(e.canDelete=!1),e.deleteAttributeId(),e.newAttributeId()}))},save:function(){for(var e=this,t=0;t<this.requirements.length;t++){if(this.requirements[t].programIndicators.length>0)for(var o=0;o<this.requirements[t].programIndicators.length;o++)if(null==this.requirements[t].programIndicators[o].description||""==this.requirements[t].programIndicators[o].description)return void(0,G.nk)({type:"error",message:"指标点描述不能为空",duration:1500});if(null==this.requirements[t].description||""==this.requirements[t].description)return void(0,G.nk)({type:"error",message:"要求点描述不能为空",duration:1500})}this.programInfo.graduateAttributes=this.requirements,console.log("save",this.programInfo),Ce(this.programInfo).then((function(t){console.log(t),"SUCCESS"==t.code?((0,G.nk)({type:"success",message:"更新成功",duration:1500}),e.backGoal()):(0,G.nk)({type:"error",message:"更新失败",duration:1500})}))["catch"]((function(e){500==e.status&&(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500})}))}}},Jo=(0,h.A)(Ko,[["render",Yo],["__scopeId","data-v-743f0846"]]),Ho=Jo;function qo(e,t,o,n,r,a){return null}const Zo={name:"Manage"},en=(0,h.A)(Zo,[["render",qo]]),tn=en;var on={class:"content"},nn={class:"block"},rn={class:"body-check"},an={class:"card"},sn={class:"dialog-footer"};function ln(e,t,o,n,r,a){var s=(0,l.g2)("CopyDocument"),i=(0,l.g2)("el-icon"),c=(0,l.g2)("el-tooltip"),u=(0,l.g2)("el-row"),d=(0,l.g2)("el-col"),h=(0,l.g2)("DrawerSearch"),f=(0,l.g2)("el-option"),m=(0,l.g2)("el-select"),p=(0,l.g2)("el-table-column"),b=(0,l.g2)("el-table"),g=(0,l.g2)("el-drawer"),k=(0,l.g2)("el-checkbox"),v=(0,l.g2)("el-checkbox-group"),I=(0,l.g2)("el-button"),y=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",on,[(0,l.Lk)("div",nn,[(0,l.bF)(u,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"box-item",effect:"dark",content:"从其他培养方案复制",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",style:{"margin-left":"70px"},onClick:t[0]||(t[0]=function(e){return a.openDrawer()})},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1})]})),_:1})]),(0,l.Lk)("div",rn,[(0,l.Lk)("div",an,[(0,l.bF)(u,{class:"all_block"},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{class:"body_block"},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{class:"title"},{default:(0,l.k6)((function(){return[(0,l.eW)("专业")]})),_:1}),(0,l.bF)(d,{class:"detail"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(r.currentMajorName),1)]})),_:1})]})),_:1}),(0,l.bF)(d,null,{default:(0,l.k6)((function(){return[(0,l.bF)(d,{class:"title"},{default:(0,l.k6)((function(){return[(0,l.eW)("年级")]})),_:1}),(0,l.bF)(d,{class:"detail"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(r.currentYear),1)]})),_:1})]})),_:1}),(0,l.bF)(d)]})),_:1})])])]),(0,l.bF)(g,{modelValue:r.drawer,"onUpdate:modelValue":t[3]||(t[3]=function(e){return r.drawer=e})},{default:(0,l.k6)((function(){return[(0,l.bF)(u,null,{default:(0,l.k6)((function(){return[(0,l.bF)(d,{span:14},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{msg:"搜索专业名称",onSearchValue:a.getSearchValue},null,8,["onSearchValue"])]})),_:1}),(0,l.bF)(d,{span:10},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{modelValue:r.year,"onUpdate:modelValue":t[1]||(t[1]=function(e){return r.year=e}),placeholder:"选择培养方案版本",clearable:"",onChange:t[2]||(t[2]=function(e){return a.getCopyProgram()})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.enroll_year,(function(e){return(0,l.uX)(),(0,l.Wv)(f,{key:e.dictValue,label:e.dictLabel,value:e.dictLabel},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1})]})),_:1}),(0,l.bF)(u,{style:{"margin-top":"40px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{data:r.programList,style:{width:"100%"},onRowClick:a.copy},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{prop:"majorName",label:"专业名称","min-width":"180px"}),(0,l.bF)(p,{prop:"enrollyear",label:"版本","min-width":"180px"})]})),_:1},8,["data","onRowClick"])]})),_:1})]})),_:1},8,["modelValue"]),(0,l.bF)(y,{modelValue:r.dialogVisible,"onUpdate:modelValue":t[7]||(t[7]=function(e){return r.dialogVisible=e}),title:"从其他大纲复制",width:"400px"},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",sn,[(0,l.bF)(I,{onClick:t[5]||(t[5]=function(e){return r.dialogVisible=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(I,{type:"primary",onClick:t[6]||(t[6]=function(e){return a.confirm()})},{default:(0,l.k6)((function(){return[(0,l.eW)("确认")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(u,{style:{"margin-bottom":"20px","font-size":"15px"}},{default:(0,l.k6)((function(){return[(0,l.eW)("从《"+(0,C.v_)(r.currentRow.majorName)+"》"+(0,C.v_)(r.currentRow.enrollyear)+" 级 培养方案复制以下内容：",1)]})),_:1}),(0,l.bF)(v,{modelValue:r.checkList,"onUpdate:modelValue":t[4]||(t[4]=function(e){return r.checkList=e})},{default:(0,l.k6)((function(){return[(0,l.bF)(k,{label:"毕业要求和指标点"}),(0,l.bF)(k,{label:"课程体系"}),(0,l.bF)(k,{label:"达成度"})]})),_:1},8,["modelValue"])]})),_:1},8,["modelValue"])],64)}var cn={class:"bar"},un={class:"searchBlock"},dn={class:"searchLine"};function hn(e,t,o,n,r,a){var s=(0,l.g2)("Search"),i=(0,l.g2)("el-icon"),c=(0,l.g2)("el-input");return(0,l.uX)(),(0,l.CE)("div",cn,[(0,l.Lk)("div",un,[(0,l.bF)(i,{class:"iconSearch",size:"24px",color:"rgb(137, 137, 137)"},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1}),(0,l.Lk)("div",dn,[(0,l.bF)(c,{class:(0,C.C4)(["searchInput",r.active?"activeInput":""]),modelValue:r.searchInput,"onUpdate:modelValue":t[0]||(t[0]=function(e){return r.searchInput=e}),placeholder:o.msg,onChange:a.sendMessage,onFocus:t[1]||(t[1]=function(e){return r.active=!0}),onBlur:t[2]||(t[2]=function(e){return a.inputBlur()}),clearable:"",onClear:t[3]||(t[3]=function(e){return a.clearInput()})},null,8,["class","modelValue","placeholder","onChange"])])]),(0,l.RG)(e.$slots,"version",{class:"rightSlot"},void 0,!0)])}const fn={name:"DrawerSearch",props:{msg:String},components:{Search:ee.vji},data:function(){return{searchInput:"",active:!1}},methods:{sendMessage:function(){this.$emit("SearchValue",this.searchInput)},inputBlur:function(){""===this.searchInput?this.active=!1:this.active=!0},clearInput:function(){this.searchInput="",this.inputBlur()}}},mn=(0,h.A)(fn,[["render",hn],["__scopeId","data-v-5eb73ed6"]]),pn=mn;function bn(e,t,o,n){return Q({url:"/detailProgram/courseIndicator",method:"get",params:{bcdmId:e,departmentId:t,schoolId:o,programId:n}})}function gn(e,t,o){return Q({url:"/detailProgram/listProgram",method:"get",params:{detailId:e,departmentId:t,schoolId:o}})}function kn(e){return Q({url:"/detailProgram/indicatorAll/"+e,method:"get"})}function vn(e){return Q({url:"/detail/"+e,method:"get"})}function In(e){return Q({url:"/detail",method:"PUT",data:e})}function yn(e){return Q({url:"/classes/editAssessmentMethod",method:"POST",data:e})}function Cn(e){return Q({url:"/detailProgram",method:"PUT",data:e})}function An(e,t,o){return Q({url:"/detail/list",method:"get",params:{courseId:e,departmentId:t,schoolId:o}})}function Fn(e){return Q({url:"/classes/setDetail",method:"POST",data:e})}function wn(e){return Q({url:"/detail/getFile/"+e,method:"GET"})}function Sn(e,t,o,n){return Q({url:"/detail/select",method:"get",params:{selectKeyWord:e,versionId:t,pageSize:o,pageNum:n}})}function _n(){return Q({url:"/detail/versionList",method:"get"})}function En(e){return Q({url:"/detail/copy",method:"PUT",data:e})}function Nn(e){return Q({url:"/detailProgram/copy",method:"PUT",data:e})}function Vn(e){return Q({url:"/program/copy",method:"PUT",data:e})}function xn(e){return Q({url:"/analysis",method:"POST",data:e})}function Tn(e){return Q({url:"/analysis",method:"PUT",data:e})}function jn(e){return Q({url:"/analysis",method:"DELETE",data:e})}function Ln(e){return Q({url:"/analysis/list/?detailId="+e,method:"get"})}function Dn(e){return Q({url:"/analysis/"+e,method:"get"})}const Bn={name:"Setting",components:{DrawerSearch:pn,CopyDocument:ee.TZn,List:ee.B8B},data:function(){return{programId:"",year:"",enroll_year:[],checkList:["毕业要求和指标点","课程体系","达成度"],currentRow:[],programList:[],keyword:"",drawer:!1,dialogVisible:!1,currentMajorId:"",currentMajorName:"",departmentId:"",schoolId:"",currentYear:"",noProgram:Boolean}},computed:{yearChange:function(){return this.$store.state.currentInfo.year}},watch:{yearChange:{deep:!0,handler:function(e){this.currentYear=this.$store.state.currentInfo.year,this.checkProgram()}}},mounted:function(){this.currentMajorId=this.$store.state.major.majorId,this.currentMajorName=this.$store.state.major.majorName,this.currentYear=this.$store.state.currentInfo.year,this.departmentId=this.$store.state.currentInfo.departmentId,this.schoolId=this.$store.state.currentInfo.schoolId,this.getDictionary(),this.checkProgram()},methods:{getDictionary:function(){var e=this;qt().then((function(t){console.log("getDictionary",t),e.enroll_year=t.enroll_year}))},checkProgram:function(){var e=this;ve(this.currentMajorId,this.currentYear).then((function(t){console.log("checkProgram",t),e.programId=t.data.programId,e.noProgram=!1}))["catch"]((function(t){"PROGRAM_NOT_FIND"===t.code&&"资源不存在"===t.msg&&(e.noProgram=!0)}))},openDrawer:function(){this.drawer=!0,this.getCopyProgram()},getSearchValue:function(e){this.keyword=e,this.getCopyProgram()},getCopyProgram:function(){var e=this;Fe(this.schoolId,this.departmentId,this.keyword,this.year).then((function(t){e.programList=t.rows,console.log("查询对应的专业 ",e.programList)}))},copy:function(e){console.log("copy",e),this.currentRow=e,this.dialogVisible=!0},confirm:function(){var e=this;!1===this.noProgram?this.copyInfo():P.s.confirm("暂未创建培养方案，是否需要创建？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.addProgram()}))["catch"]((function(){}))},addProgram:function(){var e=this;ye(this.currentMajorId,this.departmentId,this.schoolId,this.currentYear).then((function(t){console.log("addProgram",t),ve(e.currentMajorId,e.currentYear).then((function(t){console.log("checkProgram",t),e.programId=t.data.programId,console.log("@",e.programId),e.noProgram=!1,e.copyInfo()}))["catch"]((function(t){"PROGRAM_NOT_FIND"===t.code&&"资源不存在"===t.msg&&(e.noProgram=!0)}))}))},copyInfo:function(){var e=this,t={};t.sourceProgramId=this.currentRow.programId,t.targetProgramId=this.programId,-1!==this.checkList.indexOf("毕业要求和指标点")?t.isCopyGraduateAttribute=1:t.isCopyGraduateAttribute=0,-1!==this.checkList.indexOf("课程体系")?t.isCopyCourseSystem=1:t.isCopyCourseSystem=0,-1!==this.checkList.indexOf("达成度")?t.isCopyAchievement=1:t.isCopyAchievement=0,Vn(t).then((function(t){console.log("copyActAndObj",t),e.dialogVisible=!1,"SUCCESS"==t.code&&((0,G.nk)({type:"success",message:"复制成功",duration:1500}),e.drawer=!1)}))}}},$n=(0,h.A)(Bn,[["render",ln],["__scopeId","data-v-e78663ac"]]),On=$n;var Mn=function(e){return(0,l.Qi)("data-v-47d6395c"),e=e(),(0,l.jt)(),e},Un={style:{width:"auto",height:"55px","border-bottom":"1px solid rgb(189, 189, 189)",display:"flex"}},Wn={class:"rightSlot"},Rn={class:"selectionBar"},Pn={class:"submenu"},Gn={class:"numSelectedCourse"},zn={layout:"row",flex:"",class:"md-padding"},Yn={class:"el-table-container"},Xn={class:"no-program"},Qn={layout:"row",flex:"",class:"md-padding"},Kn=Mn((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","margin-top":"100px","font-size":"22px"}}," 没有课程 ",-1)})),Jn=Mn((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center",color:"grey","font-size":"13px","margin-top":"30px"}}," 请先点击右上角圆形按钮添加课程 ",-1)})),Hn={style:{"margin-top":"7px",width:"150px"}},qn=Mn((function(){return(0,l.Lk)("div",{style:{width:"1px"}},null,-1)})),Zn={class:"drawerBlock",flex:""},er={style:{flex:"auto"},class:"drawerFooter"},tr={class:"pagination-container",flex:""},or={class:"no-program"},nr=Mn((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","margin-top":"100px","font-size":"22px"}}," 未创建培养方案 ",-1)})),rr=Mn((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center",color:"grey","margin-top":"30px","font-size":"13px"}}," 请先创建培养方案 ",-1)})),ar=[nr,rr],sr={class:"assignDialog"},ir={class:"dialog-footer"};function lr(e,t,o,n,r,a){var s=this,c=(0,l.g2)("Back"),u=(0,l.g2)("el-icon"),d=(0,l.g2)("el-divider"),h=(0,l.g2)("el-option"),f=(0,l.g2)("el-select"),m=(0,l.g2)("HeaderSearch"),p=(0,l.g2)("el-button"),b=(0,l.g2)("el-col"),g=(0,l.g2)("MoreFilled"),k=(0,l.g2)("Delete"),v=(0,l.g2)("el-dropdown-item"),I=(0,l.g2)("el-dropdown-menu"),y=(0,l.g2)("el-dropdown"),A=(0,l.g2)("el-row"),F=(0,l.g2)("addBtn"),w=(0,l.g2)("el-table-column"),S=(0,l.g2)("el-table"),_=(0,l.g2)("Plus"),E=(0,l.g2)("el-tag"),N=(0,l.g2)("el-tooltip"),V=(0,l.g2)("el-drawer"),x=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bo)((0,l.Lk)("div",null,[(0,l.bo)((0,l.Lk)("div",null,[(0,l.Lk)("div",Un,[(0,l.bF)(u,{class:"backIcon",size:"24px",color:"rgb(137, 137, 137)",onClick:t[0]||(t[0]=function(e){return a.backCourse()})},{default:(0,l.k6)((function(){return[(0,l.bF)(c)]})),_:1}),(0,l.bF)(d,{class:"divider",direction:"vertical"})]),(0,l.bo)((0,l.bF)(m,{msg:"搜索课程名称",onSearchValue:a.getSearchValueformProgram,class:"SearchBar"},{rightTime:(0,l.k6)((function(){return[(0,l.Lk)("div",Wn,[(0,l.Lk)("div",Rn,[(0,l.bF)(f,{modelValue:r.chosenYear,"onUpdate:modelValue":t[1]||(t[1]=function(e){return r.chosenYear=e}),class:"selecter",placeholder:"全部学年",onChange:t[2]||(t[2]=function(e){return a.getProgramCourse()})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.academicYear,(function(e){return(0,l.uX)(),(0,l.Wv)(h,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"]),(0,l.bF)(f,{modelValue:r.chosenSemester,"onUpdate:modelValue":t[3]||(t[3]=function(e){return r.chosenSemester=e}),placeholder:"全部学期",class:"selecter",onChange:t[4]||(t[4]=function(e){return a.getProgramCourse()})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.semester,(function(e){return(0,l.uX)(),(0,l.Wv)(h,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])])])]})),_:1},8,["onSearchValue"]),[[i.aG,!r.closeShow]]),(0,l.bo)((0,l.Lk)("div",Pn,[(0,l.bF)(A,{class:"rowStyle"},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{span:2},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{onClick:t[5]||(t[5]=function(e){return s.toggleSelection()}),style:{float:"right"},class:"clearSelected"},{default:(0,l.k6)((function(){return[(0,l.eW)("取消选择")]})),_:1})]})),_:1}),(0,l.bF)(b,{span:16},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",Gn,"已选中 "+(0,C.v_)(r.numSelected)+" 门课程",1)]})),_:1}),(0,l.bF)(b,{span:4},{default:(0,l.k6)((function(){return[(0,l.bF)(y,{class:"dropdownstyle"},{dropdown:(0,l.k6)((function(){return[(0,l.bF)(I,null,{default:(0,l.k6)((function(){return[(0,l.bF)(v,{onClick:t[6]||(t[6]=function(e){return s.deleteBaseCourse()})},{default:(0,l.k6)((function(){return[(0,l.bF)(u,null,{default:(0,l.k6)((function(){return[(0,l.bF)(k)]})),_:1}),(0,l.eW)("  删除支撑课程课程 ")]})),_:1})]})),_:1})]})),default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"dropdownIcon"},{default:(0,l.k6)((function(){return[(0,l.bF)(g)]})),_:1})]})),_:1})]})),_:1})]})),_:1})],512),[[i.aG,r.closeShow]]),(0,l.Lk)("div",zn,[(0,l.bF)(F,{onClick:t[7]||(t[7]=function(e){return s.drawerShow()})}),(0,l.Lk)("div",Yn,[(0,l.bF)(S,{data:r.drawertableData,ref:"multipleTable",style:{width:"1195px"},"header-cell-style":{"padding-left":"20px","font-size":"14.4px",height:"48px","font-weight":"bold",color:"black"},"cell-style":{"padding-left":"20px","font-size":"16px",height:"60px","text-overflow":"ellipsis","white-space":"nowrap",cursor:"pointer"},"row-key":a.rowKey,onRowClick:a.goBaseCourseDetail,onSelectionChange:a.handleSelectionChange},{default:(0,l.k6)((function(){return[(0,l.bF)(w,{type:"selection",width:"55","column-key":"select","reserve-selection":!0}),(0,l.bF)(w,{prop:"className",label:"课程名",width:"190"}),(0,l.bF)(w,{prop:"allTeacherName",label:"任课教师",width:"150"}),(0,l.bF)(w,{prop:"courseCode",label:"课程号",width:"150"}),(0,l.bF)(w,{prop:"versionName",label:"大纲版本",width:"120"}),(0,l.bF)(w,{prop:"identifier",label:"开课号",width:"270"}),(0,l.bF)(w,{prop:"academicYear",label:"学年",width:"140"}),(0,l.bF)(w,{prop:"semester",label:"学期",width:"120"})]})),_:1},8,["data","row-key","onRowClick","onSelectionChange"])])])],512),[[i.aG,r.hasCourse]]),(0,l.bo)((0,l.Lk)("div",Xn,[(0,l.bo)((0,l.bF)(m,{onSearchValue:a.getSearchValueformProgram},null,8,["onSearchValue"]),[[i.aG,!r.closeShow]]),(0,l.Lk)("div",Qn,[(0,l.bF)(F,{onClick:t[8]||(t[8]=function(e){return s.drawerShow()})})]),Kn,Jn],512),[[i.aG,!r.hasCourse]]),(0,l.bF)(V,{modelValue:r.drawer,"onUpdate:modelValue":t[13]||(t[13]=function(e){return r.drawer=e}),direction:r.direction,size:"690","show-close":!0,onClose:a.closeDrawer},{header:(0,l.k6)((function(e){var o=e.titleId,n=e.titleClass;return[(0,l.bF)(A,{id:o,class:(0,C.C4)(n)},{default:(0,l.k6)((function(){return[(0,l.bF)(A,{style:{width:"100%"}},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{span:17},{default:(0,l.k6)((function(){return[(0,l.bF)(A,{style:{width:"200px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{class:"searchIndrawer",msg:"搜索课程名称",onSearchValue:a.getSearchValue},null,8,["onSearchValue"])]})),_:1})]})),_:1}),(0,l.bF)(b,{span:6},{default:(0,l.k6)((function(){return[(0,l.bF)(A,null,{default:(0,l.k6)((function(){return[(0,l.bF)(f,{modelValue:r.currentVersion,"onUpdate:modelValue":t[9]||(t[9]=function(e){return r.currentVersion=e}),onChange:t[10]||(t[10]=function(e){return a.getCourseByYear(r.currentVersion)})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.versions,(function(e){return(0,l.uX)(),(0,l.Wv)(h,{key:e.versionId,label:e.label,value:e.versionId},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1})]})),_:1})]})),_:1}),(0,l.bF)(A,{class:"drawersubmenu"},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{span:16},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",Hn," 已选中 "+(0,C.v_)(r.drawernumSelected-r.programInfoCourseCount)+" 节基础课程 ",1)]})),_:1}),(0,l.bF)(b,{span:1},{default:(0,l.k6)((function(){return[qn]})),_:1}),(0,l.bF)(b,{span:3,class:"drawerdeleteButton"},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(p,{onClick:t[11]||(t[11]=function(e){return s.getBCMId()})},{default:(0,l.k6)((function(){return[(0,l.bF)(u,null,{default:(0,l.k6)((function(){return[(0,l.bF)(_,{class:"iconSize"})]})),_:1})]})),_:1},512),[[i.aG,r.drawernumSelected-r.programInfoCourseCount]])]})),_:1})]})),_:1})]})),_:2},1032,["id","class"])]})),default:(0,l.k6)((function(){return[(0,l.Lk)("div",Zn,[(0,l.Lk)("div",null,[(0,l.bF)(S,{data:r.tableData,ref:"drawermultipleTable",style:{cursor:"pointer"},width:"645",onSelectionChange:a.drawerchandleSelectionChange,"row-key":a.rowKey},{default:(0,l.k6)((function(){return[(0,l.bF)(w,{width:"55",type:"selection",selectable:a.selectable,"reserve-selection":!0,"column-key":"select"},null,8,["selectable"]),(0,l.bF)(w,{prop:"className",label:"课程名",width:"180"}),(0,l.bF)(w,{prop:"allTeacherName",label:"任课教师",width:"150"}),(0,l.bF)(w,{prop:"courseCode",label:"课程号",width:"100"}),(0,l.bF)(w,{label:"大纲版本",width:"150"},{default:(0,l.k6)((function(e){return[(0,l.bo)((0,l.bF)(E,null,{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.row.versionName),1)]})),_:2},1536),[[i.aG,e.row.versionId]]),(0,l.bF)(N,{content:"关联课程大纲"},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(E,{type:"danger",onClick:(0,i.D$)((function(t){return a.connectBasecourseDetail(e.row)}),["stop"])},{default:(0,l.k6)((function(){return[(0,l.eW)(" 未关联课程大纲 ")]})),_:2},1032,["onClick"]),[[i.aG,!e.row.versionId]])]})),_:2},1024)]})),_:1})]})),_:1},8,["data","onSelectionChange","row-key"])])]),(0,l.Lk)("div",er,[(0,l.Lk)("div",tr,[(0,l.bF)(A,{type:"flex",justify:"center",align:"middle",class:"loadmorestyle"},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(p,{disabled:r.loadmoreDisabled,link:"",plain:"",onClick:t[12]||(t[12]=function(e){return a.loadmoreCourse()})},{default:(0,l.k6)((function(){return[(0,l.eW)("加载更多")]})),_:1},8,["disabled"]),[[i.aG,r.showLoadmore]])]})),_:1})])])]})),_:1},8,["modelValue","direction","onClose"])],512),[[i.aG,r.hasProgram]]),(0,l.bo)((0,l.Lk)("div",or,ar,512),[[i.aG,!r.hasProgram]]),(0,l.Lk)("div",sr,[(0,l.bF)(x,{modelValue:r.isAssign,"onUpdate:modelValue":t[17]||(t[17]=function(e){return r.isAssign=e}),title:"设置课程大纲",width:"330px","show-close":!1,"align-center":!0},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",ir,[(0,l.bF)(p,{onClick:t[15]||(t[15]=function(e){return r.isAssign=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(p,{type:"primary",onClick:t[16]||(t[16]=function(e){return a.confirmAssign()})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(f,{modelValue:r.assignedDetail,"onUpdate:modelValue":t[14]||(t[14]=function(e){return r.assignedDetail=e}),style:{width:"250px","margin-left":"20px"},placeholder:"选择课程大纲版本"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.detailList,(function(e,t){return(0,l.uX)(),(0,l.Wv)(h,{key:t,label:e.versionInfo,value:e.detailId},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1},8,["modelValue"])])],64)}o(13609);function cr(e,t,o,n,r,a,s,i){return Q({url:"/classes/list",method:"get",params:{academicYear:e,semester:t,departmentId:o,schoolId:n,pageSize:r,pageNum:a,selectKeyWord:s,status:i}})}function ur(e,t,o,n,r,a,s,i,l){return Q({url:"/classes/add",method:"POST",data:{academicYear:e,semester:t,departmentId:o,className:n,identifier:r,teacherNumber:a,courseCode:s,remark:i,schoolId:l}})}function dr(e){return Q({url:"/classes/edit",method:"POST",data:e})}function hr(e){return Q({url:"/classes/setClassIsRespondent",method:"POST",data:e})}function fr(e){return Q({url:"/classes/"+e,method:"DELETE"})}function mr(e){return Q({url:"/classes/"+e,method:"GET"})}function pr(e){return Q({url:"/classes/associateCourse",method:"POST",data:e})}function br(e){return Q({url:"/classes/submit/"+e,method:"POST"})}function gr(e,t,o){return Q({url:"/review",method:"POST",data:{classId:e,remark:t.message,resultStatus:o}})}function kr(e){return Q({url:"/review/list",method:"GET",params:{classId:e}})}function vr(e){return Q({url:"/review/"+e,method:"DELETE"})}function Ir(e){return Q({url:"/classes/exportReport/"+e,method:"POST",responseType:"blob"})}const yr={name:"courseDetail",components:{HeaderSearch:ne,ElIcon:de.tk,ElButton:me.S2,ElTable:pe.Up,ElMessage:G.nk,ElMessageBox:P.s,ElDialog:be.kZ,ElSelect:Jt.AV,ElOption:Jt.P9,Back:ee.kcb,FolderChecked:ee.KHk,InfoFilled:ee.N_H,Loading:ee.Rhj,Search:ee.vji,Close:ee.bm,Plus:ee.FWt,Delete:ee.epd,Edit:ee.ffu,addBtn:le,ElTag:ke.u,ElCheckbox:Ht.dI,Document:ee.yoT,ElDropdown:ge.dW,MoreFilled:ee.yGC,CircleCloseFilled:ee.BZj},data:function(){return{supportingId:[],detailList:[],assignedDetail:"",currentConnectingClass:[],isAssign:!1,currentInfo:{departmentId:Number,schoolId:Number},chosenYear:"",chosenSemester:"",academicYear:"",semester:"",loadmoreDisabled:Boolean,currentVersionName:"",courseTypeSource:[],courseNatureSource:[],keyword:"",keywordforProgrameCourse:"",showLoadmore:!0,hasProgram:Boolean,hasCourse:Boolean,checkList:(0,ce.KR)([" "]),supportingClass:[],programeInfo:[],programInfoCourseId:[0,0],programInfoCourseCount:0,deleteProgrameInfo:[{bcdmId:0,courseId:0,detailId:0,groupId:0,programId:0}],programeCourseInfo:[{courseId:0,versionId:0}],drawer:!1,direction:"ltr",drawercloseShow:(0,ce.KR)(!1),drawermultipleSelection:[],drawernumSelected:0,drawerclickState:0,drawercourseId:[],drawerCourseIndex:[],drawerresult:(0,ce.Kh)({}),drawertableData:[],origintableData:[],departmentId:"",schoolId:"",majorId:Number,majorName:"",programId:"",closeShow:(0,ce.KR)(!1),multipleSelection:[],numSelected:0,clickState:0,dialogFormVisible:(0,ce.KR)(!1),dialogFormVisible1:(0,ce.KR)(!1),formLabelWidth:"140px",form:(0,ce.Kh)({courseName:"",courseCode:"",courseType:"",courseNature:"",credit:"",courseYear:"",remark:""}),preform:(0,ce.Kh)({courseName:"",courseCode:"",courseType:"",courseNature:"",credit:"",courseYear:"",remark:""}),tableData:[],pageSize:(0,ce.KR)(20),pageNum:(0,ce.KR)(1),searchItems:{programId:"",courseId:"",courseName:""},sortBy:{option1:"",option2:""},searchCourseId:[0,0],currentVersion:"",currentVersionValue:1,currentVersionId:"",versions:[],versionLabel:[],result:(0,ce.Kh)({}),option1:[{value:"更新时间",label:"更新时间⬇"},{value:"创建时间",label:"创建时间⬇"},{value:"名称",label:"名称"}],option2:[{value:"全部",label:"全部"},{value:"已完成设置",label:"已完成设置"},{value:"未完成设置",label:"未完成设置"},{value:"回收站",label:"回收站"}]}},methods:{closeDrawer:function(){console.log("close drawer!"),this.drawercourseId=[],this.drawerCourseIndex=[],this.supportingClass=[],this.$refs.drawermultipleTable.clearSelection()},getDetailList:function(){var e=this;An(this.currentConnectingClass.courseId,this.currentInfo.departmentId,this.currentInfo.schoolId).then((function(t){console.log("getDetailList",t),e.detailList=t.rows,e.detailList.forEach((function(e){e.versionInfo=e.courseName+"-"+e.versionName}))}))},backCourse:function(){this.$router.push("/courses")},drawerClose:function(){this.$refs.drawermultipleTable.clearSelection(),this.drawer=!1},getSearchValueformProgram:function(e){console.log("searching for class"),this.keywordforProgrameCourse=e,this.getProgramCourse()},getDict:function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){var o;return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:o=e,1,e.versions=[],e.versionLabel=[],qt().then((function(t){console.log("Dict:",t),t.course_nature.forEach((function(e){o.courseNatureSource.push(e.dictLabel)})),t.course_type.forEach((function(e){o.courseTypeSource.push(e.dictLabel)})),e.academicYear=t.academic_year,e.semester=t.semester;var n={dictLabel:"全部学年",dictValue:null};e.academicYear.unshift(n);var r={dictLabel:"全部学期",dictValue:null};e.semester.unshift(r)})).then((function(){e.checkCurrentProgram()}));case 5:case"end":return t.stop()}}),t)})))()},getSearchValue:function(e){this.keyword=e,this.getBaseCourse()},getSearchValueforClass:function(e){this.keyword=e,this.getBaseCourse()},rowKey:function(e){return e.courseId},connectBasecourseDetail:function(e){console.log("connecting to bcd"),this.currentConnectingClass=e,this.getDetailList(),this.isAssign=!0},confirmAssign:function(){var e=this;console.log("connecting info:",this.currentConnectingClass);var t={};this.detailList.forEach((function(o){e.assignedDetail==o.detailId&&(t=o)}));var o=[{classId:this.currentConnectingClass.classId,detailId:this.assignedDetail,versionId:t.versionId,versionName:t.versionName}];Fn(o).then((function(t){"SUCCESS"===t.code?(e.isAssign=!1,(0,G.nk)({type:"success",message:"分配成功",duration:1500}),e.currentConnectingClass=[],e.getBaseCourse()):(0,G.nk)({type:"error",message:"分配失败",duration:1500})}))},loadmoreCourse:function(){this.$refs.drawermultipleTable.clearSelection(),this.result.total-this.pageSize>=20?(this.pageSize+=20,this.getBaseCourse()):(this.pageSize+=this.result.total-this.pageSize,this.getBaseCourse())},goBaseCourseDetail:function(e,t){console.log("row",e)},checkProgram:function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$store.state.major.programId?e.hasProgram=!0:e.hasProgram=!1,console.log("hasProgram",e.hasProgram);case 2:case"end":return t.stop()}}),t)})))()},drawerShow:function(){console.log("drawerShow:"),this.drawer=!0,this.getBaseCourse()},selectable:function(e,t){return e.remark?!e.remark:!!e.versionId||e.versionId},getDetail:function(e){var t=this,o="";return Q({url:"/detail/list?vesionId="+this.currentVersionId+"&courseId="+e,method:"get"}).then((function(e){return console.log("getDetail:",e),e.rows.forEach((function(e){e.versionId==t.currentVersionId&&(console.log("detailId",e.detailId),o=e.detailId)})),o}))},getCourseByYear:function(e){this.currentVersionId=e,this.$store.commit("course/setbaseCourseVersionId",this.currentVersionId);var t,o=(0,Qt.A)(this.versions);try{for(o.s();!(t=o.n()).done;){var n=t.value;n["versionId"]==this.currentVersionId&&(this.currentVersionName=n["label"])}}catch(err){o.e(err)}finally{o.f()}this.getBaseCourse()},getProgramCourse:function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){var o;return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=e,e.drawertableData=[],e.origintableData=[],console.log("getting supporting class"),t.abrupt("return",Q({url:"/classes/supportingClass/list",method:"get",params:{schoolId:e.schoolId,departmentId:e.departmentId,bcdmId:e.$store.state.baseCourseDetailProgram.bcdmId,courseId:e.$store.state.baseCourseDetailProgram.classId,academicYear:e.chosenYear,semester:e.chosenSemester,selectKeyWord:e.keywordforProgrameCourse}}).then((function(e){if(console.log("getClassList",e),"SUCCESS"===e.code&&(o.drawertableData=e.rows,0==o.drawertableData.length?(o.noClass=!0,o.hasClass=!1):(o.hasClass=!0,o.noClass=!1),o.total=e.total,o.pageSize>=e.total?o.showLoadmore=!1:o.showLoadmore=!0,o.drawertableData.length>0)){o.programInfoCourseCount=o.drawertableData.length;for(var t=function(e){o.drawertableData[e].allTeacherName=o.drawertableData[e].teacherName,null!==o.drawertableData[e].additionalTeacherList&&o.drawertableData[e].additionalTeacherList.forEach((function(t){o.drawertableData[e].allTeacherName=o.drawertableData[e].allTeacherName+","+t.teacherName})),o.drawertableData[e].teachers=[];var t=o.drawertableData[e].teacherName+"("+o.drawertableData[e].teacherNumber+")";o.drawertableData[e].teachers.push(t),null!==o.drawertableData[e].additionalTeacherList&&o.drawertableData[e].additionalTeacherList.forEach((function(t){var n=t.teacherName+"("+t.teacherNumber+")";o.drawertableData[e].teachers.push(n)})),o.academicYear.forEach((function(t){t.dictValue==o.drawertableData[e].academicYear&&(o.drawertableData[e].academicYear=t.dictLabel)})),o.semester.forEach((function(t){t.dictValue==o.drawertableData[e].semester&&(o.drawertableData[e].semester=t.dictLabel)}))},n=0;n<o.drawertableData.length;n++)t(n)}}))["catch"]((function(e){console.log("e",e),o.hasCourse=!1})));case 5:case"end":return t.stop()}}),t)})))()},clearForm:function(){this.form.courseId="",this.form.courseName="",this.form.courseCode="",this.form.courseType="",this.form.courseNature="",this.form.credit="",this.form.courseYear="",this.form.remark=""},postDataToform:function(e){this.preform.courseId=e.courseId,this.preform.courseName=e.courseName,this.preform.courseCode=e.courseCode,this.preform.courseType="学科基础课"==e.courseType?"0":"1",this.preform.courseNature="专业任选"==e.courseNature?"0":"1",this.preform.credit=e.credit,this.preform.courseYear="2022"==e.courseYear?"0":"1",this.preform.remark=e.remark},deleteBaseCourse:function(){var e=this;P.s.confirm("是否确认将所选支撑课程从课程体系中移除？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){return Q({url:"/classes/supportingClass/remove",method:"delete",data:e.supportingId}).then((function(t){console.log("res",t),"SUCCESS"==t.code&&((0,G.nk)({type:"success",message:"删除成功",duration:1500}),e.getProgramCourse(),e.$refs.multipleTable.clearSelection(),e.numSelected=0,1==e.clickState&&(e.clickState=0,e.closeShow=!e.closeShow))}))["catch"]((function(e){console.log("e",e),(0,G.nk)({type:"error",message:"删除失败",duration:1500})}))}))},getBCMId:function(){var e=this;console.log("currentVersionName",this.currentVersionName);var t="是否确认将所选教学班添加到支撑课程中 ？";P.s.confirm(t,"",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.addBaseCourseInProgram()}))},addBaseCourseInProgram:function(){for(var e=this,t=[],o=this.programInfoCourseCount;o<this.supportingClass.length;o++)t.push(this.supportingClass[o]);return console.log("supporting class add info",t),Q({url:"/classes/supportingClass/add",method:"post",data:t}).then((function(t){"SUCCESS"==t.code&&((0,G.nk)({type:"success",message:"新建成功",duration:1500}),e.supportingClass=[],e.drawercourseId=[],e.drawerCourseIndex=[],e.getProgramCourse(),e.getBaseCourse(),e.$refs.drawermultipleTable.clearSelection(),1==e.drawerclickState&&(e.drawerclickState=0,e.drawercloseShow=!e.drawercloseShow))}))["catch"]((function(t){console.log("e",t),409===t.status?(0,G.nk)({type:"error",message:"新建失败,课程已存在",duration:1500}):500===t.status?(0,G.nk)({type:"error",message:"新建出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500}),e.drawercourseId=[],e.drawerCourseIndex=[],e.$refs.drawermultipleTable.clearSelection(),1==e.drawerclickState&&(e.drawerclickState=0,e.drawercloseShow=!e.drawercloseShow)}))},handleSelectionChange:function(e){var t=this,o=[],n=[],r=[];this.multipleSelection=e,console.log("选中的信息：",e),e.forEach((function(e){var a={courseId:e.courseId,programId:t.programId,detailId:e.detailId,bcdmId:e.bcdmId};r.push(a),o.push(e.courseId),n.push(e.supportingId)})),this.numSelected=this.multipleSelection.length,1!=this.clickState&&(this.closeShow=!this.closeShow,this.clickState=1),1==this.clickState&&0==this.numSelected&&(this.clickState=0,this.closeShow=!this.closeShow),this.courseId=o,this.supportingId=n,this.deleteProgrameInfo=r,console.log("supportingId:",this.supportingId),console.log("deleteProgrameInfo:",this.deleteProgrameInfo)},drawerchandleSelectionChange:function(e){var t=this,o=[],n=[],r=[];this.drawermultipleSelection=e,console.log("选中的信息：",e),e.forEach((function(e){o.push(e.classId),n.push(e.index);var a={bcdmId:t.$store.state.baseCourseDetailProgram.bcdmId,classId:e.classId,className:e.className,courseCode:e.courseCode,courseId:e.courseId,schoolId:e.schoolId,teacherId:e.teacherId};r.push(a)})),this.drawernumSelected=this.drawermultipleSelection.length,this.supportingClass=r,1!=this.drawerclickState&&(this.drawercloseShow=!this.drawercloseShow,this.drawerclickState=1),1==this.drawerclickState&&0==this.drawernumSelected&&(this.drawerclickState=0,this.drawercloseShow=!this.drawercloseShow),this.drawercourseId=o,this.drawerCourseIndex=n,console.log("classId:",this.drawercourseId,"courseIndex:",this.drawerCourseIndex,"supporting class:",this.supportingClass)},toggleSelection:function(e){var t=this;e?e.forEach((function(e){t.$refs.multipleTable.toggleRowSelection(e)})):(this.$refs.multipleTable.clearSelection(),1==this.clickState&&(this.clickState=0,this.closeShow=!this.closeShow))},drawertoggleSelection:function(e){e||(this.$refs.drawermultipleTable.clearSelection(),1==this.drawerclickState&&(this.drawerclickState=0,this.drawercloseShow=!this.drawercloseShow))},getBaseCourse:function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){var o,n,r;return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:o=e,n=[],r=0,e.loadmoreDisabled=!0,cr(e.chosenYear,e.chosenSemester,e.currentInfo.departmentId,e.currentInfo.schoolId,e.pageSize,e.pageNum,e.keyword,e.chosenStatus).then((function(t){console.log("getClassList",t),e.loadmoreDisabled=!1,"SUCCESS"===t.code&&(e.result=t,t.rows.forEach((function(t){t.index=r,t.allTeacherName=t.teacherName,null!==t.additionalTeacherList&&t.additionalTeacherList.forEach((function(e){t.allTeacherName=t.allTeacherName+","+e.teacherName})),t.teachers=[];var o=t.teacherName+"("+t.teacherNumber+")";t.teachers.push(o),null!==t.additionalTeacherList&&t.additionalTeacherList.forEach((function(e){var o=e.teacherName+"("+e.teacherNumber+")";t.teachers.push(o)})),e.academicYear.forEach((function(e){e.dictValue==t.academicYear&&(t.academicYear=e.dictLabel)})),e.semester.forEach((function(e){e.dictValue==t.semester&&(t.semester=e.dictLabel)})),n.push(t),r++})),o.drawertableData.forEach((function(e){try{n.forEach((function(t){if(!t.remark){if(e.classId==t.classId)throw t.remark=!0,new Error("remark");t.remark=!1}}))}catch(t){if("remark"!=t.message)throw t}})),e.tableData=n,e.total=t.total,0==e.tableData.length?(e.noClass=!0,e.hasClass=!1):(e.hasClass=!0,e.noClass=!1),e.pageSize>=t.total?e.showLoadmore=!1:e.showLoadmore=!0,console.log("#",e.tableData))})).then((function(){o.tableData.forEach((function(e){e.remark&&o.$refs.drawermultipleTable.toggleRowSelection(o.tableData[e.index],!0)}))}));case 5:case"end":return t.stop()}}),t)})))()},checkCurrentProgram:function(){var e=this;console.log("year has changed"),ve(this.majorId,this.$store.state.currentInfo.year).then((function(t){console.log("res",t),"操作成功"==t.msg&&"SUCCESS"===t.code&&(e.hasProgram=!0,e.programId=t.data.programId,e.$store.commit("major/setProgramId",e.programId)),e.getProgramCourse()}))["catch"]((function(t){console.log("e",t),"PROGRAM_NOT_FIND"==t.code&&(e.hasProgram=!1)}))},activate:function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.departmentId=e.$store.state.currentInfo.departmentId,e.schoolId=e.$store.state.currentInfo.schoolId,e.majorId=e.$store.state.major.majorId,e.majorName=e.$store.state.major.majorName,e.programId=e.$store.state.major.programId,e.currentVersionId=e.$store.state.course.baseCourseVersionId,e.getDict(),console.log("schoolId+departmentId+majorId",e.schoolId,e.departmentId,e.majorId);case 8:case"end":return t.stop()}}),t)})))()}},mounted:function(){sessionStorage.setItem("courseSearchFlag",!0);this.checkProgram(),this.hasProgram&&(this.activate(),this.currentInfo.departmentId=this.$store.state.currentInfo.departmentId,this.currentInfo.schoolId=this.$store.state.currentInfo.schoolId,this.keyword=this.$store.state.baseCourseDetailProgram.courseCode)},computed:{yearChange:function(){return this.$store.state.currentInfo.year},currentChange:function(){return this.$store.state.currentInfo},multipleSelectionChange:function(){return this.currentConnectingClass}},watch:{multipleSelectionChange:{deep:!0,handler:function(e){e.length>0?(this.assignedDetail="",this.getDetailList(),this.showAdd=!0):(this.assignedDetail="",this.showAdd=!1)}},currentChange:{deep:!0,handler:function(e){this.currentInfo.departmentId=this.$store.state.currentInfo.departmentId,this.identity=this.$store.state.currentInfo.identity,this.getClassList()}},yearChange:{deep:!0,handler:function(e){this.checkCurrentProgram()}}}},Cr=(0,h.A)(yr,[["render",lr],["__scopeId","data-v-47d6395c"]]),Ar=Cr;function Fr(e,t,o,n,r,a){var s=(0,l.g2)("MainHeader"),i=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(s),(0,l.bF)(i)],64)}var wr=function(e){return(0,l.Qi)("data-v-aa834082"),e=e(),(0,l.jt)(),e},Sr={class:"headerBgd"},_r={class:"headerBgd"},Er={class:"content"},Nr={key:1,class:"headPlaceholder"},Vr={style:{display:"flex","flex-direction":"row"}},xr={key:0,class:"major"},Tr={key:1,class:"major"},jr={key:2,class:"year"},Lr={class:"navigatorList"},Dr={class:"headerBgd"},Br={class:"content"},$r=wr((function(){return(0,l.Lk)("div",{class:"headPlaceholder"},null,-1)})),Or=wr((function(){return(0,l.Lk)("div",{style:{display:"flex","flex-direction":"row"}},[(0,l.Lk)("div",{class:"placeholder",style:{height:"30px"}})],-1)})),Mr={class:"navigatorList"},Ur={class:"headerBgd"},Wr={class:"content"},Rr=wr((function(){return(0,l.Lk)("div",{class:"headPlaceholder"},null,-1)})),Pr=wr((function(){return(0,l.Lk)("div",{style:{display:"flex","flex-direction":"row"}},[(0,l.Lk)("div",{class:"placeholder",style:{height:"30px"}})],-1)})),Gr={class:"navigatorList"};function zr(e,t,o,n,r,a){var s=(0,l.g2)("HeaderIdentity"),c=(0,l.g2)("HomeFilled"),u=(0,l.g2)("el-icon"),d=(0,l.g2)("el-option"),h=(0,l.g2)("el-select"),f=(0,l.g2)("HeaderNav");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bo)((0,l.Lk)("div",Sr,[(0,l.bF)(s)],512),[[i.aG,"教师"==e.$store.state.currentInfo.identity]]),(0,l.bo)((0,l.Lk)("div",_r,[(0,l.Lk)("div",Er,[e.$route.meta.isMajor?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"headIcon",onClick:t[0]||(t[0]=function(e){return a.backIndex()})},[(0,l.bF)(u,{size:24},{default:(0,l.k6)((function(){return[(0,l.bF)(c)]})),_:1})])):(0,l.Q3)("",!0),e.$route.meta.isMajor?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",Nr)),(0,l.Lk)("div",null,[(0,l.Lk)("div",Vr,[e.$route.meta.isMajor?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",xr,(0,C.v_)(e.$store.state.currentInfo.departmentName),1)),e.$route.meta.isMajor?((0,l.uX)(),(0,l.CE)("div",Tr,(0,C.v_)(e.$store.state.major.majorName),1)):(0,l.Q3)("",!0),e.$route.meta.isMajor?((0,l.uX)(),(0,l.CE)("div",jr,[(0,l.bF)(h,{modelValue:r.year,"onUpdate:modelValue":t[1]||(t[1]=function(e){return r.year=e}),class:"m-2",placeholder:"年份",onChange:t[2]||(t[2]=function(e){return a.changeYear()})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.enroll_year,(function(e){return(0,l.uX)(),(0,l.Wv)(d,{key:e.dictValue,label:e.dictLabel,value:e.dictLabel},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",Lr,[(0,l.bF)(f)])]),(0,l.Lk)("div",null,[(0,l.bF)(s)])])],512),[[i.aG,"学院管理员"==e.$store.state.currentInfo.identity]]),(0,l.bo)((0,l.Lk)("div",Dr,[(0,l.Lk)("div",Br,[$r,(0,l.Lk)("div",null,[Or,(0,l.Lk)("div",Mr,[(0,l.bF)(f)])]),(0,l.Lk)("div",null,[(0,l.bF)(s)])])],512),[[i.aG,"课程负责人"==e.$store.state.currentInfo.identity]]),(0,l.bo)((0,l.Lk)("div",Ur,[(0,l.Lk)("div",Wr,[Rr,(0,l.Lk)("div",null,[Pr,(0,l.Lk)("div",Gr,[(0,l.bF)(f)])]),(0,l.Lk)("div",null,[(0,l.bF)(s)])])],512),[[i.aG,"web管理员"==e.$store.state.currentInfo.identity]])],64)}var Yr={key:0},Xr={key:0,class:"pageNav"},Qr={key:1,class:"pageNav"},Kr={key:1},Jr={class:"pageNav"},Hr={key:2},qr={class:"pageNav"};function Zr(e,t,o,n,r,a){var s=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)(l.FK,null,["学院管理员"==e.$store.state.currentInfo.identity?((0,l.uX)(),(0,l.CE)("div",Yr,[e.$route.meta.isMajor?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",Xr,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.infos1,(function(e,t){return(0,l.uX)(),(0,l.CE)("ul",{key:t,class:"Navs"},[(0,l.Lk)("li",null,[(0,l.bF)(s,{to:"".concat(e.path),onClickCapture:function(e){return a.show1(t)},class:(0,C.C4)(r.activeDisplay1==t?"active1":"")},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.value),1)]})),_:2},1032,["to","onClickCapture","class"])])])})),128))])),e.$route.meta.isMajor?((0,l.uX)(),(0,l.CE)("div",Qr,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.infos2,(function(e,t){return(0,l.uX)(),(0,l.CE)("ul",{key:t},[(0,l.Lk)("li",null,[(0,l.bF)(s,{to:"".concat(e.path),onClickCapture:function(e){return a.show2(t)},class:(0,C.C4)(r.activeDisplay2==t?"active1":"")},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.value),1)]})),_:2},1032,["to","onClickCapture","class"])])])})),128))])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),"课程负责人"==e.$store.state.currentInfo.identity?((0,l.uX)(),(0,l.CE)("div",Kr,[(0,l.Lk)("div",Jr,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.infos3,(function(e,t){return(0,l.uX)(),(0,l.CE)("ul",{key:t,class:"Navs"},[(0,l.Lk)("li",null,[(0,l.bF)(s,{to:"".concat(e.path),onClickCapture:function(e){return a.show3(t)},class:(0,C.C4)(r.activeDisplay3==t?"active1":"")},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.value),1)]})),_:2},1032,["to","onClickCapture","class"])])])})),128))])])):(0,l.Q3)("",!0),"web管理员"==e.$store.state.currentInfo.identity?((0,l.uX)(),(0,l.CE)("div",Hr,[(0,l.Lk)("div",qr,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.infos4,(function(e,t){return(0,l.uX)(),(0,l.CE)("ul",{key:t,class:"Navs"},[(0,l.Lk)("li",null,[(0,l.bF)(s,{to:"".concat(e.path),onClickCapture:function(e){return a.show4(t)},class:(0,C.C4)(r.activeDisplay4==t?"active1":"")},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.value),1)]})),_:2},1032,["to","onClickCapture","class"])])])})),128))])])):(0,l.Q3)("",!0)],64)}const ea={name:"HeaderNav",data:function(){return{activeDisplay1:0,activeDisplay2:0,activeDisplay3:0,activeDisplay4:0,infos1:[{value:"专 业",path:"./major"},{value:"课程库",path:"./baseCourse"},{value:"教学班",path:"./class"},{value:"教 师",path:"./teacher"},{value:"设 置",path:"./departmentSetting"}],infos2:[{value:"培养目标",path:"./goal"},{value:"课程体系",path:"./courses"},{value:"达成度",path:"./achieve"},{value:"学 生",path:"./student"},{value:"设 置",path:"./setting"}],infos3:[{value:"课程库",path:"./baseCourse"},{value:"教学班",path:"./class"}],infos4:[{value:"学校",path:"./schools"}]}},computed:{currentChange:function(){return this.$store.state.currentInfo},identityChange:function(){return this.$store.state.currentInfo.identity}},watch:{$route:{handler:function(e,t){e.meta.isMajor!==t.meta.isMajor&&"Courses"!==t.name&&"Courses"!==e.name&&(this.activeDisplay1=0,this.activeDisplay2=0)},deep:!0},currentChange:{deep:!0,handler:function(e){}},identityChange:{deep:!0,handler:function(e){this.$store.commit("navInfo/setActiveDisplay1",0),this.$store.commit("navInfo/setActiveDisplay2",0),this.$store.commit("navInfo/setActiveDisplay3",0),this.$store.commit("navInfo/setActiveDisplay4",0)}}},mounted:function(){this.activeDisplay1=this.$store.state.navInfo.activeDisplay1,this.activeDisplay2=this.$store.state.navInfo.activeDisplay2,this.activeDisplay3=this.$store.state.navInfo.activeDisplay3,this.activeDisplay4=this.$store.state.navInfo.activeDisplay4},methods:{show1:function(e){this.activeDisplay1=e,this.$store.commit("navInfo/setActiveDisplay1",e)},show2:function(e){this.activeDisplay2=e,this.$store.commit("navInfo/setActiveDisplay2",e)},show3:function(e){this.activeDisplay3=e,this.$store.commit("navInfo/setActiveDisplay3",e)},show4:function(e){this.activeDisplay4=e,this.$store.commit("navInfo/setActiveDisplay4",e)}}},ta=(0,h.A)(ea,[["render",Zr],["__scopeId","data-v-3a2ffffd"]]),oa=ta;var na=function(e){return(0,l.Qi)("data-v-1c770440"),e=e(),(0,l.jt)(),e},ra={class:"card-header"},aa=na((function(){return(0,l.Lk)("span",{class:"cardInfo",style:{cursor:"default"}},"身份信息",-1)})),sa={class:"cardBtn"},ia=["onClick"];function la(e,t,o,n,r,a){var s=(0,l.g2)("CaretBottom"),c=(0,l.g2)("el-icon"),u=(0,l.g2)("CaretTop"),d=(0,l.g2)("el-col"),h=(0,l.g2)("el-tag"),f=(0,l.g2)("el-row"),m=(0,l.g2)("el-card"),p=(0,l.g2)("el-input"),b=(0,l.g2)("el-form-item"),g=(0,l.g2)("el-progress"),k=(0,l.g2)("el-form"),v=(0,l.g2)("el-button"),I=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",null,[(0,l.Lk)("span",{class:"info",onClick:t[0]||(t[0]=function(){return a.show&&a.show.apply(a,arguments)})},[(0,l.eW)((0,C.v_)(e.$store.state.userInfo.userName)+" | "+(0,C.v_)(e.$store.state.currentInfo.identity)+" ",1),(0,l.bo)((0,l.bF)(c,{class:"infoIconDown",size:"14px"},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1},512),[[i.aG,r.showDown]]),(0,l.bo)((0,l.bF)(c,{class:"infoIconUp",size:"14px"},{default:(0,l.k6)((function(){return[(0,l.bF)(u)]})),_:1},512),[[i.aG,!r.showDown]])])]),(0,l.bo)((0,l.bF)(m,{class:"box-card"},{header:(0,l.k6)((function(){return[(0,l.Lk)("div",ra,[aa,(0,l.Lk)("div",sa,[(0,l.Lk)("span",{class:"cardOption1",onClick:t[1]||(t[1]=function(e){return r.dialogFormVisible=!0})},"修改密码"),(0,l.Lk)("span",{class:"cardOption2",onClick:t[2]||(t[2]=function(){return a.exit&&a.exit.apply(a,arguments)})},"退出")])])]})),default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.$store.state.userInfo.identity,(function(e,t){return(0,l.uX)(),(0,l.CE)("div",{class:"identity",key:t,onClick:function(o){return a.changeCurrentInfo(e,t)}},[(0,l.bo)((0,l.bF)(f,null,{default:(0,l.k6)((function(){return[(0,l.bF)(d,{span:18},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.departmentName),1)]})),_:2},1024),(0,l.bF)(d,{span:6},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{effect:"plain"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.roleName),1)]})),_:2},1024)]})),_:2},1024)]})),_:2},1536),[[i.aG,"课程负责人"!==e.roleName]]),(0,l.bo)((0,l.bF)(f,null,{default:(0,l.k6)((function(){return[(0,l.bF)(d,{span:18},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.departmentName),1)]})),_:2},1024),(0,l.bF)(d,{span:6},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{effect:"plain"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.roleName),1)]})),_:2},1024)]})),_:2},1024)]})),_:2},1536),[[i.aG,"课程负责人"==e.roleName]])],8,ia)})),128))]})),_:1},512),[[i.aG,r.showCard]]),(0,l.bF)(I,{title:"修改密码",modelValue:r.dialogFormVisible,"onUpdate:modelValue":t[6]||(t[6]=function(e){return r.dialogFormVisible=e}),width:"400px"},{footer:(0,l.k6)((function(){return[(0,l.bF)(v,{onClick:a.cancel},{default:(0,l.k6)((function(){return[(0,l.eW)("取 消")]})),_:1},8,["onClick"]),(0,l.bF)(v,{type:"primary",onClick:a.changePwd},{default:(0,l.k6)((function(){return[(0,l.eW)("确 认")]})),_:1},8,["onClick"])]})),default:(0,l.k6)((function(){return[(0,l.bF)(k,{ref:"form",model:r.user,rules:r.rules},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{label:"旧密码",prop:"oldPassword","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{modelValue:r.user.oldPassword,"onUpdate:modelValue":t[3]||(t[3]=function(e){return r.user.oldPassword=e}),type:"password",placeholder:"请输入旧密码","show-password":""},null,8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(b,{label:"新密码",prop:"newPassword","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{modelValue:r.user.newPassword,"onUpdate:modelValue":t[4]||(t[4]=function(e){return r.user.newPassword=e}),type:"password",placeholder:"请输入新密码","show-password":"",onChange:a.checkPassword},null,8,["modelValue","onChange"])]})),_:1},8,["label-width"]),(0,l.bo)((0,l.bF)(g,{class:"progress",percentage:r.passwordStrength,format:a.format,color:a.customColorMethod},null,8,["percentage","format","color"]),[[i.aG,r.passwordStrength]]),(0,l.bF)(b,{label:"确认密码",prop:"confirmPassword","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{modelValue:r.user.confirmPassword,"onUpdate:modelValue":t[5]||(t[5]=function(e){return r.user.confirmPassword=e}),type:"password",placeholder:"请确认新密码","show-password":""},null,8,["modelValue"])]})),_:1},8,["label-width"])]})),_:1},8,["model","rules"])]})),_:1},8,["modelValue"])],64)}function ca(e,t){return Q({url:"/login",method:"post",data:{username:e,password:t}})}function ua(){return Q({url:"/logout",method:"post"})}function da(){return Q({url:"/getInfo",method:"get"})}function ha(e,t){var o={oldPassword:e,newPassword:t};return Q({url:"/system/user/profile/updatePwd",method:"put",params:o})}const fa={name:"HeaderIdentity",data:function(){var e=this,t=function(e,t,o){var n=/[a-z]/,r=/[A-Z]/,a=/[0-9]/,s=/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]/,i=n.test(t),l=r.test(t),c=a.test(t),u=s.test(t),d=(i?1:0)+(l?1:0)+(c?1:0)+(u?1:0);t.length<8||t.length20?o(new Error("密码长度应为8至20位")):d<3?o(new Error("应包含数字,大写字母,小写字母,特殊字符中的三项")):o()},o=function(t,o,n){e.user.newPassword!==o?n(new Error("两次输入的密码不一致")):n()};return{showDown:!0,showCard:!1,dialogFormVisible:!1,formLabelWidth:"80px",user:{oldPassword:"",newPassword:"",confirmPassword:""},rules:{oldPassword:[{required:!0,message:"旧密码不能为空",trigger:"blur"}],newPassword:[{required:!0,message:"新密码不能为空",trigger:"blur"},{required:!0,validator:t,trigger:"blur"}],confirmPassword:[{required:!0,message:"确认密码不能为空",trigger:"blur"},{required:!0,validator:o,trigger:"blur"}]},passwordStrength:""}},components:{CaretBottom:ee.BHL,CaretTop:ee.ziD},mounted:function(){},methods:{show:function(){this.showCard=!this.showCard,this.showDown=!this.showDown},exit:function(){var e=this;P.s.confirm("是否确认退出登录？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){ua().then((function(t){"SUCCESS"===t.code?((0,G.nk)({type:"success",message:"已退出登录",duration:1500}),u.A.remove("Admin-Token"),u.A.remove("first-Login"),e.$router.push("/login")):(0,G.nk)({type:"error",message:"退出登录失败",duration:1500})}))}))["catch"]((function(){}))},checkPassword:function(){var e=/[a-z]/,t=/[A-Z]/,o=/[0-9]/,n=/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]/,r=e.test(this.user.newPassword),a=t.test(this.user.newPassword),s=o.test(this.user.newPassword),i=n.test(this.user.newPassword),l=(r?1:0)+(a?1:0)+(s?1:0)+(i?1:0);this.user.newPassword.length<8?this.passwordStrength="":this.passwordStrength=l>=3?100:2===l?60:1===l?30:""},format:function(e){return 100===e?"强":60===e?"中":30===e?"弱":""},customColorMethod:function(e){return 30===e?"#f41e1e":60===e?"#e6a23c":"#67c23a"},changePwd:function(){var e=this;this.$refs["form"].validate((function(t){t&&ha(e.user.oldPassword,e.user.newPassword).then((function(t){"SUCCESS"===t.code&&(e.dialogFormVisible=!1,(0,G.nk)({type:"success",message:"更新成功",duration:1500})),"ERROR"===t.code&&("新密码不能与旧密码相同"==t.msg||"修改密码失败，旧密码错误"==t.msg)&&(0,G.nk)({type:"error",message:t.msg,duration:1500})}))}))},cancel:function(){this.dialogFormVisible=!1,this.user={oldPassword:"",newPassword:"",confirmPassword:""}},changeCurrentInfo:function(e,t){console.log("identity",e),this.$store.commit("currentInfo/setDepartmentName",e.departmentName),this.$store.commit("currentInfo/setDepartmentId",e.departmentId),this.$store.commit("currentInfo/setSchoolName",e.schoolName),this.$store.commit("currentInfo/setSchoolId",e.schoolId),this.$store.commit("currentInfo/setRole",this.$store.state.userInfo.identity[t]),this.$store.getters["currentInfo/changeIsTeacher"],"学院管理员"===e.roleName&&this.$router.replace("/major"),"教师"===e.roleName&&this.$router.replace("teacherClasses"),"课程负责人"===e.roleName&&this.$router.replace("BaseCourse")}}},ma=(0,h.A)(fa,[["render",la],["__scopeId","data-v-1c770440"]]),pa=ma,ba={name:"MainHeader",components:{HeaderNav:oa,HeaderIdentity:pa,HomeFilled:ee.oCE},data:function(){return{year:"2021级",enroll_year:[]}},mounted:function(){this.$store.commit("currentInfo/setYear","2021级"),this.getDictionary()},methods:{getDictionary:function(){var e=this;qt().then((function(t){console.log("getDictionary",t),e.enroll_year=t.enroll_year}))},backIndex:function(){this.$router.replace({path:"/major"})},changeYear:function(){console.log("changeYear",this.year),this.$store.commit("currentInfo/setYear",this.year)}}},ga=(0,h.A)(ba,[["render",zr],["__scopeId","data-v-aa834082"]]),ka=ga,va={name:"Index",components:{MainHeader:ka}},Ia=(0,h.A)(va,[["render",Fr]]),ya=Ia;var Ca=function(e){return(0,l.Qi)("data-v-547d0fc8"),e=e(),(0,l.jt)(),e},Aa={class:"selectionBar"},Fa={class:"submenu"},wa={class:"numSelectedTeacher"},Sa={class:"no-class"},_a={class:"no-class"},Ea={class:"no-class-detail"},Na={layout:"row",flex:"",class:"md-padding"},Va={style:{display:"flex","align-items":"center"}},xa={style:{display:"flex","align-items":"center"}},Ta={style:{display:"flex","align-items":"center"}},ja={style:{display:"flex","align-items":"center"}},La={style:{display:"flex","align-items":"center"}},Da={style:{display:"flex","align-items":"center"}},Ba={style:{display:"flex","align-items":"center"}},$a={class:"md-padding",layout:"row",flex:""},Oa={style:{display:"flex","align-items":"center"}},Ma={style:{display:"flex","align-items":"center"}},Ua={style:{display:"flex","align-items":"center"}},Wa={style:{display:"flex","align-items":"center"}},Ra={style:{display:"flex","align-items":"center"}},Pa={style:{display:"flex","align-items":"center"}},Ga={style:{display:"flex","align-items":"center"}},za={class:"dialog-footer"},Ya={class:"dialog-footer"},Xa=Ca((function(){return(0,l.Lk)("span",null," 请选择负责人姓名： ",-1)})),Qa={class:"dialog-footer"},Ka={class:"dialog-footer"},Ja={class:"pagination-container",flex:""};function Ha(e,t,o,n,r,a){var s=this,c=(0,l.g2)("el-option"),u=(0,l.g2)("el-select"),d=(0,l.g2)("el-col"),h=(0,l.g2)("el-row"),f=(0,l.g2)("HeaderSearch"),m=(0,l.g2)("addBtn"),p=(0,l.g2)("el-button"),b=(0,l.g2)("MoreFilled"),g=(0,l.g2)("el-icon"),k=(0,l.g2)("User"),v=(0,l.g2)("el-dropdown-item"),I=(0,l.g2)("Collection"),y=(0,l.g2)("CircleClose"),A=(0,l.g2)("Delete"),F=(0,l.g2)("el-dropdown-menu"),w=(0,l.g2)("el-dropdown"),S=(0,l.g2)("el-table-column"),_=(0,l.g2)("el-tag"),E=(0,l.g2)("el-tooltip"),N=(0,l.g2)("Edit"),V=(0,l.g2)("el-table"),x=(0,l.g2)("Document"),T=(0,l.g2)("el-input"),j=(0,l.g2)("el-form-item"),L=(0,l.g2)("el-form"),D=(0,l.g2)("el-dialog"),B=(0,l.gN)("loading");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bo)((0,l.Lk)("div",null,[(0,l.bF)(f,{msg:"搜索课程名、课程负责人(姓名、工号)、课程号",onSearchValue:a.getSearchValue,value:r.keyword},{rightTime:(0,l.k6)((function(){return[(0,l.Lk)("div",Aa,[(0,l.bF)(h,{class:"selects"},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{span:9},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{modelValue:r.hasDetail,"onUpdate:modelValue":t[0]||(t[0]=function(e){return r.hasDetail=e}),class:"selecter",placeholder:"全部",onChange:t[1]||(t[1]=function(e){return a.getSelectedBaseCourse(r.hasDetail)})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.hasDetailSeletion,(function(e){return(0,l.uX)(),(0,l.Wv)(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),(0,l.bF)(d,{span:9},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{modelValue:r.currentVersionId,"onUpdate:modelValue":t[2]||(t[2]=function(e){return r.currentVersionId=e}),class:"selecter",placeholder:"全部",onChange:t[3]||(t[3]=function(e){return a.getCourseByYear(r.currentVersionId)})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.versions,(function(e){return(0,l.uX)(),(0,l.Wv)(c,{key:e.versionId,label:e.label,value:e.versionId},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),(0,l.bo)((0,l.bF)(d,{span:2,style:{position:"relative",top:"8px"}},null,512),[[i.aG,"学院管理员"==r.identity]])]})),_:1})])]})),_:1},8,["onSearchValue","value"])],512),[[i.aG,!r.closeShow]]),(0,l.bo)((0,l.bF)(m,{onClick:t[4]||(t[4]=function(e){return r.dialogFormVisible=!0})},null,512),[[i.aG,"学院管理员"==r.identity]]),(0,l.bo)((0,l.Lk)("div",Fa,[(0,l.bF)(h,null,{default:(0,l.k6)((function(){return[(0,l.bF)(d,{span:2,class:"columnstyle"},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{onClick:t[5]||(t[5]=function(e){return s.toggleSelection()}),class:"clearSelected"},{default:(0,l.k6)((function(){return[(0,l.eW)("取消选择")]})),_:1})]})),_:1}),(0,l.bF)(d,{span:16,class:"columnstyle"},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",wa,"已选中 "+(0,C.v_)(r.numSelected)+" 门课程",1)]})),_:1}),(0,l.bo)((0,l.bF)(d,{span:4,class:"columnstyle"},{default:(0,l.k6)((function(){return[(0,l.bF)(w,{class:"dropdownstyle"},{dropdown:(0,l.k6)((function(){return[(0,l.bF)(F,null,{default:(0,l.k6)((function(){return[(0,l.bF)(v,{onClick:t[6]||(t[6]=function(e){return s.addPrincipal()})},{default:(0,l.k6)((function(){return[(0,l.bF)(g,null,{default:(0,l.k6)((function(){return[(0,l.bF)(k)]})),_:1}),(0,l.eW)("  设置课程负责人 ")]})),_:1}),(0,l.bF)(v,{onClick:t[7]||(t[7]=function(e){return s.addWorkbook()})},{default:(0,l.k6)((function(){return[(0,l.bF)(g,null,{default:(0,l.k6)((function(){return[(0,l.bF)(I)]})),_:1}),(0,l.eW)("  设置手册模板 ")]})),_:1}),(0,l.bF)(v,{onClick:t[8]||(t[8]=function(e){return s.deleteRespondent()})},{default:(0,l.k6)((function(){return[(0,l.bF)(g,null,{default:(0,l.k6)((function(){return[(0,l.bF)(y)]})),_:1}),(0,l.eW)("  删除课程负责人 ")]})),_:1}),(0,l.bF)(v,{onClick:t[9]||(t[9]=function(e){return s.multideleteBaseCourse(s.courseId)})},{default:(0,l.k6)((function(){return[(0,l.bF)(g,null,{default:(0,l.k6)((function(){return[(0,l.bF)(A)]})),_:1}),(0,l.eW)("  删除课程 ")]})),_:1})]})),_:1})]})),default:(0,l.k6)((function(){return[(0,l.bF)(g,{class:"dropdownIcon"},{default:(0,l.k6)((function(){return[(0,l.bF)(b)]})),_:1})]})),_:1})]})),_:1},512),[[i.aG,"学院管理员"==r.identity]]),(0,l.bo)((0,l.bF)(d,{span:6},{default:(0,l.k6)((function(){return[(0,l.bF)(w,{class:"dropdownstyle"},{dropdown:(0,l.k6)((function(){return[(0,l.bF)(F,null,{default:(0,l.k6)((function(){return[(0,l.bF)(v,{onClick:t[10]||(t[10]=function(e){return s.addWorkbook()})},{default:(0,l.k6)((function(){return[(0,l.bF)(g,null,{default:(0,l.k6)((function(){return[(0,l.bF)(I)]})),_:1}),(0,l.eW)("  设置手册模板 ")]})),_:1})]})),_:1})]})),default:(0,l.k6)((function(){return[(0,l.bF)(g,{class:"dropdownIcon"},{default:(0,l.k6)((function(){return[(0,l.bF)(b)]})),_:1})]})),_:1})]})),_:1},512),[[i.aG,"课程负责人"==r.identity]])]})),_:1})],512),[[i.aG,r.closeShow]]),(0,l.bo)((0,l.Lk)("div",Sa," 没有版本信息，请先设置版本信息 ",512),[[i.aG,r.hasNoVersion]]),(0,l.bo)((0,l.Lk)("div",null,[(0,l.bo)((0,l.Lk)("div",_a,"没有课程",512),[[i.aG,r.hasNoBaseCourse]]),(0,l.bo)((0,l.Lk)("div",Ea," 请先点击右上角圆形按钮添加课程 ",512),[[i.aG,r.hasNoBaseCourse]]),(0,l.bo)((0,l.Lk)("div",Na,[(0,l.bF)(m,{onClick:t[11]||(t[11]=function(e){return r.dialogFormVisible=!0})}),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(V,{data:r.tableData,ref:"multipleTable1",onSelectionChange:a.handleSelectionChange,onRowClick:a.goBaseCourseDetail,class:"el-table-container",style:{width:"1375px","text-overflow":"ellipsis","white-space":"nowrap"},"header-cell-style":{"padding-left":"20px","font-size":"14.4px",height:"48px","font-weight":"bold",color:"black"},"cell-style":{"padding-left":"20px","font-size":"16px",height:"60px"},"row-key":a.rowKey},{default:(0,l.k6)((function(){return[(0,l.bF)(S,{width:"55","column-key":"select",type:"selection","reserve-selection":!0}),(0,l.bF)(S,{label:"课程名",width:"250","label-class-name":"textbold"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",Va,[(0,l.Lk)("span",null,(0,C.v_)(e.row.courseName),1)])]})),_:1}),(0,l.bF)(S,{label:"课程号",width:"150"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",xa,[(0,l.Lk)("span",null,(0,C.v_)(e.row.courseCode),1)])]})),_:1}),(0,l.bF)(S,{label:"课程类型",width:"150"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",Ta,[(0,l.Lk)("span",null,(0,C.v_)(e.row.courseType),1)])]})),_:1}),(0,l.bF)(S,{label:"课程性质",width:"120"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",ja,[(0,l.Lk)("span",null,(0,C.v_)(e.row.courseNature),1)])]})),_:1}),(0,l.bF)(S,{label:"学分",width:"80"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",La,[(0,l.Lk)("span",null,(0,C.v_)(e.row.credit),1)])]})),_:1}),(0,l.bF)(S,{label:"负责人",width:"120"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",Da,[(0,l.Lk)("span",null,(0,C.v_)(e.row.respondentName)+"  ",1)])]})),_:1}),(0,l.bF)(S,{label:"工作手册",width:"150"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",Ba,[(0,l.bo)((0,l.Lk)("span",null,(0,C.v_)(e.row.workbookName),513),[[i.aG,e.row.workbookName]]),(0,l.bo)((0,l.Lk)("span",null,null,512),[[i.aG,!e.row.workbookName]])])]})),_:1}),(0,l.bF)(S,{label:"课程大纲",width:"150"},{default:(0,l.k6)((function(e){return[(0,l.bF)(h,null,{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(d,{span:8},{default:(0,l.k6)((function(){return[(0,l.bF)(_,{class:"noBaseCourseDetail"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(r.currentVersionName),1)]})),_:1})]})),_:2},1536),[[i.aG,e.row.versionId]]),(0,l.bo)((0,l.bF)(d,{span:8},{default:(0,l.k6)((function(){return[(0,l.bF)(E,{content:"添加课程大纲"},{default:(0,l.k6)((function(){return[(0,l.bF)(_,{class:"noBaseCourseDetail",type:"danger",onClick:(0,i.D$)((function(t){return a.addBaseCourseDetail(e.row)}),["stop"])},{default:(0,l.k6)((function(){return[(0,l.eW)("无课程大纲")]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1536),[[i.aG,!e.row.versionId]])]})),_:2},1024)]})),_:1}),(0,l.bF)(S,{label:"操作",width:"150"},{default:(0,l.k6)((function(e){return[(0,l.bo)((0,l.bF)(h,null,{default:(0,l.k6)((function(){return[(0,l.bF)(d,{span:8},{default:(0,l.k6)((function(){return[(0,l.bF)(E,{content:"删除课程"},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{onClick:(0,i.D$)((function(t){return a.deleteBaseCourse(e.$index,e.row.courseId)}),["stop"]),class:"deleteButton",link:"",style:{color:"#3f51b5"}},{default:(0,l.k6)((function(){return[(0,l.bF)(g,null,{default:(0,l.k6)((function(){return[(0,l.bF)(A)]})),_:1})]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024),(0,l.bF)(d,{span:8},{default:(0,l.k6)((function(){return[(0,l.bF)(E,{content:"修改课程信息"},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{onClick:(0,i.D$)((function(t){return a.editTrigger(e.row)}),["stop"]),class:"deleteButton",link:"",style:{color:"#3f51b5"}},{default:(0,l.k6)((function(){return[(0,l.bF)(g,null,{default:(0,l.k6)((function(){return[(0,l.bF)(N)]})),_:1})]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1536),[[i.aG,r.showToolIcon]])]})),_:1})]})),_:1},8,["data","onSelectionChange","onRowClick","row-key"])),[[B,r.isloading]])],512),[[i.aG,"学院管理员"==r.identity&&r.hasBaseCourse]]),(0,l.bo)((0,l.Lk)("div",$a,[(0,l.bo)(((0,l.uX)(),(0,l.Wv)(V,{data:r.tableData,ref:"multipleTable2",class:"el-table-container",onSelectionChange:a.handleSelectionChange,onRowClick:a.goBaseCourseDetail,style:{width:"1375px","text-overflow":"ellipsis","white-space":"nowrap"},"header-cell-style":{"padding-left":"20px","font-size":"14.4px",height:"48px","font-weight":"bold",color:"black"},"cell-style":{"padding-left":"20px","font-size":"16px",height:"60px"},"row-key":a.rowKey},{default:(0,l.k6)((function(){return[(0,l.bF)(S,{width:"55","column-key":"select",type:"selection","reserve-selection":!0}),(0,l.bF)(S,{label:"课程名",width:"250"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",Oa,[(0,l.Lk)("span",null,(0,C.v_)(e.row.courseName),1)])]})),_:1}),(0,l.bF)(S,{label:"课程号",width:"150"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",Ma,[(0,l.Lk)("span",null,(0,C.v_)(e.row.courseCode),1)])]})),_:1}),(0,l.bF)(S,{label:"课程类型",width:"150"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",Ua,[(0,l.Lk)("span",null,(0,C.v_)(e.row.courseType),1)])]})),_:1}),(0,l.bF)(S,{label:"课程性质",width:"120"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",Wa,[(0,l.Lk)("span",null,(0,C.v_)(e.row.courseNature),1)])]})),_:1}),(0,l.bF)(S,{label:"学分",width:"80"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",Ra,[(0,l.Lk)("span",null,(0,C.v_)(e.row.credit),1)])]})),_:1}),(0,l.bF)(S,{label:"负责人",width:"120"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",Pa,[(0,l.Lk)("span",null,(0,C.v_)(e.row.respondentName)+"  ",1)])]})),_:1}),(0,l.bF)(S,{label:"工作手册",width:"150"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",Ga,[(0,l.bo)((0,l.Lk)("span",null,(0,C.v_)(e.row.workbookName),513),[[i.aG,e.row.workbookName]]),(0,l.bo)((0,l.Lk)("span",null,null,512),[[i.aG,!e.row.workbookName]])])]})),_:1}),(0,l.bF)(S,{label:"课程大纲",width:"150"},{default:(0,l.k6)((function(e){return[(0,l.bF)(h,null,{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(d,{span:8},{default:(0,l.k6)((function(){return[(0,l.bF)(_,{class:"noBaseCourseDetail"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(r.currentVersionName),1)]})),_:1})]})),_:2},1536),[[i.aG,e.row.versionId]]),(0,l.bo)((0,l.bF)(d,{span:8},{default:(0,l.k6)((function(){return[(0,l.bF)(E,{content:"添加课程大纲"},{default:(0,l.k6)((function(){return[(0,l.bF)(_,{class:"noBaseCourseDetail",type:"danger",onClick:(0,i.D$)((function(t){return a.addBaseCourseDetail(e.row)}),["stop"])},{default:(0,l.k6)((function(){return[(0,l.eW)("无课程大纲")]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1536),[[i.aG,!e.row.versionId]])]})),_:2},1024)]})),_:1}),(0,l.bF)(S,{label:"操作",width:"150"},{default:(0,l.k6)((function(e){return[(0,l.bo)((0,l.bF)(h,null,{default:(0,l.k6)((function(){return[(0,l.bF)(d,{span:8},{default:(0,l.k6)((function(){return[(0,l.bF)(E,{content:"修改课程信息"},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{onClick:(0,i.D$)((function(t){return a.editTrigger(e.row)}),["stop"]),class:"deleteButton",link:"",style:{color:"#3f51b5"}},{default:(0,l.k6)((function(){return[(0,l.bF)(g,null,{default:(0,l.k6)((function(){return[(0,l.bF)(x)]})),_:1})]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1536),[[i.aG,r.showToolIcon]])]})),_:1})]})),_:1},8,["data","onSelectionChange","onRowClick","row-key"])),[[B,r.isloading]])],512),[[i.aG,"课程负责人"==r.identity&&r.hasBaseCourse]])],512),[[i.aG,r.hasVersion]]),(0,l.bF)(D,{modelValue:r.dialogFormVisible,"onUpdate:modelValue":t[19]||(t[19]=function(e){return r.dialogFormVisible=e}),title:"添加基础课程",width:"580"},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",za,[(0,l.bF)(p,{onClick:a.goAddBaseCourses},{default:(0,l.k6)((function(){return[(0,l.eW)("批量添加")]})),_:1},8,["onClick"]),(0,l.bF)(p,{onClick:t[17]||(t[17]=function(e){r.dialogFormVisible=!1,a.resetForm("ruleForm")})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(p,{type:"primary",onClick:t[18]||(t[18]=function(e){return a.submitForm("ruleForm")})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(L,{model:r.form,rules:r.rules,ref:"ruleForm"},{default:(0,l.k6)((function(){return[(0,l.bF)(j,{label:"课程名称","label-width":r.formLabelWidth,prop:"courseName"},{default:(0,l.k6)((function(){return[(0,l.bF)(T,{modelValue:r.form.courseName,"onUpdate:modelValue":t[12]||(t[12]=function(e){return r.form.courseName=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(j,{label:"课程代码","label-width":r.formLabelWidth,prop:"courseCode",error:r.C_ErrorMsg},{default:(0,l.k6)((function(){return[(0,l.bF)(T,{modelValue:r.form.courseCode,"onUpdate:modelValue":t[13]||(t[13]=function(e){return r.form.courseCode=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width","error"]),(0,l.bF)(j,{label:"学分","label-width":r.formLabelWidth,prop:"credit"},{default:(0,l.k6)((function(){return[(0,l.bF)(T,{modelValue:r.form.credit,"onUpdate:modelValue":t[14]||(t[14]=function(e){return r.form.credit=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(j,{label:"课程性质","label-width":r.formLabelWidth,prop:"courseNature"},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{modelValue:r.form.courseNature,"onUpdate:modelValue":t[15]||(t[15]=function(e){return r.form.courseNature=e}),placeholder:"请选择课程性质"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.courseNatureSource,(function(e,t){return(0,l.uX)(),(0,l.Wv)(c,{key:e,label:e,value:t},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(j,{label:"课程类型","label-width":r.formLabelWidth,prop:"courseType"},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{modelValue:r.form.courseType,"onUpdate:modelValue":t[16]||(t[16]=function(e){return r.form.courseType=e}),placeholder:"请选择课程类型"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.courseTypeSource,(function(e,t){return(0,l.uX)(),(0,l.Wv)(c,{key:e,label:e,value:t},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1},8,["label-width"])]})),_:1},8,["model","rules"])]})),_:1},8,["modelValue"]),(0,l.bF)(D,{modelValue:r.dialogFormVisible1,"onUpdate:modelValue":t[27]||(t[27]=function(e){return r.dialogFormVisible1=e}),title:"修改课程信息",width:"580"},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",Ya,[(0,l.bF)(p,{onClick:t[26]||(t[26]=function(e){return r.dialogFormVisible1=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(p,{type:"primary",onClick:a.editBaseCourse},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1},8,["onClick"])])]})),default:(0,l.k6)((function(){return[(0,l.bF)(L,{model:r.preform},{default:(0,l.k6)((function(){return[(0,l.bF)(j,{label:"课程名称","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(T,{modelValue:r.preform.courseName,"onUpdate:modelValue":t[20]||(t[20]=function(e){return r.preform.courseName=e}),autocomplete:"off"},null,8,["modelValue"]),[[i.aG,"学院管理员"==r.identity]]),(0,l.bo)((0,l.Lk)("span",null,(0,C.v_)(r.preform.courseName),513),[[i.aG,"课程负责人"==r.identity]])]})),_:1},8,["label-width"]),(0,l.bF)(j,{label:"课程代码","label-width":r.formLabelWidth,error:r.C_ErrorMsg_edit},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(T,{modelValue:r.preform.courseCode,"onUpdate:modelValue":t[21]||(t[21]=function(e){return r.preform.courseCode=e}),autocomplete:"off"},null,8,["modelValue"]),[[i.aG,"学院管理员"==r.identity]]),(0,l.bo)((0,l.Lk)("span",null,(0,C.v_)(r.preform.courseCode),513),[[i.aG,"课程负责人"==r.identity]])]})),_:1},8,["label-width","error"]),(0,l.bF)(j,{label:"学分","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bF)(T,{modelValue:r.preform.credit,"onUpdate:modelValue":t[22]||(t[22]=function(e){return r.preform.credit=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(j,{label:"课程性质","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{modelValue:r.preform.courseNature,"onUpdate:modelValue":t[23]||(t[23]=function(e){return r.preform.courseNature=e}),placeholder:"请选择课程性质"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.courseNatureSource,(function(e,t){return(0,l.uX)(),(0,l.Wv)(c,{key:e,label:e,value:t},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(j,{label:"课程类型","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{modelValue:r.preform.courseType,"onUpdate:modelValue":t[24]||(t[24]=function(e){return r.preform.courseType=e}),placeholder:"请选择课程类型"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.courseTypeSource,(function(e,t){return(0,l.uX)(),(0,l.Wv)(c,{key:e,label:e,value:t},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(j,{label:"备注","label-width":r.formLabelWidth},{default:(0,l.k6)((function(){return[(0,l.bF)(T,{modelValue:r.preform.remark,"onUpdate:modelValue":t[25]||(t[25]=function(e){return r.preform.remark=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"])]})),_:1},8,["model"])]})),_:1},8,["modelValue"]),(0,l.bF)(D,{modelValue:r.showPrinciple,"onUpdate:modelValue":t[30]||(t[30]=function(e){return r.showPrinciple=e}),title:"添加负责人",width:"580"},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",Qa,[(0,l.bF)(p,{onClick:t[29]||(t[29]=function(e){return r.showPrinciple=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(p,{type:"primary",onClick:a.addRespondent},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1},8,["onClick"])])]})),default:(0,l.k6)((function(){return[Xa,(0,l.bF)(u,{modelValue:r.selectedRespondent,"onUpdate:modelValue":t[28]||(t[28]=function(e){return r.selectedRespondent=e}),"remote-method":a.remoteMethodinADD,loading:r.loading,remote:"",filterable:"","reserve-keyword":""},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.principleForm,(function(e){return(0,l.uX)(),(0,l.Wv)(c,{key:e.userId,value:e.userId,label:e.respondentName},null,8,["value","label"])})),128))]})),_:1},8,["modelValue","remote-method","loading"])]})),_:1},8,["modelValue"]),(0,l.bF)(D,{modelValue:r.showAddWorkbook,"onUpdate:modelValue":t[34]||(t[34]=function(e){return r.showAddWorkbook=e}),title:"设置手册模板",width:"330px","show-close":!1,"align-center":!0},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",Ka,[(0,l.bF)(p,{onClick:t[32]||(t[32]=function(e){return r.showAddWorkbook=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(p,{type:"primary",onClick:t[33]||(t[33]=function(e){return a.submitWorkbook()})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(u,{modelValue:r.workBookId,"onUpdate:modelValue":t[31]||(t[31]=function(e){return r.workBookId=e}),style:{width:"250px","margin-left":"20px"},placeholder:"选择手册模板"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.workBookDetail,(function(e){return(0,l.uX)(),(0,l.Wv)(c,{key:e.workbookId,label:e.name,value:e.workbookId},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1},8,["modelValue"]),(0,l.Lk)("div",Ja,[(0,l.bF)(h,{type:"flex",justify:"center",align:"middle",class:"loadmorestyle"},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(p,{disabled:r.loadmoreDisabled,link:"",plain:"",onClick:t[35]||(t[35]=function(e){return a.loadmoreCourse()})},{default:(0,l.k6)((function(){return[(0,l.eW)("加载更多")]})),_:1},8,["disabled"]),[[i.aG,r.showLoadmore&&r.hasBaseCourse&&!r.isloading&&r.hasVersion]])]})),_:1})])],64)}var qa;o(39681);function Za(e){return Q({url:"/workbook/list",method:"get",params:{departmentId:e}})}function es(e){return Q({url:"/workbook/"+e,method:"get"})}function ts(e){return Q({url:"/workbook",method:"put",data:e})}function os(e,t){return Q({url:"/workbook",method:"post",data:{name:e,departmentId:t}})}function ns(e){return Q({url:"/workbook/"+e,method:"delete"})}function rs(e){return Q({url:"/baseCourse/workbook/associate",method:"PUT",data:e})}function as(e){return Q({url:"/workbook/class/"+e,method:"get"})}function ss(e){return Q({url:"/workbook/baseCourse/"+e,method:"get"})}function is(e,t){return Q({url:"/classes/editWorkbook",method:"post",data:{classId:e,workbookJson:t}})}function ls(e,t,o){return Q({url:"/workbook/preset",method:"post",data:{detailId:e,formPreset:t,courseId:o}})}function cs(e){return Q({url:"/workbook/preset/"+e,method:"get"})}const us={name:"BaseCourse",components:(qa={request:Q,ElTooltip:ue.R7,ElIcon:de.tk,ElInput:he.WK,ElForm:fe.US,ElButton:me.S2,ElTable:pe.Up,ElMessage:G.nk,ElMessageBox:P.s,Back:ee.kcb,FolderChecked:ee.KHk,InfoFilled:ee.N_H,Loading:ee.Rhj,Search:ee.vji,Close:ee.bm,Plus:ee.FWt,Delete:ee.epd,ElDialog:be.kZ,ref:ce.KR,reactive:ce.Kh},(0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)(qa,"Delete",ee.epd),"Edit",ee.ffu),"HeaderSearch",ne),"addBtn",le),"MoreFilled",ee.yGC),"ElDropdown",ge.dW),"ArrowDown",ee.yd$),"Document",ee.yoT),"ElTag",ke.u),"Avatar",ee.euF),(0,$.A)((0,$.A)((0,$.A)((0,$.A)(qa,"DocumentChecked",ee.Fmj),"User",ee.KJW),"CircleClose",ee.R$5),"Collection",ee.pMc)),data:function(){var e,t=this,o=function(e,o,n){if(""===o)t.C_ErrorMsg_editVersion_name="请输入版本名称";else{var r=/^\d{4}版$/;r.test(o)?(t.nameFlag=!0,t.enrollYearFlag&&t.nameFlag&&t.reviseYearFlag?t.submitFlag=!0:t.submitFlag=!1):t.C_ErrorMsg_editVersion_name="请输入正确版本名称格式 例如：2020版"}},n=function(e,o,n){if(""===o)t.C_ErrorMsg_editVersion_enrollYear="请输入年份";else{var r=/^[1-9]\d{3}$/,a=/^\d+$/;a.test(o)?r.test(o)?(t.enrollYearFlag=!0,t.enrollYearFlag&&t.nameFlag&&t.reviseYearFlag?t.submitFlag=!0:t.submitFlag=!1):t.C_ErrorMsg_editVersion_enrollYear="请输入正确年份格式 例如：2020 ":t.C_ErrorMsg_editVersion_enrollYear="请输入数字"}},r=function(e,o,n){if(""===o)t.C_ErrorMsg_editVersion_reviseYear="请输入年份";else{var r=/^[1-9]\d{3}$/,a=/^\d+$/;a.test(o)?r.test(o)?(t.reviseYearFlag=!0,t.enrollYearFlag&&t.nameFlag&&t.reviseYearFlag?t.submitFlag=!0:t.submitFlag=!1):t.C_ErrorMsg_editVersion_reviseYear="请输入正确年份格式 例如：2020 ":t.C_ErrorMsg_editVersion_reviseYear="请输入数字"}};return e={canGobasecourse:!0,canAddbbasecourseDetail:!0,hasVersion:!1,hasNoVersion:!1,defaultMsg:"搜索课程名称、任课教师(姓名、工号)、课程号、开课号",hasDetail:"",hasDetailSeletion:[{label:"全部",value:""},{label:"有课程大纲",value:"1"},{label:"无课程大纲",value:"0"}],submitFlag:!1,nameFlag:!1,enrollYearFlag:!1,reviseYearFlag:!1,addFlag:!1,editFlag:!1,deleteFlag:!1,versionForm:{name:"",enrollYear:"",reviseYear:"",versionId:""},C_ErrorMsg_editVersion_name:"",C_ErrorMsg_editVersion_enrollYear:"",C_ErrorMsg_editVersion_reviseYear:"",editVersionRules:{name:[{validator:o,trigger:"blur"}],enrollYear:[{validator:n,trigger:"blur"}],reviseYear:[{validator:r,trigger:"blur"}]},showAddWorkbook:!1,workBookId:"",workBookDetail:[],showEditVersionDailogFlag:!1,C_ErrorMsg:"",C_ErrorMsg_edit:"",showToolIcon:Boolean,loadmoreDisabled:Boolean,keyword:"",Respondentkeyword:"",isloading:!0,hasBaseCourse:!1,hasNoBaseCourse:!1,courseTypeSource:[],courseNatureSource:[],showSetDetailPage:!1,selectedDetail:"",userId:"",identity:"",loading:!1,remoteteacher:[],currentEditRow:"",editRespondentPostdata:[],editRespondentInfo:"",respondentInfos:"",editPrinciple:!1,respondentPostdata:[],selectedRespondent:"",principleForm:[],showPrinciple:!1,showLoadmore:!0,rules:{courseName:[{required:!0,message:"请输入课程名称",trigger:"blur"},{min:2,max:15,message:"长度在 2 到 15 个字符",trigger:"blur"}],courseCode:[{required:!0,message:"请输入课程代码",trigger:"blur"},{min:5,max:15,message:"长度在 5 到 15 个字符",trigger:"blur"}],credit:[{required:!0,message:"请输入课程学分",trigger:"blur"}],courseNature:[{required:!1,message:"请选择课程性质",trigger:"change"}],courseType:[{required:!1,message:"请选择课程类型",trigger:"change"}]},routeVersionId:"",routeCourseId:"",currentVersion:"",currentVersionName:"",currentVersionId:""},(0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)(e,"loading",(0,ce.KR)(!1)),"options",[]),"versionLabel",[]),"versions",[]),"closeShow",(0,ce.KR)(!1)),"multipleSelection",[]),"numSelected",0),"clickState",0),"courseId",(0,ce.KR)([])),"tableData",(0,ce.Kh)([{courseName:"",courseCode:"",courseType:"",courseNature:"",respondentInfos:"",respondentName:"",credit:"",courseYear:"",remark:"",versionId:""}])),(0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)(e,"pageSize",(0,ce.KR)(20)),"pageNum",(0,ce.KR)(1)),"departmentId",""),"schoolId",""),"dialogFormVisible",(0,ce.KR)(!1)),"dialogFormVisible1",(0,ce.KR)(!1)),"formLabelWidth","100px"),"form",(0,ce.Kh)({courseName:"",courseCode:"",courseType:"",courseNature:"",respondentInfos:"",respondentName:"",credit:"",courseYear:"",remark:"",versionId:""})),"preform",(0,ce.Kh)({courseName:"",courseCode:"",courseType:"",courseNature:"",respondentInfos:"",respondentName:"",credit:"",courseYear:"",remark:"",versionId:""})),"result",{})},watch:{},methods:{getSelectedBaseCourse:function(e){this.hasDetail=e,console.log("hasDetail:",this.hasDetail),sessionStorage.setItem("baseCourseHasDetail",this.hasDetail),this.getBaseCourse(this.pageSize,this.pageNum)},cancelVersionForm:function(){this.versionForm={name:"",enrollYear:"",reviseYear:"",versionId:""},this.C_ErrorMsg_editVersion_name="",this.C_ErrorMsg_editVersion_enrollYear="",this.C_ErrorMsg_editVersion_reviseYear="",this.nameFlag=!1,this.enrollYearFlag=!1,this.reviseYearFlag=!1},showEditVersionDailog:function(){this.showEditVersionDailogFlag=!0},getSearchValueforRespondent:function(e){this.Respondentkeyword=e,this.getPrincipleInfo()},getSearchValue:function(e){this.keyword=e,sessionStorage.removeItem("baseCourseSearchForm"),console.log("searching------------------"),this.getBaseCourse(this.pageSize,this.pageNum)},getDict:function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){var o;return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=e,e.courseNatureSource=[],e.courseTypeSource=[],e.versions=[],e.versionLabel=[],qt().then((function(e){console.log("Dict:",e),e.course_nature.forEach((function(e){o.courseNatureSource.push(e.dictLabel)})),e.course_type.forEach((function(e){o.courseTypeSource.push(e.dictLabel)}))})),t.abrupt("return",Q({url:"detail/versionList",method:"get"}).then((function(t){if(console.log("versionList:",t),"SUCCESS"==t.code&&t.data.length){o.hasVersion=!0,o.hasNoVersion=!1,t.data.forEach((function(e){var t={label:e.versionName,enrollYear:e.enrollYear,reviseYear:e.reviseYear,versionId:e.versionId};o.versions.push(t),o.versionLabel.push(e.versionName)})),o.currentVersionId=e.$store.state.course.baseCourseVersionId?e.$store.state.course.baseCourseVersionId:o.versions[0].versionId,console.log("baseCourseVersionId",e.$store.state.course.baseCourseVersionId,"that.versions[0].versionId",o.versions[0].versionId);var n,r=(0,Qt.A)(o.versions);try{for(r.s();!(n=r.n()).done;){var a=n.value;a["versionId"]==o.currentVersionId&&(console.log("find same "),o.currentVersion=a["label"],o.currentVersionName=a["label"])}}catch(err){r.e(err)}finally{r.f()}}else o.hasVersion=!1,o.hasNoVersion=!0,(0,G.nk)({type:"error",message:"没有版本信息，请先添加版本！",duration:1500})}))["catch"]((function(e){console.log("error:",e)})));case 7:case"end":return t.stop()}}),t)})))()},rowKey:function(e){return e.courseId},setDetail:function(){},remoteMethodinADD:function(e){var t=this,o=this;""!==e?(this.loading=!0,setTimeout((function(){t.loading=!1,t.Respondentkeyword=e,t.getPrincipleInfo().then((function(){o.principleForm=o.remoteteacher}))}),200)):this.principleForm=[]},deleteRespondent:function(){var e=this,t=this;this.courseId.forEach((function(e){var o={courseId:e,departmentId:t.departmentId,schoolId:t.schoolId,userId:0};t.editRespondentPostdata.push(o)})),P.s.confirm("是否确认删除课程负责人","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){return Q({url:"/system/role/editRespondent",method:"post",data:e.editRespondentPostdata}).then((function(e){console.log("delete respondent res:",e),t.getBaseCourse(t.pageSize,t.pageNum),t.editPrinciple=!1,t.editRespondentPostdata=[],"SUCCESS"==e.code?(0,G.nk)({type:"success",message:"删除成功",duration:1500}):(0,G.nk)({type:"error",message:"删除失败",duration:1500})}))}))["catch"]((function(){}))},addRespondent:function(){var e=this;return this.courseId.forEach((function(t){var o={courseId:t,departmentId:e.departmentId,schoolId:e.schoolId,userId:e.selectedRespondent};e.respondentPostdata.push(o)})),Q({url:"/system/role/editRespondent",method:"post",data:this.respondentPostdata}).then((function(t){console.log("respondentPostdata :",t),e.getBaseCourse(e.pageSize,e.pageNum),e.showPrinciple=!1,e.respondentPostdata=[],"SUCCESS"==t.code&&(0,G.nk)({type:"success",message:"新建成功",duration:1500})}))["catch"]((function(e){500===e.status?(0,G.nk)({type:"error",message:"新建出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500})}))},getPrincipleInfo:function(){var e=this;return Q({url:"/teacher/list",method:"get",params:{schoolId:this.schoolId,departmentId:this.departmentId,selectKeyWord:this.Respondentkeyword}}).then((function(t){e.remoteteacher=t.rows.map((function(e){return{userId:e.userId,respondentName:e.teacherName+"("+e.teacherNumber+")"}})),console.log("principle INfo :",t.rows)}))},loadmoreCourse:function(){this.result.total-this.pageSize>=20&&(this.pageSize+=20,this.getBaseCourse(this.pageSize,this.pageNum)),this.result.total-this.pageSize<20&&this.result.total>this.pageSize&&(this.pageSize+=this.result.total-this.pageSize,this.getBaseCourse(this.pageSize,this.pageNum))},printworkbook:function(){console.log("workBookId",this.workBookId)},addWorkbook:function(){var e=this;this.showAddWorkbook=!0,this.workBookDetail=[],Za(this.departmentId).then((function(t){console.log(t),"SUCCESS"==t.code&&t.rows.forEach((function(t){e.workBookDetail.push({name:t.name,workbookId:t.workbookId})}))}))["catch"]((function(e){500===e.status?(0,G.nk)({type:"error",message:"添加出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500})}))},submitWorkbook:function(){var e=this,t=[];this.courseId.forEach((function(o){t.push({courseId:o,workbookId:e.workBookId})})),console.log("tempList",t),rs(t).then((function(t){console.log("setWorkbook res",t),"SUCCESS"==t.code&&(e.showAddWorkbook=!1,(0,G.nk)({type:"success",message:"分配成功",duration:1500}),e.getBaseCourse(e.pageSize,e.pageNum))}))["catch"]((function(e){500===e.status?(0,G.nk)({type:"error",message:"添加出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500})}))},addPrincipal:function(){console.log("add principle",this.principleForm),this.showPrinciple=!0},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return(0,G.nk)({type:"error",message:"新建失败",duration:1500}),!1;t.addBaseCourse()}))},resetForm:function(e){this.$refs[e].resetFields()},getRouter:function(){this.routeVersionId=this.$route.query.versionId,this.routeCourseId=this.$route.query.courseId,console.log("routeVersion:",this.routeVersionId),console.log("routeCourse:",this.routeCourseId)},addBaseCourseDetail:function(e){if(console.log("currentVersionId",this.currentVersionId),this.canAddbbasecourseDetail)if(this.currentVersionId){var t,o=this,n=(0,Qt.A)(this.versions);try{for(n.s();!(t=n.n()).done;){var r=t.value;r["versionId"]==o.currentVersionId&&(console.log("find same "),o.currentVersion=r["label"],o.currentVersionName=r["label"])}}catch(err){n.e(err)}finally{n.f()}console.log("currentVersionName",this.currentVersionName);var a="是否确认添加课程大纲（版本："+this.currentVersionName+" ）?";P.s.confirm(a,"",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){return console.log("versionId",o.currentVersionId,"CourseId",o.courseId),Q({url:"/detail",method:"post",data:{versionId:o.currentVersionId,courseId:e.courseId,departmentId:o.departmentId,schoolId:o.schoolId}}).then((function(e){console.log(e),"SUCCESS"==e.code&&((0,G.nk)({type:"success",message:"新建成功",duration:1500}),o.getBaseCourse(o.pageSize,o.pageNum))}))["catch"]((function(e){console.log("e",e),"UNPROCESSABLE ENTITY"==e.data.code&&"UNPROCESSABLE ENTIT"==e.data.msg?((0,G.nk)({type:"error",message:"没有选择课程大纲版本",duration:1500}),o.getBaseCourse(o.pageSize,o.pageNum)):409===e.status?(0,G.nk)({type:"error",message:"新建失败,课程已存在",duration:1500}):500===e.status?(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500}),o.getBaseCourse(o.pageSize,o.pageNum)}))}))["catch"]((function(){}))}else(0,G.nk)({type:"error",message:"请选择课程大纲！",duration:1500})},getCourseByYear:function(e){if(e){this.currentVersionId="全部"==e?null:e,console.log("currentVersionId",this.currentVersionId),this.$store.commit("course/setbaseCourseVersionId",this.currentVersionId);var t,o=(0,Qt.A)(this.versions);try{for(o.s();!(t=o.n()).done;){var n=t.value;n["versionId"]==this.currentVersionId&&(this.currentVersionName=n["label"])}}catch(err){o.e(err)}finally{o.f()}this.getBaseCourse(this.pageSize,this.pageNum)}else console.log("没有选择版本大纲",e)},clearForm:function(){this.form.courseId="",this.form.courseName="",this.form.courseCode="",this.form.courseType="",this.form.courseNature="",this.form.respondentInfos="",this.form.respondentName="",this.form.credit="",this.form.courseYear="",this.form.remark=""},toggleSelection:function(e){var t=this;e?e.forEach((function(e){t.$refs.multipleTable1.toggleRowSelection(e),t.$refs.multipleTable2.toggleRowSelection(e)})):(this.$refs.multipleTable1.clearSelection(),this.$refs.multipleTable2.clearSelection(),console.log("清空选择触发"),1==this.clickState&&(this.clickState=0,this.closeShow=!this.closeShow))},handleSelectionChange:function(e){var t=[];this.multipleSelection=e,console.log("选中的信息：",e),e.length?(this.canGobasecourse=!1,this.canAddbbasecourseDetail=!1):(this.canGobasecourse=!0,this.canAddbbasecourseDetail=!0),e.forEach((function(e){var o=e.courseId;t.push(o)})),e.length>0?(this.showToolIcon=!1,console.log("showToolIcon",this.showToolIcon)):(this.showToolIcon=!0,console.log("showToolIcon",this.showToolIcon)),this.numSelected=this.multipleSelection.length,1!=this.clickState&&(this.closeShow=!this.closeShow,this.clickState=1),1==this.clickState&&0==this.numSelected&&(this.clickState=0,this.closeShow=!this.closeShow),this.courseId=t,console.log("courseId:",this.courseId)},handleSizeChange:function(e){this.pageSize=e,console.log("每页 ".concat(e," 条")),this.getBaseCourse(this.pageSize,this.pageNum)},handleCurrentChange:function(e){this.pageNum=e,console.log("当前页: ".concat(e)),this.getBaseCourse(this.pageSize,this.pageNum)},addBaseCourse:function(){this.C_ErrorMsg="",console.log(this.form);var e=this,t=this.formTopostData(this.form);return console.log("postData:",t),Q({url:"/baseCourse/add",method:"post",data:t}).then((function(t){"SUCCESS"==t.code&&(e.dialogFormVisible=!1,(0,G.nk)({type:"success",message:"新建成功",duration:1500}),e.clearForm(),e.getBaseCourse(e.pageSize,e.pageNum))}))["catch"]((function(t){console.log("e",t),e.dialogFormVisible=!0,"E_CODE_EXIST"==t.data.code?((0,G.nk)({type:"error",message:"新建失败，课程已存在",duration:1500}),e.C_ErrorMsg="课程已存在，请重新输入"):"DATA_DUPLICATED"==t.data.code?((0,G.nk)({type:"error",message:"新建失败，数据重复",duration:1500}),e.C_ErrorMsg="课程已存在，请重新输入"):409===t.status?(0,G.nk)({type:"error",message:"新建失败,课程已存在",duration:1500}):500===t.status?(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500})}))},getBaseCourse:function(e,t){var o=this.identity,n="",r={};"学院管理员"==o&&(n="/baseCourse/list",r={pageSize:e,pageNum:t,versionId:this.currentVersionId,hasDetail:this.hasDetail,departmentId:this.departmentId,schoolId:this.schoolId,selectKeyWord:this.keyword}),"课程负责人"==o&&(n="/baseCourse/respondent",r={pageSize:e,pageNum:t,versionId:this.currentVersionId,userId:this.userId,hasDetail:this.hasDetail,departmentId:this.departmentId,schoolId:this.schoolId,selectKeyWord:this.keyword}),console.log("pageSize:",e," pageNum:",t,"versionId",this.currentVersionId);var a=this,s=[],i=[],l=[];return this.isloading=!0,this.loadmoreDisabled=!0,Q({url:n,method:"get",params:r}).then((function(t){a.isloading=!1,a.loadmoreDisabled=!1,console.log("courseDetails:",t),console.log("department:",a.departmentId,"schoolId:",a.schoolId),0!=t.total?(a.hasBaseCourse=!0,a.hasNoBaseCourse=!1,t.rows.forEach((function(e){if(e.courseName=e.courseName,e.courseCode=e.courseCode,e.courseType=a.courseTypeSource[e.courseType],e.courseNature=a.courseNatureSource[e.courseNature],e.credit=e.credit,e.bcDetails.length){var t,o=(0,Qt.A)(e.bcDetails);try{for(o.s();!(t=o.n()).done;){var n=t.value;if(n.versionId==a.currentVersionId){e.versionId=!0;break}e.versionId=!1}}catch(err){o.e(err)}finally{o.f()}}e.respondentInfos&&e.respondentInfos.forEach((function(t){e.respondentName=t.respondentName})),s.push(e),e.versionId&&(i.push(e)),e.versionId||(l.push(e))})),a.tableData=s,a.result=t,e>=a.result.total?a.showLoadmore=!1:a.showLoadmore=!0,console.log("pageSize:",e,"result.total:",a.result.total,"showloadmore:",a.showLoadmore)):(a.hasBaseCourse=!1,a.hasNoBaseCourse=!0)}))["catch"]((function(e){console.log("e",e)}))},multideleteBaseCourse:function(e){var t=this;P.s.confirm("是否确认删除课程？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){return Q({url:"/baseCourse",method:"delete",data:e}).then((function(e){console.log(e),204===e&&((0,G.nk)({type:"success",message:"删除成功",duration:1500}),t.getBaseCourse(t.pageSize,t.pageNum),t.$refs.multipleTable1.clearSelection(),t.numSelected=0,1==t.clickState&&(t.clickState=0,t.closeShow=!t.closeShow))}))["catch"]((function(e){if(console.log("e",e),"ALREADY_ADD_TO_PROGRAM"==e.code)(0,G.nk)({type:"error",message:"删除失败,已加入培养方案",duration:1500});else if("ADD_TO_PROGRAM"==e.code){var o="删除失败,课程已被添加到培养计划中";(0,G.nk)({type:"error",message:o,duration:1500})}else(0,G.nk)({type:"error",message:"删除失败",duration:1500});t.getBaseCourse(t.pageSize,t.pageNum)}))}))["catch"]((function(e){console.log("e",e)}))},deleteBaseCourse:function(e,t){console.log("deleteCourse",t);var o=this;P.s.confirm("是否确认删除课程？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){return Q({url:"/baseCourse/"+t,method:"delete"}).then((function(e){console.log(e),204===e&&((0,G.nk)({type:"success",message:"删除成功",duration:1500}),o.getBaseCourse(o.pageSize,o.pageNum),o.$refs.multipleTable1.clearSelection(),o.numSelected=0,1==o.clickState&&(o.clickState=0,o.closeShow=!o.closeShow))}))["catch"]((function(e){console.log("e",e),"ALREADY_ADD_TO_PROGRAM"==e.code?(0,G.nk)({type:"error",message:"删除失败,该课程已加入培养方案",duration:1500}):(0,G.nk)({type:"error",message:"删除失败",duration:1500}),o.getBaseCourse(o.pageSize,o.pageNum)}))}))["catch"]((function(e){console.log("e",e)}))},goBaseCourseDetail:function(e,t){if(this.canGobasecourse&&(console.log("goBaseCourseDetail",e,t),sessionStorage.setItem("baseCourseSearchForm",this.keyword),void 0===t.columnKey))if(e.bcDetails.length){var o,n="",r=(0,Qt.A)(this.versions);try{for(r.s();!(o=r.n()).done;){var a=o.value;a["versionId"]==this.currentVersionId&&(n=a["label"])}}catch(err){r.e(err)}finally{r.f()}this.$store.commit("course/setbaseCourseVersionName",n),this.$store.commit("course/setbaseCourseVersionFlag",e.versionId),this.$store.commit("course/setbaseCourseVersionId",this.currentVersionId),this.$store.commit("course/setbaseCourseCourseId",e.courseId),this.$store.commit("course/setbaseCourseCourseName",e.courseName),this.$store.commit("course/setbaseCourseCourseCode",e.courseCode),this.$store.commit("course/setbaseCourseCourseType",e.courseType),this.$store.commit("course/setbaseCourseCourseNature",e.courseNature),this.$store.commit("course/setbaseCourseCredit",e.credit),this.$store.commit("course/setbaseCourseCourseYear",e.courseYear),this.$store.commit("course/setbaseCourseRemark",e.remark),this.$router.push({path:"/baseCourseDetail"})}else this.addBaseCourseDetail(e)},editTrigger:function(e){console.log("选中的信息：",e.courseId),this.postDataToform(e),this.dialogFormVisible1=!0},editBaseCourse:function(){this.C_ErrorMsg_edit="";var e=this;return console.log("preform:",this.preform),Q({url:"/baseCourse",method:"put",data:this.preform}).then((function(t){console.log("res:",t),"SUCCESS"==t.code&&(e.dialogFormVisible1=!1,(0,G.nk)({type:"success",message:"更新成功",duration:1500}),e.getBaseCourse(e.pageSize,e.pageNum))}))["catch"]((function(t){e.dialogFormVisible1=!0,console.log("e",t),"E_CODE_EXIST"==t.data.code?((0,G.nk)({type:"error",message:"更新失败，课程已存在",duration:1500}),e.C_ErrorMsg_edit="课程已存在，请重新输入"):"UNAUTHENTICATED"==t.data.code?(0,G.nk)({type:"error",message:"更新失败，无权限",duration:1500}):500===t.status?(0,G.nk)({type:"error",message:"更新出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500})}))},goAddBaseCourses:function(){this.$router.push({path:"/batchCourseAdd"})},formTopostData:function(e){var t={};return t.departmentId=this.departmentId,t.schoolId=this.schoolId,t.courseName=e.courseName,t.courseCode=e.courseCode,t.courseType=e.courseType,t.courseNature=e.courseNature,t.respondentName=e.respondentName,t.credit=e.credit,t.courseYear=e.courseYear,t.remark=e.remark,t},postDataToform:function(e){this.preform.courseId=e.courseId,this.preform.courseName=e.courseName,this.preform.courseCode=e.courseCode,this.preform.courseType=this.courseTypeSource.indexOf(e.courseType)>-1?this.courseTypeSource.indexOf(e.courseType):"",this.preform.courseNature=this.courseNatureSource.indexOf(e.courseNature)>-1?this.courseNatureSource.indexOf(e.courseNature):"",this.preform.credit=e.credit,this.preform.respondentName=e.respondentName,this.preform.courseYear="2022"==e.courseYear?"0":"1",this.preform.remark=e.remark},dataTransfrom:function(e){return e.courseName=e.courseName,e.courseCode=e.courseCode,e.courseType=""==e.courseType?"":this.courseTypeSource[e.courseType],e.courseNature=""==e.courseNature?"":this.courseNatureSource[e.courseNature],e.respondentName=e.respondentName,e.credit=e.credit,e.courseYear="0"==e.courseYear?"2022":"2023",e.remark=e.remark?"":e.remark.trim(),e},activate:function(){this.departmentId=this.$store.state.currentInfo.departmentId,this.schoolId=this.$store.state.currentInfo.schoolId,this.identity=this.$store.state.currentInfo.identity,console.log("this.$store.state.course.baseCourseVersionId",this.$store.state.course.baseCourseVersionId),(null===sessionStorage.getItem("baseCourseHasDetail")||sessionStorage.getItem("baseCourseHasDetail"))&&(this.hasDetail=sessionStorage.getItem("baseCourseHasDetail")),sessionStorage.getItem("baseCourseSearchForm")?(this.keyword=sessionStorage.getItem("baseCourseSearchForm"),console.log("baseCourseSearchForm",this.keyword),this.getSearchValue(this.keyword)):sessionStorage.removeItem("baseCourseSearchForm"),"课程负责人"==this.identity&&(this.userId=this.$store.state.userInfo.userId)}},mounted:function(){var e=this;this.activate(),this.getDict().then((function(){var t=e.identity;"学院管理员"==t&&(e.getRouter(),e.routeVersionId&&(e.currentVersionId=e.routeVersionId)),e.getBaseCourse(e.pageSize,e.pageNum)}))}},ds=(0,h.A)(us,[["render",Ha],["__scopeId","data-v-547d0fc8"]]),hs=ds;var fs=function(e){return(0,l.Qi)("data-v-53b70403"),e=e(),(0,l.jt)(),e},ms={class:"rightSlot"},ps={class:"selects"},bs={class:"assignBtn"},gs={class:"dialog-footer"},ks={class:"dialog-footer"},vs={class:"assignDialog"},Is=fs((function(){return(0,l.Lk)("div",{class:"prompt"},"请选择课程大纲版本以及试卷分析表",-1)})),ys={key:0},Cs={class:"dialog-footer"},As={class:"assessmentDialog"},Fs={class:"dialog-footer"},ws={key:0},Ss={key:1},_s={key:2},Es={key:3},Ns={key:4},Vs={key:0},xs={key:1},Ts={class:"no-class"},js={class:"no-class-detail"},Ls={class:"pagination-container",flex:""},Ds={class:"loadMore"};function Bs(e,t,o,n,r,a){var s=(0,l.g2)("el-option"),c=(0,l.g2)("el-select"),u=(0,l.g2)("MoreFilled"),d=(0,l.g2)("el-icon"),h=(0,l.g2)("el-dropdown-item"),f=(0,l.g2)("el-dropdown-menu"),m=(0,l.g2)("el-dropdown"),p=(0,l.g2)("HeaderSearch"),b=(0,l.g2)("addBtn"),g=(0,l.g2)("el-input"),k=(0,l.g2)("el-form-item"),v=(0,l.g2)("el-form"),I=(0,l.g2)("el-button"),y=(0,l.g2)("el-dialog"),A=(0,l.g2)("el-switch"),F=(0,l.g2)("el-tooltip"),w=(0,l.g2)("el-cascader"),S=(0,l.g2)("el-col"),_=(0,l.g2)("el-row"),E=(0,l.g2)("el-table-column"),N=(0,l.g2)("el-tag"),V=(0,l.g2)("SetUp"),x=(0,l.g2)("Delete"),T=(0,l.g2)("Edit"),j=(0,l.g2)("Warning"),L=(0,l.g2)("el-table");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(p,{msg:"搜索课程名称、任课教师(姓名、工号)、课程号、开课号",onSearchValue:a.getSearchValue,value:r.keyword},{rightTime:(0,l.k6)((function(){return[(0,l.bo)((0,l.Lk)("div",ms,[(0,l.Lk)("div",ps,[(0,l.bF)(c,{modelValue:r.chosenYear,"onUpdate:modelValue":t[0]||(t[0]=function(e){return r.chosenYear=e}),placeholder:"全部学年",class:"selecter",onChange:t[1]||(t[1]=function(e){return a.getClassList()})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.academicYear,(function(e){return(0,l.uX)(),(0,l.Wv)(s,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"]),(0,l.bF)(c,{modelValue:r.chosenSemester,"onUpdate:modelValue":t[2]||(t[2]=function(e){return r.chosenSemester=e}),placeholder:"全部学期",class:"selecter",onChange:t[3]||(t[3]=function(e){return a.getClassList()})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.semester,(function(e){return(0,l.uX)(),(0,l.Wv)(s,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"]),(0,l.bF)(c,{modelValue:r.chosenStatus,"onUpdate:modelValue":t[4]||(t[4]=function(e){return r.chosenStatus=e}),placeholder:"提交状态",class:"status",onChange:t[5]||(t[5]=function(e){return a.getClassList()})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.classStatus,(function(e){return(0,l.uX)(),(0,l.Wv)(s,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])])],512),[[i.aG,!r.showAdd]]),(0,l.bo)((0,l.Lk)("div",bs,[(0,l.bF)(m,{style:{"margin-top":"10px",cursor:"pointer"}},{dropdown:(0,l.k6)((function(){return[(0,l.bF)(f,null,{default:(0,l.k6)((function(){return[(0,l.bF)(h,{onClick:t[6]||(t[6]=function(e){return a.assignDetail()})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 设置课程大纲 ")]})),_:1}),(0,l.bF)(h,{onClick:t[7]||(t[7]=function(e){return a.associateCourse()})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 关联课程库课程 ")]})),_:1}),(0,l.bF)(h,{onClick:t[8]||(t[8]=function(e){return a.openAssess()})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 设置特色教学班 ")]})),_:1})]})),_:1})]})),default:(0,l.k6)((function(){return[(0,l.bF)(d,{class:"dropdownIcon"},{default:(0,l.k6)((function(){return[(0,l.bF)(u)]})),_:1})]})),_:1})],512),[[i.aG,r.showAdd]])]})),_:1},8,["onSearchValue","value"]),(0,l.bo)((0,l.bF)(b,{onClick:t[9]||(t[9]=function(e){return r.addVisible=!0})},null,512),[[i.aG,"学院管理员"===r.identity]]),(0,l.Lk)("div",null,[(0,l.bF)(y,{modelValue:r.addVisible,"onUpdate:modelValue":t[19]||(t[19]=function(e){return r.addVisible=e}),title:"新建教学班",width:"580px","show-close":!1,"align-center":!0},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",gs,[(0,l.bF)(I,{onClick:a.goBatchAddClass},{default:(0,l.k6)((function(){return[(0,l.eW)("批量添加")]})),_:1},8,["onClick"]),(0,l.bF)(I,{onClick:t[17]||(t[17]=function(e){return r.addVisible=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(I,{type:"primary",onClick:t[18]||(t[18]=function(e){return a.addClass(r.classAddForm)})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(v,{model:r.classAddForm,rules:r.rules,ref:"classAddForm","label-position":"top"},{default:(0,l.k6)((function(){return[(0,l.bF)(k,{label:"课程名","label-width":r.formLabelWidth,prop:"className"},{default:(0,l.k6)((function(){return[(0,l.bF)(g,{modelValue:r.classAddForm.className,"onUpdate:modelValue":t[10]||(t[10]=function(e){return r.classAddForm.className=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(k,{label:"任课教师","label-width":r.formLabelWidth,prop:"instructor",error:r.T_ErrorMsg},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{modelValue:r.classAddForm.instructor,"onUpdate:modelValue":t[11]||(t[11]=function(e){return r.classAddForm.instructor=e}),multiple:"",filterable:"",remote:"","reserve-keyword":"",style:{width:"540px"},"remote-method":a.goSearch,loading:e.loading},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.result,(function(e,t){return(0,l.uX)(),(0,l.Wv)(s,{key:t,label:e.value,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue","remote-method","loading"])]})),_:1},8,["label-width","error"]),(0,l.bF)(k,{label:"课程号","label-width":r.formLabelWidth,prop:"courseCode",error:r.E_ErrorMsg},{default:(0,l.k6)((function(){return[(0,l.bF)(g,{modelValue:r.classAddForm.courseCode,"onUpdate:modelValue":t[12]||(t[12]=function(e){return r.classAddForm.courseCode=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width","error"]),(0,l.bF)(k,{label:"开课号","label-width":r.formLabelWidth,prop:"identifier"},{default:(0,l.k6)((function(){return[(0,l.bF)(g,{modelValue:r.classAddForm.identifier,"onUpdate:modelValue":t[13]||(t[13]=function(e){return r.classAddForm.identifier=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(k,{label:"开课学年","label-width":r.formLabelWidth,prop:"chosenYear"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{modelValue:r.classAddForm.chosenYear,"onUpdate:modelValue":t[14]||(t[14]=function(e){return r.classAddForm.chosenYear=e}),placeholder:"选择开课学年"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.onlyAcademicYear,(function(e){return(0,l.uX)(),(0,l.Wv)(s,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(k,{label:"开课学期","label-width":r.formLabelWidth,prop:"chosenSemester"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{modelValue:r.classAddForm.chosenSemester,"onUpdate:modelValue":t[15]||(t[15]=function(e){return r.classAddForm.chosenSemester=e}),placeholder:"选择开课学期"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.onlySemester,(function(e){return(0,l.uX)(),(0,l.Wv)(s,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(k,{label:"备注","label-width":r.formLabelWidth,prop:"remark"},{default:(0,l.k6)((function(){return[(0,l.bF)(g,{rows:2,type:"textarea",modelValue:r.classAddForm.remark,"onUpdate:modelValue":t[16]||(t[16]=function(e){return r.classAddForm.remark=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"])]})),_:1},8,["model","rules"])]})),_:1},8,["modelValue"])]),(0,l.Lk)("div",null,[(0,l.bF)(y,{modelValue:r.editVisible,"onUpdate:modelValue":t[30]||(t[30]=function(e){return r.editVisible=e}),title:"修改教学班",width:"580px","show-close":!1,"align-center":!0},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",ks,[(0,l.bF)(I,{onClick:t[28]||(t[28]=function(e){return r.editVisible=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(I,{type:"primary",onClick:t[29]||(t[29]=function(e){return a.confirmEditClass(r.classEditForm)})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(v,{model:r.classEditForm,rules:r.rules,ref:"classEditForm","label-position":"top"},{default:(0,l.k6)((function(){return[(0,l.bF)(k,{label:"课程名","label-width":r.formLabelWidth,prop:"className"},{default:(0,l.k6)((function(){return[(0,l.bF)(g,{modelValue:r.classEditForm.className,"onUpdate:modelValue":t[20]||(t[20]=function(e){return r.classEditForm.className=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(k,{label:"任课教师","label-width":r.formLabelWidth,prop:"instructor",error:r.T_ErrorMsg},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{modelValue:r.classEditForm.teachers,"onUpdate:modelValue":t[21]||(t[21]=function(e){return r.classEditForm.teachers=e}),multiple:"",filterable:"",remote:"","reserve-keyword":"",style:{width:"540px"},"remote-method":a.goSearch,loading:e.loading},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.result,(function(e,t){return(0,l.uX)(),(0,l.Wv)(s,{key:t,label:e.value,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue","remote-method","loading"])]})),_:1},8,["label-width","error"]),(0,l.bF)(k,{label:"课程号","label-width":r.formLabelWidth,prop:"courseCode",error:r.E_ErrorMsg},{default:(0,l.k6)((function(){return[(0,l.bF)(g,{modelValue:r.classEditForm.courseCode,"onUpdate:modelValue":t[22]||(t[22]=function(e){return r.classEditForm.courseCode=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width","error"]),(0,l.bF)(k,{label:"开课号","label-width":r.formLabelWidth,prop:"identifier"},{default:(0,l.k6)((function(){return[(0,l.bF)(g,{modelValue:r.classEditForm.identifier,"onUpdate:modelValue":t[23]||(t[23]=function(e){return r.classEditForm.identifier=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(k,{label:"开课学年","label-width":r.formLabelWidth,prop:"chosenYear"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{modelValue:r.classEditForm.chosenYear,"onUpdate:modelValue":t[24]||(t[24]=function(e){return r.classEditForm.chosenYear=e}),placeholder:"选择开课学年"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.onlyAcademicYear,(function(e){return(0,l.uX)(),(0,l.Wv)(s,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(k,{label:"开课学期","label-width":r.formLabelWidth,prop:"chosenSemester"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{modelValue:r.classEditForm.chosenSemester,"onUpdate:modelValue":t[25]||(t[25]=function(e){return r.classEditForm.chosenSemester=e}),placeholder:"选择开课学期"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.onlySemester,(function(e){return(0,l.uX)(),(0,l.Wv)(s,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(k,{label:"","label-width":r.formLabelWidth,prop:"isRespondent"},{default:(0,l.k6)((function(){return[(0,l.eW)(" 允许任课教师修改考核方式 "),(0,l.bF)(A,{modelValue:r.classEditForm.isRespondent,"onUpdate:modelValue":t[26]||(t[26]=function(e){return r.classEditForm.isRespondent=e}),"inline-prompt":"","active-text":"是","inactive-text":"否","active-value":"2","inactive-value":"0"},null,8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(k,{label:"备注","label-width":r.formLabelWidth,prop:"remark"},{default:(0,l.k6)((function(){return[(0,l.bF)(g,{rows:2,type:"textarea",modelValue:r.classEditForm.remark,"onUpdate:modelValue":t[27]||(t[27]=function(e){return r.classEditForm.remark=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"])]})),_:1},8,["model","rules"])]})),_:1},8,["modelValue"])]),(0,l.Lk)("div",vs,[(0,l.bF)(y,{modelValue:r.isAssign,"onUpdate:modelValue":t[34]||(t[34]=function(e){return r.isAssign=e}),title:"设置课程大纲",width:"400px","show-close":!1,"align-center":!0},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",Cs,[(0,l.bF)(I,{onClick:t[32]||(t[32]=function(e){return r.isAssign=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(I,{type:"primary",onClick:t[33]||(t[33]=function(e){return a.confirmAssign()})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[Is,(0,l.bF)(w,{modelValue:r.assignedDetail,"onUpdate:modelValue":t[31]||(t[31]=function(e){return r.assignedDetail=e}),options:r.detailList,style:{width:"330px","margin-left":"20px"},placeholder:"选择课程大纲版本",class:"custom-cascader"},{default:(0,l.k6)((function(e){var t=e.node,o=e.data;return[o.children||!o.description?((0,l.uX)(),(0,l.CE)("span",ys,(0,C.v_)(t.label),1)):((0,l.uX)(),(0,l.Wv)(F,{key:1,"hide-after":0,content:o.description,effect:"dark",placement:"top"},{default:(0,l.k6)((function(){return[(0,l.Lk)("span",null,(0,C.v_)(t.label),1)]})),_:2},1032,["content"]))]})),_:1},8,["modelValue","options"])]})),_:1},8,["modelValue"])]),(0,l.Lk)("div",As,[(0,l.bF)(y,{modelValue:r.isAssessment,"onUpdate:modelValue":t[38]||(t[38]=function(e){return r.isAssessment=e}),title:"设置特色教学班",width:"350px","show-close":!1,"align-center":!0},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",Fs,[(0,l.bF)(I,{onClick:t[36]||(t[36]=function(e){return r.isAssessment=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(I,{type:"primary",onClick:t[37]||(t[37]=function(e){return a.changeAssessment()})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(_,null,{default:(0,l.k6)((function(){return[(0,l.bF)(S,{span:18,style:{"margin-top":"5px","margin-left":"20px","font-size":"17px"}},{default:(0,l.k6)((function(){return[(0,l.eW)("是否为特色教学班")]})),_:1}),(0,l.bF)(S,{span:4},{default:(0,l.k6)((function(){return[(0,l.bF)(A,{modelValue:r.multIsRespondent,"onUpdate:modelValue":t[35]||(t[35]=function(e){return r.multIsRespondent=e}),"inline-prompt":"","active-text":"是","inactive-text":"否","active-value":"2","inactive-value":"0"},null,8,["modelValue"])]})),_:1})]})),_:1}),(0,l.bo)((0,l.bF)(_,{style:{"margin-top":"15px","margin-left":"20px","font-size":"14px",color:"grey"}},{default:(0,l.k6)((function(){return[(0,l.eW)("任课教师可修改课程目标的考核方式")]})),_:1},512),[[i.aG,"2"===r.multIsRespondent]]),(0,l.bo)((0,l.bF)(_,{style:{"margin-top":"15px","margin-left":"20px","font-size":"14px",color:"grey"}},{default:(0,l.k6)((function(){return[(0,l.eW)("课程目标采用课程组统一的考核方式")]})),_:1},512),[[i.aG,"0"===r.multIsRespondent]])]})),_:1},8,["modelValue"])]),(0,l.bo)((0,l.bF)(L,{ref:"multipleTable",class:"classesTable",data:r.classTable,onSelectionChange:a.handleSelectionChange,onRowClick:a.goCheck,style:{width:"1500px"},"header-cell-class-name":a.cellClass,"header-cell-style":{"padding-left":"20px","font-size":"14.4px",height:"48px","font-weight":"bold",color:"black"},"cell-style":{"padding-left":"20px","font-size":"16px",height:"60px","text-overflow":" ellipsis","white-space":" nowrap",cursor:"pointer"},"highlight-current-row":"","row-key":a.rowKey},{default:(0,l.k6)((function(){return[(0,l.bF)(E,{type:"selection",width:"60",selectable:a.canSelect,"reserve-selection":!0,"column-key":"select"},null,8,["selectable"]),(0,l.bF)(E,{prop:"className",label:"课程名",width:"190"}),(0,l.bF)(E,{prop:"allTeacherName",label:"任课教师",width:"150"}),(0,l.bF)(E,{prop:"courseCode",label:"课程号",width:"150"}),(0,l.bF)(E,{prop:"versionName",label:"大纲版本",width:"120"}),(0,l.bF)(E,{prop:"identifier",label:"开课号",width:"270"}),(0,l.bF)(E,{prop:"academicYear",label:"学年",width:"140"}),(0,l.bF)(E,{prop:"semester",label:"学期",width:"120"}),(0,l.bF)(E,{prop:"status",label:"状态",width:"100"},{default:(0,l.k6)((function(e){return[1==e.row.status?((0,l.uX)(),(0,l.CE)("div",ws,[(0,l.bF)(N,{type:"info"},{default:(0,l.k6)((function(){return[(0,l.eW)("未提交")]})),_:1})])):2==e.row.status?((0,l.uX)(),(0,l.CE)("div",Ss,[(0,l.bF)(N,{type:"warning"},{default:(0,l.k6)((function(){return[(0,l.eW)("已提交")]})),_:1})])):3==e.row.status?((0,l.uX)(),(0,l.CE)("div",_s,[(0,l.bF)(N,{type:"success"},{default:(0,l.k6)((function(){return[(0,l.eW)("已审核")]})),_:1})])):4==e.row.status?((0,l.uX)(),(0,l.CE)("div",Es,[(0,l.bF)(N,{type:"danger"},{default:(0,l.k6)((function(){return[(0,l.eW)("已退回")]})),_:1})])):((0,l.uX)(),(0,l.CE)("div",Ns))]})),_:1}),(0,l.bF)(E,{prop:"isRespondent",label:"",width:"50"},{default:(0,l.k6)((function(e){return[2==e.row.isRespondent?((0,l.uX)(),(0,l.CE)("div",Vs,[(0,l.bF)(F,{content:"允许任课教师修改考核方式","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(I,{link:"",style:{color:"#3f51b5",cursor:"default"}},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{style:{color:"#3f51b5"}},{default:(0,l.k6)((function(){return[(0,l.bF)(V)]})),_:1})]})),_:1})]})),_:1})])):((0,l.uX)(),(0,l.CE)("span",xs))]})),_:1}),(0,l.bF)(E,{width:"150","column-key":"edit"},{default:(0,l.k6)((function(e){return[(0,l.bF)(_,null,{default:(0,l.k6)((function(){return[(0,l.bF)(S,{span:16},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(_,null,{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(S,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(F,{content:"删除","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(I,{link:"",style:{color:"#3f51b5"},onClick:(0,i.D$)((function(t){return a.deleteClass(e.$index,e.row)}),["stop"])},{default:(0,l.k6)((function(){return[(0,l.bF)(d,null,{default:(0,l.k6)((function(){return[(0,l.bF)(x)]})),_:1})]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1536),[[i.aG,"学院管理员"===r.identity]]),(0,l.bo)((0,l.bF)(S,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(F,{content:"修改","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(I,{link:"",style:{color:"#3f51b5"},onClick:(0,i.D$)((function(t){return a.editClass(e.$index,e.row)}),["stop"])},{default:(0,l.k6)((function(){return[(0,l.bF)(d,null,{default:(0,l.k6)((function(){return[(0,l.bF)(T)]})),_:1})]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1536),[[i.aG,"学院管理员"===r.identity]])]})),_:2},1536),[[i.aG,r.canAction]])]})),_:2},1024),(0,l.bo)((0,l.bF)(S,{span:6},{default:(0,l.k6)((function(){return[(0,l.bF)(_,null,{default:(0,l.k6)((function(){return[(0,l.bF)(F,{content:"未关联课程库课程","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{style:{color:"#9d2a2e","margin-top":"4px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(j)]})),_:1})]})),_:1})]})),_:1})]})),_:2},1536),[[i.aG,"2"===e.row.courseIsDeleted]])]})),_:2},1024)]})),_:1})]})),_:1},8,["data","onSelectionChange","onRowClick","header-cell-class-name","row-key"]),[[i.aG,r.hasClass]]),(0,l.bo)((0,l.Lk)("div",Ts,"没有教学班",512),[[i.aG,r.noClass]]),(0,l.bo)((0,l.Lk)("div",js," 请先点击右上角圆形按钮添加教学班 ",512),[[i.aG,r.noClass]]),(0,l.Lk)("div",Ls,[(0,l.Lk)("div",Ds,[(0,l.bo)((0,l.bF)(I,{link:"",plain:"",onClick:t[39]||(t[39]=function(e){return a.loadMore()})},{default:(0,l.k6)((function(){return[(0,l.eW)("加载更多")]})),_:1},512),[[i.aG,r.hasClass&&r.showLoadmore]])])])],64)}o(71761),o(50375);function $s(e,t,o){return Q({url:"/teacher/list/instructor",method:"get",params:{instructor:o,departmentId:e,schoolId:t}})}function Os(e,t,o){return Q({url:"/analysis/list",method:"get",params:{detailId:e,schoolId:t,departmentId:o}})}function Ms(e){return Q({url:"/analysis/editAverageScore/"+e,method:"get"})}function Us(e){return Q({url:"/analysis/editAverageScore",method:"POST",data:e})}function Ws(e){return Q({url:"/analysis",method:"DELETE",data:e})}function Rs(e){return Q({url:"/analysis",method:"PUT",data:e})}function Ps(e,t,o,n,r,a){return Q({url:"/classes/respondent",method:"get",params:{academicYear:e,semester:t,pageSize:o,pageNum:n,status:r,selectKeyWord:a}})}const Gs={name:"Class",components:{HeaderSearch:ne,addBtn:le,Edit:ee.ffu,Delete:ee.epd,Plus:ee.FWt,SetUp:ee._nA,Warning:ee.N5l,MoreFilled:ee.yGC},data:function(){return{multIsRespondent:"",hasClass:!1,noClass:!1,canAction:!0,isRespondent:"0",showLoadmore:!0,isAssign:!1,showAdd:!1,keyword:"",detailList:[],assignedDetail:[],multipleSelection:[],selectedCourseId:"",canSelectAll:!0,identity:"",searchTeacher:"",allTeachers:[],classTable:[],academicYear:[],semester:[],classStatus:[],status:[{value:null,label:"全部"},{value:1,label:"未提交"},{value:2,label:"已提交"},{value:3,label:"已审核"},{value:4,label:"已退回"}],onlyAcademicYear:[],onlySemester:[],chosenYear:"",chosenSemester:"",chosenStatus:"",currentInfo:{departmentId:Number,schoolId:Number},addVisible:!1,editVisible:!1,isAssessment:!1,formLabelWidth:"140px",classAddForm:{className:"",instructor:"",courseCode:"",identifier:"",chosenYear:"",chosenSemester:"",remark:""},classEditForm:{className:"",instructor:"",courseCode:"",identifier:"",chosenYear:"",chosenSemester:"",remark:""},rules:{className:[{required:!0,message:"请输入课程名称",trigger:"blur"}],instructor:[{required:!0,message:"请输入任课教师",trigger:"blur"}],courseCode:[{required:!0,message:"请输入课程号",trigger:"blur"}],identifier:[{required:!0,message:"请输入开课号",trigger:"blur"}],chosenYear:[{required:!0,message:"请选择开课学年",trigger:"change"}],chosenSemester:[{required:!0,message:"请选择开课学期",trigger:"change"}]},pageNum:1,pageSize:20,total:0,E_ErrorMsg:"",T_ErrorMsg:"",result:[],canClick:!0}},mounted:function(){this.currentInfo.departmentId=this.$store.state.currentInfo.departmentId,this.currentInfo.schoolId=this.$store.state.currentInfo.schoolId,this.identity=this.$store.state.currentInfo.identity,console.log("this.identity",this.identity),this.getDictionary(),sessionStorage.getItem("classSearchFlag")&&"null"!==sessionStorage.getItem("searchForm")?(this.keyword=sessionStorage.getItem("searchForm"),this.getSearchValue(this.keyword)):sessionStorage.removeItem("searchForm")},computed:{currentChange:function(){return this.$store.state.currentInfo},teacherAddChange:function(){return this.classAddForm.instructor},teacherEditChange:function(){return this.classEditForm.instructor},multipleSelectionChange:function(){return this.multipleSelection}},watch:{currentChange:{deep:!0,handler:function(e){this.currentInfo.departmentId=this.$store.state.currentInfo.departmentId,this.identity=this.$store.state.currentInfo.identity,this.getClassList()}},teacherAddChange:{deep:!0,handler:function(e){""!==e?this.goSearch(this.classAddForm.instructor):this.allTeachers=[]}},teacherEditChange:{deep:!0,handler:function(e){""!==e?this.goSearch(this.classEditForm.instructor):this.allTeachers=[]}},multipleSelectionChange:{deep:!0,handler:function(e){e.length>0?(this.canClick=!1,this.assignedDetail=[],this.getDetailList(),this.showAdd=!0):(this.canClick=!0,this.assignedDetail=[],this.showAdd=!1)}}},beforeRouteLeave:function(e,t,o){"/class"===t.path&&"/teacherClass"!==e.path&&(sessionStorage.removeItem("classChosenYear"),sessionStorage.removeItem("classChosenSemester"),sessionStorage.removeItem("classChosenStatus")),o()},methods:{goCheck:function(e,t){this.canClick&&(console.log("row:",e),void 0===t.columnKey&&(this.$store.commit("currentInfo/setOpenDrawer",!1),this.$store.commit("reviewInfo/setmessage",""),this.$store.commit("reviewInfo/setcheckState",""),"学院管理员"==this.identity?this.$store.commit("currentInfo/setadminSideClassInfo",e):"课程负责人"==this.identity?this.$store.commit("currentInfo/setRespondClassInfo",e):this.$store.commit("currentInfo/setTeacherSideClassInfo",e),sessionStorage.setItem("searchForm",this.keyword),sessionStorage.removeItem("classSearchFlag"),""===this.chosenYear&&""===this.chosenSemester&&""===this.chosenStatus||(sessionStorage.setItem("classChosenYear",this.chosenYear),sessionStorage.setItem("classChosenSemester",this.chosenSemester),sessionStorage.setItem("classChosenStatus",this.chosenStatus)),this.$router.push({name:"TeacherClass"})))},goBatchAddClass:function(){this.$router.push({path:"/batchClassAdd"})},getSearchValue:function(e){this.$refs.multipleTable.clearSelection(),sessionStorage.removeItem("classSearchFlag"),this.keyword=e,this.getClassList()},getDictionary:function(){var e=this;qt().then((function(t){console.log("getDictionary",t),e.academicYear=t.academic_year,e.semester=t.semester,e.classStatus=t.class_status,e.onlyAcademicYear=JSON.parse(JSON.stringify(t.academic_year)),e.onlySemester=JSON.parse(JSON.stringify(t.semester));var o={dictLabel:"全部学年",dictValue:null};e.academicYear.unshift(o);var n={dictLabel:"全部学期",dictValue:null};e.semester.unshift(n);var r={dictLabel:"全部",dictValue:null};e.classStatus.unshift(r);var a=sessionStorage.getItem("classChosenYear"),s=sessionStorage.getItem("classChosenSemester"),i=sessionStorage.getItem("classChosenStatus");(a||s||i)&&(e.chosenYear="null"===a?null:a,e.chosenSemester="null"===s?null:s,e.chosenStatus="null"===i?null:i),e.getClassList()}))},handleCurrentChange:function(e){this.currentPage=e,this.getClassList()},getClassList:function(){var e=this;"学院管理员"===this.identity&&cr(this.chosenYear,this.chosenSemester,this.currentInfo.departmentId,this.currentInfo.schoolId,this.pageSize,this.pageNum,this.keyword,this.chosenStatus).then((function(t){if(console.log("getClassList",t),"SUCCESS"===t.code&&(e.classTable=t.rows,0==e.classTable.length?(e.noClass=!0,e.hasClass=!1):(e.hasClass=!0,e.noClass=!1),e.total=t.total,e.pageSize>=t.total?e.showLoadmore=!1:e.showLoadmore=!0,e.classTable.length>0))for(var o=function(t){e.classTable[t].allTeacherName=e.classTable[t].teacherName,null!==e.classTable[t].additionalTeacherList&&e.classTable[t].additionalTeacherList.forEach((function(o){e.classTable[t].allTeacherName=e.classTable[t].allTeacherName+","+o.teacherName})),e.classTable[t].teachers=[];var o=e.classTable[t].teacherName+"("+e.classTable[t].teacherNumber+")";e.classTable[t].teachers.push(o),null!==e.classTable[t].additionalTeacherList&&e.classTable[t].additionalTeacherList.forEach((function(o){var n=o.teacherName+"("+o.teacherNumber+")";e.classTable[t].teachers.push(n)})),e.academicYear.forEach((function(o){o.dictValue==e.classTable[t].academicYear&&(e.classTable[t].academicYear=o.dictLabel)})),e.semester.forEach((function(o){o.dictValue==e.classTable[t].semester&&(e.classTable[t].semester=o.dictLabel)}))},n=0;n<e.classTable.length;n++)o(n)})),"课程负责人"===this.identity&&Ps(this.chosenYear,this.chosenSemester,this.pageSize,this.pageNum,this.chosenStatus,this.keyword).then((function(t){if(console.log("getClassList",t),"SUCCESS"===t.code&&(e.classTable=t.rows,0==e.classTable.length?(e.noClass=!0,e.hasClass=!1):(e.hasClass=!0,e.noClass=!1),e.total=t.total,e.pageSize>=t.total?e.showLoadmore=!1:e.showLoadmore=!0,e.classTable.length>0))for(var o=function(t){e.classTable[t].allTeacherName=e.classTable[t].teacherName,null!==e.classTable[t].additionalTeacherList&&e.classTable[t].additionalTeacherList.forEach((function(o){e.classTable[t].allTeacherName=e.classTable[t].allTeacherName+","+o.teacherName})),e.classTable[t].teachers=[];var o=e.classTable[t].teacherName+"("+e.classTable[t].teacherNumber+")";e.classTable[t].teachers.push(o),null!==e.classTable[t].additionalTeacherList&&e.classTable[t].additionalTeacherList.forEach((function(o){var n=o.teacherName+"("+o.teacherNumber+")";e.classTable[t].teachers.push(n)})),e.academicYear.forEach((function(o){o.dictValue==e.classTable[t].academicYear&&(e.classTable[t].academicYear=o.dictLabel)})),e.semester.forEach((function(o){o.dictValue==e.classTable[t].semester&&(e.classTable[t].semester=o.dictLabel)}))},n=0;n<e.classTable.length;n++)o(n)}))},addClass:function(e){var t=this;this.$refs["classAddForm"].validate((function(o){if(o){t.T_ErrorMsg="",t.E_ErrorMsg="",console.log("classAddForm",e);var n="";e.instructor.forEach((function(e){var t=e.split("(");n=n+","+t[1].substr(0,t[1].length-1)})),n=n.substr(1,n.length),ur(t.classAddForm.chosenYear,t.classAddForm.chosenSemester,t.currentInfo.departmentId,t.classAddForm.className,t.classAddForm.identifier,n,t.classAddForm.courseCode,t.classAddForm.remark,t.currentInfo.schoolId).then((function(e){t.addVisible=!1,console.log("addClass",e),t.getClassList()}))["catch"]((function(e){"E_CODE_NOT_EXIST"===e.code?((0,G.nk)({type:"error",message:"课程号不存在",duration:1500}),t.E_ErrorMsg="课程号不存在，请重新输入"):"E_TEACHER_NOT_EXIST"===e.code&&((0,G.nk)({type:"error",message:"教师不存在",duration:1500}),t.T_ErrorMsg="教师不存在，请重新输入")}))}else(0,G.nk)({type:"error",message:"请输入完整信息",duration:1500})}))},editClass:function(e,t){var o=this;console.log("index",e,"row",t),An(t.courseId,this.currentInfo.departmentId,this.currentInfo.schoolId).then((function(e){console.log("getDetailList1",e),o.detailList=e.rows})),this.onlyAcademicYear.forEach((function(e){e.dictLabel==t.academicYear&&(t.academicYear=e.dictValue)})),this.onlySemester.forEach((function(e){e.dictLabel==t.semester&&(t.semester=e.dictValue)})),this.classEditForm.className=t.className,this.classEditForm.instructor=t.teacherName,this.classEditForm.courseCode=t.courseCode,this.classEditForm.identifier=t.identifier,this.classEditForm.chosenYear=t.academicYear,this.classEditForm.chosenSemester=t.semester,this.classEditForm.remark=t.remark,this.classEditForm.classId=t.classId,this.classEditForm.teacherNumber=t.teacherNumber,this.classEditForm.versionName=t.versionName,this.classEditForm.isRespondent=t.isRespondent,this.classEditForm.teachers=t.teachers,this.editVisible=!0,this.onlyAcademicYear.forEach((function(e){e.dictValue==t.academicYear&&(t.academicYear=e.dictLabel)})),this.onlySemester.forEach((function(e){e.dictValue==t.semester&&(t.semester=e.dictLabel)}))},confirmEditClass:function(e){var t=this;this.E_ErrorMsg="",this.T_ErrorMsg="",e.academicYear=e.chosenYear,e.semester=e.chosenSemester,e.departmentId=this.currentInfo.departmentId,e.schoolId=this.currentInfo.schoolId,e.teacherNumber="",e.teachers.forEach((function(t){var o=[];o=t.split("("),e.teacherNumber=e.teacherNumber+","+o[1].substr(0,o[1].length-1)})),e.teacherNumber=e.teacherNumber.substr(1,e.teacherNumber.length),this.giveRespondentPermission(e),console.log("修改后",e),dr(e).then((function(e){console.log("confirmEditClass",e),"SUCCESS"==e.code&&((0,G.nk)({type:"success",message:"修改成功",duration:1500}),t.editVisible=!1,t.getClassList())}))["catch"]((function(e){console.log("3",e),"E_CODE_NOT_EXIST"===e.code?((0,G.nk)({type:"error",message:"课程号不存在",duration:1500}),t.E_ErrorMsg="课程号不存在，请重新输入"):"E_TEACHER_NOT_EXIST"===e.code&&(0,G.nk)({type:"error",message:"教师不存在",duration:1500})}))},deleteClass:function(e,t){var o=this;console.log("index",e,"row",t),P.s.confirm("是否确认删除教学班?","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){fr(t.classId).then((function(e){console.log("deleteClass",e),(0,G.nk)({type:"success",message:"删除成功",duration:1500}),o.getClassList()}))}))},goSearch:function(e){var t=this;this.allTeachers=[],$s(this.currentInfo.departmentId,this.currentInfo.schoolId,e).then((function(e){t.allTeachers=e.data,t.querySearch()}))},querySearch:function(e,t){var o=this.allTeachers;if(o.length>0){var n=e?o.filter(this.createStateFilter(e)):o;n=o.map((function(e){return{value:e}})),this.result=n,clearTimeout(this.timeout),this.timeout=setTimeout((function(){}),3e3*Math.random())}},createStateFilter:function(e){return function(e){}},handleSelectionChange:function(e){this.multipleSelection=e,this.multipleSelection.length>0?(this.selectedCourseId=this.multipleSelection[0].courseId,this.canAction=!1,this.canSelectAll=!1):(this.selectedCourseId="",this.canSelectAll=!0,this.canAction=!0)},canSelect:function(e,t){return""==this.selectedCourseId||e.courseId==this.selectedCourseId},cellClass:function(e){if(this.canSelectAll&&0==e.columnIndex)return"DisableSelection"},getDetailList:function(){var e=this;An(this.multipleSelection[0].courseId,this.currentInfo.departmentId,this.currentInfo.schoolId).then((function(t){console.log("getDetailList",t),e.detailList=t.rows,e.detailList.forEach((function(t){t.versionInfo=t.courseName+"| "+t.courseCode+" | "+t.versionName,t.value=t.detailId,t.label=t.versionInfo,Os(t.detailId,e.currentInfo.schoolId,e.currentInfo.departmentId).then((function(e){t.children=e.rows,e.rows.forEach((function(e){e.value=e.id,e.label=e.name}))}))}))}))},assignDetail:function(){this.isAssign=!0,console.log("list",this.detailList)},confirmAssign:function(){var e=this;console.log("!",this.assignedDetail),this.multipleSelection.forEach((function(t){t.detailId=e.assignedDetail[0],t.examId=e.assignedDetail[1]})),Fn(this.multipleSelection).then((function(t){"SUCCESS"===t.code?(e.isAssign=!1,(0,G.nk)({type:"success",message:"分配成功",duration:1500}),e.multipleSelection=[],e.$refs.multipleTable.clearSelection(),e.getClassList()):(0,G.nk)({type:"error",message:"分配失败",duration:1500})}))},associateCourse:function(){var e=this;console.log(" this.multipleSelection",this.multipleSelection),pr(this.multipleSelection).then((function(t){console.log("associateCourses",t),"SUCCESS"===t.code&&((0,G.nk)({type:"success",message:"关联成功",duration:1500}),e.multipleSelection.forEach((function(e){e.courseIsDeleted="0"})))}))["catch"]((function(e){console.log("e",e),"CODE_NOT_EXIST"===e.code&&(0,G.nk)({type:"error",message:"请先添加课程库课程",duration:1500})}))},openAssess:function(){this.isAssessment=!0,this.multipleSelection.length>1?this.multIsRespondent="2":this.multIsRespondent=this.multipleSelection[0].isRespondent},changeAssessment:function(){var e=this,t=[];this.multipleSelection.forEach((function(o){var n={classId:o.classId,departmentId:o.departmentId,isRespondent:e.multIsRespondent,schoolId:o.schoolId};t.push(n)})),hr(t).then((function(t){console.log(t),"SUCCESS"===t.code&&((0,G.nk)({type:"success",message:"更新成功",duration:1500}),e.isAssessment=!1,e.multIsRespondent="2",e.getClassList())}))},loadMore:function(){this.total-this.pageSize>=20?(this.pageSize+=20,this.getClassList()):(this.pageSize+=this.total-this.pageSize,this.getClassList())},rowKey:function(e){return e.classId},giveRespondentPermission:function(e){var t={};t.classId=e.classId,t.departmentId=this.currentInfo.departmentId,t.isRespondent=e.isRespondent,t.schoolId=this.currentInfo.schoolId;var o=[];o.push(t),hr(o).then((function(e){console.log("setPermission",e)}))}}},zs=(0,h.A)(Gs,[["render",Bs],["__scopeId","data-v-53b70403"]]),Ys=zs,Xs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA5oAAAIBCAYAAAAoI8C/AAALp0lEQVR4nO3XQQkAMRDAwOv5d7XCWhOBQplRkG/WzOwPAAAAIv/tAAAAAN5iNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACAlNEEAAAgZTQBAABIGU0AAABSRhMAAICU0QQAACBlNAEAAEgZTQAAAFJGEwAAgJTRBAAAIGU0AQAASBlNAAAAUkYTAACA1AHWOQdKyHskLgAAAABJRU5ErkJggg==";var Qs=function(e){return(0,l.Qi)("data-v-d9e458c8"),e=e(),(0,l.jt)(),e},Ks={class:"cardList"},Js=["onClick"],Hs=Qs((function(){return(0,l.Lk)("div",{class:"cardPic"},[(0,l.Lk)("img",{src:Xs}),(0,l.Lk)("div",{class:"cardMask"},[(0,l.Lk)("button",{class:"cardMaskBtn"},"进入专业")])],-1)})),qs={class:"cardText"},Zs={class:"no-major"},ei={class:"no-major-detail"};function ti(e,t,o,n,r,a){var s=(0,l.g2)("HeaderSearch"),c=(0,l.g2)("addBtn"),u=(0,l.g2)("DeleteFilled"),d=(0,l.g2)("el-icon"),h=(0,l.g2)("el-tooltip"),f=(0,l.g2)("Tools");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(s,{msg:r.searchMsg,onSearchValue:a.getSearchValue,value:r.keyword},null,8,["msg","onSearchValue","value"]),(0,l.bF)(c,{onClick:t[0]||(t[0]=function(e){return a.addMajor()})}),(0,l.bo)((0,l.Lk)("div",Ks,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.majorList,(function(e){return(0,l.uX)(),(0,l.CE)("div",{class:"card",key:e.majorId,onClick:function(t){return a.toMajor(e)}},[(0,l.bF)(h,{class:"box-item",effect:"dark",content:"删除",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{class:"deleteIcon",size:"18px",onClick:(0,i.D$)((function(t){return a.deleteMajor(e.majorId,e.majorName)}),["stop"])},{default:(0,l.k6)((function(){return[(0,l.bF)(u)]})),_:2},1032,["onClick"])]})),_:2},1024),(0,l.bF)(h,{class:"box-item",effect:"dark",content:"修改",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{class:"toolsIcon",size:"18px",onClick:(0,i.D$)((function(t){return a.changeMajor(e.majorId,e.majorName)}),["stop"])},{default:(0,l.k6)((function(){return[(0,l.bF)(f)]})),_:2},1032,["onClick"])]})),_:2},1024),Hs,(0,l.Lk)("div",qs,[(0,l.Lk)("h3",null,(0,C.v_)(e.majorName),1)])],8,Js)})),128))],512),[[i.aG,r.hasMajor]]),(0,l.bo)((0,l.Lk)("div",Zs,"没有专业",512),[[i.aG,r.noMajor]]),(0,l.bo)((0,l.Lk)("div",ei," 请先点击右上角圆形按钮添加专业 ",512),[[i.aG,r.noMajor]])],64)}function oi(e,t,o){return Q({url:"/major/list",method:"get",params:{departmentId:e,schoolId:t,majorName:o}})}function ni(e){return Q({url:"/major/"+e,method:"get"})}function ri(e,t,o){return Q({url:"/major/add",method:"post",data:{majorName:e,departmentId:t,schoolId:o}})}function ai(e){return Q({url:"/major/"+e,method:"delete"})}function si(e,t,o){return Q({url:"/major/edit",method:"post",data:{majorName:e,majorId:t,departmentId:o}})}const ii={name:"Major",components:{Search:ee.vji,DeleteFilled:ee.Sz$,Tools:ee.S0q,HeaderSearch:ne,addBtn:le},data:function(){return{searchMsg:"搜索专业名称",keyword:"",addMajorName:"",majorList:[],hasMajor:!1,noMajor:!1,currentDepartmentId:Number,currentSchoolId:Number}},mounted:function(){this.currentDepartmentId=this.$store.state.currentInfo.departmentId,this.currentSchoolId=this.$store.state.currentInfo.schoolId,this.getMajorList()},computed:{currentChange:function(){return this.$store.state.currentInfo}},watch:{currentChange:{deep:!0,handler:function(e){this.currentDepartmentId=this.$store.state.currentInfo.departmentId,this.getMajorList(this.currentDepartmentId)}}},methods:{getSearchValue:function(e){var t=this;oi(this.currentDepartmentId,this.currentSchoolId,e).then((function(e){t.majorList=e.rows,console.log("majorList",e)}))},getMajorList:function(){var e=this;oi(this.currentDepartmentId,this.currentSchoolId).then((function(t){e.majorList=t.rows,console.log("majorList",t),e.majorList.length>0?(e.hasMajor=!0,e.noMajor=!1):(e.noMajor=!0,e.hasMajor=!1)}))},toMajor:function(e){this.$store.commit("major/setMajorName",e.majorName),this.$store.commit("major/setMajorId",e.majorId),this.$router.push({name:"Goal"})},addMajor:function(){var e=this;P.s.prompt("专业名称：","新建专业",{confirmButtonText:"确认",cancelButtonText:"取消",customClass:"add-major-box",inputPattern:/^.+$/,inputErrorMessage:"请输入新增专业名称"}).then((function(t){var o=t.value,n=o;ri(n,e.currentDepartmentId,e.currentSchoolId).then((function(t){console.log("addMajor",t),(0,G.nk)({type:"success",message:"新建成功",duration:1500}),e.getMajorList()}))}))["catch"]((function(){}))},deleteMajor:function(e,t){var o=this;P.s.confirm("是否确认删除"+t+"专业？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){ai(e).then((function(e){console.log("deleteMajor",e),o.getMajorList(),(0,G.nk)({type:"success",message:"删除成功",duration:1500})}))["catch"]((function(){}))}))},changeMajor:function(e,t){var o=this;P.s.prompt("新的专业名称：","修改专业名称",{confirmButtonText:"确认",cancelButtonText:"取消",inputValue:t,inputPattern:/^.+$/,inputErrorMessage:"请输入修改后的专业名称"}).then((function(t){var n=t.value,r=n;si(r,e,o.currentDepartmentId).then((function(e){(0,G.nk)({type:"success",message:"更新成功",duration:1500}),console.log("changeMajor",e),o.getMajorList()}))}))["catch"]((function(){}))}}},li=(0,h.A)(ii,[["render",ti],["__scopeId","data-v-d9e458c8"]]),ci=li;var ui={class:"content"},di={class:"block"},hi={class:"title"};function fi(e,t,o,n,r,a){var s=(0,l.g2)("el-divider"),i=(0,l.g2)("List"),c=(0,l.g2)("el-icon"),u=(0,l.g2)("el-tooltip"),d=(0,l.g2)("Management"),h=(0,l.g2)("el-row"),f=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)("div",ui,[(0,l.Lk)("div",di,[(0,l.bF)(h,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",hi,(0,C.v_)(r.NavMsg),1),(0,l.bF)(s,{class:"divider",direction:"vertical"}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"课程大纲版本",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",style:{"margin-left":"10px"},onClick:t[0]||(t[0]=function(e){return a.toVersion()})},{default:(0,l.k6)((function(){return[(0,l.bF)(i)]})),_:1})]})),_:1}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"工作手册模板",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",style:{"margin-left":"30px"},onClick:t[1]||(t[1]=function(e){return a.toTemplate()})},{default:(0,l.k6)((function(){return[(0,l.bF)(d)]})),_:1})]})),_:1})]})),_:1})]),(0,l.bF)(f)])}const mi={name:"DepartmentSetting",components:{List:ee.B8B,Management:ee.iVF},data:function(){return{NavMsg:"课程大纲版本"}},computed:{},watch:{},mounted:function(){},methods:{toVersion:function(){this.NavMsg="课程大纲版本",this.$router.push({name:"Version"})},toTemplate:function(){this.NavMsg="工作手册模板",this.$router.push({name:"TemplateList"})}}},pi=(0,h.A)(mi,[["render",fi],["__scopeId","data-v-48d93812"]]),bi=pi;var gi={class:"submenu"},ki={class:"numSelectedTeacher"},vi={class:"no-class"},Ii={class:"no-major-detail"},yi={class:"pagination-container",flex:""};function Ci(e,t,o,n,r,a){var s=this,c=(0,l.g2)("HeaderSearch"),u=(0,l.g2)("el-button"),d=(0,l.g2)("el-col"),h=(0,l.g2)("MoreFilled"),f=(0,l.g2)("el-icon"),m=(0,l.g2)("el-dropdown-item"),p=(0,l.g2)("el-dropdown-menu"),b=(0,l.g2)("el-dropdown"),g=(0,l.g2)("el-row"),k=(0,l.g2)("addBtn"),v=(0,l.g2)("el-table-column"),I=(0,l.g2)("el-table");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bo)((0,l.Lk)("div",null,[(0,l.bF)(c,{msg:"搜索工号、姓名、邮箱",onSearchValue:a.getSearchValue},null,8,["onSearchValue"])],512),[[i.aG,!r.closeShow]]),(0,l.bo)((0,l.Lk)("div",gi,[(0,l.bF)(g,{class:"rowStyle"},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{span:2},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{onClick:t[0]||(t[0]=function(e){return s.toggleSelection()}),style:{float:"right"},class:"clearSelected"},{default:(0,l.k6)((function(){return[(0,l.eW)("取消选择")]})),_:1})]})),_:1}),(0,l.bF)(d,{span:16},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",ki,"已选中 "+(0,C.v_)(r.numSelected)+" 个教师",1)]})),_:1}),(0,l.bF)(d,{span:4},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{class:"dropdownstyle"},{dropdown:(0,l.k6)((function(){return[(0,l.bF)(p,null,{default:(0,l.k6)((function(){return[(0,l.bF)(m,{onClick:a.deleteTeacher},{default:(0,l.k6)((function(){return[(0,l.eW)(" 删除教师 ")]})),_:1},8,["onClick"])]})),_:1})]})),default:(0,l.k6)((function(){return[(0,l.bF)(f,{class:"dropdownIcon"},{default:(0,l.k6)((function(){return[(0,l.bF)(h)]})),_:1})]})),_:1})]})),_:1})]})),_:1})],512),[[i.aG,r.closeShow]]),(0,l.bo)((0,l.Lk)("div",vi,"没有教师",512),[[i.aG,r.hasNoBaseCourse]]),(0,l.bo)((0,l.Lk)("div",Ii," 请先点击右上角圆形按钮添加教师 ",512),[[i.aG,r.hasNoBaseCourse&&!r.hasBaseCourse]]),(0,l.bF)(k,{onClick:a.goAddTeacher},null,8,["onClick"]),(0,l.bo)((0,l.Lk)("div",null,[(0,l.bF)(I,{ref:"multipleTable",data:r.tableData,"tooltip-effect":"dark",onSelectionChange:a.handleSelectionChange,style:{width:"895px"},class:"el-table-container","header-cell-style":{"padding-left":"20px","font-size":"14.4px",height:"48px","font-weight":"bold",color:"black"},"cell-style":{"padding-left":"20px","font-size":"16px",height:"60px"},"row-key":a.rowKey},{default:(0,l.k6)((function(){return[(0,l.bF)(v,{type:"selection",width:"55","reserve-selection":!0}),(0,l.bF)(v,{property:"teacherNumber",label:"工号",width:"120"}),(0,l.bF)(v,{property:"teacherName",label:"姓名",width:"120"}),(0,l.bF)(v,{property:"email",label:"邮箱",width:"600"})]})),_:1},8,["data","onSelectionChange","row-key"])],512),[[i.aG,r.hasBaseCourse]]),(0,l.Lk)("div",yi,[(0,l.bF)(g,{type:"flex",justify:"center",align:"middle",class:"loadmorestyle"},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(u,{disabled:r.loadmoreDisabled,link:"",plain:"",onClick:t[1]||(t[1]=function(e){return a.loadmoreCourse()})},{default:(0,l.k6)((function(){return[(0,l.eW)("加载更多")]})),_:1},8,["disabled"]),[[i.aG,r.showLoadmore&&r.hasBaseCourse]])]})),_:1})])],64)}(0,Be.um)();const Ai={data:function(){return{loadmoreDisabled:!1,hasBaseCourse:!1,hasNoBaseCourse:!1,showLoadmore:!0,departmentId:"",schoolId:"",keyword:"",pageNum:1,pageSize:20,tableData:[],multipleSelection:[],numSelected:0,teacherId:[],closeShow:!1,clickState:0,form:(0,ce.Kh)({queryString:""})}},components:{HotTable:De.sH,HotColumn:De.gQ,ElTooltip:ue.R7,ElIcon:de.tk,ElInput:he.WK,ElForm:fe.US,ElButton:me.S2,ElTable:pe.Up,ref:ce.KR,reactive:ce.Kh,Back:ee.kcb,FolderChecked:ee.KHk,InfoFilled:ee.N_H,Loading:ee.Rhj,Search:ee.vji,Close:ee.bm,Plus:ee.FWt,Delete:ee.epd,MoreFilled:ee.yGC,request:Q,ElMessage:G.nk,ElMessageBox:P.s,Action:p.A,HeaderSearch:ne,addBtn:le,ElDropdown:ge.dW},methods:{getSearchValue:function(e){this.keyword=e,this.getTeacherList()},rowKey:function(e){return e.teacherId},loadmoreCourse:function(){this.result.total-this.pageSize>=20?(this.pageSize+=20,this.getTeacherList()):(this.pageSize+=this.result.total-this.pageSize,this.getTeacherList())},toggleSelection:function(e){var t=this;e?e.forEach((function(e){t.$refs.multipleTable.toggleRowSelection(e)})):(this.$refs.multipleTable.clearSelection(),1==this.clickState&&(this.clickState=0,this.closeShow=!this.closeShow))},getCurrentRows:function(){},handleSelectionChange:function(e){this.multipleSelection=e;var t=[];e.forEach((function(e){var o=e.teacherId;t.push(o)})),console.log("选中的信息：",e),this.numSelected=this.multipleSelection.length,1!=this.clickState&&(this.closeShow=!this.closeShow,this.clickState=1),1==this.clickState&&0==this.numSelected&&(this.clickState=0,this.closeShow=!this.closeShow),this.teacherId=t,console.log("teacherId:",this.teacherId)},onSubmit:function(){alert(this.form.queryString)},clearqueryString:function(){this.form.queryString="",""!=this.form.queryString?this.closeShow=!0:this.closeShow=!1},goAddTeacher:function(){this.$router.push({path:"/addTeacher"})},searchTeacher:function(){alert("search")},deleteTeacher:function(){var e=this,t=this,o=this.teacherId;P.s.confirm("是否确认删除教师","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){return console.log("teacherID:",o,"typeof this.teacherID",e.teacherId),Q({url:"/teacher",method:"delete",data:o}).then((function(e){var o=e;return console.log("localres",o),204===e?((0,G.nk)({type:"success",message:"删除成功",duration:1500}),t.getTeacherList(),t.$refs.multipleTable.clearSelection(),1==t.clickState&&(t.clickState=0,t.closeShow=!t.closeShow)):(0,G.nk)({type:"error",message:"删除失败",duration:1500}),o}))}))["catch"]((function(e){return console.log(e),e}))},getTeacherList:function(){var e=this;return this.loadmoreDisabled=!0,Q({url:"/teacher/list",method:"get",params:{schoolId:this.schoolId,departmentId:this.departmentId,pageNum:this.pageNum,pageSize:this.pageSize,selectKeyWord:this.keyword}}).then((function(t){e.loadmoreDisabled=!1,console.log(t),0==t.total?(e.hasBaseCourse=!1,e.hasNoBaseCourse=!0):(e.hasBaseCourse=!0,e.hasNoBaseCourse=!1,e.tableData=t.rows,e.result=t,e.pageSize>=t.total&&(e.showLoadmore=!1))}))},activate:function(){this.departmentId=this.$store.state.currentInfo.departmentId,this.schoolId=this.$store.state.currentInfo.schoolId}},mounted:function(){this.activate(),this.getTeacherList()}},Fi=(0,h.A)(Ai,[["render",Ci],["__scopeId","data-v-521747d3"]]),wi=Fi;function Si(e,t,o,n,r,a){var s=(0,l.g2)("LuckySheet");return(0,l.uX)(),(0,l.Wv)(s)}var _i=function(e){return(0,l.Qi)("data-v-144bcf24"),e=e(),(0,l.jt)(),e},Ei={layout:"column",flex:"",class:"ng-scope layout-column flex"},Ni={class:"submenu"},Vi=_i((function(){return(0,l.Lk)("div",{class:"displayCenter"}," 可直接从excel拷贝；可拖动列的顺序；学院最多可添加500个教师 ",-1)})),xi=_i((function(){return(0,l.Lk)("div",{layout:"row",flex:"",class:"md-padding"},[(0,l.Lk)("div",{class:"hot-table-container",layout:"column",flex:"","layout-align":"start center",id:"courseHot"})],-1)}));function Ti(e,t,o,n,r,a){var s=(0,l.g2)("Back"),i=(0,l.g2)("el-icon"),c=(0,l.g2)("el-tooltip"),u=(0,l.g2)("el-divider"),d=(0,l.g2)("DocumentChecked"),h=(0,l.g2)("el-button"),f=(0,l.g2)("InfoFilled"),m=(0,l.g2)("el-row");return(0,l.uX)(),(0,l.CE)("div",Ei,[(0,l.Lk)("div",Ni,[(0,l.bF)(m,{class:"toolbar"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{content:"返回"},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{size:22,style:{cursor:"pointer"},class:"button-back",onClick:a.goTeacher},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1},8,["onClick"])]})),_:1}),(0,l.bF)(u,{class:"divider",direction:"vertical"}),(0,l.bF)(c,{content:"保存",disabled:!a.isValid()},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{"aria-label":"保存",onClick:a.save,link:"",disabled:!a.isValid()},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{size:22},{default:(0,l.k6)((function(){return[(0,l.bF)(d)]})),_:1})]})),_:1},8,["onClick","disabled"])]})),_:1},8,["disabled"]),(0,l.bF)(i,{size:22,class:"button-back"},{default:(0,l.k6)((function(){return[(0,l.bF)(f)]})),_:1}),Vi]})),_:1})]),xi])}const ji={name:"addTeacher",provide:function(){return{reload:this.reload}},data:function(){return{departmentId:"",schoolId:"",firstActivities:!0,hotInstance:void 0,dirty:!1,saving:!1,count:0,localres:{},postData:{teachers:[]},db:{items:[]},fromCourseBatchAdd:!1}},components:{ref:ce.KR,onMounted:l.sV,reactive:ce.Kh,HotTable:De.sH,HotColumn:De.gQ,registerAllModules:Be.um,ElTooltip:ue.R7,ElIcon:de.tk,ElInput:he.WK,Handsontable:$e.Ay,Back:ee.kcb,FolderChecked:ee.KHk,InfoFilled:ee.N_H,Loading:ee.Rhj,Download:ee.f5X,UploadFilled:ee.m8m,DocumentAdd:ee.pT5,ElMessage:G.nk,ElMessageBox:P.s,DocumentChecked:ee.Fmj},methods:{activate:function(){this.departmentId=this.$store.state.currentInfo.departmentId,this.schoolId=this.$store.state.currentInfo.schoolId,this.hottableInit()},hottableInit:function(){var e=document.querySelector("#courseHot"),t=this,o=new $e.Ay(e,{data:this.db.items,licenseKey:"non-commercial-and-evaluation",colHeaders:!0,rowHeaders:!0,minSpareRows:1,preventOverflow:"horizontal",manualColumnMove:!0,contextMenu:{items:{row_above:{name:"在上方插入行"},row_below:{name:"在下方插入行"},remove_row:{name:"删除行"}}},columns:[{data:"teacherNumber",title:"工号",width:200,height:20,allowEmpty:!1},{data:"teacherName",title:"姓名",width:200,height:20,allowEmpty:!1},{data:"email",title:"邮箱",width:200,height:20,validator:/.+@.+/,allowEmpty:!1}],afterChange:function(e,o){"loadData"===o?console.log("same"):(0==t.count?(t.dirty=!1,console.log("console:",t.count),console.log("different",t.dirty)):(t.dirty=!0,t.firstActivities=!1,console.log("console:",t.count,"different",t.dirty),console.log("different",t.dirty)),t.count++,console.log("console:",t.count))},afterRemoveRow:function(e,o,n,r){t.dirty=!0,t.firstActivities=!1}});this.hotInstance=o},isValid:function(){if(this.firstActivities)return!1;var e=this.toPostData();return!!e},isNotDirty:function(){this.dirty=!1},save:function(){this.saving=!0;var e=this.isValid();if(e){var t=[];this.postData.teachers.forEach((function(e){t.push(e)})),console.log("teacherList:",t);var o=this;this.addTeacher(t).then((function(e){console.log("res:",e),o.firstActivities=!0,"SUCCESS"==e.code&&((0,G.nk)({type:"success",message:"新建成功",duration:1500}),o.isNotDirty(),o.goBackandClean())}))["catch"]((function(e){var t=e.data;500==e.status?(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500}):"E_TEACHER_EXIST"==t.code?(t.data.forEach((function(e){o.hotInstance.setCellMetaObject(Object.keys(e)[0],0,{validator:/.+@.+/}),o.hotInstance.setCellMetaObject(Object.keys(e)[0],1,{validator:/.+@.+/}),o.hotInstance.setCellMetaObject(Object.keys(e)[0],2,{validator:/.+gmail@.+/})})),o.hotInstance.setCellMetaObject(o.postData.teachers.length,0,{validator:void 0}),o.hotInstance.setCellMetaObject(o.postData.teachers.length,1,{validator:void 0}),o.hotInstance.setCellMetaObject(o.postData.teachers.length,2,{validator:void 0}),o.hotInstance.validateCells((function(e){})),(0,G.nk)({type:"error",message:"新建失败,标红教师已存在",duration:1500})):"E_TEACHER_DUPLICATE"==t.code?(t.data.forEach((function(e){o.hotInstance.setCellMetaObject(Object.keys(e)[0],0,{validator:/.+@.+/}),o.hotInstance.setCellMetaObject(Object.keys(e)[0],1,{validator:/.+@.+/}),o.hotInstance.setCellMetaObject(Object.keys(e)[0],2,{validator:/.+gmail@.+/})})),o.hotInstance.setCellMetaObject(o.postData.teachers.length,0,{validator:void 0}),o.hotInstance.setCellMetaObject(o.postData.teachers.length,1,{validator:void 0}),o.hotInstance.setCellMetaObject(o.postData.teachers.length,2,{validator:void 0}),o.hotInstance.validateCells((function(e){})),(0,G.nk)({type:"error",message:"新建失败,标红教师重复",duration:1500})):"DATA_DUPLICATED"==t.code?(t.data.forEach((function(e){o.hotInstance.setCellMetaObject(Object.keys(e)[0],0,{validator:/.+@.+/}),o.hotInstance.setCellMetaObject(Object.keys(e)[0],1,{validator:/.+@.+/}),o.hotInstance.setCellMetaObject(Object.keys(e)[0],2,{validator:/.+gmail@.+/})})),o.hotInstance.setCellMetaObject(o.postData.teachers.length,0,{validator:void 0}),o.hotInstance.setCellMetaObject(o.postData.teachers.length,1,{validator:void 0}),o.hotInstance.setCellMetaObject(o.postData.teachers.length,2,{validator:void 0}),o.hotInstance.validateCells((function(e){})),(0,G.nk)({type:"error",message:"新建失败,标红数据重复",duration:1500})):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500}),o.count=0}))}else this.saving=!1},toPostData:function(){var e=this;this.postData.teachers.length=0;var t=this.postData.teachers,o=!0;return this.db.items.forEach((function(n){if(n.teacherNumber=n.teacherNumber,n.teacherName=n.teacherName,n.email=n.email,!(n.teacherNumber&&n.teacherName&&n.email))return n.teacherNumber||n.teacherName||n.email?void(o=!1):void 0;var r={teacherNumber:n.teacherNumber,email:n.email,teacherName:n.teacherName,departmentId:e.departmentId,schoolId:e.schoolId};t.push(r)})),o},getHotCellsFunction:function(e){return console.log("updating hotcolumn"),function(e,t,o){console.log("return function...");var n={};return e>1&&t>1&&(n.className="cell-disallow"),n}},goBackandClean:function(){this.db.items=[],this.postData.teachers=[],this.count=0,this.hotInstance.updateSettings({data:this.db.items}),this.$router.push({path:"/teacher"})},goTeacher:function(){var e=this;console.log("goteacher:"+this.saving+this.dirty),1==this.dirty||0==this.saving&&1==this.dirty?P.s.confirm("数据还未保存，是否仍然关闭？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.$router.push({path:"/teacher"})}))["catch"]((function(){})):this.$router.push({path:"/teacher"})},addTeacher:function(e){var t;return console.log("postData:",e),Q({url:"/teacher/addTeachers",method:"post",data:e}).then((function(e){return t=e,console.log("localres",t),t}))["catch"]((function(e){return e.response.data}))},handleEvent:function(e){var t=this;return(0,Kt.A)((0,Xt.A)().mark((function o(){return(0,Xt.A)().wrap((function(o){while(1)switch(o.prev=o.next){case 0:o.t0=e.keyCode,o.next=86===o.t0?3:6;break;case 3:return console.log("ctrl + v"),t.firstActivities=!1,o.abrupt("break",6);case 6:case"end":return o.stop()}}),o)})))()}},mounted:function(){this.activate(),window.addEventListener("keydown",this.handleEvent)},beforeDestroy:function(){window.removeEventListener("keydown",this.handleEvent)}},Li=(0,h.A)(ji,[["render",Ti],["__scopeId","data-v-144bcf24"]]),Di=Li,Bi={setup:function(){},components:{LuckySheet:Di}},$i=(0,h.A)(Bi,[["render",Si]]),Oi=$i;function Mi(e,t,o,n,r,a){var s=(0,l.g2)("MultiAddBaseCourse");return(0,l.uX)(),(0,l.Wv)(s)}var Ui=function(e){return(0,l.Qi)("data-v-36b00231"),e=e(),(0,l.jt)(),e},Wi={layout:"column",flex:"",class:"ng-scope layout-column flex"},Ri={class:"submenu"},Pi=Ui((function(){return(0,l.Lk)("div",{layout:"row",flex:"",class:"md-padding"},[(0,l.Lk)("div",{class:"hot-table-container",layout:"column",flex:"","layout-align":"start center",id:"courseHot"})],-1)}));function Gi(e,t,o,n,r,a){var s=(0,l.g2)("Back"),i=(0,l.g2)("el-icon"),c=(0,l.g2)("el-tooltip"),u=(0,l.g2)("el-divider"),d=(0,l.g2)("DocumentChecked"),h=(0,l.g2)("el-button"),f=(0,l.g2)("el-row");return(0,l.uX)(),(0,l.CE)("div",Wi,[(0,l.Lk)("div",Ri,[(0,l.bF)(f,{class:"toolbar"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{content:"返回"},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{size:22,style:{cursor:"pointer"},class:"button-back",onClick:a.goBaseCourse},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1},8,["onClick"])]})),_:1}),(0,l.bF)(u,{class:"divider",direction:"vertical"}),(0,l.bF)(c,{content:"保存",disabled:!a.isValid()},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{"aria-label":"保存",onClick:a.save,link:"",disabled:!a.isValid()},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{size:22},{default:(0,l.k6)((function(){return[(0,l.bF)(d)]})),_:1})]})),_:1},8,["onClick","disabled"])]})),_:1},8,["disabled"])]})),_:1})]),Pi])}o(97088);const zi={name:"multiAddBaseCourse",data:function(){return{dirty:!1,saving:!1,departmentId:"",schoolId:"",courseTypeSource:[],courseNatureSource:[],firstActivities:!0,count:0,localres:{},postData:{courses:[]},db:{items:[]},fromCourseBatchAdd:!1,hotInstance:void 0}},components:{ref:ce.KR,onMounted:l.sV,reactive:ce.Kh,HotTable:De.sH,HotColumn:De.gQ,registerAllModules:Be.um,ElTooltip:ue.R7,ElIcon:de.tk,ElInput:he.WK,Handsontable:$e.Ay,Back:ee.kcb,FolderChecked:ee.KHk,InfoFilled:ee.N_H,Loading:ee.Rhj,Download:ee.f5X,UploadFilled:ee.m8m,DocumentAdd:ee.pT5,ElMessage:G.nk,ElMessageBox:P.s,DocumentChecked:ee.Fmj},methods:{activate:function(){this.departmentId=this.$store.state.currentInfo.departmentId,this.schoolId=this.$store.state.currentInfo.schoolId;var e=this,t=this;this.getDict();var o=document.querySelector("#courseHot"),n=new $e.Ay(o,{data:this.db.items,licenseKey:"non-commercial-and-evaluation",colHeaders:!0,rowHeaders:!0,minSpareRows:1,preventOverflow:"horizontal",manualColumnMove:!0,contextMenu:{items:{row_above:{name:"在上方插入行"},row_below:{name:"在下方插入行"},remove_row:{name:"删除行"}}},columns:[{data:"courseName",title:"课程名",width:260,height:20,validator:/^(.){1,50}$/,allowEmpty:!1},{data:"courseCode",title:"课程号",width:180,height:20,validator:/^(.){1,50}$/,allowEmpty:!1},{data:"courseType",title:"课程类型",width:180,height:20,type:"dropdown",source:this.courseTypeSource,allowEmpty:!0},{data:"courseNature",title:"课程性质",width:120,height:20,type:"dropdown",source:this.courseNatureSource,allowEmpty:!0},{data:"credit",title:"学分",width:120,height:20,allowEmpty:!0}],afterChange:function(e,o){"loadData"===o?(console.log("same"),console.log("db.items",t.db.items)):(0==t.count?(t.dirty=!1,console.log("db.items",t.db.items),console.log("console:",t.count),console.log("different",t.dirty)):(t.dirty=!0,console.log("db.items",t.db.items),t.firstActivities=!1,console.log("console:",t.count),console.log("different",t.dirty)),t.count++,console.log("console:",t.count))},afterRemoveRow:function(t,o,n,r){e.dirty=!0,e.firstActivities=!1}});this.hotInstance=n},getDict:function(){var e=this;qt().then((function(t){console.log(t),t.course_nature.forEach((function(t){e.courseNatureSource.push(t.dictLabel)})),t.course_type.forEach((function(t){e.courseTypeSource.push(t.dictLabel)}))}))},isValid:function(){if(this.firstActivities)return!1;var e=this.toPostData();return!!e},isNotDirty:function(){this.dirty=!1},save:function(){this.saving=!0;var e=this.isValid();if(e){var t=this;this.postData.courses.forEach((function(e){e.courseType=t.courseTypeSource.indexOf(e.courseType),e.courseNature=t.courseNatureSource.indexOf(e.courseNature)})),this.addBaseCourses(this.postData.courses).then((function(e){console.log("res123123123:",e),t.firstActivities=!0,"SUCCESS"==e.code&&((0,G.nk)({type:"success",message:"新建成功",duration:1500}),t.goBackandClean(),t.isNotDirty())}))["catch"]((function(e){console.log("e",e);var o=e.data;"E_CODE_EXIST"==o.code?(o.data.forEach((function(e){t.hotInstance.setCellMetaObject(Object.keys(e)[0],0,{validator:/.+@.+/}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],1,{validator:/.+@.+/}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],2,{validator:/.+gmail@.+/}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],3,{validator:/.+@.+/}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],4,{validator:/.+@.+/})})),t.hotInstance.setCellMetaObject(t.postData.courses.length,0,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,1,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,2,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,3,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,4,{validator:void 0}),t.hotInstance.validateCells((function(e){})),(0,G.nk)({type:"error",message:"新建失败,标红课程已存在",duration:1500})):500===e.status?(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500}),t.isNotDirty()}))}else this.saving=!1},toPostData:function(){this.postData.courses.length=0;var e=this,t=this.postData.courses,o=!0;return this.db.items.forEach((function(n){if(n.courseCode=n.courseCode,n.courseName=n.courseName,n.courseType=n.courseType,n.courseNature=n.courseNature,n.credit&&(n.credit=parseInt(n.credit)),!(n.courseCode&&n.courseName&&n.credit))return n.courseCode||n.courseName||n.credit?void(o=!1):void 0;var r={departmentId:e.departmentId,schoolId:e.schoolId,courseName:n.courseName,courseCode:n.courseCode,courseType:n.courseType,courseNature:n.courseNature,credit:n.credit};t.push(r)})),o},goBackandClean:function(){this.db.items=[],this.postData.courses=[],this.hotInstance.updateSettings({data:this.db.items}),this.$router.push({path:"/baseCourse"})},goBaseCourse:function(){var e=this;console.log("gobasecourse:"+this.saving+this.dirty),1==this.dirty||0==this.saving&&1==this.dirty?P.s.confirm("数据还未保存，是否仍然关闭？","注意",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.$router.push({path:"/baseCourse"})}))["catch"]((function(){})):this.$router.push({path:"/baseCourse"})},addBaseCourses:function(e){var t=[];return this.postData.courses.forEach((function(e){t.push(e)})),console.log("courseList:",t),Q({url:"/baseCourse/addCourses",method:"post",data:t})},handleEvent:function(e){var t=this;return(0,Kt.A)((0,Xt.A)().mark((function o(){return(0,Xt.A)().wrap((function(o){while(1)switch(o.prev=o.next){case 0:o.t0=e.keyCode,o.next=86===o.t0?3:6;break;case 3:return console.log("ctrl + v"),t.firstActivities=!1,o.abrupt("break",6);case 6:case"end":return o.stop()}}),o)})))()}},mounted:function(){this.activate(),window.addEventListener("keydown",this.handleEvent)},beforeDestroy:function(){window.removeEventListener("keydown",this.handleEvent)}},Yi=(0,h.A)(zi,[["render",Gi],["__scopeId","data-v-36b00231"]]),Xi=Yi,Qi={setup:function(){},components:{MultiAddBaseCourse:Xi}},Ki=(0,h.A)(Qi,[["render",Mi]]),Ji=Ki;var Hi=function(e){return(0,l.Qi)("data-v-2114d186"),e=e(),(0,l.jt)(),e},qi={layout:"column",flex:"",class:"ng-scope layout-column flex"},Zi={class:"submenu"},el=Hi((function(){return(0,l.Lk)("div",{layout:"row",flex:"",class:"md-padding"},[(0,l.Lk)("div",{class:"hot-table-container",layout:"column",flex:"","layout-align":"start center",id:"courseHot"})],-1)}));function tl(e,t,o,n,r,a){var s=(0,l.g2)("Back"),i=(0,l.g2)("el-icon"),c=(0,l.g2)("el-tooltip"),u=(0,l.g2)("el-divider"),d=(0,l.g2)("DocumentChecked"),h=(0,l.g2)("el-button"),f=(0,l.g2)("el-row");return(0,l.uX)(),(0,l.CE)("div",qi,[(0,l.Lk)("div",Zi,[(0,l.bF)(f,{class:"toolbar"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{content:"返回"},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{size:22,style:{cursor:"pointer"},class:"button-back",onClick:a.goBaseCourse},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1},8,["onClick"])]})),_:1}),(0,l.bF)(u,{class:"divider",direction:"vertical"}),(0,l.bF)(c,{content:"保存",disabled:!a.isValid()},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{"aria-label":"保存",onClick:a.save,link:"",disabled:!a.isValid()},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{size:22},{default:(0,l.k6)((function(){return[(0,l.bF)(d)]})),_:1})]})),_:1},8,["onClick","disabled"])]})),_:1},8,["disabled"])]})),_:1})]),el])}const ol={name:"batchClassAdd",data:function(){return{dirty:!1,saving:!1,departmentId:"",schoolId:"",courseacademicYear:[],coursesemestere:[],academicYear:[],semester:["第一学期","第二学期"],firstActivities:!0,count:0,localres:{},postData:{courses:[]},db:{items:[]},fromCourseBatchAdd:!1,hotInstance:void 0}},components:{ref:ce.KR,onMounted:l.sV,reactive:ce.Kh,HotTable:De.sH,HotColumn:De.gQ,registerAllModules:Be.um,ElTooltip:ue.R7,ElIcon:de.tk,ElInput:he.WK,Handsontable:$e.Ay,Back:ee.kcb,FolderChecked:ee.KHk,InfoFilled:ee.N_H,Loading:ee.Rhj,Download:ee.f5X,UploadFilled:ee.m8m,DocumentAdd:ee.pT5,ElMessage:G.nk,ElMessageBox:P.s,DocumentChecked:ee.Fmj},methods:{getDict:function(){var e=this,t=[],o=[];qt().then((function(n){console.log(n.academic_year),n.academic_year.forEach((function(o){var n={dictCode:o.dictCode,dictLabel:o.dictLabel,dictValue:o.dictValue};t.push(n),e.courseacademicYear.push(o.dictLabel)})),n.semester.forEach((function(t){var n={dictCode:t.dictCode,dictLabel:t.dictLabel,dictValue:t.dictValue};o.push(n),e.coursesemestere.push(t.dictLabel)})),e.academicYear=t,e.semester=o,console.log("that.academicYear:",e.academicYear," that.semester",e.semester)}))},activate:function(){this.departmentId=this.$store.state.currentInfo.departmentId,this.schoolId=this.$store.state.currentInfo.schoolId,this.getDict();var e=this,t=this,o=document.querySelector("#courseHot"),n=new $e.Ay(o,{data:this.db.items,licenseKey:"non-commercial-and-evaluation",colHeaders:!0,rowHeaders:!0,minSpareRows:1,preventOverflow:"horizontal",manualColumnMove:!0,contextMenu:{items:{row_above:{name:"在上方插入行"},row_below:{name:"在下方插入行"},remove_row:{name:"删除行"}}},columns:[{data:"className",title:"课程名",width:260,height:20,validator:/^(.){1,50}$/,allowEmpty:!1},{data:"instructor",title:"任课教师工号",width:180,height:20,validator:/^(.){1,50}$/,allowEmpty:!1},{data:"courseCode",title:"课程号",width:180,height:20,validator:/^(.){1,50}$/,allowEmpty:!1},{data:"identifier",title:"开课号",width:200,height:20,validator:/^(.){1,50}$/,allowEmpty:!1},{data:"chosenYear",title:"开课学年",width:120,height:20,_key:"chosenYear",type:"dropdown",source:e.courseacademicYear,allowEmpty:!1},{data:"chosenSemester",title:"选择开课学期",width:120,height:20,_key:"chosenYear",type:"dropdown",source:e.coursesemestere,allowEmpty:!1},{data:"remark",title:"备注",width:120,height:20,allowEmpty:!0}],afterChange:function(t,o){"loadData"===o?console.log("same"):(0==e.count?(e.dirty=!1,console.log("console:",e.count),console.log("different",e.dirty)):(e.dirty=!0,e.firstActivities=!1,console.log("console:",e.count),console.log("different",e.dirty)),e.count++,console.log("console:",e.count))},afterRemoveRow:function(e,o,n,r){t.dirty=!0,t.firstActivities=!1}});this.hotInstance=n},isValid:function(){if(console.log("firstActivities",this.firstActivities),this.firstActivities)return!1;var e=this.toPostData();return console.log("result",e),!!e},isNotDirty:function(){this.dirty=!1},save:function(){this.saving=!0;var e=this.isValid();if(e){var t=this;this.addBaseCourses(this.postData.courses).then((function(e){console.log("res:",e),t.firstActivities=!0,"SUCCESS"==e.code&&((0,G.nk)({type:"success",message:"新建成功",duration:1500}),t.goBackandClean(),t.isNotDirty())}))["catch"]((function(e){var o=e.data;500==e.status?(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500}):"E_CLASS_EXIST"==o.code?(res.data.forEach((function(e){t.hotInstance.setCellMetaObject(Object.keys(e)[0],0,{validator:/.+fkmog@.+/}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],1,{validator:/.+fkmog@.+/}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],2,{validator:/.+fkmog@.+/}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],3,{validator:/.+fkmog@.+/}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],4,{validator:/.+fkmog@.+/}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],5,{validator:/.+fkmog@.+/}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],6,{validator:/.+fkmog@.+/})})),t.hotInstance.setCellMetaObject(t.postData.courses.length,0,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,1,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,2,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,3,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,4,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,5,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,6,{validator:void 0}),(0,G.nk)({type:"error",message:"新建失败，标红教学班已存在",duration:1500}),t.hotInstance.validateCells((function(e){}))):"E_TEACHER_NOT_EXIST"==o.code?(o.data.forEach((function(e){t.hotInstance.setCellMetaObject(Object.keys(e)[0],0,{validator:void 0}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],1,{validator:/.+fkmog@.+/}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],2,{validator:void 0}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],3,{validator:void 0}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],4,{validator:void 0}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],5,{validator:void 0}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],6,{validator:void 0})})),t.hotInstance.setCellMetaObject(t.postData.courses.length,0,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,1,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,2,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,3,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,4,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,5,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,6,{validator:void 0}),(0,G.nk)({type:"error",message:"新建失败，标红教师不存在",duration:1500}),t.hotInstance.validateCells((function(e){}))):"课程号不存在"==o.msg?(o.data.forEach((function(e){t.hotInstance.setCellMetaObject(Object.keys(e)[0],0,{validator:void 0}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],1,{validator:void 0}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],2,{validator:/.+fkmog@.+/}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],3,{validator:void 0}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],4,{validator:void 0}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],5,{validator:void 0}),t.hotInstance.setCellMetaObject(Object.keys(e)[0],6,{validator:void 0})})),t.hotInstance.setCellMetaObject(t.postData.courses.length,0,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,1,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,2,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,3,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,4,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,5,{validator:void 0}),t.hotInstance.setCellMetaObject(t.postData.courses.length,6,{validator:void 0}),(0,G.nk)({type:"error",message:"新建失败，标红课程号不存在",duration:1500}),t.hotInstance.validateCells((function(e){}))):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500}),t.isNotDirty()}))}else this.saving=!1},toPostData:function(){this.postData.courses.length=0;var e=this,t=this.postData.courses,o=!0;return this.db.items.forEach((function(n){if(n.courseCode=n.courseCode,n.className=n.className,n.instructor=n.instructor,n.identifier=n.identifier,n.chosenYear=n.chosenYear,n.chosenSemester=n.chosenSemester,n.remark=n.remark,!(n.courseCode&&n.className&&n.instructor&&n.identifier&&n.chosenYear&&n.chosenSemester))return n.courseCode||n.className||n.instructor||n.identifier||n.chosenYear||n.chosenSemester?void(o=!1):void 0;var r=null,a=null;e.academicYear.forEach((function(e){e.dictLabel==n.chosenYear&&(r=e.dictValue)})),e.semester.forEach((function(e){e.dictLabel==n.chosenSemester&&(a=e.dictValue)}));var s={departmentId:e.departmentId,schoolId:e.schoolId,className:n.className,identifier:n.identifier,teacherNumber:n.instructor,courseCode:n.courseCode,academicYear:r,semester:a,remark:n.remark};t.push(s)})),o},goBackandClean:function(){this.db.items=[],this.postData.courses=[],this.hotInstance.updateSettings({data:this.db.items}),this.$router.push({path:"/class"})},goBaseCourse:function(){var e=this;console.log("gobasecourse:"+this.saving+this.dirty),1==this.dirty||0==this.saving&&1==this.dirty?P.s.confirm("数据还未保存，是否仍然关闭？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.$router.push({path:"/class"})}))["catch"]((function(){})):this.$router.push({path:"/class"})},addBaseCourses:function(e){var t=[];return this.postData.courses.forEach((function(e){t.push(e)})),console.log("courseList:",t),Q({url:"/classes/addClasses",method:"post",data:t})},handleEvent:function(e){var t=this;return(0,Kt.A)((0,Xt.A)().mark((function o(){return(0,Xt.A)().wrap((function(o){while(1)switch(o.prev=o.next){case 0:o.t0=e.keyCode,o.next=86===o.t0?3:6;break;case 3:return console.log("ctrl + v"),t.firstActivities=!1,o.abrupt("break",6);case 6:case"end":return o.stop()}}),o)})))()}},mounted:function(){this.activate(),window.addEventListener("keydown",this.handleEvent)},beforeDestroy:function(){window.removeEventListener("keydown",this.handleEvent)}},nl=(0,h.A)(ol,[["render",tl],["__scopeId","data-v-2114d186"]]),rl=nl;var al=function(e){return(0,l.Qi)("data-v-68e36a88"),e=e(),(0,l.jt)(),e},sl={class:"content"},il={class:"block"},ll=al((function(){return(0,l.Lk)("div",{class:"title"},"全部课程",-1)})),cl={class:"title"},ul={class:"body"},dl={class:"card"},hl=al((function(){return(0,l.Lk)("h3",null,"课程信息",-1)})),fl=al((function(){return(0,l.Lk)("div",{class:"detail-title"},"课程名",-1)})),ml={class:"detail-info",style:{"margin-top":"10px"}},pl=al((function(){return(0,l.Lk)("div",{class:"detail-title"},"课程号",-1)})),bl={class:"detail-info",style:{"margin-top":"10px"}},gl=al((function(){return(0,l.Lk)("div",{class:"detail-title"},"学分",-1)})),kl={class:"detail-info",style:{"margin-top":"10px"}},vl=al((function(){return(0,l.Lk)("div",{class:"detail-title"},"课程类型",-1)})),Il={class:"detail-info",style:{"margin-top":"10px"}},yl=al((function(){return(0,l.Lk)("div",{class:"detail-title"},"选课类型",-1)})),Cl={class:"detail-info",style:{"margin-top":"10px"}},Al=al((function(){return(0,l.Lk)("div",{class:"detail-title"},"备注",-1)})),Fl=al((function(){return(0,l.Lk)("div",{class:"detail-info",style:{"margin-top":"10px"}},null,-1)})),wl={class:"pagination-container",flex:""},Sl={class:"loadMore"},_l={class:"dialog-footer"};function El(e,t,o,n,r,a){var s=(0,l.g2)("Back"),c=(0,l.g2)("el-icon"),u=(0,l.g2)("el-tooltip"),d=(0,l.g2)("el-divider"),h=(0,l.g2)("Histogram"),f=(0,l.g2)("Checked"),m=(0,l.g2)("DataAnalysis"),p=(0,l.g2)("List"),b=(0,l.g2)("Management"),g=(0,l.g2)("CopyDocument"),k=(0,l.g2)("el-row"),v=(0,l.g2)("el-col"),I=(0,l.g2)("el-button"),y=(0,l.g2)("el-upload"),A=(0,l.g2)("el-table-column"),F=(0,l.g2)("CircleClose"),w=(0,l.g2)("el-table"),S=(0,l.g2)("DrawerSearch"),_=(0,l.g2)("el-option"),E=(0,l.g2)("el-select"),N=(0,l.g2)("el-drawer"),V=(0,l.g2)("el-checkbox"),x=(0,l.g2)("el-checkbox-group"),T=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)("div",sl,[(0,l.Lk)("div",il,[(0,l.bF)(k,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.backBaseCourse()})},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1}),ll,(0,l.bF)(d,{class:"divider",direction:"vertical"}),(0,l.Lk)("div",cl,(0,C.v_)(r.versionName),1),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"成绩项",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",style:{"margin-left":"20px"},onClick:t[1]||(t[1]=function(e){return a.toActivities()})},{default:(0,l.k6)((function(){return[(0,l.bF)(h)]})),_:1})]})),_:1}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"课程目标",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",style:{"margin-left":"20px"},onClick:t[2]||(t[2]=function(e){return a.toObjectives()})},{default:(0,l.k6)((function(){return[(0,l.bF)(f)]})),_:1})]})),_:1}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"试卷分析",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",style:{"margin-left":"20px"},onClick:t[3]||(t[3]=function(e){return a.toPaperAnalysis()})},{default:(0,l.k6)((function(){return[(0,l.bF)(m)]})),_:1})]})),_:1}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"毕业要求指标点",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",style:{"margin-left":"20px"},onClick:t[4]||(t[4]=function(e){return a.toIndicators()})},{default:(0,l.k6)((function(){return[(0,l.bF)(p)]})),_:1})]})),_:1}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"工作手册",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",style:{"margin-left":"15px"},onClick:t[5]||(t[5]=function(e){return a.toTemplate()})},{default:(0,l.k6)((function(){return[(0,l.bF)(b)]})),_:1})]})),_:1}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"从其他大纲复制",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",style:{"margin-left":"20px"},onClick:t[6]||(t[6]=function(e){return a.openDrawer()})},{default:(0,l.k6)((function(){return[(0,l.bF)(g)]})),_:1})]})),_:1})]})),_:1})]),(0,l.Lk)("div",ul,[(0,l.Lk)("div",dl,[hl,(0,l.bF)(v,null,{default:(0,l.k6)((function(){return[(0,l.bF)(v,{style:{"margin-top":"15px"}},{default:(0,l.k6)((function(){return[fl,(0,l.Lk)("div",ml,(0,C.v_)(r.form.courseName),1)]})),_:1}),(0,l.bF)(k,{style:{"margin-top":"15px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(v,{span:12,style:{"margin-top":"10px"}},{default:(0,l.k6)((function(){return[pl,(0,l.Lk)("div",bl,(0,C.v_)(r.form.courseCode),1)]})),_:1}),(0,l.bF)(v,{span:6,style:{"margin-top":"10px"}},{default:(0,l.k6)((function(){return[gl,(0,l.Lk)("div",kl,(0,C.v_)(r.form.credit),1)]})),_:1})]})),_:1}),(0,l.bF)(k,{style:{"margin-top":"15px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(v,{span:12,style:{"margin-top":"10px"}},{default:(0,l.k6)((function(){return[vl,(0,l.Lk)("div",Il,(0,C.v_)(r.form.courseNature),1)]})),_:1}),(0,l.bF)(v,{span:6,style:{"margin-top":"10px"}},{default:(0,l.k6)((function(){return[yl,(0,l.Lk)("div",Cl,(0,C.v_)(r.form.courseType),1)]})),_:1})]})),_:1}),(0,l.bF)(v,{style:{"margin-top":"25px"}},{default:(0,l.k6)((function(){return[Al,Fl]})),_:1}),(0,l.bF)(v,{style:{"margin-top":"45px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(k,null,{default:(0,l.k6)((function(){return[(0,l.bF)(v,{class:"detail-title"},{default:(0,l.k6)((function(){return[(0,l.eW)("课程大纲")]})),_:1}),(0,l.bF)(v,{span:6},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(y,{class:"upload-demo",action:r.action,data:r.data,headers:r.headers,accept:".doc,.docx,.pdf,.rar,.zip","file-list":r.fileList,limit:1,"show-file-list":"",name:"files","on-success":a.uploadSuccess,"on-exceed":a.uploadExceed,"on-remove":a.uploadRemove},{default:(0,l.k6)((function(){return[(0,l.bF)(I,{size:"small",type:"primary"},{default:(0,l.k6)((function(){return[(0,l.eW)("上传课程大纲")]})),_:1})]})),_:1},8,["action","data","headers","file-list","on-success","on-exceed","on-remove"]),[[i.aG,!r.hasFile]])]})),_:1}),(0,l.bF)(v,null,{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(w,{data:r.filesList,style:{cursor:"pointer","margin-top":"10px",width:"225px"},"show-header":!1,onRowClick:a.downloadFile},{default:(0,l.k6)((function(){return[(0,l.bF)(A,{prop:"originalName",label:"文件名",width:"180px"}),(0,l.bF)(A,{width:"45px"},{default:(0,l.k6)((function(e){return[(0,l.bF)(u,{content:"移除","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(I,{link:"",style:{color:"#3f51b5"},onClick:(0,i.D$)((function(t){return a.beforeRemove(e.row)}),["stop"])},{default:(0,l.k6)((function(){return[(0,l.bF)(c,null,{default:(0,l.k6)((function(){return[(0,l.bF)(F)]})),_:1})]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:1})]})),_:1},8,["data","onRowClick"]),[[i.aG,r.hasFile]])]})),_:1})]})),_:1})]})),_:1})]})),_:1})])]),(0,l.bF)(N,{modelValue:r.drawer,"onUpdate:modelValue":t[10]||(t[10]=function(e){return r.drawer=e}),modal:!0},{default:(0,l.k6)((function(){return[(0,l.bF)(k,null,{default:(0,l.k6)((function(){return[(0,l.bF)(v,{span:14},{default:(0,l.k6)((function(){return[(0,l.bF)(S,{msg:"搜索课程名称、课程号",onSearchValue:a.getSearchValue},null,8,["onSearchValue"])]})),_:1}),(0,l.bF)(v,{span:10},{default:(0,l.k6)((function(){return[(0,l.bF)(E,{modelValue:r.version,"onUpdate:modelValue":t[7]||(t[7]=function(e){return r.version=e}),placeholder:"选择课程大纲版本",clearable:"",onChange:t[8]||(t[8]=function(e){return a.getEditDetail()})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.versionList,(function(e){return(0,l.uX)(),(0,l.Wv)(_,{key:e.versionId,label:e.versionName,value:e.versionId},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1})]})),_:1}),(0,l.bF)(k,{style:{"margin-top":"40px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(w,{data:r.copyCourseList,style:{width:"100%"},onRowClick:a.copyDetail},{default:(0,l.k6)((function(){return[(0,l.bF)(A,{prop:"courseName",label:"课程名","min-width":"180px"}),(0,l.bF)(A,{prop:"courseCode",label:"课程号","min-width":"180px"}),(0,l.bF)(A,{prop:"versionName",label:"版本","min-width":"180px"})]})),_:1},8,["data","onRowClick"])]})),_:1}),(0,l.Lk)("div",wl,[(0,l.Lk)("div",Sl,[(0,l.bo)((0,l.bF)(I,{link:"",plain:"",onClick:t[9]||(t[9]=function(e){return a.loadMore()})},{default:(0,l.k6)((function(){return[(0,l.eW)("加载更多")]})),_:1},512),[[i.aG,r.showLoadmore]])])])]})),_:1},8,["modelValue"]),(0,l.bF)(T,{modelValue:r.dialogVisible,"onUpdate:modelValue":t[14]||(t[14]=function(e){return r.dialogVisible=e}),title:"从其他大纲复制",width:"400px"},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",_l,[(0,l.bF)(I,{onClick:t[12]||(t[12]=function(e){return r.dialogVisible=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(I,{type:"primary",onClick:t[13]||(t[13]=function(e){return a.copyInfo()})},{default:(0,l.k6)((function(){return[(0,l.eW)("确认")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(k,{style:{"margin-bottom":"20px","font-size":"15px"}},{default:(0,l.k6)((function(){return[(0,l.eW)("从《"+(0,C.v_)(r.currentRow.courseName)+"》"+(0,C.v_)(r.currentRow.versionName)+"大纲复制以下内容：",1)]})),_:1}),(0,l.bF)(x,{modelValue:r.checkList,"onUpdate:modelValue":t[11]||(t[11]=function(e){return r.checkList=e})},{default:(0,l.k6)((function(){return[(0,l.bF)(V,{label:"成绩项"}),(0,l.bF)(V,{label:"课程目标"}),(0,l.bF)(V,{label:"预设手册模板"})]})),_:1},8,["modelValue"])]})),_:1},8,["modelValue"])])}o(47764),o(62953),o(3296),o(48408),o(14603),o(47566),o(98721);function Nl(e){return Q({url:"/common/download/file",method:"get",params:{fileAddress:e},responseType:"blob"})}function Vl(e){return Q({url:"/common/remove/file/"+e,method:"delete"})}const xl={name:"baseCourseDetail",components:{DrawerSearch:pn,CopyDocument:ee.TZn,ElTooltip:ue.R7,ElMessage:G.nk,ElMessageBox:P.s,addBtn:le,request:Q,Back:ee.kcb,Histogram:ee.dqr,List:ee.B8B,Checked:ee.y$q,CircleClose:ee.R$5,Management:ee.iVF,Download:ee.f5X,DataAnalysis:ee.ja0},data:function(){return{from:"",filesList:[],checkList:["成绩项","课程目标","预设手册模板"],currentRow:{},copyCourseList:[],keyword:"",dialogVisible:!1,versionList:[],version:"",drawer:!1,fileList:[],headers:{Authorization:"Bearer "+u.A.get("Admin-Token")},action:"",data:[],indicators:[],departmentId:"",schoolId:"",majorId:[],majorNumber:0,currentMajorId:"",detailId:"",object:[],hasFile:!1,courseId:"",versionName:"",versionId:"",versionFlag:"",form:{courseName:"",courseCode:"",courseType:"",courseNature:"",credit:"",courseYear:"",remark:""},majorForm:[],pageSize:20,pageNum:1,total:0,showLoadmore:!1,url:""}},mounted:function(){this.getRouter(),this.url=(0,l.WQ)("$baseURL"),this.$store.commit("course/setCourseName",this.form.courseName),this.$store.commit("course/setCourseId",this.courseId);var e=this;this.versionFlag?(this.isVisiable=!0,this.getDetail(),this.checkVersion()):P.s.confirm("尚未添加版本信息是否添加？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){return console.log("versionId",e.versionId,"CourseId",e.courseId),Q({url:"/detail",method:"post",data:{versionId:e.versionId,courseId:e.courseId,departmentId:e.departmentId,schoolId:e.schoolId}}).then((function(t){console.log(t),"SUCCESS"==t.code&&((0,G.nk)({type:"success",message:"新建成功",duration:1500}),e.isVisiable=!0,e.getDetail())}))["catch"]((function(t){500===t.status?(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500}),e.goBaseCourse()}))})),console.log("router from",this.$route.query["parentName"]),"courseInMajor"==this.$route.query["parentName"]?this.from=this.$route.query["parentName"]:this.from="",console.log("from",this.from)},methods:{getDetail:function(){var e=this;return Q({url:"/detail/list?vesionId="+this.versionId+"&courseId="+this.courseId,method:"get"}).then((function(t){t.rows.forEach((function(t){t.versionId==e.versionId&&(e.detailId=t.detailId)}));var o=[],n={};n.param=e.detailId,n.type="syllabusFile",o.push(n),e.action=e.url+"common/upload/files",e.data=o[0],e.$store.commit("course/setDetailId",e.detailId),e.checkFileList()}))},backBaseCourse:function(){console.log("from:",this.from),"courseInMajor"==this.from?(this.$store.commit("navInfo/setActiveDisplay2",1),this.$router.push("/courses")):this.$router.push("/baseCourse")},toActivities:function(){this.$router.push("/baseCourseActivities")},toPaperAnalysis:function(){this.$router.push("/paperAnalysis")},toIndicators:function(){this.$router.push("/baseCourseIndicators")},toObjectives:function(){this.$router.push("/baseCourseObjectives")},toTemplate:function(){this.$router.push("/templateManage")},getRouter:function(){this.versionName=this.$store.state.course.baseCourseVersionName,this.versionId=this.$store.state.course.baseCourseVersionId,this.versionFlag=this.$store.state.course.baseCourseVersionFlag,this.courseId=this.$store.state.course.baseCourseCourseId,this.form.courseName=this.$store.state.course.baseCourseCourseName,this.form.courseCode=this.$store.state.course.baseCourseCourseCode,this.form.courseType=this.$store.state.course.baseCourseCourseType,this.form.courseNature=this.$store.state.course.baseCourseCourseNature,this.form.credit=this.$store.state.course.baseCourseCredit,this.form.courseYear=this.$store.state.course.baseCourseCourseYear,this.form.remark=this.$store.state.course.baseCourseRemark,this.departmentId=this.$store.state.currentInfo.departmentId,this.schoolId=this.$store.state.currentInfo.schoolId},checkVersion:function(){var e=this;_n().then((function(t){console.log("checkVersion",t),e.versionList=t.data}))},uploadSuccess:function(e,t,o){console.log("response",e,t,"file",o,"fileList"),"SUCCESS"==e.code&&((0,G.nk)({type:"success",message:"上传成功",duration:1500}),this.checkFileList())},uploadExceed:function(){(0,G.nk)({type:"warning",message:"最多上传一个文件",duration:1500})},beforeRemove:function(e){var t=this;P.s.confirm("确认移除课程大纲文件？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){t.fileList=[],t.uploadRemove(e)}))["catch"]((function(){}))},uploadRemove:function(e){var t=this;Vl(e.fileId).then((function(e){console.log("removeDetail",e),"SUCCESS"===e.code&&((0,G.nk)({type:"success",message:"删除成功",duration:1500}),t.checkFileList())}))},beforeUpload:function(e){if(0===e.size)return(0,G.nk)({type:"warning",message:"文件不能为空",duration:1500})},checkFileList:function(){var e=this;wn(this.detailId).then((function(t){e.filesList=t.data,0==e.filesList.length?e.hasFile=!1:e.hasFile=!0}))},downloadFile:function(e){Nl(e.fileAddress).then((function(t){var o=new Blob([t]),n=document.createElement("a");n.download=decodeURI(e.originalName),n.style.display="none",n.href=URL.createObjectURL(o),document.body.appendChild(n),n.click(),URL.revokeObjectURL(n.href),document.body.removeChild(n)}))},openDrawer:function(){this.drawer=!0,this.getEditDetail()},copyDetail:function(e){console.log("copyDetail",e),this.currentRow=e,this.dialogVisible=!0},getEditDetail:function(){var e=this;Sn(this.keyword,this.version,this.pageSize,this.pageNum).then((function(t){console.log("getEditDetail",t),e.copyCourseList=t.rows,e.total=t.total,e.pageSize>=t.total?e.showLoadmore=!1:e.showLoadmore=!0}))},loadMore:function(){this.total-this.pageSize>=20?(this.pageSize+=20,this.getEditDetail()):(this.pageSize+=this.total-this.pageSize,this.getEditDetail())},getSearchValue:function(e){this.keyword=e,this.getEditDetail()},copyInfo:function(){var e=this,t={};t.sourceDetailId=this.currentRow.detailId,t.targetDetailId=this.detailId,-1!==this.checkList.indexOf("成绩项")?t.isCopyActivities=1:t.isCopyActivities=0,-1!==this.checkList.indexOf("课程目标")?t.isCopyObjectives=1:t.isCopyObjectives=0,-1!==this.checkList.indexOf("预设手册模板")?t.isCopyFormPreset=1:t.isCopyFormPreset=0,En(t).then((function(t){console.log("copyActAndObj",t),e.dialogVisible=!1,"SUCCESS"==t.code&&((0,G.nk)({type:"success",message:"复制成功",duration:1500}),e.drawer=!1)}))}}},Tl=(0,h.A)(xl,[["render",El],["__scopeId","data-v-68e36a88"]]),jl=Tl;var Ll=function(e){return(0,l.Qi)("data-v-f74804c4"),e=e(),(0,l.jt)(),e},Dl={class:"content"},Bl={class:"block"},$l=Ll((function(){return(0,l.Lk)("div",{class:"title"},"课程目标",-1)})),Ol={class:"body"},Ml={class:"card"},Ul=Ll((function(){return(0,l.Lk)("span",{style:{color:"grey","font-size":"14px"}},"课程目标",-1)})),Wl={class:"objective-description"},Rl=Ll((function(){return(0,l.Lk)("div",{style:{"margin-top":"20px"}},[(0,l.Lk)("span",{style:{color:"grey","font-size":"14px"}},"考核方式")],-1)})),Pl=Ll((function(){return(0,l.Lk)("div",{style:{height:"30px"}},null,-1)})),Gl=Ll((function(){return(0,l.Lk)("div",null,[(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","margin-top":"100px","font-size":"22px"}}," 暂未关联课程大纲 "),(0,l.Lk)("div",{style:{display:"flex","justify-content":"center",color:"grey","font-size":"13px","margin-top":"30px"}}," 请联系课程负责人进行设置 ")],-1)})),zl=[Gl],Yl=Ll((function(){return(0,l.Lk)("div",null,[(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","margin-top":"100px","font-size":"22px"}}," 暂未关联课程大纲 "),(0,l.Lk)("div",{style:{display:"flex","justify-content":"center",color:"grey","font-size":"13px","margin-top":"30px"}}," 请联系课程负责人进行设置 ")],-1)}));function Xl(e,t,o,n,r,a){var s=(0,l.g2)("Back"),c=(0,l.g2)("el-icon"),u=(0,l.g2)("el-tooltip"),d=(0,l.g2)("el-row"),h=(0,l.g2)("EditPen"),f=(0,l.g2)("el-alert"),m=(0,l.g2)("el-col");return(0,l.uX)(),(0,l.CE)("div",Dl,[(0,l.Lk)("div",Bl,[(0,l.bF)(d,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.back()})},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1}),$l]})),_:1})]),(0,l.Lk)("div",Ol,[(0,l.Lk)("div",Ml,[(0,l.bF)(d,{class:"card-head",style:{"margin-top":"30px"}},{default:(0,l.k6)((function(){return[Ul,(0,l.bF)(u,{class:"box-item",effect:"dark",content:"编辑",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"edit-pen",onClick:t[1]||(t[1]=function(e){return a.goEdit()})},{default:(0,l.k6)((function(){return[(0,l.bF)(h)]})),_:1})]})),_:1})]})),_:1}),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(this.info,(function(e,t){return(0,l.uX)(),(0,l.CE)("div",{key:t},[(0,l.bF)(f,{title:e,type:"error",closable:!1,"show-icon":"",style:{width:"350px","margin-top":"5px"}},null,8,["title"])])})),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.list.objectives,(function(e){return(0,l.uX)(),(0,l.CE)("div",{key:e.id},[(0,l.bF)(d,{style:{width:"800px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{span:1,class:"objective-num"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.serialNum),1)]})),_:2},1024),(0,l.bo)((0,l.bF)(m,{span:3,class:"objective-achieve"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.achievementTwo),1)]})),_:2},1536),[[i.aG,e.hasAchieve]]),(0,l.bo)((0,l.bF)(m,{span:1,class:"objective-achieve"},null,512),[[i.aG,!e.hasAchieve]]),(0,l.bF)(m,{span:20},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(d,{class:"objective-name"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.name),1)]})),_:2},1536),[[i.aG,e.name]]),(0,l.Lk)("div",Wl,(0,C.v_)(e.description),1),Rl,((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.assessmentMethods,(function(e,t){return(0,l.uX)(),(0,l.CE)("div",{key:t},[(0,l.bF)(d,{class:"assessments"},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{span:5},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.name),1)]})),_:2},1024),(0,l.bF)(m,{span:4},{default:(0,l.k6)((function(){return[(0,l.eW)("( "+(0,C.v_)(e.weight)+"% )",1)]})),_:2},1024),(0,l.bF)(m,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(d,null,{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.activities.item,(function(e,t){return(0,l.bo)(((0,l.uX)(),(0,l.Wv)(m,{span:8,key:t},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e),1)]})),_:2},1024)),[[i.aG,e]])})),128))]})),_:2},1024)]})),_:2},1024),(0,l.bF)(m,{span:3,class:"assess-achieve"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.achievementTwo),1)]})),_:2},1024)]})),_:2},1024)])})),128))]})),_:2},1024)]})),_:2},1024),Pl])})),128))]),(0,l.bo)((0,l.Lk)("div",null,zl,512),[[i.aG,!r.hasDetailId]]),(0,l.bo)((0,l.Lk)("div",null,[(0,l.bF)(d,null,{default:(0,l.k6)((function(){return[Yl,(0,l.bo)((0,l.bF)(m,{class:"go-edit",onClick:t[2]||(t[2]=function(e){return a.goEdit()})},{default:(0,l.k6)((function(){return[(0,l.eW)("去设置")]})),_:1},512),[[i.aG,e.isRespondent]])]})),_:1})],512),[[i.aG,r.hasDetailId&&!r.hasObjective]])])])}var Ql=o(59258),Kl=(o(9868),o(53796),{class:"editBtnBlock"});function Jl(e,t,o,n,r,a){var s=(0,l.g2)("EditPen"),i=(0,l.g2)("el-icon"),c=(0,l.g2)("el-button");return(0,l.uX)(),(0,l.CE)("div",Kl,[(0,l.bF)(c,{class:"editBtn",color:"#626aef",plain:"",type:"primary"},{default:(0,l.k6)((function(){return[(0,l.bF)(i,null,{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1})])}const Hl={name:"editBtn",components:{EditPen:ee.EDh}},ql=(0,h.A)(Hl,[["render",Jl],["__scopeId","data-v-1aa6ba83"]]),Zl=ql,ec={name:"baseCourseObjectives",components:{Back:ee.kcb,editBtn:Zl,EditPen:ee.EDh},data:function(){return{info:[],hasDetailId:!0,hasObjective:!0,classInfo:[],list:[],objectives:[],course:{name:"",detailId:Number,departmentId:Number,schoolId:Number}}},mounted:function(){this.course.name=this.$store.state.course.courseName,this.course.detailId=this.$store.state.course.detailId,null===this.course.detailId?this.hasDetailId=!1:this.hasDetailId=!0,this.checkObjectives()},methods:{back:function(){this.$router.push("/baseCourseDetail")},goEdit:function(){this.$router.push("/baseCourseObjectivesEdit")},checkActivityInfo:function(){for(var e=new Set,t=this.list.activities,o=0;o<t.length;o++){var n=t[o];e.add(n.name)}for(var r=new Set,a=this.list.objectives,s=0;s<a.length;s++){var i=a[s].assessmentMethods;i.forEach((function(e){var t=e.activities.table;e.activities.item;r.add.apply(r,(0,Ql.A)(t))}))}var l,c=(0,Qt.A)(r);try{for(c.s();!(l=c.n()).done;){var u=l.value;e.has(u)||this.info.push("成绩项表："+u+" 不存在，请重新设置")}}catch(err){c.e(err)}finally{c.f()}console.log("tables",r,e)},checkObjectives:function(){var e=this;vn(this.course.detailId).then((function(t){e.list=t.data,e.list.objectives&&(e.hasObjective=!0,e.list.objectives.forEach((function(e){"0"==e.id.charAt(0)?e.serialNum=e.id.charAt(1):e.serialNum=e.id,e.hasOwnProperty("achievement")&&null!==e.achievement?(e.achievementTwo=e.achievement.toFixed(3),e.hasAchieve=!0):e.hasAchieve=!1,e.assessmentMethods.forEach((function(e){null===e.achievement?e.achievementTwo="":e.achievementTwo=e.achievement.toFixed(3)}))}))),console.log("getObjectives:",e.list),e.checkActivityInfo()}))}}},tc=(0,h.A)(ec,[["render",Xl],["__scopeId","data-v-f74804c4"]]),oc=tc;var nc=function(e){return(0,l.Qi)("data-v-46d349cc"),e=e(),(0,l.jt)(),e},rc={layout:"column",flex:"",class:"ng-scope layout-column flex"},ac={class:"block"},sc={class:"title"},ic={class:"title"},lc={key:0,style:{display:"inline-block",width:"200px","text-align":"center",padding:"10px"}},cc={style:{width:"100px",display:"inline-block"}},uc={key:2,class:"descriptionCard"},dc={style:{"margin-left":"10px","margin-right":"10px"}},hc={style:{"font-size":"14px",color:"gray"}},fc={key:3,style:{width:"95%",height:"100px",padding:"1px 11px"}},mc={class:"card-container"},pc=nc((function(){return(0,l.Lk)("div",{class:"hot-table-container",id:"courseHot"},null,-1)}));function bc(e,t,o,n,r,a){var s=this,c=(0,l.g2)("Back"),u=(0,l.g2)("el-icon"),d=(0,l.g2)("el-tooltip"),h=(0,l.g2)("el-divider"),f=(0,l.g2)("DocumentChecked"),m=(0,l.g2)("el-button"),p=(0,l.g2)("el-row"),b=(0,l.g2)("EditPen"),g=(0,l.g2)("Checked"),k=(0,l.g2)("el-input"),v=(0,l.g2)("CirclePlus"),I=(0,l.g2)("el-tab-pane"),y=(0,l.g2)("el-tabs");return(0,l.uX)(),(0,l.CE)("div",rc,[(0,l.Lk)("div",ac,[(0,l.bF)(p,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.gobaseCourseDetail()})},{default:(0,l.k6)((function(){return[(0,l.bF)(c)]})),_:1})]})),_:1}),(0,l.bo)((0,l.Lk)("div",sc,"成绩项",512),[[i.aG,"Score"===r.from]]),(0,l.bo)((0,l.Lk)("div",ic,"课程信息",512),[[i.aG,"Score"!==r.from]]),(0,l.bF)(h,{class:"divider",direction:"vertical"}),(0,l.bF)(d,{class:"box-item",effect:"dark",content:"保存成绩项",placement:"bottom","hide-after":0,disabled:!a.isValid()},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{onClick:a.save,link:"",class:"saveBtn",style:(0,C.Tr)(a.isValid()?null:r.saveStyle),disabled:!a.isValid()},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{size:"22px",color:"rgb(137, 137, 137)"},{default:(0,l.k6)((function(){return[(0,l.bF)(f)]})),_:1})]})),_:1},8,["onClick","style","disabled"])]})),_:1},8,["disabled"])]})),_:1})]),(0,l.bo)((0,l.bF)(y,{modelValue:r.editableTabsValue,"onUpdate:modelValue":t[3]||(t[3]=function(e){return r.editableTabsValue=e}),type:"card",class:"activity-tab",editable:!!r.canedit,onTabClick:a.editableTabsValueChange,onEdit:a.handleTabsEdit,id:"drag-tab"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.editableTabs,(function(e){return(0,l.uX)(),(0,l.Wv)(I,{key:e.name,label:e.title,name:e.name},{default:(0,l.k6)((function(o){return[e.inputFlag?e.inputFlag?((0,l.uX)(),(0,l.Wv)(k,{key:1,ref_for:!0,ref:"myInput".concat(e.name),modelValue:r.newActivityTitle,"onUpdate:modelValue":t[1]||(t[1]=function(e){return r.newActivityTitle=e}),type:"text",style:{width:"250px","margin-left":"10px"},placeholder:"标题",clearable:"",onClear:function(t){e.inputFlag=!1,e.title=r.originActivityTitle}},{append:(0,l.k6)((function(){return[(0,l.bF)(u,{size:"22px",style:{cursor:"pointer"},onClick:function(t){e.inputFlag=!1,e.title=r.newActivityTitle,e.description=r.newActivitydescription,r.unsave=!1,r.dirty=!0}},{default:(0,l.k6)((function(){return[(0,l.bF)(g)]})),_:2},1032,["onClick"])]})),_:2},1032,["modelValue","onClear"])):(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("span",lc,[(0,l.bo)((0,l.bF)(u,{size:"22px",color:"rgb(137, 137, 137)",style:{float:"left",top:"4px",cursor:"pointer"},onClick:function(t){return a.tabsContent(e,e.name)}},{default:(0,l.k6)((function(){return[(0,l.bF)(b)]})),_:2},1032,["onClick"]),[[i.aG,r.canedit]]),(0,l.eW)(" "+(0,C.v_)(e.title),1)])),(0,l.bo)((0,l.Lk)("div",cc,[(0,l.bF)(d,{class:"box-item",effect:"dark",content:"添加成绩项",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{onClick:a.addActivities,link:"",disabled:!r.over21,style:{padding:"10px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{size:"22px",color:"rgb(137, 137, 137)"},{default:(0,l.k6)((function(){return[(0,l.bF)(v)]})),_:1})]})),_:1},8,["onClick","disabled"])]})),_:1})],512),[[i.aG,!("教师"===s.identity&&1==s.currenteditableTabsValue)&&s.canedit]]),e.inputFlag?e.inputFlag?((0,l.uX)(),(0,l.CE)("div",fc,[(0,l.bF)(k,{ref_for:!0,ref:"myInput".concat(e.name),modelValue:r.newActivitydescription,"onUpdate:modelValue":t[2]||(t[2]=function(e){return r.newActivitydescription=e}),type:"textarea",clearable:"",placeholder:"评分标准",rows:2,autosize:{minRows:2,maxRows:3},onClear:function(t){e.inputFlag=!1,e.description=r.originActivitydescription}},null,8,["modelValue","onClear"])])):(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",uc,[(0,l.Lk)("div",dc,[(0,l.Lk)("span",hc,(0,C.v_)(e.description),1)])]))]})),_:2},1032,["label","name"])})),128))]})),_:1},8,["modelValue","editable","onTabClick","onEdit"]),[[i.aG,r.showActivities]]),(0,l.Lk)("div",mc,[r.showActivities?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(d,{key:0,class:"box-item",style:{display:"flex"},effect:"dark",content:"添加成绩项",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{onClick:a.addActivities,link:"",disabled:!r.over21,style:{padding:"10px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{size:"22px",color:"rgb(137, 137, 137)"},{default:(0,l.k6)((function(){return[(0,l.bF)(v)]})),_:1})]})),_:1},8,["onClick","disabled"])]})),_:1})),pc])])}var gc=o(10246);const kc={name:"activities",data:function(){return(0,$.A)((0,$.A)({compareData:[],saveStyle:{cursor:"not-allowed"},canedit:!1,unsave:!1,columnSummaryList:[],showActivities:!0,hasObjectives:!1,objectivesName:["题号","分值"],activityTitleConfirm:!0,originActivityTitle:"",newActivityTitle:"",newActivitydescription:"",originActivitydescription:"",from:"",classInfo:[],identity:"",itemOrValueisEmpty:!1,sortable:"",tempEditabel:"",oldtempEditabel:"",editableTabsValue:"0",currenteditableTabsValue:0,maxeditableTabsValue:0,editableTabs:[],tabIndex:0,colNum:1,over21:Boolean,activityList:[],departmentId:"",schoolId:"",courseId:"",detailId:"",currentNumberofActivities:0,dirty:!1,saving:!1,count:0,localres:{},postData:{activities:{item:[],value:[],remark:[]},objectives:{object:[],title:[],sum:[],value:[]}},db:{items:[],objectives:[]}},"departmentId",0),"fromCourseBatchAdd",!1)},components:{ref:ce.KR,onMounted:l.sV,reactive:ce.Kh,HotTable:De.sH,HotColumn:De.gQ,registerAllModules:Be.um,ElTooltip:ue.R7,ElIcon:de.tk,ElInput:he.WK,Handsontable:$e.Ay,Back:ee.kcb,FolderChecked:ee.KHk,InfoFilled:ee.N_H,Loading:ee.Rhj,Download:ee.f5X,UploadFilled:ee.m8m,DocumentAdd:ee.pT5,ElMessage:G.nk,ElMessageBox:P.s,Action:p.A,CirclePlus:ee.HxT,DocumentChecked:ee.Fmj,Sortable:gc.Ay,EditPen:ee.EDh,Checked:ee.y$q,CloseBold:ee.QBJ},methods:{confirmSave:function(e,t){this.activityTitleConfirm=!0,P.s.confirm("是否保存更改后的成绩项名称？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){return console.log("确认"),!1}))["catch"]((function(){console.log("取消")}))},dragTab:function(){var e=this,t=document.querySelector("#drag-tab .el-tabs__nav");console.log("type of tab",(0,O.A)(t),t),this.sortable=gc.Ay.create(t,{animation:150,sort:!0,onChoose:function(t){var o=t.oldIndex,n=JSON.parse(JSON.stringify(e.tempEditabel));e.oldtempEditabel=JSON.parse(JSON.stringify(e.tempEditabel));var r=n[o];console.log("OnChoose currTab:",r),"1"==r["name"]?e.sortable.option("sort",!1):e.sortable.option("sort",!0)},onMove:function(e){if(console.log("evt.related.className",e.related.id),"tab-1"==e.related.id)return!1},onEnd:function(t){var o=t.newIndex,n=t.oldIndex,r=e.tempEditabel.splice(n,1)[0];e.tempEditabel.splice(o,0,r),e.editableTabs=e.tempEditabel,console.log("editableTabs:",e.editableTabs),e.currenteditableTabsValue=Number(e.editableTabsValue),e.hotInstance.updateSettings({data:e.db.items[e.currenteditableTabsValue-1]})}})},tabsContent:function(e,t){console.log(e,t,"双击编辑tabs"),this.isValid(),this.unsave=!0,"1"==t&&"教师"==this.identity?(e.inputFlag=!1,(0,G.nk)({type:"error",message:"该成绩项为课程组统一，不可修改",duration:1500})):(this.originActivityTitle=e.title,this.newActivityTitle=e.title,this.originActivitydescription=e.description,this.newActivitydescription=e.description,e.inputFlag=!0)},editableTabsValueChange:function(e){var t=this;return this.currenteditableTabsValue=Number(e.props.name),"学院管理员"==this.identity||"课程负责人"==this.identity?(console.log("the teacher can edit the first tab content"),this.hotInstance.updateSettings({data:t.db.items[t.currenteditableTabsValue-1],cells:function(e,o){var n={};return t.canedit?(2===e&&(n.type="dropdown",n.source=[" ","总评","期末"],n.allowEmpty=!0,n.className="ht-s-size"),3===e&&(n.allowEmpty=!1),e<4&&o>=0&&(n.readOnly=!1)):e>=0&&(n.readOnly=!0),n}}),this.canedit||this.hotInstance.updateSettings({contextMenu:!1})):"2"!=this.isRespondent&&1==Number(e.props.name)?(console.log("the teacher can not edit the first tab content"),this.hotInstance.updateSettings({data:t.db.items[t.currenteditableTabsValue-1],contextMenu:!1,cells:function(e,o){var n={};return t.canedit?(2===e&&(n.type="dropdown",n.source=[" ","总评","期末"],n.allowEmpty=!0,n.className="ht-s-size"),3===e&&(n.allowEmpty=!1),o>=0&&(n.readOnly=!0)):e>=0&&(n.readOnly=!0),n}}),this.canedit||this.hotInstance.updateSettings({contextMenu:!1})):(console.log("the teacher can edit the first tab content"),this.hotInstance.updateSettings({data:t.db.items[t.currenteditableTabsValue-1],contextMenu:{items:{col_left:{name:"在左侧插入列"},col_right:{name:"在右侧插入列"},remove_col:{name:"删除列"}}},cells:function(e,o){var n={};return t.canedit?(2===e&&(n.type="dropdown",n.source=[" ","总评","期末"],n.allowEmpty=!0,n.className="ht-s-size"),3===e&&(n.allowEmpty=!1),e<4&&o>=0&&(n.readOnly=!1)):e>=0&&(n.readOnly=!1),n}}),this.canedit||this.hotInstance.updateSettings({contextMenu:!1})),console.log("currenteditableTabsValue:",Number(e.props.name))},handleTabsEdit:function(e,t,o,n){var r=this,a=this;if(console.log("action",t,e),"add"===t&&void 0==e){var s=[null],i=[null],l=[null],c=[null],u=[];u.push(s),u.push(i),u.push(l),u.push(c),this.db.items.push(u),console.log("this.db.items",this.db.items);var d=++this.tabIndex+"";this.currenteditableTabsValue=this.tabIndex,this.maxeditableTabsValue=this.tabIndex,this.editableTabs.push({title:"成绩项 "+d,name:d.toString(),value:d,inputFlag:!1,input:"成绩项 "+d,description:""}),this.editableTabsValue=d.toString(),console.log("editableTabs after add ",this.editableTabs),console.log("@@@@@@@@@@@@@@@@",this.hotInstance),this.hotInstance.updateSettings({data:a.db.items[a.currenteditableTabsValue-1],cells:function(e,t){var o={};return a.canedit?(3===e&&(o.allowEmpty=!1),e<4&&t>=0&&(o.readOnly=!1)):e>=0&&(o.readOnly=!1),o}}),this.tempEditabel=JSON.parse(JSON.stringify(this.editableTabs)),console.log("currenteditableTabsValue:",this.currenteditableTabsValue,"maxTabsValue:",this.maxeditableTabsValue)}if("add"===t&&void 0!=e){this.currenteditableTabsValue=this.tabIndex,this.maxeditableTabsValue=this.tabIndex;var h=++this.tabIndex+"";this.editableTabs.push({title:o||"成绩项 "+h,name:h.toString(),value:h,inputFlag:!1,input:o||"成绩项 "+h,description:n}),console.log("editableTabs after add ",this.editableTabs),this.editableTabsValue=h.toString(),this.tempEditabel=JSON.parse(JSON.stringify(this.editableTabs)),console.log("currenteditableTabsValue:",this.currenteditableTabsValue)}"remove"===t&&(console.log("removing targetName:",e),"1"!=e?P.s.confirm("是否确认删除当前成绩项？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){var t=r.editableTabs;console.log("targetName:",e);var o=r.editableTabsValue;o===e&&t.forEach((function(n,r){if(n.name===e){var a=t[r+1]||t[r-1];a&&(o=a.name)}})),r.hotInstance.updateSettings({data:a.db.items[Number(o-1)]});var n={props:{name:Number(o)}};r.editableTabsValueChange(n),r.editableTabsValue=o,r.editableTabs=t.filter((function(t){return t.name!==e})),r.tempEditabel=JSON.parse(JSON.stringify(r.editableTabs)),console.log("editableTabs:",r.editableTabs)}))["catch"]((function(e){console.log("e",e)})):P.s.confirm("此成绩项为不可删除的","注意",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}))},addActivities:function(){console.log("currenteditableTabsValue",this.currenteditableTabsValue),1==this.currenteditableTabsValue&&"教师"===this.identity?(0,G.nk)({type:"error",message:"该成绩项为课程组统一，不可修改",duration:1500}):(0==this.currenteditableTabsValue?this.colNum=this.db.items[this.currenteditableTabsValue][0].length:this.colNum=this.db.items[this.currenteditableTabsValue-1][0].length,console.log("this.colNum",this.colNum),this.colNum<21&&(this.currenteditableTabsValue?(this.db.items[this.currenteditableTabsValue-1][0].push(""),this.db.items[this.currenteditableTabsValue-1][1].push(null),this.db.items[this.currenteditableTabsValue-1][2].push(""),this.db.items[this.currenteditableTabsValue-1][3].push(""),this.hotInstance.updateSettings({data:this.db.items[this.currenteditableTabsValue-1]})):(this.db.items[this.currenteditableTabsValue][0].push(""),this.db.items[this.currenteditableTabsValue][1].push(null),this.db.items[this.currenteditableTabsValue][2].push(""),this.db.items[this.currenteditableTabsValue][3].push(""),this.hotInstance.updateSettings({data:this.db.items[this.currenteditableTabsValue]}))))},activateHotcolumn:function(){var e=this;console.log("getting getActivities");var t=document.querySelector("#courseHot"),o=new $e.Ay(t,{data:e.db.items[0],licenseKey:"non-commercial-and-evaluation",colHeaders:!1,dragToScroll:!0,rowHeaders:["考核项","分值","设置","权重"],copyPaste:!0,colWidths:70,allowRemoveColumn:!0,contextMenu:{items:{col_left:{name:"在左侧插入列"},col_right:{name:"在右侧插入列"},remove_col:{name:"删除列"}}},beforeCreateCol:function(t,o,n){return console.log("beforeCreateCol",e.currenteditableTabsValue,t,o,n),1!==e.currenteditableTabsValue&&0!==e.currenteditableTabsValue||"教师"!=e.identity||"2"==e.isRespondent?void console.log("return;",e.db.items):(console.log("return false;"),!1)},beforeRemoveCol:function(t,o,n,r){return console.log("beforeRemoveCol",e.currenteditableTabsValue),(1!==e.currenteditableTabsValue&&0!==e.currenteditableTabsValue||"教师"!=e.identity||"2"==e.isRespondent)&&void 0},afterChange:function(t,o){console.log("changes",t,"source",o),"loadData"!==o&&e.isValid()},afterRemoveCol:function(e,t){}});this.hotInstance=o,("教师"==this.identity&&"2"!=this.isRespondent||!this.canedit)&&this.hotInstance.updateSettings({contextMenu:!1}),this.hotInstance.updateSettings({data:this.db.items[0],cells:this.getHotCellsFunction()})},getHotCellsFunction:function(){var e=this;return function(t,o,n){var r={};return e.canedit?(2===t&&(r.type="dropdown",r.source=[" ","总评","期末"],r.allowEmpty=!0,r.className="ht-s-size"),3===t&&(r.allowEmpty=!1),t<4&&o>=0&&("教师"!=e.identity||"2"==e.isRespondent?r.readOnly=!1:r.readOnly=!0)):t>=0&&(r.readOnly=!0),r}},getActivities:function(){var e=this;return this.db.items=[],"Score"==this.from?(console.log("this is the activity from class"),Q({url:"/classes/"+e.classInfo.classId,method:"get"}).then((function(t){console.log("class Info",t),e.isRespondent=t.data.isRespondent,console.log("isRespondent",e.isRespondent);var o=t.data;if(o.activities)o.activities.forEach((function(t){e.handleTabsEdit(1,"add",t.name,t.description);var o=[];if(o.push(t.item),o.push(t.value),o.push(t.remark),t.weight)o.push(t.weight);else{for(var n=[],r=0;r<t.item.length;r++)n.push("");o.push(n)}e.db.items.push(o)})),e.editableTabsValue="1",e.currenteditableTabsValue=1,console.log("res has activities:",e.db.items),e.compareData=JSON.parse(JSON.stringify(e.db.items)),e.dragTab();else{console.log("res has no activities"),e.handleTabsEdit(1,"add");var n=[""],r=[""],a=[""],s=[""],i=[];i.push(n),i.push(r),i.push(a),i.push(s),e.db.items.push(i),e.compareData=JSON.parse(JSON.stringify(e.db.items))}e.activateHotcolumn()}))):(console.log("this is the activity from detail",this.detailId),Q({url:"/detail/"+this.detailId,method:"get"}).then((function(t){console.log("activities",t);var o=t.data;if(o.activities.length)o.activities.forEach((function(t){e.handleTabsEdit(1,"add",t.name,t.description);var o=[];if(o.push(t.item),o.push(t.value),o.push(t.remark),t.weight)o.push(t.weight);else{for(var n=[],r=0;r<t.item.length;r++)n.push("");o.push(n)}e.db.items.push(o)})),e.editableTabsValue="1",e.currenteditableTabsValue=1,console.log("res has activities:",e.db.items),e.compareData=JSON.parse(JSON.stringify(e.db.items)),e.dragTab();else{console.log("res has no activities"),e.handleTabsEdit(1,"add");var n=[""],r=[""],a=[""],s=[""],i=[];i.push(n),i.push(r),i.push(a),i.push(s),e.db.items.push(i),e.compareData=JSON.parse(JSON.stringify(e.db.items))}e.activateHotcolumn()}))["catch"]((function(e){console.log("get activity error",e)})))},isValid:function(){var e=this.toPostData();return console.log("result",e),e},save:function(){var e=this;this.saving=!0,this.itemOrValueisEmpty=!1,this.postData.objectives={object:[],title:[],sum:[],value:[]};var t=this.isValid();if(t)if(this.canedit){for(var o=[],n=[],r=[],a=0;a<Object.keys(this.editableTabs).length;a++)o.push(Number(this.editableTabs[a]["name"])-1),n.push(this.editableTabs[a]["title"]),r.push(this.editableTabs[a]["description"]);for(var s=[],i=0;i<o.length;i++){var l=[],c=[],u=[],d=[],h=r[i],f=n[i];console.log("keyNum[i]:",o[i]),console.log(this.db.items);for(var m=0;m<this.db.items[o[i]][0].length;m++)this.db.items[o[i]][0][m]||(this.itemOrValueisEmpty=!0),this.db.items[o[i]][1][m]||(this.itemOrValueisEmpty=!0),l.push(this.db.items[o[i]][0][m].replace(/[\n\s]/g,"")),c.push(this.db.items[o[i]][1][m]),u.push(this.db.items[o[i]][2][m]),d.push(this.db.items[o[i]][3][m]);var p={item:l,value:c,remark:u,weight:d,name:f,description:h};s.push(p)}if(console.log("activities data :",s),!this.itemOrValueisEmpty)return"Score"==this.from?Q({url:"/classes/editActivities",method:"post",data:{classId:this.classInfo.classId,activities:s,schoolId:this.schoolId,departmentId:this.departmentId}}).then((function(t){console.log("res:",t),"SUCCESS"==t.code&&(0,G.nk)({type:"success",message:"保存成功",duration:1500}),e.compareData=JSON.parse(JSON.stringify(e.db.items)),e.dirty=!1}))["catch"]((function(e){var t=e.data;console.log("e:",e),500==e.status?(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500}):"UNPROCESSABLE_ENTITY"==t.code&&"OVERALL_NOT_SET"==t.msg?(0,G.nk)({type:"error",message:"更新失败，总评未设置",duration:1500}):"UNPROCESSABLE_ENTITY"==t.code&&"有权重为空"==t.msg?(0,G.nk)({type:"error",message:"更新失败，有权重为空",duration:1500}):"UNPROCESSABLE_ENTITY"==t.code&&"权重和不对"==t.msg?(0,G.nk)({type:"error",message:"更新失败，权重之和必须为100%",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500})})):Q({url:"/detail",method:"put",data:{schoolId:this.schoolId,departmentId:this.departmentId,courseId:this.courseId,detailId:this.detailId,activities:s}}).then((function(t){console.log("res:",t),"SUCCESS"==t.code&&(0,G.nk)({type:"success",message:"保存成功",duration:1e3}),e.compareData=JSON.parse(JSON.stringify(e.db.items)),e.dirty=!1}))["catch"]((function(e){var t=e.data;console.log("e:",e),500==e.status?(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500}):"UNPROCESSABLE_ENTITY"==t.code&&"OVERALL_NOT_SET"==t.msg?(0,G.nk)({type:"error",message:"新建失败，总评未设置",duration:1500}):"UNPROCESSABLE_ENTITY"==t.code&&"有权重为空"==t.msg?(0,G.nk)({type:"error",message:"新建失败，有权重为空",duration:1500}):"UNPROCESSABLE_ENTITY"==t.code&&"权重和不对"==t.msg?(0,G.nk)({type:"error",message:"新建失败，权重和不对",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500})}));(0,G.nk)({type:"error",message:"成绩项或者分值为空",duration:1500})}else(0,G.nk)({type:"error",message:"课程已审核或提交，不可以修改成绩项",duration:1500});else this.saving=!1},toPostData:function(){this.postData.activities.length=0;var e=!0;return e=!(Qo().isEqual(this.compareData,this.db.items)&&!this.dirty),e},goBackandClean:function(){this.db.items=[],this.postData.activities=[],console.log("datas:",this.db.items,this.postData.activities),this.reload()},gobaseCourseDetail:function(){var e=this;console.log("gobaseCourseDetail:"+this.saving+this.dirty),console.log(Qo().isEqual(this.compareData,this.db.items));var t=Qo().isEqual(this.compareData,this.db.items);!t||0==this.saving&&!t?P.s.confirm("数据还未保存，是否仍然关闭？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){console.log("from",e.from),"Score"==e.from?(console.log("go score"),e.$router.push({name:"Score"})):e.$router.push({path:"/baseCourseDetail"})}))["catch"]((function(){})):(console.log("from",this.from),"Score"==this.from?(console.log("go score"),this.$router.push({name:"Score"})):this.$router.push({path:"/baseCourseDetail"}))}},mounted:function(){this.departmentId=this.$store.state.currentInfo.departmentId,this.schoolId=this.$store.state.currentInfo.schoolId,this.courseId=this.$store.state.course.baseCourseCourseId,this.identity=this.$store.state.currentInfo.identity,this.detailId=this.$store.state.course.detailId,"学院管理员"==this.identity?(this.classInfo=this.$store.state.currentInfo.adminSideClassInfo,console.log("identity:",this.identity)):"课程负责人"==this.identity?(this.classInfo=this.$store.state.currentInfo.respondClassInfo,console.log("identity:",this.identity)):(this.classInfo=this.$store.state.currentInfo.teacherSideClassInfo,console.log("identity:",this.identity)),console.log("this.classInfo:",this.classInfo),"1"!=this.classInfo.status&&"4"!=this.classInfo.status||!this.classInfo||this.identity,this.canedit=!0,console.log("this.canedit:",this.canedit),console.log("db items:",this.db.items),console.log("router",this.$route.query["parentName"]),"Score"==this.$route.query["parentName"]?this.from=this.$route.query["parentName"]:this.from="",console.log("from",this.from),this.getActivities()},watch:{dirty:{handler:function(){console.log("dirty changes!",this.dirty)}}}},vc=(0,h.A)(kc,[["render",bc],["__scopeId","data-v-46d349cc"]]),Ic=vc;var yc=function(e){return(0,l.Qi)("data-v-b233312e"),e=e(),(0,l.jt)(),e},Cc={class:"block"},Ac=yc((function(){return(0,l.Lk)("div",{class:"title"},"试卷分析表",-1)})),Fc={class:"card-container"},wc=yc((function(){return(0,l.Lk)("div",{style:{height:"200px"}},[(0,l.Lk)("div",{class:"hot-table-container",id:"courseHot"})],-1)})),Sc={class:"no-class"},_c={class:"no-major-detail"};function Ec(e,t,o,n,r,a){var s=(0,l.g2)("Back"),c=(0,l.g2)("el-icon"),u=(0,l.g2)("el-tooltip"),d=(0,l.g2)("el-divider"),h=(0,l.g2)("DocumentChecked"),f=(0,l.g2)("el-button"),m=(0,l.g2)("el-row"),p=(0,l.g2)("CirclePlus");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",Cc,[(0,l.bF)(m,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.gobaseCourseDetail()})},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1}),Ac,(0,l.bF)(d,{class:"divider",direction:"vertical"}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"保存成绩项",placement:"bottom","hide-after":0,disabled:!a.isValid()},{default:(0,l.k6)((function(){return[(0,l.bF)(f,{onClick:a.save,link:"",style:{"padding-left":"20px"},disabled:!a.isValid()},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{size:"22px",color:"rgb(137, 137, 137)",style:{top:"-1px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(h)]})),_:1})]})),_:1},8,["onClick","disabled"])]})),_:1},8,["disabled"])]})),_:1})]),(0,l.bo)((0,l.Lk)("div",Fc,[(0,l.bF)(u,{class:"box-item",style:{display:"flex"},effect:"dark",content:"添加成绩项",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(f,{onClick:a.addActivities,link:"",style:{padding:"10px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{size:"22px",color:"rgb(137, 137, 137)"},{default:(0,l.k6)((function(){return[(0,l.bF)(p)]})),_:1})]})),_:1},8,["onClick"])]})),_:1}),wc],512),[[i.aG,r.hasObjectives]]),(0,l.bo)((0,l.Lk)("div",Sc,"尚未设置课程目标",512),[[i.aG,!r.hasObjectives]]),(0,l.bo)((0,l.Lk)("div",_c,"请先设置课程目标",512),[[i.aG,!r.hasObjectives]])],64)}o(28706),o(78459);var Nc=o(68561);const Vc={name:"activities",data:function(){return(0,$.A)((0,$.A)({compareData:[],columnChange:0,unsave:!1,paperAnalysisId:"",columnSummaryList:[],showActivities:!0,hasObjectives:!1,objectivesName:["题号","分值"],activityTitleConfirm:!0,originActivityTitle:"",newActivityTitle:"",newActivitydescription:"",originActivitydescription:"",from:"",classInfo:[],identity:"",itemOrValueisEmpty:!1,sortable:"",tempEditabel:"",oldtempEditabel:"",editableTabsValue:"0",currenteditableTabsValue:0,maxeditableTabsValue:0,editableTabs:[],tabIndex:0,colNum:1,activityList:[],departmentId:"",schoolId:"",courseId:"",detailId:"",currentNumberofActivities:0,firstActivities:!0,dirty:!1,saving:!1,count:0,localres:{},postData:{activities:{item:[],value:[],remark:[]},objectives:{object:[],title:[],sum:[],value:[]}},db:{items:[],objectives:[]}},"departmentId",0),"fromCourseBatchAdd",!1)},components:{ref:ce.KR,onMounted:l.sV,reactive:ce.Kh,HotTable:De.sH,HotColumn:De.gQ,registerAllModules:Be.um,ElTooltip:ue.R7,ElIcon:de.tk,ElInput:he.WK,Handsontable:$e.Ay,Back:ee.kcb,FolderChecked:ee.KHk,InfoFilled:ee.N_H,Loading:ee.Rhj,Download:ee.f5X,UploadFilled:ee.m8m,DocumentAdd:ee.pT5,ElMessage:G.nk,ElMessageBox:P.s,Action:p.A,CirclePlus:ee.HxT,DocumentChecked:ee.Fmj,Sortable:gc.Ay,EditPen:ee.EDh,Checked:ee.y$q,CloseBold:ee.QBJ},watch:{columnChange:{deep:!0,handler:function(e){for(var t=1;t<this.db.objectives.length;t++){for(var o="",n=0;n<this.db.objectives[t].length-1;n++)o=String.fromCharCode(66+n)+(t+1)+"+"+o;var r="=SUM("+o.slice(0,-1)+")";this.db.objectives[t][0]=r}this.hotInstance.updateSettings({data:this.db.objectives})}}},methods:{confirmSave:function(e,t){this.activityTitleConfirm=!0,P.s.confirm("是否保存更改后的成绩项名称？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){return console.log("确认"),!1}))["catch"]((function(){console.log("取消")}))},dragTab:function(){var e=this,t=document.querySelector("#drag-tab .el-tabs__nav");console.log("type of tab",(0,O.A)(t),t),this.sortable=gc.Ay.create(t,{animation:150,sort:!0,onChoose:function(t){var o=t.oldIndex,n=JSON.parse(JSON.stringify(e.tempEditabel));e.oldtempEditabel=JSON.parse(JSON.stringify(e.tempEditabel));var r=n[o];console.log("OnChoose currTab:",r),"1"==r["name"]?e.sortable.option("sort",!1):e.sortable.option("sort",!0)},onMove:function(e){if(console.log("evt.related.className",e.related.id),"tab-1"==e.related.id)return!1},onEnd:function(t){var o=t.newIndex,n=t.oldIndex,r=e.tempEditabel.splice(n,1)[0];e.tempEditabel.splice(o,0,r),e.editableTabs=e.tempEditabel,console.log("editableTabs:",e.editableTabs),e.currenteditableTabsValue=Number(e.editableTabsValue),e.hotInstance.updateSettings({data:e.db.items[e.currenteditableTabsValue-1]})}})},tabsContent:function(e,t){console.log(e,t,"双击编辑tabs"),this.unsave=!0,"1"==t&&"教师"==this.identity?(e.inputFlag=!1,(0,G.nk)({type:"error",message:"更新失败，没有权限",duration:1500})):(this.originActivityTitle=e.title,this.newActivityTitle=e.title,this.originActivitydescription=e.description,this.newActivitydescription=e.description,e.inputFlag=!0)},editableTabsValueChange:function(e){var t=this;return this.currenteditableTabsValue=Number(e.props.name),"学院管理员"==this.identity||"课程负责人"==this.identity?(console.log("the teacher can edit the first tab content"),this.hotInstance.updateSettings({data:t.db.items[t.currenteditableTabsValue-1],cells:function(e,t){var o={};return 2===e&&(o.type="dropdown",o.source=[" ","总评","期末"],o.allowEmpty=!0,o.className="ht-s-size"),3===e&&(o.allowEmpty=!1),e<4&&t>=0&&(o.readOnly=!1),o}})):"2"!=this.isRespondent&&1==Number(e.props.name)?(console.log("the teacher can not edit the first tab content"),this.hotInstance.updateSettings({data:t.db.items[t.currenteditableTabsValue-1],contextMenu:!1,cells:function(e,t){var o={};return 2===e&&(o.type="dropdown",o.source=[" ","总评","期末"],o.allowEmpty=!0,o.className="ht-s-size"),3===e&&(o.allowEmpty=!1),t>=0&&(o.readOnly=!0),o}})):(console.log("the teacher can edit the first tab content"),this.hotInstance.updateSettings({data:t.db.items[t.currenteditableTabsValue-1],contextMenu:{items:{col_left:{name:"在左侧插入列"},col_right:{name:"在右侧插入列"},remove_col:{name:"删除列"}}},cells:function(e,t){var o={};return 2===e&&(o.type="dropdown",o.source=[" ","总评","期末"],o.allowEmpty=!0,o.className="ht-s-size"),3===e&&(o.allowEmpty=!1),e<4&&t>=0&&(o.readOnly=!1),o}})),console.log("currenteditableTabsValue:",Number(e.props.name))},handleTabsEdit:function(e,t,o,n){var r=this,a=this;if(console.log("action",t,e),"add"===t&&void 0==e){var s=[""],i=[""],l=[""],c=[""],u=[];u.push(s),u.push(i),u.push(l),u.push(c),this.db.items.push(u);var d=++this.tabIndex+"";this.currenteditableTabsValue=this.tabIndex,this.maxeditableTabsValue=this.tabIndex,this.editableTabs.push({title:"成绩项 "+d,name:d.toString(),value:d,inputFlag:!1,input:"成绩项 "+d,description:""}),this.editableTabsValue=d.toString(),console.log("editableTabs after add ",this.editableTabs),console.log("@@@@@@@@@@@@@@@@",this.hotInstance),this.hotInstance.updateSettings({data:a.db.items[a.currenteditableTabsValue-1]}),this.tempEditabel=JSON.parse(JSON.stringify(this.editableTabs)),console.log("currenteditableTabsValue:",this.currenteditableTabsValue,"maxTabsValue:",this.maxeditableTabsValue)}if("add"===t&&void 0!=e){this.currenteditableTabsValue=this.tabIndex,this.maxeditableTabsValue=this.tabIndex;var h=++this.tabIndex+"";this.editableTabs.push({title:o||"成绩项 "+h,name:h.toString(),value:h,inputFlag:!1,input:o||"成绩项 "+h,description:n}),console.log("editableTabs after add ",this.editableTabs),this.editableTabsValue=h.toString(),this.tempEditabel=JSON.parse(JSON.stringify(this.editableTabs)),console.log("currenteditableTabsValue:",this.currenteditableTabsValue)}"remove"===t&&(console.log("removing targetName:",e),"1"!=e?P.s.confirm("是否确认删除当前成绩项？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){var t=r.editableTabs;console.log("targetName:",e);var o=r.editableTabsValue;o===e&&t.forEach((function(n,r){if(n.name===e){var a=t[r+1]||t[r-1];a&&(o=a.name)}})),r.hotInstance.updateSettings({data:a.db.items[Number(o-1)]});var n={props:{name:Number(o)}};r.editableTabsValueChange(n),r.editableTabsValue=o,r.editableTabs=t.filter((function(t){return t.name!==e})),r.tempEditabel=JSON.parse(JSON.stringify(r.editableTabs)),console.log("editableTabs:",r.editableTabs)}))["catch"]((function(e){console.log("e",e)})):P.s.confirm("此成绩项为不可删除的","注意",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}))},addActivities:function(){console.log("this.db.objectives[0].length",this.db.objectives[0].length),this.db.objectives[0].length<20&&(this.db.objectives.forEach((function(e){e.push(null)})),this.columnChange++,this.hotInstance.updateSettings({data:this.db.objectives}))},activateHotcolumn:function(){var e=this,t=this;console.log("getting getActivities");var o=document.querySelector("#courseHot");console.log("Handsontable init");var n=new $e.Ay(o,{data:e.db.objectives,licenseKey:"non-commercial-and-evaluation",colHeaders:!1,dragToScroll:!0,rowHeaders:e.objectivesName,rowHeaderWidth:70,copyPaste:!0,allowRemoveColumn:!0,colWidths:70,formulas:{engine:Nc.f1},contextMenu:{callback:function(t,o,n){e.columnChange++},items:{col_left:{name:"在左侧插入列"},col_right:{name:"在右侧插入列"},remove_col:{name:"删除列"}}},beforeRemoveCol:function(e,t,o){return console.log(e,t,o),0!=e&&void 0},afterChange:function(t,o){"loadData"!==o&&e.isValid()},afterRemoveCol:function(t,o){e.firstActivities=!1}});t.hotInstance=n,t.hotInstance.updateSettings({data:t.db.objectives,cells:t.getHotCellsFunction()})},getHotCellsFunction:function(){return function(e,t,o){var n={};return 0==e&&(n.allowEmpty=!1),0==t&&(n.readOnly=!0),n}},getActivities:function(){var e=this;Dn(this.paperAnalysisId).then((function(t){if(console.log("getDetailedPaperAnalysis",t),t){e.hasObjectives=!0;var o=t.data.setting;if(o.object.forEach((function(t){e.objectivesName.push(t)})),o.sum){var n=["合计"];e.db.objectives.push(n.concat(o.title));for(var r=0;r<o.sum.length;r++){for(var a=[],s="",i=0;i<o.value[r].length;i++)s=String.fromCharCode(66+i)+(r+2)+"+"+s;console.log("tempLine",s.slice(0,-1));var l="=SUM("+s.slice(0,-1)+")";a.push(l);for(var c=0;c<o.value[r].length;c++)a.push(o.value[r][c]);e.db.objectives.push(a)}for(var u=o.sum.length+1;u<e.objectivesName.length;u++)e.db.objectives.push([""]);console.log("this.db.objectives",e.db.objectives)}else e.db.objectives.push(["合计",""]),e.db.objectives.push(["",""]),o.object.forEach((function(){e.db.objectives.push(["",""])}));e.compareData=JSON.parse(JSON.stringify(e.db.objectives)),e.activateHotcolumn(),e.columnChange++}else e.hasObjectives=!1}))["catch"]((function(e){console.log(e)}))},isValid:function(){var e=this.toPostData();return e},save:function(){var e=this;this.saving=!0,this.postData.objectives={object:[],title:[],sum:[],value:[]};var t=this.isValid();if(t){console.log("this.db.objectives:",this.db.objectives),this.db.objectives[0].slice(1,this.db.objectives[0].length).forEach((function(t){"string"===typeof t?e.postData.objectives.title.push(t.trim()):e.postData.objectives.title.push(t)})),this.postData.objectives.object=this.objectivesName.slice(2,this.objectivesName.length);for(var o=1;o<this.db.objectives.length;o++){var n=this.hotInstance.getDataAtCell(o,0);"string"===typeof n?this.postData.objectives.sum.push(parseFloat(n.trim())):this.postData.objectives.sum.push(parseFloat(n));for(var r=[],a=this.db.objectives[0].length,s=1;s<a;s++)"string"===typeof this.db.objectives[o][s]?r.push(Number(this.db.objectives[o][s].trim())):r.push(Number(this.db.objectives[o][s]));this.postData.objectives.value.push(r)}for(var i=0;i<this.postData.objectives.value.length;i++)for(var l=0;l<this.postData.objectives.value[i].length;l++)this.postData.objectives.value[i][l]||(this.postData.objectives.value[i][l]=null);delete this.postData.objectives["length"],console.log("paperAnalysis postdata:",this.postData.objectives),Tn({setting:this.postData.objectives,detailId:this.detailId,id:this.paperAnalysisId}).then((function(t){console.log("paperAnalysis submit res",t),"SUCCESS"==t.code&&((0,G.nk)({type:"success",message:"更新成功",duration:1500}),e.compareData=JSON.parse(JSON.stringify(e.db.objectives)))}))["catch"]((function(e){500==e.status?(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500})}))}else this.saving=!1},toPostData:function(){this.postData.objectives.length=0;var e=!0;if(this.db.objectives[0]){for(var t=0;t<this.db.objectives[0].length;t++)if(!this.db.objectives[0][t]){e=!1;break}}else e=!1;return e&&Qo().isEqual(this.compareData,this.db.objectives)&&(e=!1),e},gobaseCourseDetail:function(){var e=this;console.log("gobaseCourseDetail:"+this.saving+this.dirty),console.log(Qo().isEqual(this.compareData,this.db.objectives));var t=Qo().isEqual(this.compareData,this.db.objectives);!t||0==this.saving&&!t?P.s.confirm("数据还未保存，是否仍然关闭？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.$router.push({path:"/paperAnalysis"})}))["catch"]((function(){})):this.$router.push({path:"/paperAnalysis"})}},mounted:function(){this.departmentId=this.$store.state.currentInfo.departmentId,this.schoolId=this.$store.state.currentInfo.schoolId,this.courseId=this.$store.state.course.baseCourseCourseId,this.identity=this.$store.state.currentInfo.identity,this.detailId=this.$store.state.course.detailId,this.paperAnalysisId=this.$store.state.course.basecoursePaperAnalysisId,"学院管理员"==this.identity?(this.classInfo=this.$store.state.currentInfo.adminSideClassInfo,console.log("identity:",this.identity)):"课程负责人"==this.identity?(this.classInfo=this.$store.state.currentInfo.respondClassInfo,console.log("identity:",this.identity)):(this.classInfo=this.$store.state.currentInfo.teacherSideClassInfo,console.log("identity:",this.identity)),console.log("db items:",this.db.items),console.log("router",this.$route.query["parentName"]),this.showActivities=!1,this.showPaperAnalysis=!0,this.getActivities()}},xc=(0,h.A)(Vc,[["render",Ec],["__scopeId","data-v-b233312e"]]),Tc=xc;var jc=function(e){return(0,l.Qi)("data-v-43818a18"),e=e(),(0,l.jt)(),e},Lc={class:"content"},Dc={class:"block"},Bc=jc((function(){return(0,l.Lk)("div",{class:"title"},"毕业要求指标点",-1)})),$c={class:"body"},Oc={class:"no-major"},Mc={class:"card"},Uc=jc((function(){return(0,l.Lk)("span",{style:{color:"grey","font-size":"14px"}},"毕业要求指标点",-1)})),Wc={class:"noIndicator"},Rc={class:"attribute-detail"},Pc={class:"detail-num"},Gc={class:"detail-content"},zc={class:"name"},Yc={class:"desc"},Xc={style:{"margin-left":"90px"}},Qc=jc((function(){return(0,l.Lk)("span",{style:{color:"grey","font-size":"14px"}},"支撑方式",-1)})),Kc={class:"methods"};function Jc(e,t,o,n,r,a){var s=(0,l.g2)("Back"),c=(0,l.g2)("el-icon"),u=(0,l.g2)("el-tooltip"),d=(0,l.g2)("el-row"),h=(0,l.g2)("EditPen"),f=(0,l.g2)("el-button"),m=(0,l.g2)("el-col"),p=(0,l.g2)("el-tab-pane"),b=(0,l.g2)("el-tabs");return(0,l.uX)(),(0,l.CE)("div",Lc,[(0,l.Lk)("div",Dc,[(0,l.bF)(d,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.backBaseCourseDetail()})},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1}),Bc]})),_:1})]),(0,l.Lk)("div",$c,[(0,l.bo)((0,l.Lk)("div",Oc,"未加入任何培养方案",512),[[i.aG,!r.hasMajor]]),(0,l.bo)((0,l.Lk)("div",null,[(0,l.bF)(b,{class:"major-tab",style:{width:"750px"},onTabChange:t[1]||(t[1]=function(e){return a.tabChange()}),modelValue:r.chosenMajor,"onUpdate:modelValue":t[2]||(t[2]=function(e){return r.chosenMajor=e})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.majorList,(function(e,t){return(0,l.uX)(),(0,l.Wv)(p,{key:e.majorId,label:e.programVersion},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",Mc,[(0,l.bF)(d,{class:"card-head",style:{"margin-top":"30px"}},{default:(0,l.k6)((function(){return[Uc,(0,l.bo)((0,l.Lk)("div",null,[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"编辑",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"edit-pen",style:{"margin-top":"-15px"},onClick:function(e){return a.goEdit(t)}},{default:(0,l.k6)((function(){return[(0,l.bF)(h)]})),_:2},1032,["onClick"])]})),_:2},1024)],512),[[i.aG,r.hasIndicators[t]]])]})),_:2},1024),(0,l.bo)((0,l.Lk)("div",Wc,[(0,l.bF)(f,{style:{color:"#6573c0"},text:"",onClick:function(e){return a.goEdit(t)}},{default:(0,l.k6)((function(){return[(0,l.eW)("添加考核方式 ")]})),_:2},1032,["onClick"])],512),[[i.aG,!r.hasIndicators[t]]]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.indicators,(function(e){return(0,l.uX)(),(0,l.CE)("div",{class:"attribute",key:e.id},[(0,l.Lk)("div",Rc,[(0,l.Lk)("div",Pc,(0,C.v_)(e.serialNum),1),(0,l.Lk)("div",Gc,[(0,l.Lk)("div",zc,(0,C.v_)(e.name),1),(0,l.Lk)("div",Yc,(0,C.v_)(e.description),1)])]),(0,l.Lk)("div",Xc,[Qc,(0,l.Lk)("div",Kc,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.supportMethodVos,(function(e){return(0,l.uX)(),(0,l.CE)("div",{key:e.id},[(0,l.bF)(d,{class:"method-detail"},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{span:4,class:"method-weight"},{default:(0,l.k6)((function(){return[(0,l.eW)(" ( "+(0,C.v_)(e.weight)+"% ) ",1)]})),_:2},1024),(0,l.bF)(m,{span:18,class:"method-desc"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.description),1)]})),_:2},1024)]})),_:2},1024)])})),128))])])])})),128))])]})),_:2},1032,["label"])})),128))]})),_:1},8,["modelValue"])],512),[[i.aG,r.hasMajor]])])])}const Hc={name:"baseCourseIndicators",components:{Back:ee.kcb,editBtn:Zl,EditPen:ee.EDh},data:function(){return{chosenMajor:"0",course:{name:"",detailId:Number,departmentId:Number,schoolId:Number},majorList:[],programIdList:[],currentProgramId:"",hasIndicators:[],hasMajor:!1}},mounted:function(){this.course.name=this.$store.state.course.courseName,this.course.detailId=this.$store.state.course.detailId,this.course.departmentId=this.$store.state.currentInfo.departmentId,this.course.schoolId=this.$store.state.currentInfo.schoolId,console.log(this.course.name,this.course.detailId),this.checkMajors()},methods:{backBaseCourseDetail:function(){this.$router.push("/baseCourseDetail")},goEdit:function(e){this.$store.commit("baseCourseDetailProgram/setmajorNum",e.toString()),this.$router.push("/baseCourseIndicatorsEdit")},checkMajors:function(){var e=this;gn(this.course.detailId,this.course.departmentId,this.course.schoolId).then((function(t){console.log("!",t),e.majorList=t.data,0==e.majorList.length?e.hasMajor=!1:e.hasMajor=!0,console.log("this.majorList:",e.majorList);for(var o=function(t){ni(e.majorList[t].majorId).then((function(o){e.majorList[t].majorName=o.data.majorName,e.majorList[t].programVersion=e.majorList[t].majorName+"-"+e.majorList[t].enrollyear,console.log("!",(0,O.A)(e.majorList[t].indicators)),e.programIdList[t]=e.majorList[t].programId}))},n=0;n<e.majorList.length;n++)o(n);e.checkIndicators()}))},checkIndicators:function(){for(var e=this,t=function(t){bn(e.majorList[t].bcdmId,e.course.departmentId,e.course.schoolId,e.majorList[t].programId).then((function(o){console.log("getIndicators:",t,o),e.majorList[t].indicators=o.data;for(var n=0;n<e.majorList[t].indicators.length;n++){var r=[];0==e.majorList[t].indicators[n].id.charAt(0)?r[0]=e.majorList[t].indicators[n].id.charAt(1):r[0]=e.majorList[t].indicators[n].id.substring(0,2),0==e.majorList[t].indicators[n].id.charAt(2)?r[1]=e.majorList[t].indicators[n].id.charAt(3):r[1]=e.majorList[t].indicators[n].id.substring(2,4),e.majorList[t].indicators[n].serialNum=r.join(".")}e.currentProgramId=e.programIdList[e.chosenMajor],e.checkPullIndicators(t)}))},o=0;o<this.majorList.length;o++)t(o)},checkPullIndicators:function(e){var t=this;kn(this.currentProgramId).then((function(o){console.log("getPullIndicator",o),null===t.majorList[e].indicators||0==t.majorList[e].indicators.length?t.hasIndicators[e]=!1:t.hasIndicators[e]=!0}))},tabChange:function(){0==this.majorList[this.chosenMajor].indicators.length?this.hasIndicators[this.chosenMajor]=!1:this.hasIndicators[this.chosenMajor]=!0,this.currentProgramId=this.programIdList[this.chosenMajor],this.checkPullIndicators(this.chosenMajor)}}},qc=(0,h.A)(Hc,[["render",Jc],["__scopeId","data-v-43818a18"]]),Zc=qc;var eu=function(e){return(0,l.Qi)("data-v-1d2059f6"),e=e(),(0,l.jt)(),e},tu={class:"content"},ou={class:"head-block"},nu={class:"body"},ru={class:"card"},au=eu((function(){return(0,l.Lk)("span",{style:{color:"grey","font-size":"14px","margin-top":"20px"}},"毕业要求指标点",-1)})),su={class:"attribute-detail"},iu={class:"detail-num"},lu={class:"detail-content"},cu={class:"name"},uu={class:"desc"},du={class:"closeIcon"},hu={key:0,style:{"margin-left":"90px"}},fu={class:"support-head"},mu=eu((function(){return(0,l.Lk)("span",{style:{color:"grey","font-size":"14px"}},"支撑方式",-1)})),pu={class:"penIcon"},bu={class:"methods"},gu={style:{display:"flex","flex-direction":"row"}},ku={style:{"margin-top":"35px"}},vu=eu((function(){return(0,l.Lk)("div",{style:{"margin-top":"50px"}},null,-1)})),Iu={style:{"margin-top":"7px"}},yu={class:"dialog-footer"},Cu={class:"dialog-footer"};function Au(e,t,o,n,r,a){var s=this,c=(0,l.g2)("Back"),u=(0,l.g2)("el-icon"),d=(0,l.g2)("el-tooltip"),h=(0,l.g2)("el-divider"),f=(0,l.g2)("DocumentChecked"),m=(0,l.g2)("el-row"),p=(0,l.g2)("el-col"),b=(0,l.g2)("CopyDocument"),g=(0,l.g2)("Close"),k=(0,l.g2)("EditPen"),v=(0,l.g2)("el-button"),I=(0,l.g2)("Plus"),y=(0,l.g2)("el-autocomplete"),A=(0,l.g2)("el-tab-pane"),F=(0,l.g2)("el-tabs"),w=(0,l.g2)("Edit"),S=(0,l.g2)("el-input"),_=(0,l.g2)("el-option"),E=(0,l.g2)("el-select"),N=(0,l.g2)("el-dialog"),V=(0,l.g2)("DrawerSearch"),x=(0,l.g2)("el-table-column"),T=(0,l.g2)("el-table"),j=(0,l.g2)("el-drawer");return(0,l.uX)(),(0,l.CE)("div",tu,[(0,l.Lk)("div",ou,[(0,l.bF)(m,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"icon",size:"24px",style:{"margin-left":"50px"},color:"rgb(137, 137, 137)",onClick:t[0]||(t[0]=function(e){return a.back()})},{default:(0,l.k6)((function(){return[(0,l.bF)(c)]})),_:1})]})),_:1}),(0,l.bF)(h,{class:"divider",direction:"vertical"}),(0,l.bF)(d,{class:"box-item",effect:"dark",content:"保存",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"icon",color:"rgb(137, 137, 137)",size:"24px",style:{"margin-left":"10px"},onClick:t[1]||(t[1]=function(e){return a.judgeBeforeSave()})},{default:(0,l.k6)((function(){return[(0,l.bF)(f)]})),_:1})]})),_:1})]})),_:1})]),(0,l.Lk)("div",nu,[(0,l.bF)(F,{class:"major-tab",modelValue:r.chosenMajor,"onUpdate:modelValue":t[7]||(t[7]=function(e){return r.chosenMajor=e}),onTabChange:t[8]||(t[8]=function(e){return a.tabChange()})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.majorList,(function(e,o){return(0,l.uX)(),(0,l.Wv)(A,{modelValue:r.chosenMajor,"onUpdate:modelValue":t[6]||(t[6]=function(e){return r.chosenMajor=e}),key:e.majorId,label:e.programVersion},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",ru,[(0,l.bF)(m,{style:{"margin-top":"30px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{span:22},{default:(0,l.k6)((function(){return[au]})),_:1}),(0,l.bF)(p,{span:2},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{class:"box-item",effect:"dark",content:"从其他大纲复制",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",onClick:t[2]||(t[2]=function(e){return a.openDrawer()})},{default:(0,l.k6)((function(){return[(0,l.bF)(b)]})),_:1})]})),_:1})]})),_:1})]})),_:1}),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.indicators,(function(e,t){return(0,l.uX)(),(0,l.CE)("div",{class:"attribute",key:e.id},[(0,l.Lk)("div",su,[(0,l.Lk)("div",iu,(0,C.v_)(e.serialNum),1),(0,l.Lk)("div",lu,[(0,l.Lk)("div",cu,(0,C.v_)(e.name),1),(0,l.Lk)("div",uu,(0,C.v_)(e.description),1)]),(0,l.Lk)("div",du,[(0,l.bF)(u,{class:"close-icon",onClick:function(t){return a.deleteIndicator(e,o)}},{default:(0,l.k6)((function(){return[(0,l.bF)(g)]})),_:2},1032,["onClick"])])]),0!==e.supportMethodVos.length?((0,l.uX)(),(0,l.CE)("div",hu,[(0,l.Lk)("div",fu,[mu,(0,l.Lk)("div",pu,[(0,l.bF)(u,{class:"pen-icon",onClick:function(n){return a.editSupportMethods(e,o,t)}},{default:(0,l.k6)((function(){return[(0,l.bF)(k)]})),_:2},1032,["onClick"])])]),(0,l.Lk)("div",bu,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.supportMethodVos,(function(e){return(0,l.uX)(),(0,l.CE)("div",{key:e.id},[(0,l.bF)(m,{class:"method-detail"},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{span:4,class:"method-weight"},{default:(0,l.k6)((function(){return[(0,l.eW)(" ( "+(0,C.v_)(e.weight)+"% ) ",1)]})),_:2},1024),(0,l.bF)(p,{span:18,class:"method-desc"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.description),1)]})),_:2},1024)]})),_:2},1024)])})),128))])])):(0,l.Q3)("",!0),0===e.supportMethodVos.length?((0,l.uX)(),(0,l.Wv)(m,{key:1,class:"noSupport"},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",null,[(0,l.bF)(v,{style:{color:"#6573c0"},text:"",onClick:function(n){return a.newSupportPart(e,o,t)}},{default:(0,l.k6)((function(){return[(0,l.eW)("添加支撑方式 ")]})),_:2},1032,["onClick"])])]})),_:2},1024)):(0,l.Q3)("",!0)])})),128)),(0,l.bo)((0,l.bF)(v,{class:"add-indicator-button",style:{color:"#6573c0"},text:"",onClick:t[3]||(t[3]=function(e){return s.newIndicator=!0})},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{size:18,color:"#586dbe"},{default:(0,l.k6)((function(){return[(0,l.bF)(I)]})),_:1}),(0,l.eW)(" 新增支持指标点 ")]})),_:1},512),[[i.aG,!r.newIndicator]]),(0,l.bo)((0,l.Lk)("div",gu,[(0,l.bF)(y,{"popper-class":"el-autocomplete-suggestion","popper-append-to-body":!1,modelValue:r.searchValue,"onUpdate:modelValue":t[4]||(t[4]=function(e){return r.searchValue=e}),"fetch-suggestions":a.querySearch,placeholder:"选择指标点（筛选可输入文字或指标点编号，如：1.2）",style:{width:"680px","margin-left":"20px","margin-top":"30px"},"fit-input-width":!0,onSelect:function(e){return a.addIndicator(r.searchValue,o)}},null,8,["modelValue","fetch-suggestions","onSelect"]),(0,l.Lk)("div",ku,[(0,l.bF)(u,{class:"autocomplete-icon",onClick:t[5]||(t[5]=function(e){return s.newIndicator=!1})},{default:(0,l.k6)((function(){return[(0,l.bF)(g)]})),_:1})])],512),[[i.aG,r.newIndicator]])])]})),_:2},1032,["modelValue","label"])})),128))]})),_:1},8,["modelValue"])]),(0,l.Lk)("div",null,[(0,l.bF)(N,{modelValue:r.dialogFormVisible,"onUpdate:modelValue":t[12]||(t[12]=function(e){return r.dialogFormVisible=e}),title:"设置支撑方式",width:"680px","show-close":!1,"align-center":!0},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",yu,[(0,l.bF)(v,{onClick:t[10]||(t[10]=function(e){return r.dialogFormVisible=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(v,{type:"primary",onClick:t[11]||(t[11]=function(e){return a.confirmAddSupport(r.dialogIndicator)})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(m,{style:{"margin-bottom":"10px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{span:1}),(0,l.bF)(p,{span:4,class:"indicator-name"},{default:(0,l.k6)((function(){return[(0,l.eW)("指标点"+(0,C.v_)(r.dialogIndicator.serialNum),1)]})),_:1}),(0,l.bF)(p,{span:19,class:"indicator-desc"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(r.dialogIndicator.description),1)]})),_:1})]})),_:1}),vu,((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.dialogIndicator.supportMethodVos,(function(e,t){return(0,l.uX)(),(0,l.Wv)(m,{class:"assessment",key:t,style:{"margin-top":"30px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{span:1}),(0,l.bo)((0,l.bF)(p,{span:4,class:"showWeight"},{default:(0,l.k6)((function(){return[(0,l.bF)(m,null,{default:(0,l.k6)((function(){return[(0,l.bF)(p,{span:12},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.weight)+"% ",1)]})),_:2},1024),(0,l.bF)(p,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{onClick:function(t){return a.editWeight(e)}},{default:(0,l.k6)((function(){return[(0,l.bF)(w)]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1536),[[i.aG,!e.isEditWeight]]),(0,l.bo)((0,l.bF)(p,{span:4,class:"editWeight"},{default:(0,l.k6)((function(){return[(0,l.bF)(m,null,{default:(0,l.k6)((function(){return[(0,l.bF)(p,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(S,{modelValue:e.weight,"onUpdate:modelValue":function(t){return e.weight=t},onKeyup:(0,i.jR)((function(t){return a.saveWeight(e)}),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]})),_:2},1024),(0,l.bF)(p,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{onClick:function(t){return a.saveWeight(e)}},{default:(0,l.k6)((function(){return[(0,l.bF)(f)]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1536),[[i.aG,e.isEditWeight]]),(0,l.bF)(p,{span:18},{default:(0,l.k6)((function(){return[(0,l.bF)(E,{modelValue:e.description,"onUpdate:modelValue":function(t){return e.description=t},style:{width:"450px"},placeholder:"课程目标"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.objectives,(function(e){return(0,l.uX)(),(0,l.Wv)(_,{key:e.id,label:e.complete,value:e.description},null,8,["label","value"])})),128))]})),_:2},1032,["modelValue","onUpdate:modelValue"])]})),_:2},1024),(0,l.bF)(p,{span:1},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",Iu,[(0,l.bF)(u,{onClick:function(t){return a.deleteSupport(e)}},{default:(0,l.k6)((function(){return[(0,l.bF)(g)]})),_:2},1032,["onClick"])])]})),_:2},1024)]})),_:2},1024)})),128)),(0,l.bF)(v,{class:"add-support-button",style:{color:"#6573c0","margin-top":"30px"},text:"",onClick:t[9]||(t[9]=function(e){return a.addSupport()})},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{size:18,color:"#586dbe"},{default:(0,l.k6)((function(){return[(0,l.bF)(I)]})),_:1}),(0,l.eW)(" 新增课程目标 ")]})),_:1})]})),_:1},8,["modelValue"])]),(0,l.bF)(j,{modelValue:r.drawer,"onUpdate:modelValue":t[15]||(t[15]=function(e){return r.drawer=e})},{default:(0,l.k6)((function(){return[(0,l.bF)(m,null,{default:(0,l.k6)((function(){return[(0,l.bF)(p,{span:14},{default:(0,l.k6)((function(){return[(0,l.bF)(V,{msg:"搜索专业名称",onSearchValue:a.getSearchValue},null,8,["onSearchValue"])]})),_:1}),(0,l.bF)(p,{span:10},{default:(0,l.k6)((function(){return[(0,l.bF)(E,{modelValue:r.year,"onUpdate:modelValue":t[13]||(t[13]=function(e){return r.year=e}),placeholder:"选择培养方案版本",clearable:"",onChange:t[14]||(t[14]=function(e){return a.getCopyProgram()})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.enroll_year,(function(e){return(0,l.uX)(),(0,l.Wv)(_,{key:e.dictValue,label:e.dictLabel,value:e.dictLabel},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1})]})),_:1}),(0,l.bF)(m,{style:{"margin-top":"40px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(T,{data:r.programList,style:{width:"100%"}},{default:(0,l.k6)((function(){return[(0,l.bF)(x,{type:"expand"},{default:(0,l.k6)((function(e){return[(0,l.bF)(T,{data:e.row.baseCourseAndDetailVoList,onRowClick:a.copyCourse},{default:(0,l.k6)((function(){return[(0,l.bF)(x,{label:"课程名",prop:"courseName"}),(0,l.bF)(x,{label:"课程号",prop:"courseCode"}),(0,l.bF)(x,{label:"版本",prop:"bcDetails[0].versionName"})]})),_:2},1032,["data","onRowClick"])]})),_:1}),(0,l.bF)(x,{prop:"majorName",label:"专业名称","min-width":"180px"}),(0,l.bF)(x,{prop:"enrollyear",label:"版本","min-width":"180px"})]})),_:1},8,["data"])]})),_:1})]})),_:1},8,["modelValue"]),(0,l.bF)(N,{modelValue:r.dialogVisible,"onUpdate:modelValue":t[18]||(t[18]=function(e){return r.dialogVisible=e}),title:"从其他大纲复制",width:"400px"},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",Cu,[(0,l.bF)(v,{onClick:t[16]||(t[16]=function(e){return r.dialogVisible=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(v,{type:"primary",onClick:t[17]||(t[17]=function(e){return a.copyInfo()})},{default:(0,l.k6)((function(){return[(0,l.eW)("确认")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(m,{style:{"margin-bottom":"20px","font-size":"15px"}},{default:(0,l.k6)((function(){return[(0,l.eW)("从《"+(0,C.v_)(r.currentRow.courseName)+"》"+(0,C.v_)(r.currentRow.bcDetails[0].versionName)+"大纲复制毕业要求指标点",1)]})),_:1})]})),_:1},8,["modelValue"])])}const Fu={name:"baseCourseIndicatorsEdit",components:{DrawerSearch:pn,Back:ee.kcb,DocumentChecked:ee.Fmj,Plus:ee.FWt,Delete:ee.epd,Close:ee.bm,EditPen:ee.EDh,Edit:ee.ffu,CopyDocument:ee.TZn},data:function(){return{currentRow:[],dialogVisible:!1,programCourse:[],programList:[],year:"",keyword:"",enroll_year:[],drawer:!1,searchValue:"",allIndicators:[],newIndicator:!1,chosenMajor:"0",course:{name:"",detailId:Number,departmentId:Number,schoolId:Number},majorList:[],currentProgramId:"",programIdList:[],majorListCopy:[],programId:Number,index1:Number,index2:Number,dialogFormVisible:!1,dialogIndicator:{},objectives:[],successNum:0,canSave:!0,wrongNum:0}},computed:{currentProgramIdChange:function(){return this.currentProgramId}},watch:{currentProgramIdChange:{deep:!0,handler:function(e){this.checkPullIndicators()}}},mounted:function(){this.course.name=this.$store.state.course.courseName,this.course.detailId=this.$store.state.course.detailId,this.course.departmentId=this.$store.state.currentInfo.departmentId,this.course.schoolId=this.$store.state.currentInfo.schoolId,this.chosenMajor=this.$store.state.baseCourseDetailProgram.majorNum,this.checkMajors(),this.checkObjectives(),this.getDictionary()},methods:{back:function(){var e=this;console.log(this.majorListCopy,this.majorList,JSON.stringify(this.majorListCopy)===JSON.stringify(this.majorList)),JSON.stringify(this.majorListCopy)!==JSON.stringify(this.majorList)?P.s.confirm("数据还未保存，是否仍然关闭？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.$router.push("/baseCourseIndicators")}))["catch"]((function(){})):this.$router.push("/baseCourseIndicators")},judgeBeforeSave:function(){var e=this;this.wrongNum=0,this.majorList.forEach((function(t){t.indicators.forEach((function(t){t.supportMethods=t.supportMethodVos,0==t.supportMethods.length&&(e.wrongNum=e.wrongNum+1)}))})),this.wrongNum>0?(this.canSave=!1,G.nk.error("请为指标点添加支撑方式")):this.canSave=!0,this.canSave&&this.save()},save:function(){var e=this;this.successNum=0,this.majorList.forEach((function(t){t.indicators.forEach((function(e){e.supportMethods=e.supportMethodVos})),console.log("保存内容",t),t.courseIndicators=t.indicators,Cn(t).then((function(t){console.log("save",t),"SUCCESS"===t.code?(e.successNum=e.successNum+1,(0,G.nk)({type:"success",message:"更新成功",duration:1500}),e.majorListCopy=JSON.parse(JSON.stringify(e.majorList)),e.back()):(0,G.nk)({type:"error",message:"更新失败",duration:1500})}))["catch"]((function(e){500==e.status&&(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500})}))}))},getDictionary:function(){var e=this;qt().then((function(t){console.log("getDictionary",t),e.enroll_year=t.enroll_year}))},checkMajors:function(){var e=this;gn(this.course.detailId,this.course.departmentId,this.course.schoolId).then((function(t){e.majorList=t.data,console.log("this.majorList:",e.majorList);for(var o=function(t){ni(e.majorList[t].majorId).then((function(o){e.majorList[t].majorName=o.data.majorName,e.majorList[t].programVersion=e.majorList[t].majorName+"-"+e.majorList[t].enrollyear,e.programIdList[t]=e.majorList[t].programId}))},n=0;n<e.majorList.length;n++)o(n);e.checkIndicators()}))},checkIndicators:function(){for(var e=this,t=function(t){bn(e.majorList[t].bcdmId,e.course.departmentId,e.course.schoolId,e.majorList[t].programId).then((function(o){console.log("getIndicators:",t,o),e.majorList[t].indicators=o.data,e.majorList[t].schoolId=e.course.schoolId,e.majorList[t].departmentId=e.course.departmentId;for(var n=0;n<e.majorList[t].indicators.length;n++){var r=[];0==e.majorList[t].indicators[n].id.charAt(0)?r[0]=e.majorList[t].indicators[n].id.charAt(1):r[0]=e.majorList[t].indicators[n].id.substring(0,2),0==e.majorList[t].indicators[n].id.charAt(2)?r[1]=e.majorList[t].indicators[n].id.charAt(3):r[1]=e.majorList[t].indicators[n].id.substring(2,4),e.majorList[t].indicators[n].serialNum=r.join(".")}e.majorList[t].indicators.forEach((function(e){e.supportMethodVos.forEach((function(e){e.isEditWeight=!1,console.log("展示的item",e)}))})),e.currentProgramId=e.programIdList[e.chosenMajor],e.majorListCopy=JSON.parse(JSON.stringify(e.majorList))}))},o=0;o<this.majorList.length;o++)t(o)},checkObjectives:function(){var e=this;vn(this.course.detailId).then((function(t){e.objectives=t.data.objectives,console.log("this.objectives",e.objectives),e.objectives&&e.objectives.forEach((function(e){"0"==e.id.charAt(0)?e.serialNum=e.id.charAt(1):e.serialNum=e.id,e.complete="课程目标"+e.serialNum+"："+e.description})),console.log("objectives:",e.objectives)}))},deleteIndicator:function(e,t){var o=this;this.index1=t,P.s.confirm("是否确认删除指标点"+e.serialNum+"?","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){o.majorList[t].indicators.pop(e)}))},editSupportMethods:function(e,t,o){console.log("editSupportMethods",e,o),this.index1=t,this.index2=o,this.dialogIndicator=JSON.parse(JSON.stringify(e)),console.log("indicator",this.dialogIndicator),this.dialogFormVisible=!0},deleteSupport:function(e){this.dialogIndicator.supportMethodVos.pop(e)},addSupport:function(){var e={name:"",weight:0,isEditWeight:!1,description:"",id:""};this.dialogIndicator.supportMethodVos.push(e)},newSupportPart:function(e,t,o){this.index1=t,this.index2=o,this.dialogIndicator=JSON.parse(JSON.stringify(e)),this.dialogFormVisible=!0},addIndicator:function(e,t){var o=this;try{var n=e.split(" ");if(4==n.length){this.majorList[t].indicators.forEach((function(e){if(e.serialNum==n[2])throw G.nk.error("指标点"+n[2]+"已存在"),o.searchValue="","true"}));var r={supportMethodVos:[]};r.achievement=Number,r.name=n[1],r.description=n[3],r.serialNum=n[2];var a=n[2].split(".");Number(a[0])>9?r.id=a[0]:r.id="0"+a[0],Number(a[1])>9?r.id=r.id+a[1]:r.id=r.id+"0"+a[1],this.majorList[t].indicators.push(r),this.newIndicator=!1,this.searchValue="",console.log("newIndicator",r)}if(3==n.length){this.majorList[t].indicators.forEach((function(e){if(e.serialNum==n[1])throw G.nk.error("指标点"+n[1]+"已存在"),o.searchValue="","true"}));var s={supportMethodVos:[]};s.achievement=Number,s.name="",s.description=n[2],s.serialNum=n[1];var i=n[1].split(".");Number(i[0])>9?s.id=i[0]:s.id="0"+i[0],Number(i[1])>9?s.id=s.id+i[1]:(chosenMajor,s.id=s.id+"0"+i[1]),this.majorList[t].indicators.push(s),this.newIndicator=!1,this.searchValue="",console.log("newIndicator",s)}}catch(l){if("true"==l)return}},checkPullIndicators:function(){var e=this;kn(this.currentProgramId).then((function(t){console.log("getPullIndicator",t),e.allIndicators[e.chosenMajor]=t.data}))},querySearch:function(e,t){var o=this.allIndicators,n=e?o.filter(this.createStateFilter(e)):o;console.log("result",n),n.forEach((function(e){e.map((function(e){return null===e.requirementName?(console.log("sange",e),e.value="毕业要求"+e.requirementSerialNum+" "+e.indicatorSerialNum+" "+e.indicatorDescription):(console.log("四个",e),e.value="毕业要求"+e.requirementSerialNum+" "+e.requirementName+" "+e.indicatorSerialNum+" "+e.indicatorDescription)}))})),n=n[0],console.log("result后",n),t(n),clearTimeout(this.timeout),this.timeout=setTimeout((function(){t(n)}),3e3*Math.random())},createStateFilter:function(e){return function(t){return-1!==t.value.toLowerCase().indexOf(e.toLowerCase())}},editWeight:function(e){e.isEditWeight=!0},saveWeight:function(e){Number(e.weight)>100||Number(e.weight)<=0?G.nk.error("权重范围在1%-100%"):e.isEditWeight=!1},confirmAddSupport:function(e){var t=this,o=0,n=!1,r=!1;e.supportMethodVos.forEach((function(e){t.objectives.forEach((function(t){t.description==e.description&&(e.id=t.id,e.serialNum=t.serialNum,console.log("赋id,serialNum后的item",e))})),o+=Number(e.weight),""==e.description&&(n=!0),"0"==e.weight&&(r=!0)})),1==r&&G.nk.error("权重范围在1%-100%"),100!==o&&G.nk.error("权重之和必须为100%"),1==n&&G.nk.error("请为支持方式选择课程目标"),100==o&&0==n&&0==r&&(this.majorList[this.index1].indicators[this.index2].supportMethodVos=this.dialogIndicator.supportMethodVos,console.log("~",this.majorList[this.index1].indicators[this.index2].supportMethodVos),this.dialogFormVisible=!1)},tabChange:function(){this.currentProgramId=this.programIdList[this.chosenMajor],console.log(this.programIdList),console.log("tab","currentProgramId",this.currentProgramId,"chosen",this.chosenMajor)},openDrawer:function(){this.drawer=!0},getCopyProgram:function(){var e=this;Fe(this.course.schoolId,this.course.departmentId,this.keyword,this.year).then((function(t){e.programList=t.rows,console.log("查询对应的专业 ",e.programList)}))},getSearchValue:function(e){this.keyword=e,this.getCopyProgram()},copyCourse:function(e){console.log("copyCourse",e),this.currentRow=e,this.dialogVisible=!0},copyInfo:function(){var e=this,t={};t.sourcebcdmId=this.currentRow.bcDetails[0].bcDetailProgramVoList[0].bcdmId,t.targetbcdmId=this.majorList[this.chosenMajor].bcdmId,Nn(t).then((function(t){console.log("copyIndicator",t),e.dialogVisible=!1,"SUCCESS"==t.code&&((0,G.nk)({type:"success",message:"复制成功",duration:1500}),e.drawer=!1)}))}}},wu=(0,h.A)(Fu,[["render",Au],["__scopeId","data-v-1d2059f6"]]),Su=wu;var _u=function(e){return(0,l.Qi)("data-v-51f91944"),e=e(),(0,l.jt)(),e},Eu={class:"content"},Nu={class:"block"},Vu={class:"edit-body"},xu={class:"card"},Tu={class:"num-title"},ju={class:"num-wrap"},Lu={class:"title-text"},Du=_u((function(){return(0,l.Lk)("section",{class:"rotate-bar"},null,-1)})),Bu={class:"objective-name"},$u={class:"objective-description"},Ou=_u((function(){return(0,l.Lk)("span",{style:{color:"grey","font-size":"14px"}},"考核方式",-1)})),Mu=_u((function(){return(0,l.Lk)("div",{style:{height:"20px"}},null,-1)})),Uu={class:"closeIcon"},Wu={class:"dialog-footer"};function Ru(e,t,o,n,r,a){var s=this,c=(0,l.g2)("Back"),u=(0,l.g2)("el-icon"),d=(0,l.g2)("el-tooltip"),h=(0,l.g2)("el-divider"),f=(0,l.g2)("DocumentChecked"),m=(0,l.g2)("el-row"),p=(0,l.g2)("el-alert"),b=(0,l.g2)("el-col"),g=(0,l.g2)("el-input"),k=(0,l.g2)("el-form-item"),v=(0,l.g2)("EditPen"),I=(0,l.g2)("el-button"),y=(0,l.g2)("Plus"),A=(0,l.g2)("Delete"),F=(0,l.g2)("el-form"),w=(0,l.g2)("Edit"),S=(0,l.g2)("el-cascader"),_=(0,l.g2)("Close"),E=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)("div",Eu,[(0,l.Lk)("div",Nu,[(0,l.bF)(m,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.backObjectives()})},{default:(0,l.k6)((function(){return[(0,l.bF)(c)]})),_:1})]})),_:1}),(0,l.bF)(h,{class:"divider",direction:"vertical"}),(0,l.bF)(d,{class:"box-item",effect:"dark",content:"保存",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",onClick:t[1]||(t[1]=function(e){return a.judgeBeforeSave()}),style:{"margin-left":"10px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(f)]})),_:1})]})),_:1})]})),_:1})]),(0,l.Lk)("div",Vu,[(0,l.Lk)("div",xu,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(this.info,(function(e,t){return(0,l.uX)(),(0,l.CE)("div",{key:t},[(0,l.bF)(p,{title:e,type:"error",closable:!1,"show-icon":"",style:{width:"300px","margin-top":"5px","margin-left":"30px"}},null,8,["title"])])})),128)),(0,l.bF)(F,{model:r.objectives,ref:"objectives","label-position":"top"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.objectives,(function(e,t){return(0,l.uX)(),(0,l.Wv)(b,{key:e.id},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{style:{"margin-top":"0px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{span:3,class:"two-digits",style:{"padding-left":"16px"}},{default:(0,l.k6)((function(){return[(0,l.Lk)("section",Tu,[(0,l.Lk)("section",ju,[(0,l.Lk)("span",Lu,(0,C.v_)(e.serialNum),1)]),Du])]})),_:2},1024),(0,l.bF)(b,{span:20},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.Lk)("div",null,[(0,l.bF)(k,{label:"课程目标",class:"title"},{default:(0,l.k6)((function(){return[(0,l.bF)(g,{modelValue:e.name,"onUpdate:modelValue":function(t){return e.name=t},placeholder:"课程目标"},null,8,["modelValue","onUpdate:modelValue"])]})),_:2},1024),(0,l.bF)(k,{label:"达成途径",class:"title",style:{"margin-top":"30px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(g,{modelValue:e.description,"onUpdate:modelValue":function(t){return e.description=t},rows:3,type:"textarea",maxlength:"1000",placeholder:"达成途径"},null,8,["modelValue","onUpdate:modelValue"])]})),_:2},1024)],512),[[i.aG,"学院管理员"===s.$store.state.currentInfo.identity||"课程负责人"===s.$store.state.currentInfo.identity]]),(0,l.bo)((0,l.Lk)("div",null,[(0,l.Lk)("div",Bu,(0,C.v_)(e.name),1),(0,l.Lk)("div",$u,(0,C.v_)(e.description),1)],512),[[i.aG,"教师"===s.$store.state.currentInfo.identity]]),(0,l.bF)(m,{style:{"margin-top":"20px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{span:22},{default:(0,l.k6)((function(){return[Ou]})),_:1}),(0,l.bF)(b,{span:2,class:"penIcon"},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"pen-icon",onClick:function(o){return a.editAssessments(e,t)}},{default:(0,l.k6)((function(){return[(0,l.bF)(v)]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024),0!==e.assessmentMethods.length?((0,l.uX)(),(0,l.Wv)(m,{key:0},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.assessmentMethods,(function(e,t){return(0,l.uX)(),(0,l.Wv)(b,{span:23,key:t,class:"assessments"},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{class:"assessment"},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{span:5},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.name),1)]})),_:2},1024),(0,l.bF)(b,{span:5},{default:(0,l.k6)((function(){return[(0,l.eW)("( "+(0,C.v_)(e.weight)+"% )",1)]})),_:2},1024),(0,l.bF)(b,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(m,null,{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.activities.item,(function(e,t){return(0,l.uX)(),(0,l.Wv)(b,{span:6,key:t},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e),1)]})),_:2},1024)})),128))]})),_:2},1024)]})),_:2},1024)]})),_:2},1024)]})),_:2},1024)})),128))]})),_:2},1024)):(0,l.Q3)("",!0),0==e.assessmentMethods.length?((0,l.uX)(),(0,l.Wv)(m,{key:1,class:"noAssessment"},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",null,[(0,l.bF)(I,{style:{color:"#6573c0"},text:"",onClick:function(o){return a.newAssessmentPart(e,t)}},{default:(0,l.k6)((function(){return[(0,l.eW)("添加考核方式 ")]})),_:2},1032,["onClick"])])]})),_:2},1024)):(0,l.Q3)("",!0)]})),_:2},1024)]})),_:2},1024),Mu]})),_:2},1024)})),128)),(0,l.bo)((0,l.bF)(m,{class:"attribute-Btn"},{default:(0,l.k6)((function(){return[(0,l.bF)(I,{style:{color:"#6573c0"},text:"",onClick:t[2]||(t[2]=function(e){return a.addObject()})},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{size:18,color:"#6573c0"},{default:(0,l.k6)((function(){return[(0,l.bF)(y)]})),_:1}),(0,l.eW)(" 新增课程目标 ")]})),_:1}),(0,l.bo)((0,l.bF)(I,{type:"danger",text:"",onClick:t[3]||(t[3]=function(e){return a.deleteObject()})},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{size:18,color:"#ff0000"},{default:(0,l.k6)((function(){return[(0,l.bF)(A)]})),_:1}),(0,l.eW)(" 删除课程目标"+(0,C.v_)(r.deleteSerialNum),1)]})),_:1},512),[[i.aG,r.canDelete]])]})),_:1},512),[[i.aG,"学院管理员"===s.$store.state.currentInfo.identity||"课程负责人"===s.$store.state.currentInfo.identity]])]})),_:1},8,["model"])])]),(0,l.Lk)("div",null,[(0,l.bF)(E,{modelValue:r.dialogFormVisible,"onUpdate:modelValue":t[7]||(t[7]=function(e){return r.dialogFormVisible=e}),title:"设置考核方式",width:"680px","show-close":!1,"align-center":!0},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",Wu,[(0,l.bF)(I,{onClick:t[5]||(t[5]=function(e){return r.dialogFormVisible=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(I,{type:"primary",onClick:t[6]||(t[6]=function(e){return a.confirmAddAssessment(r.dialogObject)})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(m,{style:{"margin-bottom":"10px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{span:3,class:"object-name"},{default:(0,l.k6)((function(){return[(0,l.eW)("课程目标"+(0,C.v_)(r.dialogObject.serialNum)+"： ",1)]})),_:1}),(0,l.bF)(b,{span:20,class:"object-name"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(r.dialogObject.name),1)]})),_:1})]})),_:1}),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.dialogObject.assessmentMethods,(function(e,t){return(0,l.uX)(),(0,l.Wv)(m,{class:"assessment",key:t},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{span:1}),(0,l.bo)((0,l.bF)(b,{span:4,class:"showWeight"},{default:(0,l.k6)((function(){return[(0,l.bF)(m,null,{default:(0,l.k6)((function(){return[(0,l.bF)(b,{span:10},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.weight)+"% ",1)]})),_:2},1024),(0,l.bF)(b,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{onClick:function(t){return a.editWeight(e)}},{default:(0,l.k6)((function(){return[(0,l.bF)(w)]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1536),[[i.aG,!e.isEditWeight]]),(0,l.bo)((0,l.bF)(b,{span:4,class:"editWeight"},{default:(0,l.k6)((function(){return[(0,l.bF)(m,null,{default:(0,l.k6)((function(){return[(0,l.bF)(b,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(g,{modelValue:e.weight,"onUpdate:modelValue":function(t){return e.weight=t},onKeyup:(0,i.jR)((function(t){return a.saveWeight(e)}),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]})),_:2},1024),(0,l.bF)(b,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{onClick:function(t){return a.saveWeight(e)}},{default:(0,l.k6)((function(){return[(0,l.bF)(f)]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1536),[[i.aG,e.isEditWeight]]),(0,l.bF)(b,{span:4},{default:(0,l.k6)((function(){return[(0,l.bF)(g,{placeholder:"考核方式",modelValue:e.name,"onUpdate:modelValue":function(t){return e.name=t},width:"50px"},null,8,["modelValue","onUpdate:modelValue"])]})),_:2},1024),(0,l.bF)(b,{span:1}),(0,l.bF)(b,{span:13},{default:(0,l.k6)((function(){return[(0,l.bF)(S,{modelValue:e.activities.frontItem,"onUpdate:modelValue":function(t){return e.activities.frontItem=t},options:r.allOfAll,props:r.props,placeholder:"成绩项",style:{width:"330px"}},null,8,["modelValue","onUpdate:modelValue","options","props"])]})),_:2},1024),(0,l.bF)(b,{span:1},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",Uu,[(0,l.bF)(u,{class:"close-icon",onClick:function(t){return a.deleteAssessment(e)}},{default:(0,l.k6)((function(){return[(0,l.bF)(_)]})),_:2},1032,["onClick"])])]})),_:2},1024)]})),_:2},1024)})),128)),(0,l.bF)(I,{class:"add-assessment-button",style:{color:"#6573c0","margin-top":"10px"},text:"",onClick:t[4]||(t[4]=function(e){return a.addAssessment()})},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{size:18,color:"#586dbe"},{default:(0,l.k6)((function(){return[(0,l.bF)(y)]})),_:1}),(0,l.eW)(" 新增考核方式 ")]})),_:1})]})),_:1},8,["modelValue"])])])}const Pu={name:"baseCourseObjectivesEdit",components:{Back:ee.kcb,DocumentChecked:ee.Fmj,EditPen:ee.EDh,Plus:ee.FWt,Delete:ee.epd,Close:ee.bm,Edit:ee.ffu},data:function(){return{classId:"",map:{},props:{multiple:!0},info:[],course:{name:"",detailId:Number,departmentId:Number,schoolId:Number},list:[],listCopy:[],objectives:[],assessmentMethods:[],dialogFormVisible:!1,chosenActivityItems:[[]],dialogObject:{},index:Number,deleteSerialNum:"",activities:{},allActivities:{},allOfAll:[],isEditWeight:!1,isChange:!1,canDelete:!1}},watch:{list:{deep:!0,handler:function(){this.isChange=!0}}},mounted:function(){this.course.name=this.$store.state.course.courseName,this.course.detailId=this.$store.state.course.detailId,this.checkObjectives()},methods:{backObjectives:function(){var e=this;JSON.stringify(this.listCopy)!==JSON.stringify(this.list)?P.s.confirm("数据还未保存，是否仍然关闭？","注意",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){"学院管理员"==e.$store.state.currentInfo.identity||"课程负责人"==e.$store.state.currentInfo.identity?e.$router.push("/baseCourseObjectives"):e.$router.push({name:"Objectives"})}))["catch"]((function(){})):"学院管理员"==this.$store.state.currentInfo.identity||"课程负责人"==this.$store.state.currentInfo.identity?(console.log(this.$store.state.currentInfo.identity),this.$router.push("/baseCourseObjectives")):this.$router.push({name:"Objectives"})},judgeBeforeSave:function(){try{if(this.list.schoolId=this.$store.state.currentInfo.schoolId,this.list.departmentId=this.$store.state.currentInfo.departmentId,this.list.majorId=this.$store.state.major.majorId,0==this.list.objectives.length)throw G.nk.error("请添加课程目标"),"true";this.list.objectives.forEach((function(e){if(""==e.description)throw G.nk.error("达成途径不能为空"),"true";if(0==e.assessmentMethods.length)throw G.nk.error("请为课程目标添加考核方式"),"true"})),this.save()}catch(e){if("true"==e)return}},save:function(){var e=this;console.log(this.$store.state.currentInfo.identity),"教师"===this.$store.state.currentInfo.identity?(this.list.classId=this.$store.state.currentInfo.teacherSideClassInfo.classId,yn(this.list).then((function(t){console.log("保存的内容",e.list),console.log("save",t),"SUCCESS"===t.code?((0,G.nk)({type:"success",message:"更新成功",duration:1500}),e.listCopy=JSON.parse(JSON.stringify(e.list)),e.backObjectives()):(0,G.nk)({type:"error",message:"更新失败",duration:1500})}))["catch"]((function(e){500==e.status&&(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500})}))):"学院管理员"!=this.$store.state.currentInfo.identity&&"课程负责人"!=this.$store.state.currentInfo.identity||In(this.list).then((function(t){console.log("保存的内容",e.list),console.log("save",t),"SUCCESS"===t.code?((0,G.nk)({type:"success",message:"更新成功",duration:1500}),e.listCopy=JSON.parse(JSON.stringify(e.list)),e.backObjectives()):(0,G.nk)({type:"error",message:"更新失败",duration:1500})}))["catch"]((function(e){500==e.status&&(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500})}))},checkObjectives:function(){var e=this;"教师"===this.$store.state.currentInfo.identity?(this.classId=this.$store.state.currentInfo.teacherSideClassInfo.classId,mr(this.classId).then((function(t){e.list=t.data,t.hasOwnProperty("info")&&(e.info=t.info),console.log("getObjectives",t);for(var o=0;o<e.list.activities.length;o++){e.map[e.list.activities[o].name]=o;var n=e.list.activities[o];e.allOfAll.push({children:[],value:n.name,label:n.name});for(var r=0;r<n.item.length;r++){var a={value:n.item[r],label:n.item[r]};e.allOfAll[o].children.push(a)}if(console.log("all",e.allOfAll),e.list.objectives[o])for(var s=e.list.objectives[o].assessmentMethods,i=0;i<s.length;i++){var l=s[i].activities;l.frontItem=[];for(var c=0;c<l.item.length;c++)l.table&&l.frontItem.push([l.table[c],l.item[c]])}}e.list.objectives&&e.list.objectives.forEach((function(e){"0"==e.id.charAt(0)?e.serialNum=e.id.charAt(1):e.serialNum=e.id})),e.objectives=e.list.objectives,e.objectives.forEach((function(e){e.assessmentMethods.forEach((function(e){e.isEditWeight=!1}))})),console.log("objectives:",e.objectives),e.getDeleteSerialNum()}))):"学院管理员"!=this.$store.state.currentInfo.identity&&"课程负责人"!=this.$store.state.currentInfo.identity||vn(this.course.detailId).then((function(t){e.list=t.data,t.hasOwnProperty("info")&&(e.info=t.info),console.log("getObjectives",t);for(var o=0;o<e.list.activities.length;o++){e.map[e.list.activities[o].name]=o;var n=e.list.activities[o];e.allOfAll.push({children:[],value:n.name,label:n.name});for(var r=0;r<n.item.length;r++){var a={value:n.item[r],label:n.item[r]};e.allOfAll[o].children.push(a)}if(console.log("all",e.allOfAll),e.list.objectives[o])for(var s=e.list.objectives[o].assessmentMethods,i=0;i<s.length;i++){var l=s[i].activities;l.frontItem=[];for(var c=0;c<l.item.length;c++)l.table&&l.frontItem.push([l.table[c],l.item[c]])}}e.list.objectives&&e.list.objectives.forEach((function(e){"0"==e.id.charAt(0)?e.serialNum=e.id.charAt(1):e.serialNum=e.id})),e.objectives=e.list.objectives,e.objectives.forEach((function(e){e.assessmentMethods.forEach((function(e){e.isEditWeight=!1}))})),console.log("objectives:",e.objectives),e.getDeleteSerialNum()}))},editAssessments:function(e,t){this.index=t,this.dialogObject=JSON.parse(JSON.stringify(e)),console.log("objective",this.dialogObject),this.dialogFormVisible=!0},addAssessment:function(){var e={name:"",weight:0,activities:{}};console.log("新增考核方式",e),this.dialogObject.assessmentMethods.push(e)},newAssessmentPart:function(e,t){this.index=t,this.dialogObject=JSON.parse(JSON.stringify(e)),this.dialogFormVisible=!0,console.log("新创建的课程目标下 新建考核方式",this.dialogObject)},deleteAssessment:function(e){this.dialogObject.assessmentMethods.pop(e)},confirmAddAssessment:function(e){var t=this;console.log("#",e);var o=0,n=!1,r=!1;e.assessmentMethods.forEach((function(e){o+=Number(e.weight),console.log("@",e.activities.frontItem),0==e.activities.frontItem.length&&(n=!0),"0"==e.weight&&(r=!0)})),1==r&&G.nk.error("权重范围在1%-100%"),100!==o&&G.nk.error("权重之和必须为100%"),1==n&&G.nk.error("请为考核方式选择成绩项"),100==o&&0==n&&0==r&&(this.dialogObject.assessmentMethods.forEach((function(e){var o=e.activities;"item"in o||(o.item=[]),"remark"in o||(o.remark=[]),"value"in o||(o.value=[]);var n=0;o.frontItem&&(n=o.frontItem.length);for(var r=0;r<n;r++){console.log("@@cur",o),o.item[r]=o.frontItem[r][1],o.table||(o.table=[]),o.table[r]=o.frontItem[r][0];var a=t.map[o.table[r]],s=t.list.activities[a],i=s.item.indexOf(o.item[r]);o.remark[r]=s.remark[i],o.value[r]=s.value[i]}console.log("after",e)})),this.objectives[this.index].assessmentMethods=this.dialogObject.assessmentMethods,this.dialogFormVisible=!1)},addObject:function(){var e={description:"",name:""};e.achievement=Number,e.serialNum=Number(this.deleteSerialNum)+1,e.serialNum>=10?e.id=e.serialNum+"":e.id="0"+e.serialNum,e.serialNum=e.serialNum+"",e.assessmentMethods=[],this.objectives.push(e),console.log("!!",this.objectives),this.getDeleteSerialNum(),this.canDelete=!0},deleteObject:function(){var e=this;P.s.confirm("是否确认删除课程目标"+this.deleteSerialNum+"?","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.objectives.pop(),0==e.objectives.length&&(e.canDelete=!1),e.getDeleteSerialNum()}))},getDeleteSerialNum:function(){this.objectives.length>0?(this.deleteSerialNum=this.objectives[this.objectives.length-1].serialNum,this.canDelete=!0):(this.deleteSerialNum=0,this.canDelete=!1),this.listCopy=JSON.parse(JSON.stringify(this.list))},editWeight:function(e){e.isEditWeight=!0},saveWeight:function(e){Number(e.weight)>100||Number(e.weight)<=0?G.nk.error("权重范围在1%-100%"):e.isEditWeight=!1}}},Gu=(0,h.A)(Pu,[["render",Ru],["__scopeId","data-v-51f91944"]]),zu=Gu;var Yu=function(e){return(0,l.Qi)("data-v-7a2786dd"),e=e(),(0,l.jt)(),e},Xu={class:"content"},Qu={class:"block"},Ku=Yu((function(){return(0,l.Lk)("div",{class:"head_title"},"工作手册",-1)})),Ju={class:"body"},Hu={class:"card"},qu={class:"no-workbook"},Zu=Yu((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","margin-top":"100px","font-size":"22px"}}," 暂未分配工作手册模板 ",-1)})),ed=Yu((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center",color:"grey","font-size":"13px","margin-top":"30px"}}," 请先分配工作手册模板 ",-1)})),td=[Zu,ed],od={class:"dialog-footer"},nd={class:"dialog-footer"};function rd(e,t,o,n,r,a){var s=(0,l.g2)("Back"),c=(0,l.g2)("el-icon"),u=(0,l.g2)("el-tooltip"),d=(0,l.g2)("el-divider"),h=(0,l.g2)("Switch"),f=(0,l.g2)("Document"),m=(0,l.g2)("Delete"),p=(0,l.g2)("el-row"),b=(0,l.g2)("el-col"),g=(0,l.g2)("el-option"),k=(0,l.g2)("el-select"),v=(0,l.g2)("el-button"),I=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)("div",Xu,[(0,l.Lk)("div",Qu,[(0,l.bF)(p,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.back()})},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1}),Ku,(0,l.bF)(d,{class:"divider",direction:"vertical"}),(0,l.bo)((0,l.Lk)("div",null,[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"修改关联模板",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"20px"},onClick:t[1]||(t[1]=function(e){return r.changeWorkbook=!0})},{default:(0,l.k6)((function(){return[(0,l.bF)(h)]})),_:1})]})),_:1}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"预设关联模板",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"10px"},onClick:t[2]||(t[2]=function(e){return a.goPresent()})},{default:(0,l.k6)((function(){return[(0,l.bF)(f)]})),_:1})]})),_:1}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"删除关联模板",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"20px"},onClick:a.Delete},{default:(0,l.k6)((function(){return[(0,l.bF)(m)]})),_:1},8,["onClick"])]})),_:1})],512),[[i.aG,r.hasWorkbook]]),(0,l.bo)((0,l.Lk)("div",null,[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"设置关联模板",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"10px"},onClick:t[3]||(t[3]=function(e){return r.addWorkbook=!0})},{default:(0,l.k6)((function(){return[(0,l.bF)(h)]})),_:1})]})),_:1})],512),[[i.aG,!r.hasWorkbook]])]})),_:1})]),(0,l.bo)((0,l.Lk)("div",Ju,[(0,l.Lk)("div",Hu,[(0,l.bF)(p,{class:"all_block"},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{class:"body_block"},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{class:"title"},{default:(0,l.k6)((function(){return[(0,l.eW)("工作手册名称")]})),_:1}),(0,l.bF)(b,{class:"detail"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(r.workbookInfo.name),1)]})),_:1})]})),_:1})]})),_:1})])],512),[[i.aG,r.hasWorkbook]]),(0,l.bo)((0,l.Lk)("div",qu,td,512),[[i.aG,!r.hasWorkbook]]),(0,l.bF)(I,{modelValue:r.changeWorkbook,"onUpdate:modelValue":t[7]||(t[7]=function(e){return r.changeWorkbook=e}),title:"修改关联模板",width:"330px","show-close":!1,"align-center":!0},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",od,[(0,l.bF)(v,{onClick:t[5]||(t[5]=function(e){return r.changeWorkbook=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(v,{type:"primary",onClick:t[6]||(t[6]=function(e){return a.submit()})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(k,{modelValue:r.workbookId,"onUpdate:modelValue":t[4]||(t[4]=function(e){return r.workbookId=e}),style:{width:"250px","margin-left":"20px"},placeholder:"".concat(r.workbookInfo.name)},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.workbooks,(function(e){return(0,l.uX)(),(0,l.Wv)(g,{key:e.workbookId,label:e.name,value:e.workbookId},null,8,["label","value"])})),128))]})),_:1},8,["modelValue","placeholder"])]})),_:1},8,["modelValue"]),(0,l.bF)(I,{modelValue:r.addWorkbook,"onUpdate:modelValue":t[11]||(t[11]=function(e){return r.addWorkbook=e}),title:"设置手册模板",width:"330px","show-close":!1,"align-center":!0},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",nd,[(0,l.bF)(v,{onClick:t[9]||(t[9]=function(e){return r.addWorkbook=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(v,{type:"primary",onClick:t[10]||(t[10]=function(e){return a.submit()})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(k,{modelValue:r.workbookId,"onUpdate:modelValue":t[8]||(t[8]=function(e){return r.workbookId=e}),style:{width:"250px","margin-left":"20px"},placeholder:e.选择手册模板},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.workbooks,(function(e){return(0,l.uX)(),(0,l.Wv)(g,{key:e.workbookId,label:e.name,value:e.workbookId},null,8,["label","value"])})),128))]})),_:1},8,["modelValue","placeholder"])]})),_:1},8,["modelValue"])])}const ad={name:"templateManage",components:{Back:ee.kcb,Switch:ee.dOG,Delete:ee.epd,Document:ee.yoT},data:function(){return{departmentId:"",courseId:"",hasWorkbook:Boolean,workbookInfo:[],changeWorkbook:!1,addWorkbook:!1,workbookId:"",workbooks:[]}},mounted:function(){this.departmentId=this.$store.state.currentInfo.departmentId,this.courseId=this.$store.state.course.courseId,this.getWorkbookInfo(),this.getWorkbooks()},methods:{goPresent:function(){this.$router.push({name:"WorkbookPresent"})},back:function(){this.$router.push("/baseCourseDetail")},getWorkbooks:function(){var e=this;Za(this.departmentId).then((function(t){"SUCCESS"==t.code&&(e.workbooks=t.rows,console.log("workbooks",e.workbooks))}))},getWorkbookInfo:function(){var e=this;ss(this.courseId).then((function(t){(t.code="SUCCESS")&&(e.hasWorkbook=!0,e.workbookInfo=t.data,console.log("workbookInfo",e.workbookInfo),e.workbookId=e.workbookInfo.workbookId)}))["catch"]((function(t){console.log("e",t),"NOT_FIND"==t.data.code&&(e.hasWorkbook=!1)}))},submit:function(){var e=this;1==this.changeWorkbook?P.s.confirm("是否确认修改关联的工作手册模板？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.associate()})):this.associate()},associate:function(){var e=this,t={};t.workbookId=this.workbookId,t.courseId=this.courseId;var o=[];o.push(t),rs(o).then((function(t){"SUCCESS"==t.code&&1==e.changeWorkbook&&((0,G.nk)({type:"success",message:"更新成功",duration:1500}),e.changeWorkbook=!1,e.getWorkbookInfo()),"SUCCESS"==t.code&&1==e.addWorkbook&&((0,G.nk)({type:"success",message:"分配成功",duration:1500}),e.addWorkbook=!1,e.getWorkbookInfo())}))},Delete:function(){var e=this;P.s.confirm("是否确认删除关联的工作手册模板？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){var t={workbookId:0};t.courseId=e.courseId;var o=[];o.push(t),rs(o).then((function(t){console.log("res",t),"SUCCESS"==t.code&&((0,G.nk)({type:"success",message:"删除成功",duration:1500}),e.getWorkbookInfo())}))}))}}},sd=(0,h.A)(ad,[["render",rd],["__scopeId","data-v-7a2786dd"]]),id=sd;var ld=function(e){return(0,l.Qi)("data-v-8b8631d4"),e=e(),(0,l.jt)(),e},cd={class:"block"},ud=ld((function(){return(0,l.Lk)("div",{class:"title"},"试卷分析表",-1)})),dd={class:"submenu"},hd={class:"numSelectedTeacher"},fd={class:"no-class"},md={class:"no-major-detail"},pd={class:"pagination-container",flex:""},bd={class:"dialog-footer"},gd={class:"dialog-footer"};function kd(e,t,o,n,r,a){var s=this,c=(0,l.g2)("Back"),u=(0,l.g2)("el-icon"),d=(0,l.g2)("el-tooltip"),h=(0,l.g2)("el-divider"),f=(0,l.g2)("el-row"),m=(0,l.g2)("el-button"),p=(0,l.g2)("el-col"),b=(0,l.g2)("MoreFilled"),g=(0,l.g2)("el-dropdown-item"),k=(0,l.g2)("el-dropdown-menu"),v=(0,l.g2)("el-dropdown"),I=(0,l.g2)("addBtn"),y=(0,l.g2)("el-table-column"),A=(0,l.g2)("Delete"),F=(0,l.g2)("Edit"),w=(0,l.g2)("el-table"),S=(0,l.g2)("el-input"),_=(0,l.g2)("el-form-item"),E=(0,l.g2)("el-form"),N=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bo)((0,l.Lk)("div",cd,[(0,l.bF)(f,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.backBaseCourse()})},{default:(0,l.k6)((function(){return[(0,l.bF)(c)]})),_:1})]})),_:1}),ud,(0,l.bF)(h,{class:"divider",direction:"vertical"})]})),_:1})],512),[[i.aG,!r.closeShow]]),(0,l.bo)((0,l.Lk)("div",dd,[(0,l.bF)(f,{class:"rowStyle"},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{span:2},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{onClick:t[1]||(t[1]=function(e){return s.toggleSelection()}),style:{float:"right"},class:"clearSelected"},{default:(0,l.k6)((function(){return[(0,l.eW)("取消选择")]})),_:1})]})),_:1}),(0,l.bF)(p,{span:16},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",hd," 已选中 "+(0,C.v_)(r.numSelected)+" 份试卷分析表 ",1)]})),_:1}),(0,l.bF)(p,{span:4},{default:(0,l.k6)((function(){return[(0,l.bF)(v,{class:"dropdownstyle"},{dropdown:(0,l.k6)((function(){return[(0,l.bF)(k,null,{default:(0,l.k6)((function(){return[(0,l.bF)(g,{onClick:a.deleteTeacher},{default:(0,l.k6)((function(){return[(0,l.eW)(" 删除试卷分析表 ")]})),_:1},8,["onClick"])]})),_:1})]})),default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"dropdownIcon"},{default:(0,l.k6)((function(){return[(0,l.bF)(b)]})),_:1})]})),_:1})]})),_:1})]})),_:1})],512),[[i.aG,r.closeShow]]),(0,l.bo)((0,l.Lk)("div",fd,"没有试卷分析表",512),[[i.aG,r.hasNoBaseCourse]]),(0,l.bo)((0,l.Lk)("div",md," 请先点击右上角圆形按钮添加试卷分析表 ",512),[[i.aG,r.hasNoBaseCourse]]),(0,l.bo)((0,l.bF)(I,{onClick:a.goAddTeacher},null,8,["onClick"]),[[i.aG,r.canedit]]),(0,l.bo)((0,l.Lk)("div",null,[(0,l.bF)(w,{ref:"multipleTable",data:r.tableData,"tooltip-effect":"dark",onSelectionChange:a.handleSelectionChange,onRowClick:a.goPaperAnalysisDetail,style:{width:"835px"},class:"el-table-container","header-cell-style":{"padding-left":"20px","font-size":"14.4px",height:"48px","font-weight":"bold",color:"black"},"cell-style":{"padding-left":"20px","font-size":"16px",height:"60px"},"row-key":a.rowKey},{default:(0,l.k6)((function(){return[(0,l.bF)(y,{type:"selection","column-key":"select",width:"55","reserve-selection":!0}),(0,l.bF)(y,{property:"name",label:"名称",width:"230"}),(0,l.bF)(y,{property:"description",label:"描述",width:"350"}),(0,l.bF)(y,{label:"操作",width:"200"},{default:(0,l.k6)((function(e){return[(0,l.bF)(f,null,{default:(0,l.k6)((function(){return[(0,l.bF)(p,{span:6},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{content:"删除","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{link:"",style:{color:"#3f51b5"},disabled:!r.canedit,onClick:(0,i.D$)((function(t){return a.deleteAnalysys(e.row)}),["stop"])},{default:(0,l.k6)((function(){return[(0,l.bF)(u,null,{default:(0,l.k6)((function(){return[(0,l.bF)(A)]})),_:1})]})),_:2},1032,["disabled","onClick"])]})),_:2},1024)]})),_:2},1024),(0,l.bF)(p,{span:6},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{content:"修改","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{link:"",style:{color:"#3f51b5"},disabled:!r.canedit,onClick:(0,i.D$)((function(t){return a.editAnalysys(e.row)}),["stop"])},{default:(0,l.k6)((function(){return[(0,l.bF)(u,null,{default:(0,l.k6)((function(){return[(0,l.bF)(F)]})),_:1})]})),_:2},1032,["disabled","onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1024)]})),_:1})]})),_:1},8,["data","onSelectionChange","onRowClick","row-key"])],512),[[i.aG,r.hasBaseCourse]]),(0,l.Lk)("div",pd,[(0,l.bF)(f,{type:"flex",justify:"center",align:"middle",class:"loadmorestyle"},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(m,{disabled:r.loadmoreDisabled,link:"",plain:"",onClick:t[2]||(t[2]=function(e){return a.loadmoreCourse()})},{default:(0,l.k6)((function(){return[(0,l.eW)("加载更多")]})),_:1},8,["disabled"]),[[i.aG,r.showLoadmore&&r.hasBaseCourse]])]})),_:1})]),(0,l.bF)(N,{modelValue:r.dialogFormVisible,"onUpdate:modelValue":t[7]||(t[7]=function(e){return r.dialogFormVisible=e}),title:"添加试卷分析表",width:"380px","show-close":!1,"align-center":!0},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",bd,[(0,l.bF)(m,{onClick:t[5]||(t[5]=function(e){r.dialogFormVisible=!1,r.analysisForm.name="",r.analysisForm.description=""})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(m,{type:"primary",onClick:t[6]||(t[6]=function(e){return a.submitAnalysis(r.analysisForm.name,r.analysisForm.description)})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(E,{model:r.analysisForm,ref:"ruleForm"},{default:(0,l.k6)((function(){return[(0,l.bF)(_,{label:"名称",prop:"courseName"},{default:(0,l.k6)((function(){return[(0,l.bF)(S,{modelValue:r.analysisForm.name,"onUpdate:modelValue":t[3]||(t[3]=function(e){return r.analysisForm.name=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1}),(0,l.bF)(_,{label:"描述",prop:"courseCode"},{default:(0,l.k6)((function(){return[(0,l.bF)(S,{type:"textarea",modelValue:r.analysisForm.description,"onUpdate:modelValue":t[4]||(t[4]=function(e){return r.analysisForm.description=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1})]})),_:1},8,["model"])]})),_:1},8,["modelValue"]),(0,l.bF)(N,{modelValue:r.editDialog,"onUpdate:modelValue":t[13]||(t[13]=function(e){return r.editDialog=e}),title:"修改试卷分析表",width:"380px","show-close":!1,"align-center":!0},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",gd,[(0,l.bF)(m,{onClick:t[11]||(t[11]=function(e){return r.editDialog=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(m,{type:"primary",onClick:t[12]||(t[12]=function(e){return a.confirmEditDialog()})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(E,{modelValue:r.examEdit,"onUpdate:modelValue":t[10]||(t[10]=function(e){return r.examEdit=e}),rules:e.rules,ref:"examEditForm","label-position":"top"},{default:(0,l.k6)((function(){return[(0,l.bF)(_,{label:"名称",prop:"name"},{default:(0,l.k6)((function(){return[(0,l.bF)(S,{modelValue:r.examEdit.name,"onUpdate:modelValue":t[8]||(t[8]=function(e){return r.examEdit.name=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1}),(0,l.bF)(_,{label:"描述",prop:"description"},{default:(0,l.k6)((function(){return[(0,l.bF)(S,{type:"textarea",modelValue:r.examEdit.description,"onUpdate:modelValue":t[9]||(t[9]=function(e){return r.examEdit.description=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1})]})),_:1},8,["modelValue","rules"])]})),_:1},8,["modelValue"])],64)}(0,Be.um)();const vd={data:function(){return{canedit:!1,examEdit:{},editDialog:!1,analysisForm:{name:"",description:""},formLabelWidth:"100px",dialogFormVisible:!1,detailId:"",courseId:"",identity:"",loadmoreDisabled:!1,hasBaseCourse:!1,hasNoBaseCourse:!1,showLoadmore:!0,departmentId:"",schoolId:"",keyword:"",pageNum:1,pageSize:20,tableData:[],multipleSelection:[],numSelected:0,teacherId:[],closeShow:!1,clickState:0,form:(0,ce.Kh)({queryString:""})}},components:{HotTable:De.sH,HotColumn:De.gQ,ElTooltip:ue.R7,ElIcon:de.tk,ElInput:he.WK,ElForm:fe.US,ElButton:me.S2,ElTable:pe.Up,ref:ce.KR,reactive:ce.Kh,Back:ee.kcb,FolderChecked:ee.KHk,InfoFilled:ee.N_H,Loading:ee.Rhj,Search:ee.vji,Close:ee.bm,Plus:ee.FWt,Delete:ee.epd,MoreFilled:ee.yGC,request:Q,ElMessage:G.nk,ElMessageBox:P.s,Action:p.A,HeaderSearch:ne,addBtn:le,ElDropdown:ge.dW,Edit:ee.ffu},methods:{submitAnalysis:function(e,t){var o=this;xn({name:e,description:t,detailId:this.detailId}).then((function(e){console.log("create analysis",e),"SUCCESS"==e.code&&(0,G.nk)({type:"success",message:"添加成功",duration:1500}),o.dialogFormVisible=!1,o.getTeacherList()}))["catch"]((function(e){500===e.status?(0,G.nk)({type:"error",message:"添加出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500})}))},goPaperAnalysisDetail:function(e,t){void 0===t.columnKey&&(this.$router.push({path:"/baseCourseAnalysis"}),this.$store.commit("course/setbasecoursePaperAnalysisId",e.id))},backBaseCourse:function(){this.$router.push({path:"/baseCourseDetail"})},getSearchValue:function(e){this.keyword=e,this.getTeacherList()},rowKey:function(e){return e.teacherId},loadmoreCourse:function(){this.result.total-this.pageSize>=20?(this.pageSize+=20,this.getTeacherList()):(this.pageSize+=this.result.total-this.pageSize,this.getTeacherList())},toggleSelection:function(e){var t=this;e?e.forEach((function(e){t.$refs.multipleTable.toggleRowSelection(e)})):(this.$refs.multipleTable.clearSelection(),1==this.clickState&&(this.clickState=0,this.closeShow=!this.closeShow))},getCurrentRows:function(){},handleSelectionChange:function(e){this.multipleSelection=e;var t=[];e.forEach((function(e){var o=e.id;t.push(o)})),console.log("选中的信息：",e),this.numSelected=this.multipleSelection.length,1!=this.clickState&&(this.closeShow=!this.closeShow,this.clickState=1),1==this.clickState&&0==this.numSelected&&(this.clickState=0,this.closeShow=!this.closeShow),this.teacherId=t,console.log("teacherId:",this.teacherId)},onSubmit:function(){alert(this.form.queryString)},clearqueryString:function(){this.form.queryString="",""!=this.form.queryString?this.closeShow=!0:this.closeShow=!1},goAddTeacher:function(){this.dialogFormVisible=!0},deleteTeacher:function(){var e=this,t=this,o=this.teacherId;P.s.confirm("是否确认删除试卷分析表？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){console.log("teacherID:",o,"typeof this.teacherID",e.teacherId),jn(o).then((function(e){var o=e;return console.log("localres",o),204===e?((0,G.nk)({type:"success",message:"删除成功",duration:1500}),t.getTeacherList(),t.$refs.multipleTable.clearSelection(),1==t.clickState&&(t.clickState=0,t.closeShow=!t.closeShow)):(0,G.nk)({type:"error",message:"删除失败",duration:1500}),o}))}))["catch"]((function(e){return console.log(e),e}))},getTeacherList:function(){var e=this;this.loadmoreDisabled=!0,Ln(this.detailId).then((function(t){e.loadmoreDisabled=!1,console.log("paperAnalysis 信息",t),0==t.total?(e.hasBaseCourse=!1,e.hasNoBaseCourse=!0):(e.hasBaseCourse=!0,e.hasNoBaseCourse=!1,e.tableData=t.rows,e.result=t,e.pageSize>=t.total&&(e.showLoadmore=!1))}))},activate:function(){this.departmentId=this.$store.state.currentInfo.departmentId,this.schoolId=this.$store.state.currentInfo.schoolId,this.courseId=this.$store.state.course.baseCourseCourseId,this.identity=this.$store.state.currentInfo.identity,this.detailId=this.$store.state.course.detailId,"学院管理员"==this.identity?(this.classInfo=this.$store.state.currentInfo.adminSideClassInfo,console.log("identity:",this.identity),this.canedit=!0):"课程负责人"==this.identity?(this.classInfo=this.$store.state.currentInfo.respondClassInfo,this.canedit=!0,console.log("identity:",this.identity)):(this.classInfo=this.$store.state.currentInfo.teacherSideClassInfo,this.canedit=!1,console.log("identity:",this.identity)),"1"!=this.classInfo.status&&"4"!=this.classInfo.status||(this.canedit=!0),console.log("this.canedit:",this.canedit)},deleteAnalysys:function(e){var t=this,o=[e.id];P.s.confirm("是否确认删除？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){Ws(o).then((function(e){204===e&&((0,G.nk)({type:"success",message:"删除成功",duration:1500}),t.getTeacherList())}))}))},editAnalysys:function(e){this.editDialog=!0,this.examEdit=e,console.log(e)},confirmEditDialog:function(){var e=this;Rs(this.examEdit).then((function(t){console.log(t),"SUCCESS"===t.code&&((0,G.nk)({type:"success",message:"更新成功",duration:1500}),e.examEdit={},e.editDialog=!1,e.getTeacherList())}))}},mounted:function(){this.activate(),this.getTeacherList()}},Id=(0,h.A)(vd,[["render",kd],["__scopeId","data-v-8b8631d4"]]),yd=Id;var Cd=function(e){return(0,l.Qi)("data-v-96822f4e"),e=e(),(0,l.jt)(),e},Ad={class:"bg"},Fd=Cd((function(){return(0,l.Lk)("div",{class:"background"},null,-1)})),wd={class:"loginContainer"},Sd={class:"card"},_d={class:"loginCard"},Ed=Cd((function(){return(0,l.Lk)("h2",{style:{"text-align":"center"}},"教学过程质量监控管理平台",-1)}));function Nd(e,t,o,n,r,a){var s=(0,l.g2)("user"),c=(0,l.g2)("el-icon"),u=(0,l.g2)("el-input"),d=(0,l.g2)("el-form-item"),h=(0,l.g2)("lock"),f=(0,l.g2)("el-button"),m=(0,l.g2)("el-form");return(0,l.uX)(),(0,l.CE)("div",Ad,[Fd,(0,l.Lk)("div",wd,[(0,l.Lk)("div",Sd,[(0,l.Lk)("div",_d,[Ed,(0,l.bF)(m,{rules:r.rules,ref:"loginForm",model:r.loginForm,style:{"margin-top":"40px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{prop:"userName"},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{placeholder:"请输入用户名",modelValue:r.loginForm.userName,"onUpdate:modelValue":t[0]||(t[0]=function(e){return r.loginForm.userName=e}),clearable:"",size:"large"},{prefix:(0,l.k6)((function(){return[(0,l.bF)(c,null,{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1},8,["modelValue"])]})),_:1}),(0,l.bF)(d,{prop:"passWord",error:r.errorMsg},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{modelValue:r.loginForm.passWord,"onUpdate:modelValue":t[1]||(t[1]=function(e){return r.loginForm.passWord=e}),placeholder:"请输入密码",type:"password","show-password":"",clearable:"",size:"large",style:{"margin-top":"10px"},onKeyup:t[2]||(t[2]=(0,i.jR)((function(e){return a.userLogin()}),["enter"]))},{prefix:(0,l.k6)((function(){return[(0,l.bF)(c,null,{default:(0,l.k6)((function(){return[(0,l.bF)(h)]})),_:1})]})),_:1},8,["modelValue"])]})),_:1},8,["error"]),(0,l.bF)(f,{size:"large",type:"primary",style:{width:"100%","margin-top":"10px","font-size":"16px","box-shadow":"0 0 5px #cac6c6"},onClick:t[3]||(t[3]=function(e){return a.userLogin()})},{default:(0,l.k6)((function(){return[(0,l.eW)("登      录")]})),_:1})]})),_:1},8,["rules","model"])])])])])}const Vd={name:"userLogin",components:{User:ee.KJW,Lock:ee.c_I},data:function(){return{loginForm:{userName:"",passWord:""},rules:{userName:[{required:!0,message:"用户名不能为空",trigger:"blur"}],passWord:[{required:!0,message:"密码不能为空",trigger:"blur"}]},errorMsg:""}},methods:{userLogin:function(){var e=this;this.$refs.loginForm.validate((function(t){if(!t)return!1;e.errorMsg="",ca(e.loginForm.userName,e.loginForm.passWord).then((function(t){if("SUCCESS"==t.code&&(void 0===W()?(u.A.set("Admin-Token",t.token),u.A.set("first-Login",!0)):(u.A.set("Admin-Token",t.token),u.A.set("first-Login",!1)),e.$store.commit("navInfo/setActiveDisplay1",0),e.$store.commit("navInfo/setActiveDisplay2",0),e.$store.commit("navInfo/setActiveDisplay3",0),e.$store.commit("navInfo/setActiveDisplay4",0),da().then((function(t){console.log("userInfo",t),e.$store.commit("userInfo/setUserName",t.user.userName),e.$store.commit("userInfo/setUserId",t.user.userId),e.$store.commit("userInfo/setRoleInfo",t.user.roles),e.$store.commit("userInfo/setIdentity",t.roles),0!==t.roles.length&&(e.$store.commit("currentInfo/setDepartmentName",t.roles[0].departmentName),e.$store.commit("currentInfo/setDepartmentId",t.roles[0].departmentId),e.$store.commit("currentInfo/setSchoolName",t.roles[0].schoolName),e.$store.commit("currentInfo/setSchoolId",t.roles[0].schoolId),e.$store.commit("currentInfo/setRole",t.roles[0])),e.$store.getters["currentInfo/changeIsTeacher"],"学院管理员"==e.$store.state.currentInfo.identity&&e.$router.replace("major"),"教师"==e.$store.state.currentInfo.identity&&e.$router.replace("teacherClasses"),"课程负责人"==e.$store.state.currentInfo.identity&&e.$router.replace("BaseCourse"),"web管理员"==e.$store.state.currentInfo.identity&&e.$router.replace("Schools")}))),"ERROR"===t.code)return e.errorMsg="账号/密码不正确，请重新输入",void(e.loginForm.passWord="")}))}))}}},xd=(0,h.A)(Vd,[["render",Nd],["__scopeId","data-v-96822f4e"]]),Td=xd;var jd={class:"content"},Ld={class:"dialog-footer"};function Dd(e,t,o,n,r,a){var s=(0,l.g2)("addBtn"),c=(0,l.g2)("el-table-column"),u=(0,l.g2)("DocumentAdd"),d=(0,l.g2)("el-icon"),h=(0,l.g2)("el-button"),f=(0,l.g2)("el-tooltip"),m=(0,l.g2)("el-col"),p=(0,l.g2)("el-row"),b=(0,l.g2)("Document"),g=(0,l.g2)("Delete"),k=(0,l.g2)("Edit"),v=(0,l.g2)("el-table"),I=(0,l.g2)("el-upload"),y=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)("div",jd,[(0,l.bF)(s,{onClick:t[0]||(t[0]=function(e){return a.addTemplate()})}),(0,l.bF)(v,{class:"ListTable",data:r.workbookList,style:{width:"800px"},"header-cell-style":{"padding-left":"20px","font-size":"14.4px",height:"48px","font-weight":"bold",color:"black"},"cell-style":{"padding-left":"20px","font-size":"16px",height:"60px",cursor:"pointer"},"highlight-current-row":"",onRowClick:a.goEdit},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{prop:"name",label:"名称",width:"200"}),(0,l.bF)(c,{prop:"updateTime",label:"更新时间",width:"250"}),(0,l.bF)(c,{prop:"report",label:"模板文件",width:"200"},{default:(0,l.k6)((function(e){return[(0,l.bo)((0,l.bF)(p,null,{default:(0,l.k6)((function(){return[(0,l.bF)(m,null,{default:(0,l.k6)((function(){return[(0,l.bF)(f,{content:"添加模板","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{link:"",style:{color:"#3f51b5"},onClick:(0,i.D$)((function(t){return a.check(e.row)}),["stop"])},{default:(0,l.k6)((function(){return[(0,l.bF)(d,null,{default:(0,l.k6)((function(){return[(0,l.bF)(u)]})),_:1})]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1536),[[i.aG,null===e.row.templateFile]]),(0,l.bo)((0,l.bF)(p,null,{default:(0,l.k6)((function(){return[(0,l.bF)(m,null,{default:(0,l.k6)((function(){return[(0,l.bF)(f,{content:"查看模板","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{link:"",style:{color:"#3f51b5"},onClick:(0,i.D$)((function(t){return a.check(e.row)}),["stop"])},{default:(0,l.k6)((function(){return[(0,l.bF)(d,null,{default:(0,l.k6)((function(){return[(0,l.bF)(b)]})),_:1})]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1536),[[i.aG,null!==e.row.templateFile]])]})),_:1}),(0,l.bF)(c,{label:"操作",width:"150"},{default:(0,l.k6)((function(e){return[(0,l.bF)(p,null,{default:(0,l.k6)((function(){return[(0,l.bF)(m,{span:6},{default:(0,l.k6)((function(){return[(0,l.bF)(f,{content:"删除","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{link:"",style:{color:"#3f51b5"},onClick:(0,i.D$)((function(t){return a.deleteBook(e.row)}),["stop"])},{default:(0,l.k6)((function(){return[(0,l.bF)(d,null,{default:(0,l.k6)((function(){return[(0,l.bF)(g)]})),_:1})]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024),(0,l.bF)(m,{span:6},{default:(0,l.k6)((function(){return[(0,l.bF)(f,{content:"修改","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{link:"",style:{color:"#3f51b5"},onClick:(0,i.D$)((function(t){return a.editBook(e.row)}),["stop"])},{default:(0,l.k6)((function(){return[(0,l.bF)(d,null,{default:(0,l.k6)((function(){return[(0,l.bF)(k)]})),_:1})]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1024)]})),_:1})]})),_:1},8,["data","onRowClick"]),(0,l.bF)(y,{modelValue:r.dialogVisible,"onUpdate:modelValue":t[3]||(t[3]=function(e){return r.dialogVisible=e}),width:"400px","show-close":!1},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",Ld,[(0,l.bF)(h,{onClick:t[1]||(t[1]=function(e){return r.dialogVisible=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(h,{type:"primary",onClick:t[2]||(t[2]=function(e){return r.dialogVisible=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(p,{style:{"margin-left":"30px"}},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(m,null,{default:(0,l.k6)((function(){return[(0,l.bF)(v,{data:r.filesList,style:{cursor:"pointer","margin-top":"10px",width:"280px"},"show-header":!1,onRowClick:a.downloadFile},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{prop:"originalName",label:"文件名",width:"280px"})]})),_:1},8,["data","onRowClick"])]})),_:1},512),[[i.aG,r.hasFile]]),(0,l.bF)(p,{style:{"margin-top":"30px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(I,{"show-file-list":!1,class:"upload-demo",action:r.action,headers:r.headers,accept:".doc,.docx",name:"files",data:r.data,limit:1,"on-success":a.uploadSuccess,"on-exceed":e.uploadExceed},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{type:"primary"},{default:(0,l.k6)((function(){return[(0,l.eW)("上传模板")]})),_:1})]})),_:1},8,["action","headers","data","on-success","on-exceed"])]})),_:1})]})),_:1})]})),_:1},8,["modelValue"])])}const Bd={name:"TemplateList",components:{Back:ee.kcb,addBtn:le,Delete:ee.epd,Edit:ee.ffu,Document:ee.yoT,DocumentAdd:ee.pT5,CircleClose:ee.R$5},data:function(){return{url:"",departmentId:"",workbookList:[],dialogVisible:!1,hasFile:!1,fileName:"",filesList:[],rowInfo:{},headers:{Authorization:"Bearer "+u.A.get("Admin-Token")},action:this.url+"common/upload/files",data:{type:"reportTemplateFile",param:""}}},mounted:function(){this.departmentId=this.$store.state.currentInfo.departmentId,this.getWorkbookList()},methods:{backSetting:function(){this.$router.push("/departmentSetting")},goEdit:function(e){console.log(e),this.$router.push({path:"/templateEdit",query:{workbookId:e.workbookId}})},addTemplate:function(){var e=this;P.s.prompt("模板名称：","新建模板",{confirmButtonText:"确认",cancelButtonText:"取消",customClass:"add-major-box",inputPattern:/^.+$/,inputErrorMessage:"请输入新增模板名称"}).then((function(t){var o=t.value;os(o,e.departmentId).then((function(t){"SUCCESS"===t.code&&(e.getWorkbookList(),(0,G.nk)({type:"success",message:"新建成功",duration:1500}))}))}))["catch"]((function(){}))},getWorkbookList:function(){var e=this;Za(this.departmentId).then((function(t){console.log("workbookList",t),"SUCCESS"===t.code&&(e.workbookList=t.rows,e.workbookList.forEach((function(e){null===e.updateTime&&(e.updateTime=e.createTime)})))}))},editBook:function(e){var t=this;console.log(e),P.s.prompt("新的工作手册名称：","修改工作手册名称",{confirmButtonText:"确认",cancelButtonText:"取消",inputValue:e.name,inputPattern:/^.+$/,inputErrorMessage:"请输入修改后的工作手册名称"}).then((function(o){var n=o.value;e.name=n,ts(e).then((function(e){(0,G.nk)({type:"success",message:"更新成功",duration:1500}),t.getWorkbookList()}))}))["catch"]((function(){}))},deleteBook:function(e){var t=this;console.log(e),P.s.confirm("是否确认删除模板?","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){ns(e.workbookId).then((function(e){204===e&&(t.getWorkbookList(),(0,G.nk)({type:"success",message:"删除成功",duration:1500}))}))}))},check:function(e){console.log("check",e),this.data.param=e.workbookId,this.rowInfo=e,null===e.templateFile?this.hasFile=!1:(this.hasFile=!0,this.filesList=[],this.filesList.push(e.templateFile),this.fileName=e.templateFile.originalName),this.dialogVisible=!0},uploadSuccess:function(e,t,o){console.log("response",e,t,"file",o,"fileList"),"SUCCESS"==e.code&&((0,G.nk)({type:"success",message:"上传成功",duration:1500}),this.dialogVisible=!1,this.getWorkbookList())},downloadFile:function(e){Nl(e.fileAddress).then((function(t){var o=new Blob([t]),n=document.createElement("a");n.download=decodeURI(e.originalName),n.style.display="none",n.href=URL.createObjectURL(o),document.body.appendChild(n),n.click(),URL.revokeObjectURL(n.href),document.body.removeChild(n)}))}}},$d=(0,h.A)(Bd,[["render",Dd],["__scopeId","data-v-28ca9444"]]),Od=$d;var Md={class:"content"},Ud={class:"block"},Wd={class:"block_title"},Rd={class:"form-designer"};function Pd(e,t,o,n,r,a){var s=(0,l.g2)("Back"),i=(0,l.g2)("el-icon"),c=(0,l.g2)("el-tooltip"),u=(0,l.g2)("el-divider"),d=(0,l.g2)("DocumentChecked"),h=(0,l.g2)("el-row"),f=(0,l.g2)("fc-designer");return(0,l.uX)(),(0,l.CE)("div",Md,[(0,l.Lk)("div",Ud,[(0,l.bF)(h,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.backList()})},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1}),(0,l.Lk)("div",Wd,(0,C.v_)(r.total.name),1),(0,l.bF)(u,{class:"divider",direction:"vertical"}),(0,l.bF)(c,{class:"box-item",effect:"dark",content:"保存",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",onClick:t[1]||(t[1]=function(e){return a.save()}),style:{"margin-left":"20px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(d)]})),_:1})]})),_:1})]})),_:1})]),(0,l.Lk)("div",Rd,[(0,l.bF)(f,{ref:"designer",class:"designer",height:"800px",menu:r.menu},null,8,["menu"])])])}o(64346),o(21211),o(15472);var Gd=o(62075);function zd(e,t,o,n,r,a){var s=(0,l.g2)("el-button"),i=(0,l.g2)("el-upload");return(0,l.uX)(),(0,l.Wv)(i,{"file-list":e.fileList,"onUpdate:fileList":t[0]||(t[0]=function(t){return e.fileList=t}),class:"upload-demo",action:e.action,multiple:"",headers:e.headers,limit:e.limit,data:e.data,accept:".doc,.docx,.pdf,.rar,.zip",showFileList:"","list-type":"text"},{default:(0,l.k6)((function(){return[(0,l.bF)(s,{type:"primary"},{default:(0,l.k6)((function(){return[(0,l.eW)("点击上传")]})),_:1})]})),_:1},8,["file-list","action","headers","limit","data"])}const Yd={name:"upload",components:{},data:function(){return{}}},Xd=(0,h.A)(Yd,[["render",zd]]),Qd=Xd;var Kd=function(e,t,o){return o.map((function(o){return"formCreate$required"===o.field?o.title=e("props.required")||o.title:o.field&&"_optionType"!==o.field&&(o.title=e("components."+t+"."+o.field)||o.title),o}))};function Jd(){return{type:"Required",field:"formCreate$required",title:"是否必填"}}var Hd=" 上传",qd="upload",Zd=1,eh=function(){return"uni".concat(Zd++)},th={icon:"icon-upload",label:Hd,name:Qd,rule:function(){return{component:(0,ce.IJ)(Qd),type:qd,field:eh(),title:Hd,info:"",effect:{fetch:""},props:{action:"http://81.68.103.96:8099/common/upload/files",headers:{Authorization:"Bearer "+u.A.get("Admin-Token")},data:[{type:"workbookFile"}],listType:"text",onSuccess:function(e){console.log("suc",e)}}}},props:function(e,t){var o=t.t;return Kd(o,qd+".props",[Jd(),{type:"switch",field:"multiple",title:"是否支持多选文件"},{type:"switch",field:"disabled",title:"是否禁用"},{type:"inputNumber",field:"limit",title:"最大允许上传个数",props:{min:0}}])}};const oh={name:"TemplateEdit",components:{Back:ee.kcb,DocumentChecked:ee.Fmj},data:function(){return{total:[],json:[],option:{},workbookId:"",fApi:{},value:{},menu:[{title:"表单组件",name:"group1",list:[{icon:"icon-input",name:"input",label:"输入框"},{icon:"icon-number",name:"inputNumber",label:"计数器"},{icon:"icon-radio",name:"radio",label:"单选框"},{icon:"icon-checkbox",name:"checkbox",label:"多选框"},{icon:"icon-cascader",name:"cascader",label:"级联选择器"},{icon:"icon-select",name:"select",label:"选择器"},{icon:"icon-editor",name:"fc-editor",label:"富文本框"},{icon:"icon-rate",name:"rate",label:"评分"},{icon:"icon-slider",name:"slider",label:"滑块"},{icon:"icon-switch",name:"switch",label:"开关"},{icon:"icon-time",name:"timePicker",label:"时间选择器"},{icon:"icon-date",name:"datePicker",label:"日期选择器"}]},{title:"辅助组件",name:"group2",list:[{icon:"icon-alert",name:"el-alert",label:"提示"},{icon:"icon-divider",name:"el-divider",label:"分割线"},{icon:"icon-span",name:"span",label:"文字"}]},{title:"布局组件",name:"group3",list:[{icon:"icon-row",name:"row",label:"栅格布局"},{icon:"icon-tab",name:"tab",label:"标签页"},{icon:"icon-space",name:"div",label:"间距"}]}]}},mounted:function(){this.$refs.designer.addComponent(th),this.$refs.designer.appendMenuItem("group1",{icon:th.icon,name:th.name,label:th.label}),this.workbookId=this.$route.query.workbookId,this.getWorkbookInfo()},methods:{backList:function(){var e=this;this.json=JSON.parse(this.$refs.designer.getJson()),this.getOption(),console.log("!",Qo().isEqual(this.total.formJson,this.JSON),this.total.formJson,this.json),console.log(Qo().isEqual(this.total.cssJson,this.option),this.total.cssJson,this.option),Qo().isEqual(this.total.formJson,this.json)&&Qo().isEqual(this.total.cssJson,this.option)?this.$router.push("/templateList"):P.s.confirm("数据还未保存，是否仍然关闭？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.$router.push("/templateList")}))["catch"]((function(){}))},save:function(){var e=this;this.json=JSON.parse(this.$refs.designer.getJson()),this.getOption(),this.total.formJson=this.json,this.total.cssJson=this.option,this.total.formJson.length>0&&this.total.formJson.forEach((function(e){"upload"===e.type&&Reflect.deleteProperty(e,"component")})),this.searchChildren(this.total.formJson),console.log("save",this.total),ts(this.total).then((function(t){"SUCCESS"===t.code&&((0,G.nk)({type:"success",message:"更新成功",duration:1500}),e.getWorkbookInfo())}))["catch"]((function(e){500==e.status&&(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500})}))},getOption:function(){this.option=this.$refs.designer.getOption(),this.option.form.formCreateResetBtn=this.option.resetBtn.show,this.option.form.formCreateSubmitBtn=this.option.submitBtn.show,console.log("getOption",this.option)},setOption:function(){this.$refs.designer.setOption(this.option)},getJson:function(){this.json=this.$refs.designer.getJson()},setJson:function(){this.$refs.designer.setRule(this.json)},getWorkbookInfo:function(){var e=this;es(this.workbookId).then((function(t){console.log("getWorkbookInfo",t),e.total=t.data,e.json=t.data.formJson,e.option=t.data.cssJson,null===e.json&&(e.json=[]),null===e.option&&(e.option={},e.option.form={}),console.log("option",e.option),e.setJson(),e.setOption()}))},searchChildren:function(e){var t=this;e.forEach((function(e){Array.isArray(e.children)&&e.children.length>0?t.searchChildren(e.children):""!==e&&("checkbox"!=e.type&&"radio"!=e.type&&"select"!=e.type||e.options.forEach((function(e){e.value=e.value+""})),"cascader"==e.type&&e.props.options.forEach((function(e){e.value=e.value+""})))}))}}},nh=(0,h.A)(oh,[["render",Pd],["__scopeId","data-v-61726908"]]),rh=nh;var ah=function(e){return(0,l.Qi)("data-v-760297f3"),e=e(),(0,l.jt)(),e},sh={class:"content"},ih={class:"block"},lh=ah((function(){return(0,l.Lk)("div",{class:"block_title"},"工作手册",-1)})),ch={class:"form-card"},uh={class:"noWorkbook"},dh=ah((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","margin-top":"100px","font-size":"22px"}}," 暂未设置工作手册模板 ",-1)})),hh=ah((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center",color:"grey","font-size":"13px","margin-top":"30px"}}," 请联系管理员设置工作手册模板 ",-1)})),fh=[dh,hh];function mh(e,t,o,n,r,a){var s=(0,l.g2)("Back"),c=(0,l.g2)("el-icon"),u=(0,l.g2)("el-tooltip"),d=(0,l.g2)("el-divider"),h=(0,l.g2)("DocumentChecked"),f=(0,l.g2)("UploadFilled"),m=(0,l.g2)("el-switch"),p=(0,l.g2)("el-row"),b=(0,l.g2)("form-create"),g=(0,l.g2)("reviewDrawer");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",sh,[(0,l.Lk)("div",ih,[(0,l.bF)(p,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.backClass()})},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1}),lh,(0,l.bF)(d,{class:"divider",direction:"vertical"}),(0,l.bo)((0,l.Lk)("div",null,[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"临时保存（仅临时存放在当前浏览器，请及时保存至服务器）",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",onClick:t[1]||(t[1]=function(e){return a.tempSave(r.value,r.classInfo.classId)}),style:{"margin-left":"10px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(h)]})),_:1})]})),_:1}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"保存至服务器",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",onClick:t[2]||(t[2]=function(e){return a.save()}),style:{"margin-left":"20px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(f)]})),_:1})]})),_:1})],512),[[i.aG,r.hasWorkbook&&"教师"==r.identity&&!r.noEdit]]),(0,l.bF)(d,{class:"divider",direction:"vertical"}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"审核意见",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{modelValue:r.openDrawer,"onUpdate:modelValue":t[3]||(t[3]=function(e){return r.openDrawer=e}),class:"switchstyle",onChange:a.openDrawerChange},null,8,["modelValue","onChange"])]})),_:1})]})),_:1})]),(0,l.bo)((0,l.Lk)("div",ch,[(0,l.bF)(b,{modelValue:r.value,"onUpdate:modelValue":t[4]||(t[4]=function(e){return r.value=e}),api:r.fApi,"onUpdate:api":t[5]||(t[5]=function(e){return r.fApi=e}),rule:r.json,option:r.option},null,8,["modelValue","api","rule","option"])],512),[[i.aG,r.hasWorkbook]]),(0,l.bo)((0,l.Lk)("div",uh,fh,512),[[i.aG,!r.hasWorkbook]])]),(0,l.bF)(g,{visible:r.openDrawer},null,8,["visible"])],64)}var ph=o(18135),bh=function(e){return(0,l.Qi)("data-v-2c9f4d00"),e=e(),(0,l.jt)(),e},gh={id:"drawerbox"},kh=bh((function(){return(0,l.Lk)("h2",{style:{color:"black"}},"审核记录",-1)})),vh={style:{color:"white"}},Ih={class:"reviewCardInfo"},yh={style:{color:"gray","margin-right":"auto","font-size":"12px"}},Ch={style:{color:"gray","margin-left":"auto","font-size":"12px"}},Ah={style:{width:"90%","text-overflow":"ellipsis",overflow:"hidden","word-wrap":"break-word"}},Fh=["onClick"],wh={class:"reviewBoxStyle"},Sh=bh((function(){return(0,l.Lk)("h2",null,"评审反馈：",-1)})),_h={class:"dialog-footer"};function Eh(e,t,o,n,r,a){var s=(0,l.g2)("el-row"),c=(0,l.g2)("Delete"),u=(0,l.g2)("el-icon"),d=(0,l.g2)("el-option"),h=(0,l.g2)("el-select"),f=(0,l.g2)("el-form-item"),m=(0,l.g2)("el-input"),p=(0,l.g2)("el-form"),b=(0,l.g2)("el-button"),g=(0,l.g2)("el-drawer");return(0,l.uX)(),(0,l.CE)("div",gh,[(0,l.bF)(g,{modelValue:r.openDrawer,"onUpdate:modelValue":t[3]||(t[3]=function(e){return r.openDrawer=e}),"show-close":!1,"lock-scroll":!1},{header:(0,l.k6)((function(){return[kh]})),default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.reviewInfo,(function(e,t){return(0,l.uX)(),(0,l.CE)("div",{class:"reviewCard",key:t},[(0,l.Lk)("div",{class:"reviewCardStatus",style:(0,C.Tr)("3"===e.resultStatus?r.statusPass:r.statusNotPass)},[(0,l.Lk)("span",vh,(0,C.v_)("3"==e.resultStatus?"已审核":"已退回"),1)],4),(0,l.Lk)("div",Ih,[(0,l.bF)(s,{style:{padding:"5px 5px 0px 5px"}},{default:(0,l.k6)((function(){return[(0,l.Lk)("span",yh,(0,C.v_)(e.reviewerName),1),(0,l.Lk)("span",Ch,(0,C.v_)(e.createTime),1)]})),_:2},1024),(0,l.bF)(s,{style:{"padding-top":"5px","padding-left":"5px"}},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",Ah,(0,C.v_)(e.remark),1)]})),_:2},1024)]),(0,l.bo)((0,l.Lk)("div",{class:"reviewCardDelete",style:{"background-color":"rgb(247, 92, 92)",cursor:"pointer"},onClick:function(t){return a.deleteReview(e.reviewId)}},[(0,l.bF)(u,{size:"24px",color:"white"},{default:(0,l.k6)((function(){return[(0,l.bF)(c)]})),_:1})],8,Fh),[[i.aG,"教师"!=r.identity]])])})),128)),(0,l.bo)((0,l.Lk)("div",wh,[Sh,(0,l.bF)(p,{model:r.checkFeedback,rules:r.checkFeedbackRules,ref:"ruleForm"},{default:(0,l.k6)((function(){return[(0,l.bF)(f,{label:"审核是否通过：","label-width":140,prop:"checkState"},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{modelValue:r.checkFeedback.checkState,"onUpdate:modelValue":t[0]||(t[0]=function(e){return r.checkFeedback.checkState=e})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.checkStates,(function(e){return(0,l.uX)(),(0,l.Wv)(d,{key:e.value,value:e.value,label:e.label},null,8,["value","label"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),(0,l.bF)(f,{label:"审核意见：","label-width":140,prop:"message"},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{modelValue:r.checkFeedback.message,"onUpdate:modelValue":t[1]||(t[1]=function(e){return r.checkFeedback.message=e}),autocomplete:"off",rows:10,maxlength:"500","show-word-limit":"",type:"textarea"},null,8,["modelValue"])]})),_:1})]})),_:1},8,["model","rules"])],512),[[i.aG,"已提交"==r.status&&("学院管理员"==r.identity||"课程负责人"==r.identity)]])]})),footer:(0,l.k6)((function(){return[(0,l.bo)((0,l.Lk)("span",_h,[(0,l.bF)(b,{type:"primary",onClick:t[2]||(t[2]=function(e){return a.submitForm("ruleForm")})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 提交反馈 ")]})),_:1})],512),[[i.aG,"已提交"==r.status&&("学院管理员"==r.identity||"课程负责人"==r.identity)]])]})),_:1},8,["modelValue"])])}var Nh=o(45013),Vh=o(28207);const xh={name:"reviewDrawer",props:{visible:Boolean},components:{Back:ee.kcb,Avatar:ee.euF,TrendCharts:ee.R0w,Checked:ee.y$q,Download:ee.f5X,UploadFilled:ee.m8m,Finished:ee.d57,ElDialog:be.kZ,ElForm:fe.US,Management:ee.iVF,ElSwitch:ph.qi,ElDrawer:Nh.pw,ElCollapse:Vh.Vl,Delete:ee.epd},data:function(){return{statusPass:{backgroundColor:"green"},statusNotPass:{backgroundColor:"orange"},reviewInfo:[],activeNames:"",openDrawer:!1,hasNoReviewInfo:Boolean,checkStates:[{label:"审核通过",value:"3"},{label:"退回",value:"4"}],selectedCheckState:"",checkFeedback:{message:"",checkState:"",workNumber:"",reviewerName:""},checkFeedbackRules:{checkState:[{required:!0,trigger:"blur"}]},showCheckDialogFlag:!1,identity:"",classInfo:{},academicYear:[],semester:[],hasFile:!1,objectInfo:[],status:""}},mounted:function(){this.identity=this.$store.state.currentInfo.identity,this.openDrawer=this.$store.state.currentInfo.opendrawer,"学院管理员"==this.identity?this.classInfo=this.$store.state.currentInfo.adminSideClassInfo:"课程负责人"==this.identity?this.classInfo=this.$store.state.currentInfo.respondClassInfo:this.classInfo=this.$store.state.currentInfo.teacherSideClassInfo,this.checkFeedback.message=this.$store.state.reviewInfo.message,this.checkFeedback.checkState=this.$store.state.reviewInfo.checkState,this.getClassInfo(),this.getReviewInfo()},computed:{openDrawerChange:function(){return this.$props.visible},checkStateChange:function(){return this.checkFeedback.checkState},checkMessageChange:function(){return this.checkFeedback.message}},watch:{openDrawerChange:{deep:!0,handler:function(e){this.openDrawer=this.$props.visible}},checkStateChange:{deep:!0,handler:function(e){this.$store.commit("reviewInfo/setmessage",this.checkFeedback.message),this.$store.commit("reviewInfo/setcheckState",this.checkFeedback.checkState)}},checkMessageChange:{deep:!0,handler:function(e){this.$store.commit("reviewInfo/setmessage",this.checkFeedback.message),this.$store.commit("reviewInfo/setcheckState",this.checkFeedback.checkState)}}},methods:{deleteReview:function(e){var t=this;P.s.confirm("是否删除该评审意见？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){vr(e).then((function(e){console.log("deleteReview res",e),204==e&&(0,G.nk)({type:"success",message:"删除成功",duration:1500}),t.getReviewInfo()}))["catch"]((function(e){(0,G.nk)({type:"error",message:"删除失败",duration:1500}),console.log("e",e)}))}))["catch"]((function(){}))},sendopenDrawer:function(){this.$emit("getData",!1)},collapseHandleChange:function(e){},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return(0,G.nk)({type:"error",message:"新建失败",duration:1500}),!1;gr(t.classInfo.classId,t.checkFeedback,t.checkFeedback.checkState).then((function(e){if("SUCCESS"==e.code){(0,G.nk)({type:"success",message:"新建成功",duration:1500});for(var o=Object.keys(t.checkStates),n=0,r=o;n<r.length;n++){var a=r[n];if(console.log(t.checkStates[a],t.checkFeedback.checkState),t.checkStates[a]["value"]==t.checkFeedback.checkState){t.status=t.checkStates[a]["label"],console.log("status:",t.status);break}}t.getClassInfo(),t.getReviewInfo()}}))["catch"]((function(e){409===e.status?(0,G.nk)({type:"error",message:"新建失败,提交已存在",duration:1500}):500===e.status?(0,G.nk)({type:"error",message:"提交出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500})}))}))},getDictionary:function(){var e=this;qt().then((function(t){e.academicYear=t.academic_year,e.semester=t.semester,e.academicYear.forEach((function(t){t.dictValue==e.classInfo.academicYear&&(e.classInfo.academicYear=t.dictLabel)})),e.semester.forEach((function(t){t.dictValue==e.classInfo.semester&&(e.classInfo.semester=t.dictLabel)}))}))},getReviewInfo:function(){var e=this;kr(this.classInfo.classId).then((function(t){console.log("getReviewInfo",t),0!=t.total?(e.hasNoReviewInfo=!1,e.reviewInfo=t.rows):e.hasNoReviewInfo=!0}))},getClassInfo:function(){var e=this;mr(this.classInfo.classId).then((function(t){"教师"==e.identity?(e.$store.commit("currentInfo/setTeacherSideClassInfo",t.data),e.classInfo=e.$store.state.currentInfo.teacherSideClassInfo):"课程负责人"==e.identity?(e.$store.commit("currentInfo/setRespondClassInfo",t.data),e.classInfo=e.$store.state.currentInfo.respondClassInfo):(e.$store.commit("currentInfo/setadminSideClassInfo",t.data),e.classInfo=e.$store.state.currentInfo.adminSideClassInfo),e.classStatus()}))},submit:function(){var e=this;"已退回"==this.status&&"教师"==this.identity?P.s.confirm("是否已按照审核意见进行修改?","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){br(e.classInfo.classId).then((function(t){"SUCCESS"==t.code&&(0,G.nk)({type:"success",message:"新建成功",duration:1500}),e.getClassInfo()}))["catch"]((function(e){409===e.status?(0,G.nk)({type:"error",message:"新建失败,提交已存在",duration:1500}):500===e.status?(0,G.nk)({type:"error",message:"新建出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500})}))}))["catch"]((function(){})):br(this.classInfo.classId).then((function(t){"SUCCESS"==t.code&&(0,G.nk)({type:"success",message:"新建成功",duration:1500}),e.getClassInfo()}))["catch"]((function(e){409===e.status?(0,G.nk)({type:"error",message:"新建失败,提交已存在",duration:1500}):500===e.status?(0,G.nk)({type:"error",message:"新建出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500})}))},classStatus:function(){switch(this.classInfo.status){case"1":this.status="未提交";break;case"2":this.status="已提交";break;case"3":this.status="已审核";break;case"4":this.status="已退回";break}}}},Th=(0,h.A)(xh,[["render",Eh],["__scopeId","data-v-2c9f4d00"]]),jh=Th;var Lh,Dh=o(13293);const Bh={name:"Workbook",components:{UploadFilled:ee.m8m,Back:ee.kcb,reviewDrawer:jh,ElSwitch:ph.qi,DocumentChecked:ee.Fmj},data:function(){return{identity:"",openDrawer:!1,classInfo:{},noEdit:!1,hasWorkbook:Boolean,courseId:"",detailId:"",formPresent:[],workbook:[],json:[],option:{},fApi:{},value:{},afterPreValue:{},url:"",editor:[],canSave:!1}},mounted:function(){this.url=(0,l.WQ)("$baseURL"),this.openDrawer=this.$store.state.currentInfo.opendrawer,this.getPre()},computed:{teacherInfoChange:function(){return this.$store.state.currentInfo.teacherSideClassInfo},respondInfoChange:function(){return this.$store.state.currentInfo.respondClassInfo},adminInfoChange:function(){return this.$store.state.currentInfo.adminSideClassInfo}},watch:{teacherInfoChange:{deep:!0,handler:function(e){"教师"==this.identity&&(this.classInfo=this.$store.state.currentInfo.teacherSideClassInfo)}},respondInfoChange:{deep:!0,handler:function(e){"课程负责人"==this.identity&&(this.classInfo=this.$store.state.currentInfo.respondClassInfo)}},adminInfoChange:{deep:!0,handler:function(e){"学院管理员"==this.identity&&(this.classInfo=this.$store.state.currentInfo.adminSideClassInfo)}}},methods:(Lh={openDrawerChange:function(){this.$store.commit("currentInfo/setOpenDrawer",this.openDrawer)},getPre:function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.create();case 2:console.log("classInfo",e.classInfo),e.courseId=e.classInfo.courseId,e.detailId=e.classInfo.detailId;case 5:case"end":return t.stop()}}),t)})))()},create:function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.createValue();case 2:return t.next=4,is(e.classInfo.classId,e.value).then((function(t){"SUCCESS"===t.code&&e.getClassInfo()}));case 4:case"end":return t.stop()}}),t)})))()},createValue:function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,o){e.identity=e.$store.state.currentInfo.identity,"学院管理员"==e.identity?e.classInfo=e.$store.state.currentInfo.adminSideClassInfo:"课程负责人"==e.identity?e.classInfo=e.$store.state.currentInfo.respondClassInfo:e.classInfo=e.$store.state.currentInfo.teacherSideClassInfo,2==e.classInfo.status||3==e.classInfo.status?e.noEdit=!0:e.noEdit=!1,e.classInfo.workbookJson||(e.value=JSON.parse(JSON.stringify(e.classInfo.workbookJson)),console.log("*(*())",Qo().isEqual(e.classInfo.workbookJson,e.value))),e.getWorkbook(),t("suc"),o(err)})));case 1:case"end":return t.stop()}}),t)})))()}},(0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)(Lh,"openDrawerChange",(function(){this.$store.commit("currentInfo/setOpenDrawer",this.openDrawer)})),"isBase64Encoded",(function(e){var t=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/;return t.test(e)})),"backClass",(function(){var e=this;if("教师"==this.identity){console.log("save",this.value);var t=JSON.parse(JSON.stringify(this.afterPreValue)),o=JSON.parse(JSON.stringify(this.value));console.log(t,o,Qo().isEqual(t,o)),this.editor.forEach((function(o){"string"===typeof t[o]&&t[o].includes("zheshibase64bianma/")&&(t[o]=t[o].slice(19),e.isBase64Encoded(t[o])&&(t[o]=Dh.o4.decode(t[o])))})),Qo().isEqual(t,o)||this.canSave?this.$router.push({name:"TeacherClass"}):P.s.confirm("数据还未保存，是否仍然关闭？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.$router.push({name:"TeacherClass"})}))["catch"]((function(){}))}else this.$router.push({name:"TeacherClass"})})),"disabledForm",(function(){this.workbook.formJson.forEach((function(e){Array.isArray(e.children)&&e.children.forEach((function(e){"object"===(0,O.A)(e)&&(Array.isArray(e.children)&&""!==e.children[0]&&e.children.forEach((function(e){"object"===(0,O.A)(e)&&(void 0===e.props&&(e.props={}),e.props.disabled=!0)})),void 0===e.props&&(e.props={}),e.props.disabled=!0)})),void 0===e.props&&(e.props={}),e.props.disabled=!0}))})),"abledForm",(function(){this.workbook.formJson.forEach((function(e){e.props.disabled=!1}))})),"saveToLocal",(function(e,t){var o=this;localStorage.setItem("classId",JSON.stringify(t)),localStorage.setItem("workbook",JSON.stringify(e)),console.log(e,"   s!!!!2134234234234");var n=function(t){if(!e[t])return 1;o.editor.forEach((function(n){n==t&&e[t].includes("zheshibase64bianma/")&&(e[t]=e[t].slice(19),o.isBase64Encoded(e[t])&&(e[t]=Dh.o4.decode(e[t])))}))};for(var r in e)n(r)})),"tempSave",(function(e,t){var o=this;localStorage.setItem("classId",JSON.stringify(t)),localStorage.setItem("workbook",JSON.stringify(e));var n=function(t){if(!e[t])return 1;o.editor.forEach((function(n){n==t&&e[t].includes("zheshibase64bianma/")&&(e[t]=e[t].slice(19),o.isBase64Encoded(e[t])&&(e[t]=Dh.o4.decode(e[t])))}))};for(var r in e)n(r);(0,G.nk)({type:"success",message:"临时保存成功",duration:1500}),this.canSave=!0})),"save",(function(){var e=this;this.fApi.submit((function(t,o){e.editor.forEach((function(e){t[e]=Dh.o4.encode(t[e]),t[e]="zheshibase64bianma/"+t[e]})),console.log("save",t),is(e.classInfo.classId,t).then((function(t){"SUCCESS"===t.code&&((0,G.nk)({type:"success",message:"保存成功",duration:1500}),localStorage.removeItem("classId"),localStorage.removeItem("workbook"),e.getClassInfo())}))}))["catch"]((function(e){(0,G.nk)({type:"error",message:"部分字段未填写完整",duration:1500})}))})),"getWorkbook",(function(){var e=this;as(this.classInfo.classId).then((function(t){"SUCCESS"===t.code&&(0==t.data.length?e.hasWorkbook=!1:(e.hasWorkbook=!0,t.data.formJson.forEach((function(t){var o=e;if("upload"===t.type){var n=t.props.limit;t.props={disabled:!1,limit:n,listType:"text",multiple:!0,name:"files",action:e.url+"common/upload/files",headers:{Authorization:"Bearer "+u.A.get("Admin-Token")},data:{param:e.classInfo.classId,type:"workbookFile",field:t.field},onSuccess:function(e,t){t.url=e.fileRecords[0].fileAddress},onExceed:function(){(0,G.nk)({type:"warning",message:"超出上传文件数量限制",duration:1500})},onPreview:function(e){o.download(e)}}}})),e.workbook=t.data,e.workbookId=e.workbook.workbookId,console.log("workbook",e.workbook),e.json=t.data.formJson,e.json.forEach((function(t){t.type&&"fc-editor"===t.type&&e.editor.push(t.field)})),e.option=t.data.cssJson,e.option.submitBtn=!1,2==e.classInfo.status||3==e.classInfo.status||"教师"!==e.identity?e.disabledForm():e.abledForm()))}))["catch"]((function(t){"资源不存在"==t.msg&&"NOT_FIND"==t.code&&(e.hasWorkbook=!1)}))})),"getClassInfo",(function(){var e=this;mr(this.classInfo.classId).then((function(t){console.log("getClassInfo",t),"学院管理员"==e.identity?e.$store.commit("currentInfo/setadminSideClassInfo",t.data):"课程负责人"==e.identity?e.$store.commit("currentInfo/setRespondClassInfo",t.data):e.$store.commit("currentInfo/setTeacherSideClassInfo",t.data),e.value=JSON.parse(JSON.stringify(t.data.workbookJson)),console.log("value",e.value),e.editor.forEach((function(t){"string"===typeof e.value[t]&&e.value[t].includes("zheshibase64bianma/")&&(e.value[t]=e.value[t].slice(19),e.isBase64Encoded(e.value[t])&&(e.value[t]=Dh.o4.decode(e.value[t])))})),console.log("decode",e.value),e.getPresent()}))})),(0,$.A)((0,$.A)((0,$.A)((0,$.A)(Lh,"download",(function(e){var t=e.url,o=e.name;Nl(t).then((function(e){console.log("downloadFile",e);var t=new Blob([e]),n=document.createElement("a");n.download=decodeURI(o),n.style.display="none",n.href=URL.createObjectURL(t),document.body.appendChild(n),n.click(),URL.revokeObjectURL(n.href),document.body.removeChild(n)}))})),"getPresent",(function(){var e=this;this.detailId&&cs(this.detailId).then((function(t){console.log("getPresent",t),e.formPresent=t.data.preset.formPreset,e.formPresent.forEach((function(e){"["==e.value[0]&&(e.value=e.value.match(/\d+/g))})),console.log("getPresent",e.formPresent),e.getLocalValue()}))})),"getLocalValue",(function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){var o;return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.showPresent(e.json);case 2:localStorage.getItem("workbook")&&(console.log("!",e.classInfo.classId),localStorage.getItem("classId")==e.classInfo.classId?(o=JSON.parse(localStorage.getItem("workbook")),e.value=o,e.afterPreValue=o,console.log("????")):(console.log("remove"),localStorage.removeItem("classId"),localStorage.removeItem("workbook"))),e.$watch("value",(function(t){console.log("元素的值已经变化：",t),e.saveToLocal(t,e.classInfo.classId)}));case 4:case"end":return t.stop()}}),t)})))()})),"showPresent",(function(e){var t=this;return(0,Kt.A)((0,Xt.A)().mark((function o(){return(0,Xt.A)().wrap((function(o){while(1)switch(o.prev=o.next){case 0:e.forEach((function(e){Array.isArray(e.children)&&e.children.length>0?t.showPresent(e.children):""!==e&&t.formPresent.forEach((function(t){t.field===e.field&&void 0===e.value&&(e.value=t.value)}))}));case 1:case"end":return o.stop()}}),o)})))()})))},$h=(0,h.A)(Bh,[["render",mh],["__scopeId","data-v-760297f3"]]),Oh=$h;var Mh=function(e){return(0,l.Qi)("data-v-0258215a"),e=e(),(0,l.jt)(),e},Uh={class:"content"},Wh={class:"block"},Rh=Mh((function(){return(0,l.Lk)("div",{class:"block_title"},"预设手册模板",-1)})),Ph={class:"form-card"};function Gh(e,t,o,n,r,a){var s=(0,l.g2)("Back"),i=(0,l.g2)("el-icon"),c=(0,l.g2)("el-tooltip"),u=(0,l.g2)("el-divider"),d=(0,l.g2)("UploadFilled"),h=(0,l.g2)("el-row"),f=(0,l.g2)("form-create");return(0,l.uX)(),(0,l.CE)("div",Uh,[(0,l.Lk)("div",Wh,[(0,l.bF)(h,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.back()})},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1}),Rh,(0,l.bF)(u,{class:"divider",direction:"vertical"}),(0,l.Lk)("div",null,[(0,l.bF)(c,{class:"box-item",effect:"dark",content:"保存",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",onClick:t[1]||(t[1]=function(e){return a.save()}),style:{"margin-left":"10px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(d)]})),_:1})]})),_:1})])]})),_:1})]),(0,l.Lk)("div",Ph,[(0,l.bF)(f,{modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=function(e){return r.value=e}),api:r.fApi,"onUpdate:api":t[3]||(t[3]=function(e){return r.fApi=e}),rule:r.json,option:r.option},null,8,["modelValue","api","rule","option"])])])}const zh={name:"WorkbookPresent",components:{Back:ee.kcb,DocumentChecked:ee.Fmj,UploadFilled:ee.m8m},data:function(){return{workbook:[],presentValue:[],formPresent:[],json:[],option:{},fApi:{},value:{},courseId:"",detailId:"",workbookId:"",origin:{},editor:[]}},mounted:function(){this.courseId=this.$store.state.course.courseId,this.detailId=this.$store.state.course.detailId,this.getWorkbook()},methods:{back:function(){var e=this,t=JSON.parse(JSON.stringify(this.json));console.log(Qo().isEqual(this.origin,t)),Qo().isEqual(this.origin,t)?this.$router.push("/templateManage"):P.s.confirm("数据还未保存，是否仍然关闭？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.$router.push("/templateManage")}))["catch"]((function(){}))},save:function(){var e=this;this.searchChildren(this.json);var t=(0,Ql.A)(new Set(this.editor));t.forEach((function(t){e.presentValue.forEach((function(e){t==e.field&&(e.value="zheshibase64bianma/"+Dh.o4.encode(e.value))}))})),console.log("!",t,this.presentValue),ls(this.detailId,this.presentValue,this.courseId).then((function(t){"SUCCESS"===t.code&&(e.getWorkbook(),(0,G.nk)({type:"success",message:"更新成功",duration:1500}))}))["catch"]((function(e){500==e.status&&(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500})}))},getPresent:function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,cs(e.detailId).then((function(t){e.formPresent=t.data.preset.formPreset,e.formPresent.forEach((function(e){"["==e.value[0]&&(e.value=e.value.match(/\d+/g),console.log("!",e.value))}))}));case 2:return t.next=4,e.showPresent(e.json);case 4:e.origin=JSON.parse(JSON.stringify(e.json));case 5:case"end":return t.stop()}}),t)})))()},isBase64Encoded:function(e){var t=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/;return t.test(e)},showPresent:function(e){var t=this;return(0,Kt.A)((0,Xt.A)().mark((function o(){return(0,Xt.A)().wrap((function(o){while(1)switch(o.prev=o.next){case 0:e.forEach((function(e){Array.isArray(e.children)&&e.children.length>0?t.showPresent(e.children):""!==e&&t.formPresent.forEach((function(o){if(o.field==e.field&&(e.value=o.value,"string"===typeof e.value&&e.value.includes("zheshibase64bianma/"))){var n=e.value.slice(19);t.isBase64Encoded(n)&&(e.value=Dh.o4.decode(n),console.log("@@",Dh.o4.decode(n)))}}))}));case 1:case"end":return o.stop()}}),o)})))()},getWorkbook:function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:ss(e.courseId).then((function(t){"SUCCESS"===t.code&&(t.data.formJson.forEach((function(e){"upload"===e.type&&(e.props={disabled:!0})})),e.workbook=t.data,e.workbookId=e.workbook.workbookId,e.value=e.workbook.formJson,e.dfs(e.value),console.log("this.value",e.value),console.log("getWorkbook1111",e.workbook),e.json=t.data.formJson,e.json.forEach((function(t){t.type&&"fc-editor"===t.type&&e.editor.push(t.field)})),e.option=t.data.cssJson,e.option.submitBtn=!1,e.getPresent())}));case 1:case"end":return t.stop()}}),t)})))()},dfs:function(e){var t=this;e.forEach((function(e){e.$required&&(e.$required=!1),e.children&&t.dfs(e.children)}))},searchChildren:function(e){var t=this;e.forEach((function(e){Array.isArray(e.children)&&e.children.length>0?t.searchChildren(e.children):""!==e&&void 0!==e.value&&("object"===(0,O.A)(e.value)&&(e.value=JSON.stringify(e.value)),t.presentValue.push({field:e.field,value:e.value}))}))}}},Yh=(0,h.A)(zh,[["render",Gh],["__scopeId","data-v-0258215a"]]),Xh=Yh;function Qh(e,t,o,n,r,a){var s=(0,l.g2)("MainHeader"),i=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(s),(0,l.bF)(i)],64)}const Kh={name:"TeacherIndex",components:{MainHeader:ka}},Jh=(0,h.A)(Kh,[["render",Qh]]),Hh=Jh;var qh=function(e){return(0,l.Qi)("data-v-29100316"),e=e(),(0,l.jt)(),e},Zh={class:"rightSlot"},ef={class:"selects"},tf={class:"classes-list"},of=["onClick"],nf=qh((function(){return(0,l.Lk)("div",{class:"cardPic"},[(0,l.Lk)("img",{src:Xs}),(0,l.Lk)("div",{class:"cardMask"},[(0,l.Lk)("button",{class:"cardMaskBtn"},"进入课程")])],-1)})),rf={class:"cardText"};function af(e,t,o,n,r,a){var s=(0,l.g2)("el-option"),c=(0,l.g2)("el-select"),u=(0,l.g2)("HeaderSearch");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(u,{msg:"搜索课程名称、任课教师(姓名、工号)、课程号、开课号",onSearchValue:a.getSearchValue,value:r.keyword},{rightTime:(0,l.k6)((function(){return[(0,l.bo)((0,l.Lk)("div",Zh,[(0,l.Lk)("div",ef,[(0,l.bF)(c,{modelValue:r.chosenYear,"onUpdate:modelValue":t[0]||(t[0]=function(e){return r.chosenYear=e}),placeholder:"全部学年",class:"selecter",onChange:t[1]||(t[1]=function(e){return a.getClassesList()})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.academicYear,(function(e){return(0,l.uX)(),(0,l.Wv)(s,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"]),(0,l.bF)(c,{modelValue:r.chosenSemester,"onUpdate:modelValue":t[2]||(t[2]=function(e){return r.chosenSemester=e}),placeholder:"全部学期",class:"selecter",onChange:t[3]||(t[3]=function(e){return a.getClassesList()})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.semester,(function(e){return(0,l.uX)(),(0,l.Wv)(s,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"]),(0,l.bF)(c,{modelValue:r.chosenStatus,"onUpdate:modelValue":t[4]||(t[4]=function(e){return r.chosenStatus=e}),placeholder:"提交状态",class:"status",onChange:t[5]||(t[5]=function(e){return a.getClassesList()})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.classStatus,(function(e){return(0,l.uX)(),(0,l.Wv)(s,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])])],512),[[i.aG,!e.showAdd]])]})),_:1},8,["onSearchValue","value"]),(0,l.Lk)("div",tf,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.classesList,(function(e){return(0,l.uX)(),(0,l.CE)("div",{class:"card",key:e.classId,onClick:function(t){return a.toClass(e)}},[nf,(0,l.Lk)("div",rf,[(0,l.Lk)("h3",null,(0,C.v_)(e.className),1),(0,l.Lk)("span",null,(0,C.v_)(e.identifier),1)])],8,of)})),128))])],64)}function sf(e,t,o,n,r,a){return Q({url:"/classes/teacher",method:"get",params:{schoolId:e,departmentId:t,selectKeyWord:o,academicYear:n,semester:r,status:a}})}const lf={name:"TeacherClasses",components:{Search:ee.vji,DeleteFilled:ee.Sz$,Tools:ee.S0q,HeaderSearch:ne},data:function(){return{classesList:{},keyword:"",chosenYear:"",chosenSemester:"",chosenStatus:"",academicYear:[],semester:[],classStatus:[],status:[{value:null,label:"全部"},{value:1,label:"未提交"},{value:2,label:"已提交"},{value:3,label:"已审核"},{value:4,label:"已退回"}]}},mounted:function(){this.getDictionary(),sessionStorage.getItem("classTeacherSearchFlag")&&"null"!==sessionStorage.getItem("teacherSearchForm")?(this.keyword=sessionStorage.getItem("teacherSearchForm"),this.getSearchValue(this.keyword)):sessionStorage.removeItem("teacherSearchForm")},beforeRouteLeave:function(e,t,o){"/teacherClasses"===t.path&&"/teacherClass"!==e.path&&(sessionStorage.removeItem("teacherChosenYear"),sessionStorage.removeItem("teacherChosenSemester"),sessionStorage.removeItem("teacherChosenStatus"),sessionStorage.removeItem("teacherSearchForm"),sessionStorage.removeItem("classTeacherSearchFlag")),o()},methods:{getDictionary:function(){var e=this;qt().then((function(t){console.log("getDictionary",t),e.academicYear=t.academic_year,e.semester=t.semester,e.classStatus=t.class_status,e.onlyAcademicYear=JSON.parse(JSON.stringify(t.academic_year)),e.onlySemester=JSON.parse(JSON.stringify(t.semester));var o={dictLabel:"全部学年",dictValue:null};e.academicYear.unshift(o);var n={dictLabel:"全部学期",dictValue:null};e.semester.unshift(n);var r={dictLabel:"全部",dictValue:null};e.classStatus.unshift(r);var a=sessionStorage.getItem("teacherChosenYear"),s=sessionStorage.getItem("teacherChosenSemester"),i=sessionStorage.getItem("teacherChosenStatus");(a||s||i)&&(e.chosenYear="null"===a?null:a,e.chosenSemester="null"===s?null:s,e.chosenStatus="null"===i?null:i),e.getClassesList()}))},getClassesList:function(){var e=this;sf(this.$store.state.currentInfo.schoolId,this.$store.state.currentInfo.departmentId,this.keyword,this.chosenYear,this.chosenSemester,this.chosenStatus).then((function(t){e.classesList=t.rows,console.log("getClassesList",e.classesList)}))},toClass:function(e){this.$store.commit("currentInfo/setTeacherSideClassInfo",e),this.$store.commit("currentInfo/setOpenDrawer",!1),sessionStorage.setItem("teacherSearchForm",this.keyword),sessionStorage.removeItem("classTeacherSearchFlag"),""===this.chosenYear&&""===this.chosenSemester&&""===this.chosenStatus||(sessionStorage.setItem("teacherChosenYear",this.chosenYear),sessionStorage.setItem("teacherChosenSemester",this.chosenSemester),sessionStorage.setItem("teacherChosenStatus",this.chosenStatus)),this.$router.push({name:"TeacherClass"})},getSearchValue:function(e){this.keyword=e,sessionStorage.removeItem("classTeacherSearchFlag"),console.log("keyword",this.keyword),this.getClassesList()}}},cf=(0,h.A)(lf,[["render",af],["__scopeId","data-v-29100316"]]),uf=cf;var df=function(e){return(0,l.Qi)("data-v-298beb1a"),e=e(),(0,l.jt)(),e},hf={class:"content"},ff={class:"block"},mf=df((function(){return(0,l.Lk)("div",{class:"title"},"全部课程",-1)})),pf={class:"status_desc"},bf={class:"status_desc"},gf={class:"status_desc"},kf={class:"body"},vf={class:"card"},If=df((function(){return(0,l.Lk)("h3",null,"课程信息",-1)})),yf=df((function(){return(0,l.Lk)("div",{class:"detail-title"},"课程名",-1)})),Cf={class:"detail-info"},Af=df((function(){return(0,l.Lk)("div",{class:"detail-title"},"课程号",-1)})),Ff={class:"detail-info"},wf=df((function(){return(0,l.Lk)("div",{class:"detail-title"},"开课号",-1)})),Sf={class:"detail-info"},_f=df((function(){return(0,l.Lk)("div",{class:"detail-title"},"学年",-1)})),Ef={class:"detail-info"},Nf=df((function(){return(0,l.Lk)("div",{class:"detail-title"},"学期",-1)})),Vf={class:"detail-info"};function xf(e,t,o,n,r,a){var s=(0,l.g2)("Back"),c=(0,l.g2)("el-icon"),u=(0,l.g2)("el-tooltip"),d=(0,l.g2)("el-divider"),h=(0,l.g2)("TrendCharts"),f=(0,l.g2)("Checked"),m=(0,l.g2)("Management"),p=(0,l.g2)("UploadFilled"),b=(0,l.g2)("el-switch"),g=(0,l.g2)("el-row"),k=(0,l.g2)("el-col"),v=(0,l.g2)("el-table-column"),I=(0,l.g2)("el-table"),y=(0,l.g2)("reviewDrawer");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",hf,[(0,l.Lk)("div",ff,[(0,l.bF)(g,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.backHome()})},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1}),mf,(0,l.bF)(d,{class:"divider",direction:"vertical"}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"成绩",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"20px"},onClick:t[1]||(t[1]=function(e){return a.toScore()})},{default:(0,l.k6)((function(){return[(0,l.bF)(h)]})),_:1})]})),_:1}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"课程目标",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"20px"},onClick:t[2]||(t[2]=function(e){return a.toObjectives()})},{default:(0,l.k6)((function(){return[(0,l.bF)(f)]})),_:1})]})),_:1}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"工作手册",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"20px"},onClick:t[3]||(t[3]=function(e){return a.toWorkbook()})},{default:(0,l.k6)((function(){return[(0,l.bF)(m)]})),_:1})]})),_:1}),(0,l.bF)(d,{class:"divider",direction:"vertical"}),(0,l.bo)((0,l.Lk)("div",null,[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"提交",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"10px"},onClick:t[4]||(t[4]=function(e){return a.submit()})},{default:(0,l.k6)((function(){return[(0,l.bF)(p)]})),_:1})]})),_:1})],512),[[i.aG,"未提交"==r.status&&"教师"==r.identity]]),(0,l.bo)((0,l.Lk)("div",pf," 未提交 ",512),[[i.aG,"未提交"==r.status&&("学院管理员"==r.identity||"课程负责人"==r.identity)]]),(0,l.bo)((0,l.Lk)("div",bf," 已提交 ",512),[[i.aG,"已提交"==r.status&&"教师"==r.identity]]),(0,l.bo)((0,l.Lk)("div",gf," 待审核 ",512),[[i.aG,"已提交"==r.status&&("学院管理员"==r.identity||"课程负责人"==r.identity)]]),(0,l.bo)((0,l.Lk)("div",null,"已退回",512),[[i.aG,"已退回"==r.status&&"教师"==r.identity]]),(0,l.bo)((0,l.Lk)("div",null,[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"重新提交",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"10px"},onClick:t[5]||(t[5]=function(e){return a.submit()})},{default:(0,l.k6)((function(){return[(0,l.bF)(p)]})),_:1})]})),_:1})],512),[[i.aG,"已退回"==r.status&&"教师"==r.identity]]),(0,l.bo)((0,l.Lk)("div",null," 已退回 ",512),[[i.aG,"已退回"==r.status&&("学院管理员"==r.identity||"课程负责人"==r.identity)]]),(0,l.bo)((0,l.Lk)("div",null,"已审核",512),[[i.aG,"已审核"==r.status]]),(0,l.bF)(d,{class:"divider",direction:"vertical"}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"审核意见",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{modelValue:r.openDrawer,"onUpdate:modelValue":t[6]||(t[6]=function(e){return r.openDrawer=e}),class:"switchstyle",ref:"switch",onChange:a.openDrawerChange},null,8,["modelValue","onChange"])]})),_:1})]})),_:1})]),(0,l.Lk)("div",kf,[(0,l.Lk)("div",vf,[If,(0,l.bF)(k,null,{default:(0,l.k6)((function(){return[(0,l.bF)(k,{style:{"margin-top":"15px"}},{default:(0,l.k6)((function(){return[yf,(0,l.Lk)("div",Cf,(0,C.v_)(r.classInfo.className),1)]})),_:1}),(0,l.bF)(g,{style:{"margin-top":"15px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(k,{span:12,style:{"margin-top":"10px"}},{default:(0,l.k6)((function(){return[Af,(0,l.Lk)("div",Ff,(0,C.v_)(r.classInfo.courseCode),1)]})),_:1}),(0,l.bF)(k,{span:12,style:{"margin-top":"10px"}},{default:(0,l.k6)((function(){return[wf,(0,l.Lk)("div",Sf,(0,C.v_)(r.classInfo.identifier),1)]})),_:1})]})),_:1}),(0,l.bF)(g,{style:{"margin-top":"15px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(k,{span:12,style:{"margin-top":"10px"}},{default:(0,l.k6)((function(){return[_f,(0,l.Lk)("div",Ef,(0,C.v_)(r.classInfo.academicYear),1)]})),_:1}),(0,l.bF)(k,{span:6,style:{"margin-top":"10px"}},{default:(0,l.k6)((function(){return[Nf,(0,l.Lk)("div",Vf,(0,C.v_)(r.classInfo.semester),1)]})),_:1})]})),_:1}),(0,l.bF)(k,{style:{"margin-top":"25px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(g,null,{default:(0,l.k6)((function(){return[(0,l.bF)(k,{class:"detail-title"},{default:(0,l.k6)((function(){return[(0,l.eW)("课程大纲")]})),_:1}),(0,l.bF)(k,null,{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(I,{data:e.filesList,style:{cursor:"pointer","margin-top":"10px",width:"180px"},"show-header":!1,onRowClick:a.downloadFile},{default:(0,l.k6)((function(){return[(0,l.bF)(v,{prop:"originalName",label:"文件名",width:"180px"})]})),_:1},8,["data","onRowClick"]),[[i.aG,r.hasFile]])]})),_:1})]})),_:1})]})),_:1})]})),_:1})])])]),(0,l.bF)(y,{visible:r.openDrawer,onGetData:a.getdata},null,8,["visible","onGetData"])],64)}const Tf={name:"TeacherClass",components:{Back:ee.kcb,Avatar:ee.euF,TrendCharts:ee.R0w,Checked:ee.y$q,Download:ee.f5X,UploadFilled:ee.m8m,Finished:ee.d57,ElDialog:be.kZ,ElForm:fe.US,Management:ee.iVF,ElSwitch:ph.qi,ElDrawer:Nh.pw,ElCollapse:Vh.Vl,reviewDrawer:jh},data:function(){return{isRespondent:"",reviewInfo:[],activeNames:"",openDrawer:!1,hasNoReviewInfo:Boolean,checkStates:[{label:"审核通过",value:"3"},{label:"退回",value:"4"}],selectedCheckState:"",checkFeedback:{message:"",checkState:"",workNumber:""},checkFeedbackRules:{checkState:[{required:!0,trigger:"blur"}]},showCheckDialogFlag:!1,identity:"",classInfo:{},academicYear:[],semester:[],hasFile:!1,objectInfo:[],status:""}},mounted:function(){sessionStorage.setItem("classSearchFlag",!0),sessionStorage.setItem("classTeacherSearchFlag",!0),this.identity=this.$store.state.currentInfo.identity,this.openDrawer=this.$store.state.currentInfo.opendrawer,"学院管理员"==this.identity?(this.classInfo=this.$store.state.currentInfo.adminSideClassInfo,console.log("identity:",this.identity)):"课程负责人"==this.identity?(this.classInfo=this.$store.state.currentInfo.respondClassInfo,console.log("identity:",this.identity)):(this.classInfo=this.$store.state.currentInfo.teacherSideClassInfo,console.log("identity:",this.identity)),this.getClassInfo(),this.checkFileList()},computed:{teacherInfoChange:function(){return this.$store.state.currentInfo.teacherSideClassInfo},respondInfoChange:function(){return this.$store.state.currentInfo.respondClassInfo}},watch:{teacherInfoChange:{deep:!0,handler:function(e){"教师"==this.identity&&(this.classInfo=this.$store.state.currentInfo.teacherSideClassInfo,this.classStatus())}},respondInfoChange:{deep:!0,handler:function(e){"课程负责人"==this.identity&&(this.classInfo=this.$store.state.currentInfo.respondClassInfo,this.classStatus())}}},methods:{submit:function(){var e=this;"已退回"==this.status&&"教师"==this.identity?P.s.confirm("是否已按照审核意见进行修改?","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){br(e.classInfo.classId).then((function(t){console.log("res",t),"SUCCESS"==t.code&&(0,G.nk)({type:"success",message:"提交成功",duration:1500}),e.getClassInfo()}))["catch"]((function(t){"conflict"===t.data.code?(0,G.nk)({type:"error",message:"成绩或工作手册尚未填写完整",duration:1500}):500===t.status?(0,G.nk)({type:"error",message:"提交出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500}),e.getClassInfo()}))}))["catch"]((function(e){console.log("e",e)})):P.s.confirm("请确保已录入完整的成绩和工作手册","是否确认提交",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){br(e.classInfo.classId).then((function(t){console.log("res",t),"SUCCESS"==t.code&&(0,G.nk)({type:"success",message:"提交成功",duration:1500}),e.getClassInfo()}))["catch"]((function(t){"conflict"===t.data.code?(0,G.nk)({type:"error",message:"成绩或工作手册尚未填写完整",duration:1500}):500===t.status?(0,G.nk)({type:"error",message:"提交出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500}),e.getClassInfo()}))}))["catch"]((function(e){console.log("e",e)}))},openDrawerChange:function(){this.$store.commit("currentInfo/setOpenDrawer",this.openDrawer)},getdata:function(e){this.openDrawer=e},backHome:function(){"学院管理员"==this.identity||"课程负责人"==this.identity?this.$router.push("/class"):this.$router.push("/teacherClasses")},toStudents:function(){this.$router.push({name:"Students"})},toScore:function(){this.$router.push({name:"Score"})},toObjectives:function(){this.$router.push({name:"Objectives"})},toWorkbook:function(){this.$router.push({name:"Workbook"})},getDictionary:function(){var e=this;qt().then((function(t){console.log("getDictionary",t),e.academicYear=t.academic_year,e.semester=t.semester,e.academicYear.forEach((function(t){t.dictValue==e.classInfo.academicYear&&(e.classInfo.academicYear=t.dictLabel)})),e.semester.forEach((function(t){t.dictValue==e.classInfo.semester&&(e.classInfo.semester=t.dictLabel)}))}))},getClassInfo:function(){var e=this;mr(this.classInfo.classId).then((function(t){console.log("getClassInfo",t.data),"教师"==e.identity?(e.$store.commit("currentInfo/setTeacherSideClassInfo",t.data),e.classInfo=e.$store.state.currentInfo.teacherSideClassInfo,e.isRespondent=e.classInfo.isRespondent):"课程负责人"==e.identity?(e.$store.commit("currentInfo/setRespondClassInfo",t.data),e.classInfo=e.$store.state.currentInfo.respondClassInfo):(e.$store.commit("currentInfo/setadminSideClassInfo",t.data),e.classInfo=e.$store.state.currentInfo.adminSideClassInfo),e.getDictionary(),e.classStatus()}))},checkFileList:function(){var e=this;this.classInfo.detailId&&wn(this.classInfo.detailId).then((function(t){e.filesList=t.data,0==e.filesList.length?e.hasFile=!1:e.hasFile=!0}))},downloadFile:function(e){Nl(e.fileAddress).then((function(t){var o=new Blob([t]),n=document.createElement("a");n.download=decodeURI(e.originalName),n.style.display="none",n.href=URL.createObjectURL(o),document.body.appendChild(n),n.click(),URL.revokeObjectURL(n.href),document.body.removeChild(n)}))},classStatus:function(){switch(this.classInfo.status){case"1":this.status="未提交";break;case"2":this.status="已提交";break;case"3":this.status="已审核";break;case"4":this.status="已退回";break}},downloadReport:function(){Ir(this.classInfo.classId).then((function(e){console.log("下载报告",e);var t=new Blob([e]),o=document.createElement("a");o.download=decodeURI("报告.doc"),o.style.display="none",o.href=URL.createObjectURL(t),document.body.appendChild(o),o.click(),URL.revokeObjectURL(o.href),document.body.removeChild(o)}))}}},jf=(0,h.A)(Tf,[["render",xf],["__scopeId","data-v-298beb1a"]]),Lf=jf;var Df={class:"block"},Bf={class:"title"},$f={layout:"row",flex:"",class:"md-padding"};function Of(e,t,o,n,r,a){var s=(0,l.g2)("Back"),i=(0,l.g2)("el-icon"),c=(0,l.g2)("el-tooltip"),u=(0,l.g2)("el-divider"),d=(0,l.g2)("el-row"),h=(0,l.g2)("el-table-column"),f=(0,l.g2)("el-table");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",Df,[(0,l.bF)(d,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.backClass()})},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1}),(0,l.Lk)("div",Bf,(0,C.v_)(r.classInfo.className),1),(0,l.bF)(u,{class:"divider",direction:"vertical"})]})),_:1})]),(0,l.Lk)("div",$f,[(0,l.bF)(f,{class:"studentsTable",data:r.studentsTable,style:{width:"40%"},"header-cell-style":{"padding-left":"40px","font-size":"14.4px",height:"48px","font-weight":"bold",color:"black"},"cell-style":{"padding-left":"40px","font-size":"16px",height:"60px"},"highlight-current-row":""},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{prop:"studentId",label:"学号",width:"200px"}),(0,l.bF)(h,{prop:"studentName",label:"姓名"})]})),_:1},8,["data"])])],64)}const Mf={name:"Students",components:{Back:ee.kcb,addBtn:le,request:Q},data:function(){return{programId:"",classInfo:[],studentsTable:[{studentId:222050200,studentName:"张三"},{studentId:222050211,studentName:"李四"}]}},mounted:function(){this.classInfo=this.$store.state.currentInfo.teacherSideClassInfo,this.programId=this.$store.state.major.programId,console.log("classInfo",this.classInfo),this.getStudents()},methods:{backClass:function(){this.$router.push("/teacherClass")},getStudents:function(){return Q({url:"/student/listByProgram/"+this.programId,method:"get"}).then((function(e){console.log(e)}))}}},Uf=(0,h.A)(Mf,[["render",Of],["__scopeId","data-v-742acdb2"]]),Wf=Uf;var Rf=function(e){return(0,l.Qi)("data-v-7b9a395f"),e=e(),(0,l.jt)(),e},Pf={key:0,layout:"column",flex:"",class:"ng-scope layout-column flex"},Gf={class:"block"},zf={class:"card-container"},Yf=Rf((function(){return(0,l.Lk)("div",{class:"hot-table-container",id:"courseHot"},null,-1)})),Xf=[Yf],Qf={style:{"padding-top":"120px",display:"flex","justify-content":"center","font-size":"22px","background-color":"#f2f2f2"}},Kf={style:{"padding-top":"120px",display:"flex","justify-content":"center","font-size":"22px","background-color":"#f2f2f2"}};function Jf(e,t,o,n,r,a){var s=(0,l.g2)("Back"),c=(0,l.g2)("el-icon"),u=(0,l.g2)("el-button"),d=(0,l.g2)("el-tooltip"),h=(0,l.g2)("DocumentChecked"),f=(0,l.g2)("el-row"),m=(0,l.g2)("el-tab-pane"),p=(0,l.g2)("el-tabs");return r.isRouterAlive?((0,l.uX)(),(0,l.CE)("div",Pf,[(0,l.Lk)("div",Gf,[(0,l.bF)(f,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{link:"",onClick:t[0]||(t[0]=function(e){return a.goTeacher()})},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1})]})),_:1}),(0,l.bF)(d,{class:"box-item",effect:"dark",content:"保存成绩",placement:"bottom","hide-after":0,disabled:!a.isValid()},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{onClick:a.save,link:"",disabled:!a.isValid()},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"20px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(h)]})),_:1})]})),_:1},8,["onClick","disabled"])]})),_:1},8,["disabled"])]})),_:1})]),(0,l.bo)((0,l.bF)(p,{modelValue:r.editableTabsValue,"onUpdate:modelValue":t[1]||(t[1]=function(e){return r.editableTabsValue=e}),type:"card",class:"activity-tab",onTabClick:a.editableTabsValueChange},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.editableTabs,(function(e,t){return(0,l.uX)(),(0,l.Wv)(m,{key:e.name,label:e.title,name:e.name},null,8,["label","name"])})),128))]})),_:1},8,["modelValue","onTabClick"]),[[i.aG,r.hasActivities&&r.hasObjectives]]),(0,l.bo)((0,l.Lk)("div",zf,Xf,512),[[i.aG,r.hasActivities&&r.hasObjectives]]),(0,l.bo)((0,l.Lk)("div",Qf," 未创建成绩项 ",512),[[i.aG,r.hasNoActivities]]),(0,l.bo)((0,l.Lk)("div",Kf," 未创建课程目标 ",512),[[i.aG,r.hasNoObjectives]])])):(0,l.Q3)("",!0)}o(50113);const Hf={name:"addTeacher",data:function(){return(0,$.A)((0,$.A)({compareData:[],errorInTable:!1,editableTabsValue:"0",currenteditableTabsValue:0,maxeditableTabsValue:0,editableTabs:[],tabIndex:0,originData:[],hasActivities:!1,hasNoActivities:!1,hasScores:!1,hasNoScores:!1,hasObjectives:!1,hasNoObjectives:!1,departmentId:"",schoolId:"",programId:"",classInfo:"",NUM_AUX_ROW:3,NUM_AUX_COL:2,ROW_INDEX_ACTIVITY:0,ROW_INDEX_TOTALSCORE:1,ROW_INDEX_SCORESETTING:2,currentNumberofActivities:0,firstActivities:!0,addNewStudentList:[],hotInstance:void 0,columnList:[],scoreSettingOptions:[" ","缺考","缓考","不及格","取消考试资格"],isRouterAlive:!0,dirty:!1,saving:!1,count:0,localres:{},postData:{students:[],scores:[],newStudents:[]},db:{items:[]}},"departmentId",0),"fromCourseBatchAdd",!1)},components:{ref:ce.KR,onMounted:l.sV,reactive:ce.Kh,HotTable:De.sH,HotColumn:De.gQ,registerAllModules:Be.um,ElTooltip:ue.R7,ElIcon:de.tk,ElInput:he.WK,Handsontable:$e.Ay,Back:ee.kcb,FolderChecked:ee.KHk,InfoFilled:ee.N_H,Loading:ee.Rhj,Download:ee.f5X,UploadFilled:ee.m8m,DocumentAdd:ee.pT5,ElMessage:G.nk,ElMessageBox:P.s,Action:p.A,CirclePlus:ee.HxT,DocumentChecked:ee.Fmj},methods:{editableTabsValueChange:function(e){var t=this,o=this;this.currenteditableTabsValue=Number(e.props.name);for(var n=this.originData,r=this.currenteditableTabsValue-1,a=3;a<this.db.items[0].length;a++){if(!this.db.items[r][a]){this.db.items[r][a]={};for(var s=0;s<Object.keys(this.db.items[r][1]).length;s++)this.db.items[r][a][s]=null}if(this.db.items[0].length<this.db.items[r].length)while(this.db.items[0].length!=this.db.items[r].length)this.db.items[r].pop();for(var i=0;i<2;i++)this.db.items[0][a][i]?this.db.items[r][a][i]=this.db.items[0][a][i]:this.db.items[r][a][i]=null}for(var l=function(){var e=t.db.items[r][c][0],o=t.db.items[r][c][1];if(console.log("ID:",e),e&&o)for(var a=function(a){var s=Object.keys(n[r][a]),i=s.find((function(t){return n[r][a][t]===e}));s.find((function(e){return n[r][a][e]===o}));if(0==i)for(var l=0;l<Object.keys(n[r][a]).length;l++)1!=l&&(t.db.items[r][c][l]=n[r][a][l])},s=3;s<n[r].length;s++)a(s);else{console.log("this Id is null",t.db.items[r][c]);for(var i=0;i<Object.keys(t.db.items[r][c]).length;i++)t.db.items[r][c][i]=null}},c=3;c<this.db.items[r].length;c++)l();return 1!==this.currenteditableTabsValue?this.hotInstance.updateSettings({columns:o.db.items[o.currenteditableTabsValue-1][0],data:o.db.items[o.currenteditableTabsValue-1],contextMenu:!1}):this.hotInstance.updateSettings({columns:o.db.items[o.currenteditableTabsValue-1][0],data:o.db.items[o.currenteditableTabsValue-1],contextMenu:{items:{row_above:{name:"在上方插入行"},row_below:{name:"在下方插入行"},remove_row:{name:"删除行"}}},cells:o.getHotCellsFunction()}),console.log("currenteditableTabsValue:",Number(e.props.name))},handleTabsEdit:function(e,t,o){var n=this,r=this;if(console.log("action",t,"targetName",e,"activityName",o),"add"===t&&!e){console.log("handleTabsEdit add processing");var a=[""],s=[""],i=[""],l=[""],c=[];c.push(a),c.push(s),c.push(i),c.push(l),this.db.items.push(c);var u=++this.tabIndex+"";this.currenteditableTabsValue=this.tabIndex,this.maxeditableTabsValue=this.tabIndex,this.editableTabs.push({title:"成绩项 "+u,name:u.toString(),value:u}),this.editableTabsValue=u.toString(),this.hotInstance.updateSettings({data:r.db.items[r.currenteditableTabsValue-1],cells:r.getHotCellsFunction()}),console.log("currenteditableTabsValue:",this.currenteditableTabsValue,"maxTabsValue:",this.maxeditableTabsValue)}if("add"===t&&e&&o){console.log("handleTabsEdit 初始化 processing"),this.currenteditableTabsValue=++this.tabIndex,this.maxeditableTabsValue=this.tabIndex;var d=this.tabIndex+"";this.editableTabs.push({title:o||"成绩项 "+d,name:d.toString(),value:d}),this.editableTabsValue=this.editableTabs[0].name,this.currenteditableTabsValue=1,console.log("currenteditableTabsValue:",this.currenteditableTabsValue)}"remove"===t&&P.s.confirm("是否确认删除成绩项","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){var t=n.editableTabs;console.log("targetName:",e);var o=n.editableTabsValue;o===e&&t.forEach((function(n,r){if(n.name===e){var a=t[r+1]||t[r-1];a&&(o=a.name)}})),n.hotInstance.updateSettings({data:r.db.items[Number(o-1)],cells:r.getHotCellsFunction()}),n.editableTabsValue=o,n.editableTabs=t.filter((function(t){return t.name!==e})),console.log("editableTabs:",n.editableTabs)}))["catch"]((function(e){console.log("e",e)}))},activate:function(){this.identity=this.$store.state.currentInfo.identity,this.departmentId=this.$store.state.currentInfo.departmentId,this.schoolId=this.$store.state.currentInfo.schoolId,this.programId=this.$store.state.major.programId,"学院管理员"==this.identity?(this.classInfo=this.$store.state.currentInfo.adminSideClassInfo,console.log("identity:",this.identity)):"课程负责人"==this.identity?this.classInfo=this.$store.state.currentInfo.respondClassInfo:(this.classInfo=this.$store.state.currentInfo.teacherSideClassInfo,console.log("identity:",this.identity)),console.log("this.departmentId",this.departmentId,"this.schoolId",this.schoolId,"this.programId",this.programId,"this.classInfo",this.classInfo),this.activateHotcolumn()},activateHotcolumn:function(){var e=this,t=this;this.getActivities().then((function(){console.log("Handsontable init..........");var o=document.querySelector("#courseHot"),n=new $e.Ay(o,{data:e.db.items[0],licenseKey:"non-commercial-and-evaluation",colHeaders:function(e){return 0===e?"学号":1===e?"姓名":2===e?"考试情况":"成绩项"},rowHeaders:function(t){return 0===t?"名称":1===t?"分值":2===t?"设置":t-e.NUM_AUX_ROW+1},fixedRowsTop:3,fixedColumnsLeft:2,minSpareRows:0,minSpareCols:0,preventOverflow:"horizontal",manualColumnMove:!1,copyPaste:!0,colWidths:70,contextMenu:{items:{row_above:{name:"在上方插入行"},row_below:{name:"在下方插入行"},remove_row:{name:"删除行"}}},beforeCreateRow:function(t,o,n){if("loadData"!==n)return console.log("add extare row",t,o,n),console.log(e.db.items),!(t<=2)&&void 0},afterCreateRow:function(t,o,n){console.log(e.db.items)},beforeRemoveRow:function(e,t,o,n){if("loadData"!==n)return!(e<=2)&&void 0},afterRemoveRow:function(){console.log(e.db.items)},afterChange:function(t,o){"loadData"!==o&&e.isValid()}});t.hotInstance=n,t.hotInstance.updateSettings({columns:t.db.items[0][0],data:t.db.items[0],cells:t.getHotCellsFunction()})}))},getHotCellsFunction:function(){var e=this;return function(t,o,n){var r={};return 0===o&&(r.readOnly=!0,r.className="cell-disallow"),t<3&&o<3&&0!=o&&(r.readOnly=!1,r.className="cell-disallow"),0!=t&&2!=t&&o>=3&&(r.type="numeric",r.format="0.00",r.validator=/^(100(\.00?)?|0(\.\d{1,2})?|[1-9]?\d(\.\d{1,2})?)$/),0===o&&(r.width=100,t>2&&(r.readOnly=!1)),o>=0&&o<=2&&t>=0&&t<=2&&(r.readOnly=!0),2===o&&t>2&&(console.log("updating cell rules current currenteditableTabsValue:",e.currenteditableTabsValue),e.currenteditableTabsValue-1==0||0==e.currenteditableTabsValue?(r.type="dropdown",r.source=[" ","缺考","缓考","不及格","取消考试资格"],r.allowEmpty=!0):r.readOnly=!0),t<=2&&(r.readOnly=!0),o<2&&t>2&&(e.currenteditableTabsValue-1==0||0==e.currenteditableTabsValue?r.readOnly=!1:r.readOnly=!0),r}},validStudentNumber:function(e){return console.log("validStudentNumber",e),!!/^\d+$/.test(e)},validStudentName:function(e){return console.log("validStudentName",e),!!/^[\u4e00-\u9fa5]+$/.test(e)},validString:function(e,t){e&&e.length>0?t(!0):t(!1)},validScoreSetting:function(e){console.log(e,this.scoreSettingOptions.indexOf(e)),e?this.scoreSettingOptions.indexOf(e)>=0?this.errorInTable=!1:this.errorInTable=!0:this.errorInTable=!1},validateNumberWithin100:function(e){console.log(e,/^\d{1,2}(\.\d{1,2})?$/.test(e)),e?!isNaN(e)&&e>=0&&e<=200&&/^\d+(\.\d{1,2})?$/.test(e)?this.errorInTable=!1:this.errorInTable=!0:this.errorInTable=!1},getActivities:function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){var o;return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=e,t.abrupt("return",Q({url:"/classes/"+e.classInfo.classId,method:"get"}).then((function(e){console.log("class Info",e);var t=e.data;if(t.objectives?(o.hasObjectives=!0,o.hasNoObjectives=!1):(o.hasObjectives=!1,o.hasNoObjectives=!0),t.scores){o.hasScores=!0,o.hasNoScores=!1;var n=0;if(t.activities&&o.hasObjectives){o.hasActivities=!0,o.hasNoActivities=!1;var r=0;t.activities.forEach((function(e){console.log('activity["name"]',e["name"]),o.handleTabsEdit(1,"add",e["name"]);var a=e["item"].length;console.log("activityNumber:",a);var s=t.scores.length;o.currentNumberofActivities=a;for(var i=[],l=0;l<s+3;l++)i[l]={};i[0]={0:"",1:"",2:""};for(var c=0;c<a;c++)i[0][c+3]=e["item"][c],i[1][c+3]=e["value"][c],i[2][c+3]=e["remark"][c];console.log("tempList",i);for(var u=0;u<s;u++)if("string"==typeof t.scores[u]["info"][0]?i[3+u][0]=t.scores[u]["info"][0].trim():i[3+u][0]=t.scores[u]["info"][0],"string"==typeof t.scores[u]["info"][1]?i[3+u][1]=t.scores[u]["info"][1].trim():i[3+u][1]=t.scores[u]["info"][1],i[3+u][2]=t.scores[u]["status"][r],n+1>t.scores[u]["grade"].length)for(var d=0;d<a;d++)i[3+u][d+3]=null,i[3+u][d+3]=null;else for(var h=0;h<a;h++)t.scores[u]["grade"][n][h]?i[3+u][h+3]=t.scores[u]["grade"][n][h]:0==t.scores[u]["grade"][n][h]?i[3+u][h+3]=0:i[3+u][h+3]=null;o.db.items.push(i),n++,r++})),o.editableTabsValue="1",o.currenteditableTabsValue=1,o.originData=JSON.parse(JSON.stringify(o.db.items)),o.compareData=JSON.parse(JSON.stringify(o.db.items)),console.log("db.items",o.db.items,"columnList:",o.columnList)}else console.log("res has no activities"),o.handleTabsEdit(1,"add"),o.hasActivities=!1,o.hasNoActivities=!1}else console.log("res has no scores"),o.hasScores=!1,o.hasNoScores=!0,t.activities&&o.hasObjectives&&(o.hasActivities=!0,o.hasNoActivities=!1,t.activities.forEach((function(e){o.handleTabsEdit(1,"add",e["name"]);var n=e["item"].length,r=t.scores?t.scores.length:1;o.currentNumberofActivities=n;for(var a=[],s=0;s<r+3;s++)a[s]={};a[0]={0:"",1:"",2:""};for(var i=0;i<n;i++){a[0][i+3]=e["item"][i],a[1][i+3]=e["value"][i],a[2][i+3]=e["remark"][i]}o.db.items.push(a)})),o.originData=JSON.parse(JSON.stringify(o.db.items)),o.compareData=JSON.parse(JSON.stringify(o.db.items)),console.log("db.items",o.db.items,"columnList:",o.columnList))})));case 2:case"end":return t.stop()}}),t)})))()},isValid:function(){var e=!Qo().isEqual(this.compareData,this.db.items);return console.log("result:",e),e},save:function(){var e=this;this.saving=!0,this.postData.scores=[];var t=this.isValid();if(t){for(var o=this,n=[],r=JSON.parse(JSON.stringify(o.db.items[0])),a=0;a<3;a++)r.shift();for(var s=0;s<r.length;s++)void 0!=r[s][0]&&n.push(r[s][0]);n.forEach((function(t){var n=[],a=[],s=[];o.db.items.forEach((function(o){for(var i=[],l="",c=JSON.parse(JSON.stringify(o)),u=0;u<3;u++)c.shift();for(var d=0;d<r.length;d++)if(c[d]&&c[d][0]==t){var h={studentNumber:"",studentName:""};for(var f in c[d])0==f?h["studentNumber"]=c[d][f]:1==f?h["studentName"]=c[d][f]:2==f?(!1===e.errorInTable&&(e.validScoreSetting(c[d][f]),console.log("validScoreSetting",c[d][f],"errorInTable",e.errorInTable)),l=c[d][f]):(!1===e.errorInTable&&(e.validateNumberWithin100(c[d][f]),console.log("validateNumberWithin100",c[d][f],"errorInTable",e.errorInTable)),i.push(c[d][f])),n.push(h)}a.push(i),s.push(l)}));var i={info:[n[0]["studentNumber"],n[0]["studentName"]],status:s,grade:a};o.postData.scores.push(i)})),console.log("this.errorInTable",this.errorInTable),this.errorInTable?((0,G.nk)({type:"error",message:"保存出错，请检查分数",duration:1500}),this.errorInTable=!1):o.addScores(o.postData.scores)}else this.saving=!1},toPostData:function(){this.postData.students.length=0;this.postData.students;var e=!0,t=Boolean,o=Boolean,n=0;this.db.items.forEach((function(e){for(var t=JSON.parse(JSON.stringify(e)),o=0;o<3;o++)t.shift();for(var r=0;r<t.length;r++)if(t[r]["studentNumber"])for(var a in t[r])"pass"==a||t[r][a]?0:n++}));for(var r=0,a=[],s=0;s<this.db.item.length;s++)a.push(this.db.item[s][0]);return a.forEach((function(e){r=r+e.length-3})),console.log("trueFlagNum:",n),n>0?(t=!0,o=n==r):(t=!1,o=!1),console.log("OrFlag:",t,"AndFlag:",o),t?o?void console.log("----------全都为空------------"):(e=!1,void console.log("-----------部分为空-----------")):e},goBackandClean:function(){this.postData.scores=[]},goTeacher:function(){var e=this;console.log("goteacher:"+this.saving+this.dirty),console.log(Qo().isEqual(this.compareData,this.db.items));var t=Qo().isEqual(this.compareData,this.db.items);!t||0==this.saving&&!t?P.s.confirm("数据还未保存，是否仍然关闭？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.$router.push({path:"/score"})}))["catch"]((function(){})):this.$router.push({path:"/score"})},addScores:function(e){var t=this;return console.log("score postData:",e),Q({url:"/classes/editScores",method:"post",data:{classId:this.classInfo.classId,scores:e}}).then((function(e){t.postData.scores=[],console.log("saving scores res:",e),t.firstActivities=!0,"SUCCESS"==e.code&&((0,G.nk)({type:"success",message:"保存成功",duration:1500}),t.goBackandClean(),t.originData=JSON.parse(JSON.stringify(t.db.items)),t.compareData=JSON.parse(JSON.stringify(t.db.items))),console.log("postData.scores",t.postData.scores)}))["catch"]((function(e){console.log("e:",e),500==e.status?(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500}):409==e.status?(0,G.nk)({type:"error",message:"成绩项分值为空",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500})}))}},mounted:function(){this.activate()}},qf=(0,h.A)(Hf,[["render",Jf],["__scopeId","data-v-7b9a395f"]]),Zf=qf;var em=function(e){return(0,l.Qi)("data-v-577f7da3"),e=e(),(0,l.jt)(),e},tm={class:"block"},om={class:"title"},nm={layout:"row",flex:"",class:"md-padding"},rm={class:"studentCard"},am={class:"subtabletitle"},sm=["onClick"],im={class:"no-program"},lm=em((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","padding-top":"120px","font-size":"22px"}}," 尚未录入成绩 ",-1)})),cm={style:{display:"flex","justify-content":"center","margin-top":"30px","font-size":"13px",color:"#828d96"}},um={style:{display:"flex","justify-content":"center","margin-top":"30px","font-size":"13px",color:"#828d96"}},dm={class:"no-program"},hm=em((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","padding-top":"120px","font-size":"22px"}}," 该课程尚未关联课程大纲 ",-1)})),fm=em((function(){return(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","margin-top":"30px","font-size":"13px",color:"#828d96"}}," 请联系学院管理员关联课程大纲 ",-1)})),mm=[hm,fm];function pm(e,t,o,n,r,a){var s=this,c=(0,l.g2)("Back"),u=(0,l.g2)("el-icon"),d=(0,l.g2)("el-tooltip"),h=(0,l.g2)("el-divider"),f=(0,l.g2)("Histogram"),m=(0,l.g2)("DataAnalysis"),p=(0,l.g2)("el-switch"),b=(0,l.g2)("el-row"),g=(0,l.g2)("addBtn"),k=(0,l.g2)("el-tab-pane"),v=(0,l.g2)("el-tabs"),I=(0,l.g2)("el-table-column"),y=(0,l.g2)("el-col"),A=(0,l.g2)("el-table"),F=(0,l.g2)("reviewDrawer");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",tm,[(0,l.bF)(b,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.backClass()})},{default:(0,l.k6)((function(){return[(0,l.bF)(c)]})),_:1})]})),_:1}),(0,l.Lk)("div",om,(0,C.v_)(r.classInfo.className),1),(0,l.bF)(h,{class:"divider",direction:"vertical"}),(0,l.bF)(d,{class:"box-item",effect:"dark",placement:"bottom","hide-after":0},{content:(0,l.k6)((function(){return[(0,l.bo)((0,l.Lk)("span",null," 成绩项 ",512),[[i.aG,r.hasDetail]]),(0,l.bo)((0,l.Lk)("span",null," 请先关联课程大纲 ",512),[[i.aG,r.hasNoDetail]])]})),default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(u,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",onClick:a.goActivity},{default:(0,l.k6)((function(){return[(0,l.bF)(f)]})),_:1},8,["onClick"]),[[i.aG,"教师"==s.identity]])]})),_:1}),(0,l.bo)((0,l.bF)(d,{class:"box-item",effect:"dark",placement:"bottom","hide-after":0},{content:(0,l.k6)((function(){return[(0,l.bo)((0,l.Lk)("span",null," 试卷分析 ",512),[[i.aG,r.hasDetail]]),(0,l.bo)((0,l.Lk)("span",null," 请先关联课程大纲 ",512),[[i.aG,r.hasNoDetail]])]})),default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"20px"},onClick:t[1]||(t[1]=function(e){return a.goPaperAnalysis()})},{default:(0,l.k6)((function(){return[(0,l.bF)(m)]})),_:1})]})),_:1},512),[[i.aG,"教师"==s.identity]]),(0,l.bF)(h,{class:"divider",direction:"vertical"}),(0,l.bF)(d,{class:"box-item",effect:"dark",content:"审核意见",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{modelValue:r.openDrawer,"onUpdate:modelValue":t[2]||(t[2]=function(e){return r.openDrawer=e}),class:"switchstyle",onChange:a.openDrawerChange},null,8,["modelValue","onChange"])]})),_:1})]})),_:1})]),(0,l.Lk)("div",nm,[(0,l.bo)((0,l.bF)(g,{onClick:a.goAddScore},null,8,["onClick"]),[[i.aG,"教师"==r.identity&&("1"==r.classInfo.status||"4"==r.classInfo.status)]]),(0,l.bo)((0,l.Lk)("div",null,[(0,l.bo)((0,l.bF)(v,{modelValue:e.editableTabsValue,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.editableTabsValue=t}),type:"card",class:"activity-tab",onTabClick:a.editableTabsValueChange},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.editableTabs,(function(e,t){return(0,l.uX)(),(0,l.Wv)(k,{key:e.name,label:e.title,name:e.name},null,8,["label","name"])})),128))]})),_:1},8,["modelValue","onTabClick"]),[[i.aG,r.hasScores]]),(0,l.bo)((0,l.Lk)("div",rm,[(0,l.bF)(A,{class:"studentsTable",data:r.studentsTable[this.currenteditableTabsValue-1],height:"600px","header-cell-style":{"padding-left":"40px","font-size":"14.4px",height:"63px","font-weight":"bold",color:"black"},"cell-style":{"padding-left":"40px","font-size":"16px",height:"60px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(I,{fixed:"",prop:"studentNumber",label:"学号",width:"180px"}),(0,l.bF)(I,{fixed:"",prop:"studentName",label:"姓名",width:"180px"}),s.currenteditableTabsValue-1==0?((0,l.uX)(),(0,l.Wv)(I,{key:0,fixed:"",prop:"studentStatus",label:"考试情况",width:"160px"})):(0,l.Q3)("",!0),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.currentactivityName,(function(e,t){return(0,l.uX)(),(0,l.Wv)(I,{label:e,key:e,width:"180px"},{header:(0,l.k6)((function(){return[(0,l.bF)(y,null,{default:(0,l.k6)((function(){return[(0,l.bF)(b,null,{default:(0,l.k6)((function(){return[(0,l.Lk)("span",null,(0,C.v_)(e),1)]})),_:2},1024),(0,l.bF)(b,null,{default:(0,l.k6)((function(){return[(0,l.Lk)("span",am,"("+(0,C.v_)(r.currentactivityScores[t])+")",1),(0,l.bo)((0,l.Lk)("span",null,"/"+(0,C.v_)(r.currentactivityweight[t])+"%",513),[[i.aG,r.currentactivityweight[t]]])]})),_:2},1024)]})),_:2},1024)]})),default:(0,l.k6)((function(e){return[(0,l.Lk)("span",{class:"scoreintable",onClick:function(t){return a.showInfo(e.row)}},(0,C.v_)(e.row.scores[s.currenteditableTabsValue-1][t]),9,sm)]})),_:2},1032,["label"])})),128))]})),_:1},8,["data"])],512),[[i.aG,r.hasScores]]),(0,l.bo)((0,l.Lk)("div",im,[lm,(0,l.bo)((0,l.Lk)("div",cm," 请先点击右上角圆形按钮添加成绩 ",512),[[i.aG,"教师"===r.identity]]),(0,l.bo)((0,l.Lk)("div",um," 请先联系课程教师添加成绩 ",512),[[i.aG,"教师"!==r.identity]])],512),[[i.aG,r.hasNoScores]])],512),[[i.aG,r.hasDetail]]),(0,l.bo)((0,l.Lk)("div",dm,mm,512),[[i.aG,r.hasNoDetail]])]),(0,l.bF)(F,{visible:r.openDrawer},null,8,["visible"])],64)}const bm={name:"Score",components:{Back:ee.kcb,addBtn:le,request:Q,ElSwitch:ph.qi,reviewDrawer:jh,Histogram:ee.dqr,ElMessage:G.nk,DataAnalysis:ee.ja0},data:function(){return{identity:"",isRespondent:"",hasDetail:!1,hasNoDetail:!1,openDrawer:!1,hasActivities:!1,hasScores:!1,hasNoScores:!1,editableTabs:[],tabIndex:0,currenteditableTabsValue:0,classInfo:[],activityName:[],currentactivityName:[],activityScores:[],currentactivityScores:[],activityweight:[],currentactivityweight:[],studentsTable:[],tableWidth:""}},mounted:function(){this.identity=this.$store.state.currentInfo.identity,this.openDrawer=this.$store.state.currentInfo.opendrawer,"学院管理员"==this.identity?(this.classInfo=this.$store.state.currentInfo.adminSideClassInfo,console.log("identity:",this.identity)):"课程负责人"==this.identity?(this.classInfo=this.$store.state.currentInfo.respondClassInfo,console.log("identity:",this.identity)):(this.classInfo=this.$store.state.currentInfo.teacherSideClassInfo,console.log("identity:",this.identity)),this.getActivities()},methods:{goActivity:function(){this.hasDetail?(this.$store.commit("course/setbaseCourseCourseId",this.classInfo.courseId),this.$store.commit("course/setDetailId",this.classInfo.detailId),this.$router.push({path:"/baseCourseActivities",query:{parentName:"Score"}})):(0,G.nk)({type:"error",message:"请先关联课程大纲",duration:1500})},openDrawerChange:function(){this.$store.commit("currentInfo/setOpenDrawer",this.openDrawer)},showInfo:function(e){console.log("row",e)},editableTabsValueChange:function(e){var t=0;return this.currenteditableTabsValue=Number(e.props.name),this.currentactivityName=this.activityName[this.currenteditableTabsValue-1],this.currentactivityScores=this.activityScores[this.currenteditableTabsValue-1],this.currentactivityweight=this.activityweight[this.currenteditableTabsValue-1],t=180*(this.currentactivityName.length+1)+100,this.tableWidth=t.toString()+"px",console.log("currenteditableTabsValue:",Number(e.props.name))},handleTabsEdit:function(e,t,o){var n=this,r=this;if(console.log("action",t),"add"===t&&!e){var a=[""],s=[""],i=[""],l=[""],c=[];c.push(a),c.push(s),c.push(i),c.push(l),this.db.items.push(c);var u=++this.tabIndex+"";this.currenteditableTabsValue=this.tabIndex,this.maxeditableTabsValue=this.tabIndex,this.editableTabs.push({title:"成绩项 "+u,name:u.toString(),value:u}),this.editableTabsValue=u.toString(),this.hotInstance.updateSettings({data:r.db.items[r.currenteditableTabsValue-1]}),console.log("currenteditableTabsValue:",this.currenteditableTabsValue,"maxTabsValue:",this.maxeditableTabsValue)}if("add"===t&&e){this.currenteditableTabsValue=++this.tabIndex,this.maxeditableTabsValue=this.tabIndex;var d=this.tabIndex+"";this.editableTabs.push({title:o||"成绩项 "+d,name:d.toString(),value:d}),this.editableTabsValue=d.toString(),console.log("currenteditableTabsValue:",this.currenteditableTabsValue)}"remove"===t&&P.s.confirm("是否确认删除当前成绩项","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){var t=n.editableTabs;console.log("targetName:",e);var o=n.editableTabsValue;o===e&&t.forEach((function(n,r){if(n.name===e){var a=t[r+1]||t[r-1];a&&(o=a.name)}})),n.hotInstance.updateSettings({data:r.db.items[Number(o-1)]}),n.editableTabsValue=o,n.editableTabs=t.filter((function(t){return t.name!==e})),console.log("editableTabs:",n.editableTabs)}))["catch"]((function(e){console.log("e",e)}))},goAddScore:function(){this.$router.push("/addScore")},backClass:function(){this.$router.push("/teacherClass")},goPaperAnalysis:function(){this.hasDetail?this.$router.push("/examAnalysis"):(0,G.nk)({type:"error",message:"请先关联课程大纲",duration:1500})},getActivities:function(){var e=this;return(0,Kt.A)((0,Xt.A)().mark((function t(){var o;return(0,Xt.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(o=e,!e.classInfo.detailId){t.next=7;break}return e.hasDetail=!0,e.hasNoDetail=!1,t.abrupt("return",Q({url:"/classes/"+e.classInfo.classId,method:"get"}).then((function(e){console.log("class Info",e),o.isRespondent=e.data.isRespondent,console.log("isRespondent",o.isRespondent);var t=e.data;if(t.scores){o.hasScores=!0,o.hasNoScores=!1;var n=0;if(t.activities.length){o.hasActivities=!0,t.activities.forEach((function(e){o.handleTabsEdit(1,"add",e.name);var r=e["item"].length;o.activityName.push(e["item"]),o.activityScores.push(e["value"]),o.activityweight.push(e["weight"]);for(var a=t.scores.length,s=[],i=0;i<a;i++){if(n+1>t.scores[i]["grade"].length){for(var l=[],c=0;c<r;c++)l.push(null);t.scores[i]["grade"].push(l)}var u={studentNumber:t.scores[i]["info"][0],studentName:t.scores[i]["info"][1],studentStatus:t.scores[i]["status"][0],scores:t.scores[i]["grade"]};s.push(u)}o.studentsTable.push(s),n++})),console.log("studentsTable",o.studentsTable),o.currentactivityName=o.activityName[0],o.currentactivityScores=o.activityScores[0],o.currentactivityweight=o.activityweight[0];var r=0;r=180*(o.currentactivityName.length+1)+100,o.tableWidth=r.toString()+"px",o.editableTabsValue="1",o.currenteditableTabsValue=1,console.log("activityName",o.activityName,"activityScores:",o.activityScores,"activityWeight",o.activityweight)}else console.log("res has no activities"),o.hasActivities=!1}else console.log("res has no scores"),o.hasScores=!1,o.hasNoScores=!0})));case 7:e.hasDetail=!1,e.hasNoDetail=!0;case 9:case"end":return t.stop()}}),t)})))()}}},gm=(0,h.A)(bm,[["render",pm],["__scopeId","data-v-577f7da3"]]),km=gm;var vm=function(e){return(0,l.Qi)("data-v-d289e574"),e=e(),(0,l.jt)(),e},Im={class:"content"},ym={class:"body"},Cm={class:"block"},Am=vm((function(){return(0,l.Lk)("div",{class:"title"},"课程目标1",-1)})),Fm={class:"card"},wm=vm((function(){return(0,l.Lk)("span",{class:"head-text",style:{color:"grey","font-size":"14px"}},"课程目标",-1)})),Sm={class:"objective-description"},_m=vm((function(){return(0,l.Lk)("div",{style:{"margin-top":"20px"}},[(0,l.Lk)("span",{style:{color:"grey","font-size":"14px"}},"考核方式")],-1)})),Em=vm((function(){return(0,l.Lk)("div",{style:{height:"30px"}},null,-1)})),Nm=vm((function(){return(0,l.Lk)("div",null,[(0,l.Lk)("div",null,[(0,l.Lk)("div",{style:{display:"flex","justify-content":"center","margin-top":"100px","font-size":"22px"}}," 暂未关联课程大纲 "),(0,l.Lk)("div",{style:{display:"flex","justify-content":"center",color:"grey","font-size":"13px","margin-top":"30px"}}," 请联系课程负责人进行设置 ")])],-1)})),Vm=[Nm];function xm(e,t,o,n,r,a){var s=(0,l.g2)("Back"),c=(0,l.g2)("el-icon"),u=(0,l.g2)("el-tooltip"),d=(0,l.g2)("el-divider"),h=(0,l.g2)("el-switch"),f=(0,l.g2)("el-row"),m=(0,l.g2)("EditPen"),p=(0,l.g2)("el-alert"),b=(0,l.g2)("el-col"),g=(0,l.g2)("reviewDrawer");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",Im,[(0,l.Lk)("div",ym,[(0,l.Lk)("div",Cm,[(0,l.bF)(f,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.backClass()})},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1}),Am,(0,l.bF)(d,{class:"divider",direction:"vertical"}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"审核意见",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(h,{modelValue:r.openDrawer,"onUpdate:modelValue":t[1]||(t[1]=function(e){return r.openDrawer=e}),class:"switchstyle",onChange:a.openDrawerChange},null,8,["modelValue","onChange"])]})),_:1})]})),_:1})]),(0,l.bo)((0,l.Lk)("div",Fm,[(0,l.bF)(f,{class:"card-head"},{default:(0,l.k6)((function(){return[wm,(0,l.bo)((0,l.Lk)("div",null,[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"编辑",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"edit-pen",onClick:t[2]||(t[2]=function(e){return a.goEdit()})},{default:(0,l.k6)((function(){return[(0,l.bF)(m)]})),_:1})]})),_:1})],512),[[i.aG,r.isRespondent&&"教师"===e.identity]])]})),_:1}),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(this.info,(function(e,t){return(0,l.uX)(),(0,l.CE)("div",{key:t},[(0,l.bF)(p,{title:e,type:"error",closable:!1,"show-icon":"",style:{width:"350px","margin-top":"5px"}},null,8,["title"])])})),128)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.objectives,(function(e){return(0,l.uX)(),(0,l.CE)("div",{key:e.id},[(0,l.bF)(f,{style:{width:"800px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{span:1,class:"objective-num"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.serialNum),1)]})),_:2},1024),(0,l.bo)((0,l.bF)(b,{span:3,class:"objective-achieve"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.achievementTwo),1)]})),_:2},1536),[[i.aG,e.hasAchieve]]),(0,l.bo)((0,l.bF)(b,{span:1,class:"objective-achieve"},null,512),[[i.aG,!e.hasAchieve]]),(0,l.bF)(b,{span:20},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.Lk)("div",{class:"objective-name"},(0,C.v_)(e.name),513),[[i.aG,e.name]]),(0,l.Lk)("div",Sm,(0,C.v_)(e.description),1),_m,((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.assessmentMethods,(function(e,t){return(0,l.uX)(),(0,l.CE)("div",{key:t},[(0,l.bF)(f,{class:"assessments"},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{span:5},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.name),1)]})),_:2},1024),(0,l.bF)(b,{span:4},{default:(0,l.k6)((function(){return[(0,l.eW)("( "+(0,C.v_)(e.weight)+"% )",1)]})),_:2},1024),(0,l.bF)(b,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(f,{gutter:20},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.activities.item,(function(t,o){return(0,l.uX)(),(0,l.Wv)(b,{span:8,style:{"margin-bottom":"10px"},key:o},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{"hide-after":0,content:e.activities.table[o],effect:"dark",placement:"top"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(t),1)]})),_:2},1032,["content"])]})),_:2},1024)})),128))]})),_:2},1024)]})),_:2},1024),(0,l.bF)(b,{span:3,class:"assess-achieve"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.achievementTwo),1)]})),_:2},1024)]})),_:2},1024)])})),128))]})),_:2},1024)]})),_:2},1024),Em])})),128))],512),[[i.aG,r.hasDetailId&&r.hasObjective]]),(0,l.bo)((0,l.Lk)("div",null,Vm,512),[[i.aG,!r.hasDetailId]]),(0,l.bo)((0,l.Lk)("div",null,[(0,l.bF)(f,{class:"no-info"},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{style:{margin:"10px 0 10px"}},{default:(0,l.k6)((function(){return[(0,l.eW)("暂未设置课程目标")]})),_:1}),(0,l.bo)((0,l.bF)(b,{class:"go-edit",onClick:t[3]||(t[3]=function(e){return a.goEdit()})},{default:(0,l.k6)((function(){return[(0,l.eW)("去设置")]})),_:1},512),[[i.aG,r.isRespondent&&"教师"===e.identity]])]})),_:1})],512),[[i.aG,r.hasDetailId&&!r.hasObjective]])])]),(0,l.bF)(g,{visible:r.openDrawer},null,8,["visible"])],64)}const Tm={name:"Objectives",components:{Back:ee.kcb,EditPen:ee.EDh,reviewDrawer:jh,ElSwitch:ph.qi},data:function(){return{info:[],openDrawer:!1,hasDetailId:!0,hasObjective:!0,isRespondent:!1,classInfo:[],list:[],objectives:[]}},mounted:function(){this.identity=this.$store.state.currentInfo.identity,this.openDrawer=this.$store.state.currentInfo.opendrawer,"学院管理员"==this.identity?(this.classInfo=this.$store.state.currentInfo.adminSideClassInfo,console.log("identity:",this.identity)):"课程负责人"==this.identity?(this.classInfo=this.$store.state.currentInfo.respondClassInfo,console.log("identity:",this.identity)):(this.classInfo=this.$store.state.currentInfo.teacherSideClassInfo,console.log("identity:",this.identity)),console.log("this.classinfo",this.classInfo),this.$store.commit("course/setDetailId",this.classInfo.detailId),2==this.classInfo.isRespondent?this.isRespondent=!0:this.isRespondent=!1,null===this.classInfo.detailId?(this.hasDetailId=!1,console.log("this.hasDetailId",this.hasDetailId)):(this.hasDetailId=!0,console.log("this.hasDetailId",this.hasDetailId),this.checkClassInfo())},methods:{openDrawerChange:function(){this.$store.commit("currentInfo/setOpenDrawer",this.openDrawer)},goEdit:function(){this.$router.push("/baseCourseObjectivesEdit")},backClass:function(){this.$router.push("/teacherClass")},checkActivityInfo:function(){for(var e=new Set,t=this.classInfo.activities,o=0;o<t.length;o++){var n=t[o];e.add(n.name)}for(var r=new Set,a=this.classInfo.objectives,s=0;s<a.length;s++){var i=a[s].assessmentMethods;i.forEach((function(e){var t=e.activities.table;e.activities.item;r.add.apply(r,(0,Ql.A)(t))}))}var l,c=(0,Qt.A)(r);try{for(c.s();!(l=c.n()).done;){var u=l.value;e.has(u)||this.info.push("成绩项表："+u+" 不存在，请重新设置")}}catch(err){c.e(err)}finally{c.f()}console.log("tables",r,e)},checkClassInfo:function(){var e=this;mr(this.classInfo.classId).then((function(t){e.objectives=t.data.objectives,e.objectives&&(e.objectives.length>0?(e.hasObjective=!0,e.objectives.forEach((function(e){"0"==e.id.charAt(0)?e.serialNum=e.id.charAt(1):e.serialNum=e.id,e.hasOwnProperty("achievement")?(e.achievementTwo=e.achievement.toFixed(3),e.hasAchieve=!0):e.hasAchieve=!1,e.assessmentMethods.forEach((function(e){null===e.achievement||void 0===e.achievement?e.achievementTwo="":e.achievementTwo=e.achievement.toFixed(3)}))}))):e.hasObjective=!1),console.log("getClassInfo",e.objectives)}))}}},jm=(0,h.A)(Tm,[["render",xm],["__scopeId","data-v-d289e574"]]),Lm=jm;var Dm=function(e){return(0,l.Qi)("data-v-d65132de"),e=e(),(0,l.jt)(),e},Bm={class:"content"},$m={class:"block"},Om={class:"edit-body"},Mm={class:"card"},Um={class:"num-title"},Wm={class:"num-wrap"},Rm={class:"title-text"},Pm=Dm((function(){return(0,l.Lk)("section",{class:"rotate-bar"},null,-1)})),Gm=Dm((function(){return(0,l.Lk)("div",{style:{"margin-top":"50px"}},[(0,l.Lk)("span",{style:{color:"grey","font-size":"14px"}},"考核方式")],-1)})),zm=Dm((function(){return(0,l.Lk)("div",{style:{height:"50px"}},null,-1)})),Ym={class:"closeIcon"},Xm={class:"dialog-footer"};function Qm(e,t,o,n,r,a){var s=(0,l.g2)("Back"),c=(0,l.g2)("el-icon"),u=(0,l.g2)("el-tooltip"),d=(0,l.g2)("el-divider"),h=(0,l.g2)("DocumentChecked"),f=(0,l.g2)("el-row"),m=(0,l.g2)("el-col"),p=(0,l.g2)("el-input"),b=(0,l.g2)("el-form-item"),g=(0,l.g2)("EditPen"),k=(0,l.g2)("el-button"),v=(0,l.g2)("Plus"),I=(0,l.g2)("Delete"),y=(0,l.g2)("el-form"),A=(0,l.g2)("Edit"),F=(0,l.g2)("el-option"),w=(0,l.g2)("el-select"),S=(0,l.g2)("Close"),_=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)("div",Bm,[(0,l.Lk)("div",$m,[(0,l.bF)(f,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.backObjectives()})},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1}),(0,l.bF)(d,{class:"divider",direction:"vertical"}),(0,l.bF)(u,{class:"box-item",effect:"dark",content:"保存",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",onClick:t[1]||(t[1]=function(e){return a.judgeBeforeSave()}),style:{"margin-left":"10px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(h)]})),_:1})]})),_:1})]})),_:1})]),(0,l.Lk)("div",Om,[(0,l.Lk)("div",Mm,[(0,l.bF)(y,{model:r.objectives,ref:"objectives","label-position":"top"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.objectives,(function(e,t){return(0,l.uX)(),(0,l.Wv)(m,{key:e.id},{default:(0,l.k6)((function(){return[(0,l.bF)(f,{style:{"margin-top":"20px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{span:3,class:"two-digits",style:{"padding-left":"16px"}},{default:(0,l.k6)((function(){return[(0,l.Lk)("section",Um,[(0,l.Lk)("section",Wm,[(0,l.Lk)("span",Rm,(0,C.v_)(e.serialNum),1)]),Pm])]})),_:2},1024),(0,l.bF)(m,{span:20},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{label:"简称",class:"title"},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{modelValue:e.name,"onUpdate:modelValue":function(t){return e.name=t},maxlength:"20","show-word-limit":"",placeholder:"简称"},null,8,["modelValue","onUpdate:modelValue"])]})),_:2},1024),(0,l.bF)(b,{label:"描述",class:"title",style:{"margin-top":"50px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{modelValue:e.description,"onUpdate:modelValue":function(t){return e.description=t},autosize:"",type:"textarea",maxlength:"1000",placeholder:"描述"},null,8,["modelValue","onUpdate:modelValue"])]})),_:2},1024),Gm,0!==e.assessmentMethods.length?((0,l.uX)(),(0,l.Wv)(f,{key:0},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.assessmentMethods,(function(e,t){return(0,l.uX)(),(0,l.Wv)(m,{span:23,key:t,class:"assessments"},{default:(0,l.k6)((function(){return[(0,l.bF)(f,{class:"assessment"},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{span:5},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.name),1)]})),_:2},1024),(0,l.bF)(m,{span:5},{default:(0,l.k6)((function(){return[(0,l.eW)("( "+(0,C.v_)(e.weight)+"% )",1)]})),_:2},1024),(0,l.bF)(m,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(f,null,{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.activities.item,(function(e,t){return(0,l.uX)(),(0,l.Wv)(m,{span:6,key:t},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e),1)]})),_:2},1024)})),128))]})),_:2},1024)]})),_:2},1024)]})),_:2},1024)]})),_:2},1024)})),128)),(0,l.bF)(m,{span:1,class:"penIcon"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"pen-icon",onClick:function(o){return a.editAssessments(e,t)}},{default:(0,l.k6)((function(){return[(0,l.bF)(g)]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024)):(0,l.Q3)("",!0),0==e.assessmentMethods.length?((0,l.uX)(),(0,l.Wv)(f,{key:1,class:"noAssessment"},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",null,[(0,l.bF)(k,{style:{color:"#6573c0"},text:"",onClick:function(o){return a.newAssessmentPart(e,t)}},{default:(0,l.k6)((function(){return[(0,l.eW)("添加考核方式 ")]})),_:2},1032,["onClick"])])]})),_:2},1024)):(0,l.Q3)("",!0)]})),_:2},1024)]})),_:2},1024),zm]})),_:2},1024)})),128)),(0,l.bF)(f,{class:"attribute-Btn"},{default:(0,l.k6)((function(){return[(0,l.bF)(k,{style:{color:"#6573c0"},text:"",onClick:t[2]||(t[2]=function(e){return a.addObject()})},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{size:18,color:"#6573c0"},{default:(0,l.k6)((function(){return[(0,l.bF)(v)]})),_:1}),(0,l.eW)(" 新增课程目标 ")]})),_:1}),(0,l.bo)((0,l.bF)(k,{type:"danger",text:"",onClick:t[3]||(t[3]=function(e){return a.deleteObject()})},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{size:18,color:"#ff0000"},{default:(0,l.k6)((function(){return[(0,l.bF)(I)]})),_:1}),(0,l.eW)(" 删除课程目标"+(0,C.v_)(r.deleteSerialNum),1)]})),_:1},512),[[i.aG,r.canDelete]])]})),_:1})]})),_:1},8,["model"])])]),(0,l.Lk)("div",null,[(0,l.bF)(_,{modelValue:r.dialogFormVisible,"onUpdate:modelValue":t[7]||(t[7]=function(e){return r.dialogFormVisible=e}),title:"设置考核方式",width:"680px","show-close":!1,"align-center":!0},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",Xm,[(0,l.bF)(k,{onClick:t[5]||(t[5]=function(e){return r.dialogFormVisible=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(k,{type:"primary",onClick:t[6]||(t[6]=function(e){return a.confirmAddAssessment(r.dialogObject)})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(f,{style:{"margin-bottom":"10px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{span:20,class:"object-name"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(r.dialogObject.name),1)]})),_:1})]})),_:1}),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.dialogObject.assessmentMethods,(function(e,t){return(0,l.uX)(),(0,l.Wv)(f,{class:"assessment",key:t},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{span:1}),(0,l.bo)((0,l.bF)(m,{span:4,class:"showWeight"},{default:(0,l.k6)((function(){return[(0,l.bF)(f,null,{default:(0,l.k6)((function(){return[(0,l.bF)(m,{span:10},{default:(0,l.k6)((function(){return[(0,l.eW)((0,C.v_)(e.weight)+"% ",1)]})),_:2},1024),(0,l.bF)(m,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{onClick:function(t){return a.editWeight(e)}},{default:(0,l.k6)((function(){return[(0,l.bF)(A)]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1536),[[i.aG,!e.isEditWeight]]),(0,l.bo)((0,l.bF)(m,{span:4,class:"editWeight"},{default:(0,l.k6)((function(){return[(0,l.bF)(f,null,{default:(0,l.k6)((function(){return[(0,l.bF)(m,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{modelValue:e.weight,"onUpdate:modelValue":function(t){return e.weight=t}},null,8,["modelValue","onUpdate:modelValue"])]})),_:2},1024),(0,l.bF)(m,{span:12},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{onClick:function(t){return a.saveWeight(e)}},{default:(0,l.k6)((function(){return[(0,l.bF)(h)]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1536),[[i.aG,e.isEditWeight]]),(0,l.bF)(m,{span:4},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{placeholder:"考核方式",modelValue:e.name,"onUpdate:modelValue":function(t){return e.name=t},width:"50px"},null,8,["modelValue","onUpdate:modelValue"])]})),_:2},1024),(0,l.bF)(m,{span:1}),(0,l.bF)(m,{span:13},{default:(0,l.k6)((function(){return[(0,l.bF)(w,{multiple:"",placeholder:"成绩项",modelValue:e.activities.item,"onUpdate:modelValue":function(t){return e.activities.item=t},style:{width:"330px"}},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.allActivities,(function(e,t){return(0,l.uX)(),(0,l.Wv)(F,{key:t,label:e.value,value:e.value},null,8,["label","value"])})),128))]})),_:2},1032,["modelValue","onUpdate:modelValue"])]})),_:2},1024),(0,l.bF)(m,{span:1},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",Ym,[(0,l.bF)(c,{class:"close-icon",onClick:function(t){return a.deleteAssessment(e)}},{default:(0,l.k6)((function(){return[(0,l.bF)(S)]})),_:2},1032,["onClick"])])]})),_:2},1024)]})),_:2},1024)})),128)),(0,l.bF)(k,{class:"add-assessment-button",style:{color:"#6573c0","margin-top":"10px"},text:"",onClick:t[4]||(t[4]=function(e){return a.addAssessment()})},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{size:18,color:"#586dbe"},{default:(0,l.k6)((function(){return[(0,l.bF)(v)]})),_:1}),(0,l.eW)(" 新增考核方式 ")]})),_:1})]})),_:1},8,["modelValue"])])])}const Km={name:"objectivesEdit",components:{Back:ee.kcb,DocumentChecked:ee.Fmj,EditPen:ee.EDh,Plus:ee.FWt,Delete:ee.epd,Close:ee.bm,Edit:ee.ffu},data:function(){return{classInfo:[],course:{name:"",detailId:Number,departmentId:Number,schoolId:Number},list:[],objectives:[],assessmentMethods:[],dialogFormVisible:!1,chosenActivityItems:[[]],dialogObject:{},index:Number,deleteSerialNum:"",activities:[],allActivities:[],isEditWeight:!1,isChange:!1,canDelete:!1}},watch:{list:{deep:!0,handler:function(){this.isChange=!0}}},mounted:function(){this.classInfo=this.$store.state.currentInfo.teacherSideClassInfo,this.course.name=this.classInfo.courseName,this.course.detailId=this.classInfo.detailId,this.checkObjectives()},methods:{backObjectives:function(){this.$router.push({name:"Objectives"})},judgeBeforeSave:function(){try{if(this.list.schoolId=this.classInfo.schoolId,this.list.departmentId=this.classInfo.departmentId,this.list.majorId=this.$store.state.major.majorId,0==this.list.objectives.length)throw G.nk.error("请添加课程目标"),"true";this.list.objectives.forEach((function(e){if(""==e.description)throw G.nk.error("描述内容不能为空"),"true";if(0==e.assessmentMethods.length)throw G.nk.error("请为课程目标添加考核方式"),"true"})),this.save()}catch(e){if("true"==e)return}},save:function(){var e=this;In(this.list).then((function(t){console.log("save",t),"SUCCESS"==t.code?((0,G.nk)({type:"success",message:"更新成功",duration:1500}),e.backObjectives()):(0,G.nk)({type:"error",message:"更新失败",duration:1500})}))["catch"]((function(e){500==e.status&&(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500})}))},checkObjectives:function(){var e=this;vn(this.course.detailId).then((function(t){e.list=t.data,console.log("getObjectives",t),e.allActivities=e.list.activities,console.log("初始allActivities",e.list.activities),e.allActivities.itemObject=e.allActivities[0].item.map((function(e){return{value:e}})),e.list.objectives&&e.list.objectives.forEach((function(e){"0"==e.id.charAt(0)?e.serialNum=e.id.charAt(1):e.serialNum=e.id})),e.objectives=e.list.objectives,e.objectives.forEach((function(e){e.assessmentMethods.forEach((function(e){e.activities.itemObject=e.activities.item.map((function(e){return{value:e}})),e.isEditWeight=!1}))})),console.log("objectives:",e.objectives),e.objectives.length>0&&e.objectives[0].assessmentMethods.length>0&&(e.activities=e.objectives[0].assessmentMethods[0].activities),e.getDeleteSerialNum()}))},editAssessments:function(e,t){this.index=t,this.dialogObject=JSON.parse(JSON.stringify(e)),console.log("objective",this.dialogObject),this.dialogFormVisible=!0},addAssessment:function(){var e={name:"",weight:0};e.activities=this.activities,this.dialogObject.assessmentMethods.push(e)},newAssessmentPart:function(e,t){this.index=t,this.dialogObject=JSON.parse(JSON.stringify(e)),console.log("objective",this.dialogObject),this.dialogFormVisible=!0},deleteAssessment:function(e){this.dialogObject.assessmentMethods.pop(e)},confirmAddAssessment:function(e){var t=0,o=!1,n=!1,r=!1;e.assessmentMethods.forEach((function(e){t+=Number(e.weight),""==e.name&&(o=!0),0==e.activities.item.length&&(n=!0),"0"==e.weight&&(r=!0)})),1==r&&G.nk.error("权重范围在1%-100%"),100!==t&&G.nk.error("权重之和必须为100%"),1==o&&G.nk.error("考核方式不能为空"),1==n&&G.nk.error("请为考核方式选择成绩项"),100==t&&0==o&&0==n&&0==r&&(this.objectives[this.index].assessmentMethods=this.dialogObject.assessmentMethods,this.dialogFormVisible=!1)},addObject:function(){var e={description:"",name:""};e.achievement=Number,e.numStudents=Number,e.serialNum=Number(this.deleteSerialNum)+1,e.serialNum>=10?e.id=e.serialNum+"":e.id="0"+e.serialNum,e.serialNum=e.serialNum+"",e.assessmentMethods=[],this.objectives.push(e),console.log("!!",this.objectives),this.getDeleteSerialNum(),this.canDelete=!0},deleteObject:function(){var e=this;P.s.confirm("是否确认删除课程目标"+this.deleteSerialNum+"?","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.objectives.pop(),0==e.objectives.length&&(e.canDelete=!1),e.getDeleteSerialNum()}))},getDeleteSerialNum:function(){this.objectives.length>0?this.deleteSerialNum=this.objectives[this.objectives.length-1].serialNum:(this.deleteSerialNum=0,this.canDelete=!1)},editWeight:function(e){e.isEditWeight=!0},saveWeight:function(e){Number(e.weight)>100||Number(e.weight)<=0?G.nk.error("权重范围在1%-100%"):e.isEditWeight=!1}}},Jm=(0,h.A)(Km,[["render",Qm],["__scopeId","data-v-d65132de"]]),Hm=Jm;var qm=function(e){return(0,l.Qi)("data-v-2d77b767"),e=e(),(0,l.jt)(),e},Zm={flex:""},ep={class:"block"},tp={class:"card-container"},op=qm((function(){return(0,l.Lk)("div",{class:"hot-table-container",id:"courseHot"},null,-1)})),np=[op],rp={class:"no-class"},ap={class:"no-major-detail"};function sp(e,t,o,n,r,a){var s=(0,l.g2)("Back"),c=(0,l.g2)("el-icon"),u=(0,l.g2)("el-button"),d=(0,l.g2)("el-tooltip"),h=(0,l.g2)("DocumentChecked"),f=(0,l.g2)("el-row");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",Zm,[(0,l.Lk)("div",ep,[(0,l.bF)(f,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(d,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{link:"",onClick:t[0]||(t[0]=function(e){return a.goTeacher()})},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"icon",size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1})]})),_:1}),(0,l.bF)(d,{class:"box-item",effect:"dark",content:"保存成绩",placement:"bottom","hide-after":0,disabled:!a.isValid()},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(u,{onClick:a.save,link:"",disabled:!a.isValid()},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{size:"24px",color:"rgb(137, 137, 137)",style:{"margin-left":"20px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(h)]})),_:1})]})),_:1},8,["onClick","disabled"]),[[i.aG,r.hasExamAnalysis]])]})),_:1},8,["disabled"])]})),_:1})])]),(0,l.bo)((0,l.Lk)("div",tp,np,512),[[i.aG,r.hasExamAnalysis]]),(0,l.bo)((0,l.Lk)("div",rp,"没有试卷分析表",512),[[i.aG,!r.hasExamAnalysis]]),(0,l.bo)((0,l.Lk)("div",ap," 请先添加试卷分析表 ",512),[[i.aG,!r.hasExamAnalysis]])],64)}const ip={name:"addTeacher",data:function(){return(0,$.A)((0,$.A)({compareData:[],canedit:!1,hasExamAnalysis:!0,objectivesName:["题号","分值"],editableTabsValue:"0",currenteditableTabsValue:0,maxeditableTabsValue:0,editableTabs:[],tabIndex:0,originData:[],hasActivities:!1,hasNoActivities:!1,hasScores:!1,hasNoScores:!1,hasObjectives:!1,hasNoObjectives:!1,departmentId:"",schoolId:"",programId:"",classInfo:"",NUM_AUX_ROW:3,NUM_AUX_COL:2,ROW_INDEX_ACTIVITY:0,ROW_INDEX_TOTALSCORE:1,ROW_INDEX_SCORESETTING:2,currentNumberofActivities:0,firstActivities:!0,addNewStudentList:[],hotInstance:void 0,columnList:[],scoreSettingOptions:["总评","期末"],isRouterAlive:!0,dirty:!1,saving:!1,count:0,localres:{},postData:{students:[],scores:[],newStudents:[],averageScore:{averageScoreOnTitle:[],scoreRateOnTitle:[],averageScoreOnObject:[],scoreRateOnObject:[]}},db:{items:[],objectives:[]}},"departmentId",0),"fromCourseBatchAdd",!1)},components:{ref:ce.KR,onMounted:l.sV,reactive:ce.Kh,HotTable:De.sH,HotColumn:De.gQ,registerAllModules:Be.um,ElTooltip:ue.R7,ElIcon:de.tk,ElInput:he.WK,Handsontable:$e.Ay,Back:ee.kcb,FolderChecked:ee.KHk,InfoFilled:ee.N_H,Loading:ee.Rhj,Download:ee.f5X,UploadFilled:ee.m8m,DocumentAdd:ee.pT5,ElMessage:G.nk,ElMessageBox:P.s,Action:p.A,CirclePlus:ee.HxT,DocumentChecked:ee.Fmj},methods:{editableTabsValueChange:function(e){var t=this;return this.currenteditableTabsValue=Number(e.props.name),this.hotInstance.updateSettings({columns:t.columnList[t.currenteditableTabsValue-1],data:t.db.items[t.currenteditableTabsValue-1],cells:t.getHotCellsFunction()}),console.log("currenteditableTabsValue:",Number(e.props.name))},handleTabsEdit:function(e,t,o){var n=this,r=this;if(console.log("action",t,"targetName",e,"activityName",o),"add"===t&&!e){console.log("handleTabsEdit add processing");var a=[""],s=[""],i=[""],l=[""],c=[];c.push(a),c.push(s),c.push(i),c.push(l),this.db.items.push(c);var u=++this.tabIndex+"";this.currenteditableTabsValue=this.tabIndex,this.maxeditableTabsValue=this.tabIndex,this.editableTabs.push({title:"成绩项 "+u,name:u.toString(),value:u}),this.editableTabsValue=u.toString(),this.hotInstance.updateSettings({data:r.db.items[r.currenteditableTabsValue-1],cells:r.getHotCellsFunction()}),console.log("currenteditableTabsValue:",this.currenteditableTabsValue,"maxTabsValue:",this.maxeditableTabsValue)}if("add"===t&&e&&o){console.log("handleTabsEdit 初始化 processing"),this.currenteditableTabsValue=++this.tabIndex,this.maxeditableTabsValue=this.tabIndex;var d=this.tabIndex+"";this.editableTabs.push({title:o||"成绩项 "+d,name:d.toString(),value:d}),this.editableTabsValue=this.editableTabs[0].name,this.currenteditableTabsValue=1,console.log("currenteditableTabsValue:",this.currenteditableTabsValue)}"remove"===t&&P.s.confirm("是否确认删除成绩项","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){var t=n.editableTabs;console.log("targetName:",e);var o=n.editableTabsValue;o===e&&t.forEach((function(n,r){if(n.name===e){var a=t[r+1]||t[r-1];a&&(o=a.name)}})),n.hotInstance.updateSettings({data:r.db.items[Number(o-1)],cells:r.getHotCellsFunction()}),n.editableTabsValue=o,n.editableTabs=t.filter((function(t){return t.name!==e})),console.log("editableTabs:",n.editableTabs)}))["catch"]((function(e){console.log("e",e)}))},activate:function(){this.identity=this.$store.state.currentInfo.identity,this.departmentId=this.$store.state.currentInfo.departmentId,this.schoolId=this.$store.state.currentInfo.schoolId,this.programId=this.$store.state.major.programId,"学院管理员"==this.identity?(this.classInfo=this.$store.state.currentInfo.adminSideClassInfo,console.log("identity:",this.identity)):"课程负责人"==this.identity?this.classInfo=this.$store.state.currentInfo.respondClassInfo:(this.classInfo=this.$store.state.currentInfo.teacherSideClassInfo,console.log("identity:",this.identity)),"1"!=this.classInfo.status&&"4"!=this.classInfo.status||(this.canedit=!0),console.log("this.canedit:",this.canedit),console.log("this.departmentId",this.departmentId,"this.schoolId",this.schoolId,"this.programId",this.programId,"this.classInfo",this.classInfo),this.getActivities()},activateHotcolumn:function(){console.log("Handsontable init");var e=this,t=this,o=document.querySelector("#courseHot"),n=new $e.Ay(o,{data:e.db.objectives,licenseKey:"non-commercial-and-evaluation",colHeaders:!1,dragToScroll:!0,rowHeaders:e.objectivesName,rowHeaderWidth:100,copyPaste:!0,allowRemoveColumn:!0,colWidths:100,contextMenu:!1,formulas:{engine:Nc.f1},afterChange:function(t,o){"loadData"!==o&&e.isValid()}});t.hotInstance=n,t.hotInstance.updateSettings({data:t.db.objectives,cells:t.getHotCellsFunction()})},getHotCellsFunction:function(){var e=this;return function(t,o,n){var r={};return e.canedit?(t>=e.objectivesName.length-2&&o<e.db.objectives["0"].length-2||t<e.objectivesName.length-2&&o>=e.db.objectives["0"].length-2?r.readOnly=!1:r.readOnly=!0,t!==e.objectivesName.length-1&&o!==e.db.objectives["0"].length-1||(r.readOnly=!0),e.hotInstance.getDataAtCell(t,0)||o===e.db.objectives["0"].length-2&&(r.readOnly=!0),0!==o&&0!==t||(r.readOnly=!0),o===e.db.objectives["0"].length-2&&(r.readOnly=!0)):o>=0&&(r.readOnly=!0),r}},getActivities:function(){var e=this;Ms(this.classInfo.classId).then((function(t){if(console.log("getExamAnalysis",t),t.data.setting){var o=t.data.setting,n=t.data.averageScore;if(o.object.forEach((function(t){e.objectivesName.push(t)})),e.objectivesName.push("平均得分"),e.objectivesName.push("得分率"),console.log("objectivesName",e.objectivesName),o.sum){var r,a,s=["合计"];s=s.concat(o.title),s.push("平均得分"),s.push("得分率"),e.db.objectives.push(s);for(var i=0;i<o.sum.length;i++){var l=[];l.push(o.sum[i]);for(var c="",u=0;u<o.value[i].length;u++)if(l.push(o.value[i][u]),o.value[i][u]){var d=o.sum.length+2;console.log(o.value[i][u],u),c=c+String.fromCharCode(66+u)+d+"+"}if(n){var h="=SUM("+c.slice(0,c.length-1)+")";console.log("calculateAverageScoreOnObject",h),l.push(h)}else l.push(null);n?l.push(n.scoreRateOnObject[i]+"%"):l.push(null),console.log("templist",l),l[l.length-1]="=TEXT("+String.fromCharCode(63+l.length)+(2+i)+"/"+String.fromCharCode(65)+(2+i)+'*100,"0.00%")',e.db.objectives.push(l)}if(n)r=[""],n.averageScoreOnTitle.forEach((function(e){r.push(e)}));else{r=[];for(var f=0;f<o.title.length+1;f++)r.push(null)}if(e.db.objectives.push(r),n)a=[""],n.scoreRateOnTitle.forEach((function(e){e?a.push(e+"%"):a.push(e)}));else{a=[];for(var m=0;m<o.title.length+1;m++)a.push(null)}for(var p=1;p<a.length;p++){var b="";b=String.fromCharCode(65+p)+2,console.log("sum:",b),a[p]="=TEXT("+String.fromCharCode(65+p)+(e.objectivesName.length-1)+"/SUM("+b+')*100,"0.00%")'}e.db.objectives.push(a)}else o.object.forEach((function(){e.db.objectives.push([""])}));console.log("this.db.objectives",e.db.objectives),e.compareData=JSON.parse(JSON.stringify(e.db.objectives)),e.activateHotcolumn()}else e.hasExamAnalysis=!1}))["catch"]((function(t){e.hasExamAnalysis=!1,console.log("e:",t),500==t.status?(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500}):409==t.status?(0,G.nk)({type:"error",message:"成绩项分值为空",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500})}))},isValid:function(){var e=this.toPostData();return e},save:function(){var e=this;this.saving=!0,this.dirty=!1,this.postData.averageScore={averageScoreOnTitle:[],scoreRateOnTitle:[],averageScoreOnObject:[],scoreRateOnObject:[]};var t=this.isValid();if(t)if(this.canedit){console.log("this.db.objectives",this.db.objectives);var o=[],n=[];this.db.objectives.forEach((function(t){"平均得分"!==t[e.db.objectives["0"].length-2]&&""!==t[0]&&(console.log("row",(0,O.A)(t[e.db.objectives["0"].length-2])),"string"===typeof t[e.db.objectives["0"].length-2]?o.push(parseFloat(t[e.db.objectives["0"].length-2].trim())):t[e.db.objectives["0"].length-2]?o.push(parseFloat(t[e.db.objectives["0"].length-2])):o.push(null))}));for(var r=0;r<this.objectivesName.length-3;r++){var a=this.hotInstance.getDataAtCell(r+1,this.db.objectives[0].length-1);console.log("tempRate",a),a?n.push(parseFloat(a)):n.push(null)}this.postData.averageScore.averageScoreOnObject=o,this.postData.averageScore.scoreRateOnObject=n;for(var s=1;s<this.db.objectives["0"].length-2;s++)"string"===typeof this.db.objectives[this.objectivesName.length-2][s]?this.postData.averageScore.averageScoreOnTitle.push(parseFloat(this.db.objectives[this.objectivesName.length-2][s].trim())):this.db.objectives[this.objectivesName.length-2][s]?this.postData.averageScore.averageScoreOnTitle.push(parseFloat(this.db.objectives[this.objectivesName.length-2][s])):this.postData.averageScore.averageScoreOnTitle.push(null);for(var i=0;i<this.db.objectives[0].length-3;i++){var l=this.hotInstance.getDataAtCell(this.objectivesName.length-1,i+1);console.log("tempRate",l),l?this.postData.averageScore.scoreRateOnTitle.push(parseFloat(l)):this.postData.averageScore.scoreRateOnTitle.push(null)}delete this.postData.averageScore["length"],console.log("this.postData.averageScore",this.postData.averageScore),Us({averageScore:this.postData.averageScore,classId:this.classInfo.classId}).then((function(t){console.log("editExamAnalysis:",t),"SUCCESS"==t.code&&(0,G.nk)({type:"success",message:"更新成功",duration:1500}),e.compareData=JSON.parse(JSON.stringify(e.db.objectives))}))["catch"]((function(e){500==e.status?(0,G.nk)({type:"error",message:"保存出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500})}))}else(0,G.nk)({type:"error",message:"课程已审核或提交，不可以修改成绩项",duration:1500});else this.saving=!1},toPostData:function(){this.postData.averageScore.length=0;var e=!0;if(this.db.objectives["0"]){for(var t=0;t<this.db.objectives[0].length;t++)if(!this.db.objectives["0"][t]){e=!1;break}}else e=!1;return e&&Qo().isEqual(this.compareData,this.db.objectives)&&(e=!1),e},goBackandClean:function(){this.postData.scores=[]},goTeacher:function(){var e=this;console.log("goteacher:"+this.saving+this.dirty),console.log(this.compareData,this.db.objectives);var t=Qo().isEqual(this.compareData,this.db.objectives);!t||0==this.saving&&!t?P.s.confirm("数据还未保存，是否仍然关闭？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){e.$router.push({path:"/score"})}))["catch"]((function(){})):this.$router.push({path:"/score"})},addScores:function(e){var t=this;return console.log("score postData:",e),Q({url:"/classes/editScores",method:"post",data:{classId:this.classInfo.classId,scores:e}}).then((function(e){t.postData.scores=[],console.log("saving scores res:",e),t.firstActivities=!0,"SUCCESS"==e.code&&((0,G.nk)({type:"success",message:"更新成功",duration:1500}),t.goBackandClean()),console.log("postData.scores",t.postData.scores)}))["catch"]((function(e){console.log("e:",e),500==e.status?(0,G.nk)({type:"error",message:"更新出错，请检查填写的内容",duration:1500}):(0,G.nk)({type:"error",message:"未知错误,请联系相关人员",duration:1500})}))}},mounted:function(){this.activate()}},lp=(0,h.A)(ip,[["render",sp],["__scopeId","data-v-2d77b767"]]),cp=lp;function up(e,t,o,n,r,a){var s=(0,l.g2)("MainHeader"),i=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(s),(0,l.bF)(i)],64)}const dp={name:"PrincipalIndex",components:{MainHeader:ka}},hp=(0,h.A)(dp,[["render",up]]),fp=hp;var mp=function(e){return(0,l.Qi)("data-v-66e36217"),e=e(),(0,l.jt)(),e},pp={class:"content"},bp={class:"block"},gp=mp((function(){return(0,l.Lk)("div",{class:"title"},"全部课程",-1)})),kp={class:"title"},vp={class:"body"},Ip={class:"card"},yp=mp((function(){return(0,l.Lk)("h3",null,"课程信息",-1)})),Cp=mp((function(){return(0,l.Lk)("div",{class:"detail-title"},"课程名",-1)})),Ap={class:"detail-info",style:{"margin-top":"10px"}},Fp=mp((function(){return(0,l.Lk)("div",{class:"detail-title"},"课程号",-1)})),wp={class:"detail-info",style:{"margin-top":"10px"}},Sp=mp((function(){return(0,l.Lk)("div",{class:"detail-title"},"学分",-1)})),_p={class:"detail-info",style:{"margin-top":"10px"}},Ep=mp((function(){return(0,l.Lk)("div",{class:"detail-title"},"课程类型",-1)})),Np={class:"detail-info",style:{"margin-top":"10px"}},Vp=mp((function(){return(0,l.Lk)("div",{class:"detail-title"},"选课类型",-1)})),xp={class:"detail-info",style:{"margin-top":"10px"}},Tp=mp((function(){return(0,l.Lk)("div",{class:"detail-title"},"备注",-1)})),jp={class:"detail-info",style:{"margin-top":"10px"}};function Lp(e,t,o,n,r,a){var s=(0,l.g2)("Back"),i=(0,l.g2)("el-icon"),c=(0,l.g2)("el-tooltip"),u=(0,l.g2)("el-divider"),d=(0,l.g2)("Histogram"),h=(0,l.g2)("List"),f=(0,l.g2)("Checked"),m=(0,l.g2)("el-row"),p=(0,l.g2)("el-col");return(0,l.uX)(),(0,l.CE)("div",pp,[(0,l.Lk)("div",bp,[(0,l.bF)(m,{class:"block-row"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{class:"box-item",effect:"dark",content:"返回",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",style:{"margin-left":"50px"},onClick:t[0]||(t[0]=function(e){return a.backBaseCourse()})},{default:(0,l.k6)((function(){return[(0,l.bF)(s)]})),_:1})]})),_:1}),gp,(0,l.bF)(u,{class:"divider",direction:"vertical"}),(0,l.Lk)("div",kp,(0,C.v_)(r.versionName),1),(0,l.bF)(c,{class:"box-item",effect:"dark",content:"成绩项",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",style:{"margin-left":"20px"},onClick:t[1]||(t[1]=function(t){return e.toActivities()})},{default:(0,l.k6)((function(){return[(0,l.bF)(d)]})),_:1})]})),_:1}),(0,l.bF)(c,{class:"box-item",effect:"dark",content:"毕业要求指标点",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",style:{"margin-left":"20px"},onClick:t[2]||(t[2]=function(t){return e.toIndicators()})},{default:(0,l.k6)((function(){return[(0,l.bF)(h)]})),_:1})]})),_:1}),(0,l.bF)(c,{class:"box-item",effect:"dark",content:"课程目标",placement:"bottom","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{class:"icon",size:"22px",color:"rgb(137, 137, 137)",style:{"margin-left":"20px"},onClick:t[3]||(t[3]=function(t){return e.toObjectives()})},{default:(0,l.k6)((function(){return[(0,l.bF)(f)]})),_:1})]})),_:1})]})),_:1})]),(0,l.Lk)("div",vp,[(0,l.Lk)("div",Ip,[yp,(0,l.bF)(p,null,{default:(0,l.k6)((function(){return[(0,l.bF)(p,{style:{"margin-top":"15px"}},{default:(0,l.k6)((function(){return[Cp,(0,l.Lk)("div",Ap,(0,C.v_)(r.form.courseName),1)]})),_:1}),(0,l.bF)(m,{style:{"margin-top":"15px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{span:12,style:{"margin-top":"10px"}},{default:(0,l.k6)((function(){return[Fp,(0,l.Lk)("div",wp,(0,C.v_)(r.form.courseCode),1)]})),_:1}),(0,l.bF)(p,{span:6,style:{"margin-top":"10px"}},{default:(0,l.k6)((function(){return[Sp,(0,l.Lk)("div",_p,(0,C.v_)(r.form.credit),1)]})),_:1})]})),_:1}),(0,l.bF)(m,{style:{"margin-top":"15px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{span:12,style:{"margin-top":"10px"}},{default:(0,l.k6)((function(){return[Ep,(0,l.Lk)("div",Np,(0,C.v_)(r.form.courseNature),1)]})),_:1}),(0,l.bF)(p,{span:6,style:{"margin-top":"10px"}},{default:(0,l.k6)((function(){return[Vp,(0,l.Lk)("div",xp,(0,C.v_)(r.form.courseType),1)]})),_:1})]})),_:1}),(0,l.bF)(p,{style:{"margin-top":"25px"}},{default:(0,l.k6)((function(){return[Tp,(0,l.Lk)("div",jp,(0,C.v_)(r.form.remark),1)]})),_:1})]})),_:1})])])])}const Dp={name:"PrincipalBaseCourseDetail",components:{HeaderSearch:ne,ElTooltip:ue.R7,ElMessage:G.nk,ElMessageBox:P.s,addBtn:le,request:Q,Back:ee.kcb,Histogram:ee.dqr,List:ee.B8B,Checked:ee.y$q},data:function(){return{indicators:[],departmentId:"",schoolId:"",majorId:[],majorNumber:0,currentMajorId:"",detailId:"",courseId:"",versionName:"",versionId:"",versionFlag:"",form:{courseName:"",courseCode:"",courseType:"",courseNature:"",credit:"",courseYear:"",remark:""},majorForm:[]}},mounted:function(){this.getRouter(),this.$store.commit("course/setCourseName",this.form.courseName);var e=this;this.versionFlag?(this.isVisiable=!0,this.getDetail()):P.s.confirm("尚未添加版本信息是否添加？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){return console.log("versionId",e.versionId,"CourseId",e.courseId),Q({url:"/detail",method:"post",data:{versionId:e.versionId,courseId:e.courseId,departmentId:e.departmentId,schoolId:e.schoolId}}).then((function(t){console.log(t),"200"==t.code?((0,G.nk)({type:"success",message:"新建成功",duration:1500}),e.isVisiable=!0,e.getDetail()):((0,G.nk)({type:"error",message:"新建失败",duration:1500}),e.goBaseCourse())}))}))},methods:{getDetail:function(){var e=this;return Q({url:"/detail/list?vesionId="+this.versionId+"&courseId="+this.courseId,method:"get"}).then((function(t){console.log("getDetail:",t),t.rows.forEach((function(t){t.versionId==e.versionId&&(e.detailId=t.detailId)})),console.log("detailId",e.detailId),e.$store.commit("course/setDetailId",e.detailId),e.getMajorId()}))},getMajorId:function(){var e=this,t=[],o=0;return Q({url:"/detailMajor/list?detailId="+this.detailId,method:"get"}).then((function(n){console.log("getMajorId:",n),n.rows?n.rows.forEach((function(e){t.push(e.majorId),o++})):(t.push(n.data.majorId),o=1),e.majorId=t,e.majorNumber=o,e.showMajor()}))},showMajor:function(){var e=[],t=0;if(console.log("index Type:",(0,O.A)(t.toString())),this.majorList){if(!(this.majorNumber>1))return Q({url:"/major/"+this.majorId[0],method:"get"}).then((function(o){console.log("Each Major Detail:",o),o.data.index=t.toString(),e.push(o.data)}));this.majorId.forEach((function(o){return console.log("each majoId:",o),Q({url:"/major/"+o,method:"get"}).then((function(o){console.log("Each Major Detail:",o),o.data.index=t.toString(),e.push(o.data),t++}))})),console.log("majorList",e),this.majorForm=e}else console.log("majorList is null "),this.majorForm=[]},backBaseCourse:function(){this.$router.push("/principalBaseCourse")},getRouter:function(){this.versionName=this.$store.state.course.baseCourseVersionName,this.versionId=this.$store.state.course.baseCourseVersionFlag,this.versionFlag=this.$store.state.course.baseCourseVersionId,this.courseId=this.$store.state.course.baseCourseCourseId,this.form.courseName=this.$store.state.course.baseCourseCourseName,this.form.courseCode=this.$store.state.course.baseCourseCourseCode,this.form.courseType=this.$store.state.course.baseCourseCourseType,this.form.courseNature=this.$store.state.course.baseCourseCourseNature,this.form.credit=this.$store.state.course.baseCourseCredit,this.form.courseYear=this.$store.state.course.baseCourseCourseYear,this.form.remark=this.$store.state.course.baseCourseRemark,this.departmentId=this.$store.state.currentInfo.departmentId,this.schoolId=this.$store.state.currentInfo.schoolId}}},Bp=(0,h.A)(Dp,[["render",Lp],["__scopeId","data-v-66e36217"]]),$p=Bp;(0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)({request:Q,ElTooltip:ue.R7,ElIcon:de.tk,ElInput:he.WK,ElForm:fe.US,ElButton:me.S2,ElTable:pe.Up,ElMessage:G.nk,ElMessageBox:P.s,Back:ee.kcb,FolderChecked:ee.KHk,InfoFilled:ee.N_H,Loading:ee.Rhj,Search:ee.vji,Close:ee.bm,Plus:ee.FWt,Delete:ee.epd,ElDialog:be.kZ,ref:ce.KR,reactive:ce.Kh},"Delete",ee.epd),"Edit",ee.ffu),"HeaderSearch",ne),"addBtn",le),"MoreFilled",ee.yGC),"ElDropdown",ge.dW),"ArrowDown",ee.yd$),"Document",ee.yoT),"ElTag",ke.u);var Op={class:"rightSlot"},Mp={class:"selects"},Up={class:"content"},Wp={class:"dialog-footer"};function Rp(e,t,o,n,r,a){var s=(0,l.g2)("el-option"),i=(0,l.g2)("el-select"),c=(0,l.g2)("HeaderSearch"),u=(0,l.g2)("el-table-column"),d=(0,l.g2)("Edit"),h=(0,l.g2)("el-icon"),f=(0,l.g2)("el-button"),m=(0,l.g2)("el-tooltip"),p=(0,l.g2)("el-table"),b=(0,l.g2)("el-input"),g=(0,l.g2)("el-form-item"),k=(0,l.g2)("el-autocomplete"),v=(0,l.g2)("el-form"),I=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(c,null,{rightTime:(0,l.k6)((function(){return[(0,l.Lk)("div",Op,[(0,l.Lk)("div",Mp,[(0,l.bF)(i,{modelValue:r.chosenYear,"onUpdate:modelValue":t[0]||(t[0]=function(e){return r.chosenYear=e}),placeholder:"全部学年",class:"selecter",onChange:t[1]||(t[1]=function(e){return a.getClassList()})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.academicYear,(function(e){return(0,l.uX)(),(0,l.Wv)(s,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"]),(0,l.bF)(i,{modelValue:r.chosenSemester,"onUpdate:modelValue":t[2]||(t[2]=function(e){return r.chosenSemester=e}),placeholder:"学期",class:"selecter",onChange:t[3]||(t[3]=function(e){return a.getClassList()})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.semester,(function(e){return(0,l.uX)(),(0,l.Wv)(s,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])])])]})),_:1}),(0,l.Lk)("div",Up,[(0,l.bF)(p,{class:"classList",data:r.classList,style:{width:"1480px"},"header-cell-style":{"padding-left":"20px","font-size":"14.4px",height:"48px","font-weight":"bold",color:"black"},"cell-style":{"padding-left":"20px","font-size":"16px",height:"60px"},"highlight-current-row":""},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{prop:"className",label:"课程名",width:"230"}),(0,l.bF)(u,{prop:"teacherName",label:"任课教师",width:"160"}),(0,l.bF)(u,{prop:"courseCode",label:"课程号",width:"200"}),(0,l.bF)(u,{prop:"identifier",label:"开课号",width:"220"}),(0,l.bF)(u,{prop:"academicYear",label:"学年",width:"180"}),(0,l.bF)(u,{prop:"semester",label:"学期",width:"180"}),(0,l.bF)(u,{prop:"remark",label:"备注",width:"160"}),(0,l.bF)(u,{width:"150"},{default:(0,l.k6)((function(e){return[(0,l.bF)(m,{content:"修改","hide-after":0},{default:(0,l.k6)((function(){return[(0,l.bF)(f,{link:"",style:{color:"#3f51b5"},onClick:function(t){return a.editClass(e.$index,e.row)}},{default:(0,l.k6)((function(){return[(0,l.bF)(h,null,{default:(0,l.k6)((function(){return[(0,l.bF)(d)]})),_:1})]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:1})]})),_:1},8,["data"]),(0,l.bF)(I,{modelValue:r.dialogFormVisible,"onUpdate:modelValue":t[13]||(t[13]=function(e){return r.dialogFormVisible=e}),title:"修改教学班",width:"580px","show-close":!1,"align-center":!0},{footer:(0,l.k6)((function(){return[(0,l.Lk)("span",Wp,[(0,l.bF)(f,{onClick:t[11]||(t[11]=function(e){return r.dialogFormVisible=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bF)(f,{type:"primary",onClick:t[12]||(t[12]=function(e){return a.confirmEditClass(r.classEditForm)})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)(v,{model:r.classEditForm,rules:r.rules,ref:"classEditForm","label-position":"top"},{default:(0,l.k6)((function(){return[(0,l.bF)(g,{label:"课程名","label-width":r.formLabelWidth,prop:"className"},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{modelValue:r.classEditForm.className,"onUpdate:modelValue":t[4]||(t[4]=function(e){return r.classEditForm.className=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(g,{label:"任课教师","label-width":r.formLabelWidth,prop:"instructor"},{default:(0,l.k6)((function(){return[(0,l.bF)(k,{style:{width:"540px"},modelValue:r.classEditForm.instructor,"onUpdate:modelValue":t[5]||(t[5]=function(e){return r.classEditForm.instructor=e}),"hide-loading":"","fetch-suggestions":a.querySearch},null,8,["modelValue","fetch-suggestions"])]})),_:1},8,["label-width"]),(0,l.bF)(g,{label:"课程号","label-width":r.formLabelWidth,prop:"courseCode"},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{modelValue:r.classEditForm.courseCode,"onUpdate:modelValue":t[6]||(t[6]=function(e){return r.classEditForm.courseCode=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(g,{label:"开课号","label-width":r.formLabelWidth,prop:"identifier"},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{modelValue:r.classEditForm.identifier,"onUpdate:modelValue":t[7]||(t[7]=function(e){return r.classEditForm.identifier=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(g,{label:"开课学年","label-width":r.formLabelWidth,prop:"chosenYear"},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{modelValue:r.classEditForm.chosenYear,"onUpdate:modelValue":t[8]||(t[8]=function(e){return r.classEditForm.chosenYear=e}),placeholder:"选择开课学年"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.academicYear,(function(e){return(0,l.uX)(),(0,l.Wv)(s,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(g,{label:"开课学期","label-width":r.formLabelWidth,prop:"chosenSemester"},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{modelValue:r.classEditForm.chosenSemester,"onUpdate:modelValue":t[9]||(t[9]=function(e){return r.classEditForm.chosenSemester=e}),placeholder:"选择开课学期"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.semester,(function(e){return(0,l.uX)(),(0,l.Wv)(s,{key:e.dictValue,label:e.dictLabel,value:e.dictValue},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1},8,["label-width"]),(0,l.bF)(g,{label:"备注","label-width":r.formLabelWidth,prop:"remark"},{default:(0,l.k6)((function(){return[(0,l.bF)(b,{rows:2,type:"textarea",modelValue:r.classEditForm.remark,"onUpdate:modelValue":t[10]||(t[10]=function(e){return r.classEditForm.remark=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width"])]})),_:1},8,["model","rules"])]})),_:1},8,["modelValue"])])],64)}const Pp={name:"PrincipalClass",components:{HeaderSearch:ne,Edit:ee.ffu},data:function(){return{classList:[],allTeachers:[],dialogFormVisible:!1,classEditForm:{className:"",instructor:"",courseCode:"",identifier:"",chosenYear:"",chosenSemester:"",remark:""},currentInfo:{departmentId:Number,schoolId:Number},formLabelWidth:"140px",rules:{className:[{required:!0,message:"请输入课程名称",trigger:"blur"}],instructor:[{required:!0,message:"请输入任课教师",trigger:"blur"}],courseCode:[{required:!0,message:"请输入课程号",trigger:"blur"}],identifier:[{required:!0,message:"请输入开课号",trigger:"blur"}],chosenYear:[{required:!0,message:"请选择开课学年",trigger:"change"}],chosenSemester:[{required:!0,message:"请选择开课学期",trigger:"change"}]},academicYear:[],semester:[],chosenYear:"",chosenSemester:""}},computed:{teacherEditChange:function(){return this.classEditForm.instructor}},watch:{teacherEditChange:{deep:!0,handler:function(e){""!==e?this.goSearch(this.classEditForm.instructor):this.allTeachers=[]}}},mounted:function(){this.currentInfo.departmentId=this.$store.state.currentInfo.departmentId,this.currentInfo.schoolId=this.$store.state.currentInfo.schoolId,this.getDictionary()},methods:{getDictionary:function(){var e=this;qt().then((function(t){console.log(t);var o={dictLabel:"全部学年",dictValue:null};e.academicYear=t.academic_year,e.academicYear.unshift(o);var n={dictLabel:"全部学期",dictValue:null};e.semester=t.semester,e.semester.unshift(n),e.getClassList()}))},getClassList:function(){var e=this;Ps(this.chosenYear,this.chosenSemester).then((function(t){if(e.classList=t.data,console.log("getClassList",e.classList),e.classList.length>0)for(var o=function(t){e.academicYear.forEach((function(o){o.dictValue==e.classList[t].academicYear&&(e.classList[t].academicYear=o.dictLabel)})),e.semester.forEach((function(o){o.dictValue==e.classList[t].semester&&(e.classList[t].semester=o.dictLabel)}))},n=0;n<e.classList.length;n++)o(n)}))},editClass:function(e,t){console.log("index",e,"row",t),this.academicYear.forEach((function(e){e.dictLabel==t.academicYear&&(t.academicYear=e.dictValue)})),this.semester.forEach((function(e){e.dictLabel==t.semester&&(t.semester=e.dictValue)})),this.classEditForm.className=t.className,this.classEditForm.instructor=t.teacherName,this.classEditForm.courseCode=t.courseCode,this.classEditForm.identifier=t.identifier,this.classEditForm.chosenYear=t.academicYear,this.classEditForm.chosenSemester=t.semester,this.classEditForm.remark=t.remark,this.classEditForm.classId=t.classId,this.classEditForm.teacherName=t.teacherName,this.classEditForm.teacherNumber=t.teacherNumber,this.dialogFormVisible=!0},confirmEditClass:function(e){var t=this;e.academicYear=e.chosenYear,e.semester=e.chosenSemester,e.departmentId=this.currentInfo.departmentId,e.schoolId=this.currentInfo.schoolId,dr(e).then((function(e){console.log("confirmEditClass",e),"SUCCESS"==e.code&&(t.dialogFormVisible=!1,t.getClassList())}))},goSearch:function(e){var t=this;this.allTeachers=[],$s(this.currentInfo.departmentId,this.currentInfo.schoolId,e).then((function(e){t.allTeachers=e.data}))},querySearch:function(e,t){var o=this.allTeachers;if(o.length>0){var n=e?o.filter(this.createStateFilter(e)):o;n=o.map((function(e){return{value:e}})),t(n),clearTimeout(this.timeout),this.timeout=setTimeout((function(){t(n)}),3e3*Math.random())}},createStateFilter:function(e){return function(e){}}}},Gp=(0,h.A)(Pp,[["render",Rp],["__scopeId","data-v-0ff62916"]]),zp=Gp;function Yp(e,t,o,n,r,a){var s=(0,l.g2)("MainHeader"),i=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(s),(0,l.bF)(i)],64)}const Xp={name:"WebAdminIndex",components:{MainHeader:ka}},Qp=(0,h.A)(Xp,[["render",Yp]]),Kp=Qp;var Jp=function(e){return(0,l.Qi)("data-v-1f34a782"),e=e(),(0,l.jt)(),e},Hp=Jp((function(){return(0,l.Lk)("div",{class:"content"},"123",-1)}));function qp(e,t,o,n,r,a){var s=(0,l.g2)("HeaderSearch");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(s,{msg:"搜索学校名称"}),Hp],64)}const Zp={name:"Schools",components:{HeaderSearch:ne}},eb=(0,h.A)(Zp,[["render",qp],["__scopeId","data-v-1f34a782"]]),tb=eb;var ob,nb={class:"content"},rb={style:{display:"flex","align-items":"center"}},ab={style:{display:"flex","align-items":"center"}},sb={style:{display:"flex","align-items":"center"}},ib={class:"dialog-footer"};function lb(e,t,o,n,r,a){var s=this,c=(0,l.g2)("addBtn"),u=(0,l.g2)("el-table-column"),d=(0,l.g2)("Delete"),h=(0,l.g2)("el-icon"),f=(0,l.g2)("el-button"),m=(0,l.g2)("el-tooltip"),p=(0,l.g2)("el-col"),b=(0,l.g2)("Edit"),g=(0,l.g2)("el-row"),k=(0,l.g2)("el-table"),v=(0,l.g2)("el-input"),I=(0,l.g2)("el-form-item"),y=(0,l.g2)("el-form"),A=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",nb,[(0,l.bF)(c,{onClick:t[0]||(t[0]=function(e){s.addFlag=!0,s.deleteFlag=!1,s.editFlag=!1,s.showEditVersionDailogFlag=!0})}),(0,l.bF)(k,{data:r.versions,class:"el-table-container","header-cell-style":{"padding-left":"20px","font-size":"14.4px",height:"48px","font-weight":"bold",color:"black"},"cell-style":{"padding-left":"20px","font-size":"16px",height:"60px"},style:{width:"800px"}},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{label:"名称",width:"200"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",rb,[(0,l.Lk)("span",null,(0,C.v_)(e.row.label),1)])]})),_:1}),(0,l.bF)(u,{label:"面向年级",width:"200"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",ab,[(0,l.Lk)("span",null,(0,C.v_)(e.row.enrollYear),1)])]})),_:1}),(0,l.bF)(u,{label:"修订年份",width:"200"},{default:(0,l.k6)((function(e){return[(0,l.Lk)("div",sb,[(0,l.Lk)("span",null,(0,C.v_)(e.row.reviseYear),1)])]})),_:1}),(0,l.bF)(u,{label:"操作",width:"200"},{default:(0,l.k6)((function(e){return[(0,l.bF)(g,null,{default:(0,l.k6)((function(){return[(0,l.bF)(p,{span:6},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{content:"删除"},{default:(0,l.k6)((function(){return[(0,l.bF)(f,{class:"deleteButton",link:"",style:{color:"#3f51b5"},onClick:(0,i.D$)((function(t){return s.deleteVersion(e.row)}),["stop"])},{default:(0,l.k6)((function(){return[(0,l.bF)(h,null,{default:(0,l.k6)((function(){return[(0,l.bF)(d)]})),_:1})]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024),(0,l.bF)(p,{span:6},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{content:"修改版本信息"},{default:(0,l.k6)((function(){return[(0,l.bF)(f,{class:"deleteButton",link:"",style:{color:"#3f51b5"},onClick:function(t){s.editFlag=!0,s.deleteFlag=!1,s.addFlag=!1,s.nameFlag=!0,s.selectVersion(e.row),s.showEditVersionDailogFlag=!0}},{default:(0,l.k6)((function(){return[(0,l.bF)(h,null,{default:(0,l.k6)((function(){return[(0,l.bF)(b)]})),_:1})]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1024)]})),_:1})]})),_:1},8,["data"])]),(0,l.bF)(A,{modelValue:r.showEditVersionDailogFlag,"onUpdate:modelValue":t[9]||(t[9]=function(e){return r.showEditVersionDailogFlag=e}),width:"500"},{header:(0,l.k6)((function(){return[(0,l.bo)((0,l.Lk)("h4",null,"课程大纲版本号新建",512),[[i.aG,r.addFlag]]),(0,l.bo)((0,l.Lk)("h4",null,"版本信息",512),[[i.aG,r.editFlag]]),(0,l.bo)((0,l.Lk)("h4",null,"课程大纲版本号删除",512),[[i.aG,r.deleteFlag]])]})),footer:(0,l.k6)((function(){return[(0,l.Lk)("span",ib,[(0,l.bF)(f,{onClick:t[5]||(t[5]=function(e){r.showEditVersionDailogFlag=!1,s.cancelVersionForm()})},{default:(0,l.k6)((function(){return[(0,l.eW)("取消")]})),_:1}),(0,l.bo)((0,l.bF)(f,{type:"primary",disabled:!r.submitFlag,onClick:t[6]||(t[6]=function(e){return a.addVersion()})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1},8,["disabled"]),[[i.aG,r.addFlag]]),(0,l.bo)((0,l.bF)(f,{type:"primary",onClick:t[7]||(t[7]=function(e){return a.editVersion()})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1},512),[[i.aG,r.editFlag]]),(0,l.bo)((0,l.bF)(f,{type:"primary",disabled:!r.submitFlag,onClick:t[8]||(t[8]=function(e){return a.deleteVersion()})},{default:(0,l.k6)((function(){return[(0,l.eW)(" 确认 ")]})),_:1},8,["disabled"]),[[i.aG,r.deleteFlag]])])]})),default:(0,l.k6)((function(){return[(0,l.bF)(y,{model:r.versionForm,rules:r.editVersionRules},{default:(0,l.k6)((function(){return[(0,l.bo)((0,l.bF)(I,{label:"课程大纲版本号","label-width":r.formLabelWidth,prop:"name",error:r.C_ErrorMsg_editVersion_name},{default:(0,l.k6)((function(){return[(0,l.bF)(v,{modelValue:r.versionForm.name,"onUpdate:modelValue":t[1]||(t[1]=function(e){return r.versionForm.name=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width","error"]),[[i.aG,r.addFlag]]),(0,l.bo)((0,l.bF)(I,{label:"课程大纲版本号","label-width":r.formLabelWidth,error:r.C_ErrorMsg_editVersion_name,prop:"name"},{default:(0,l.k6)((function(){return[(0,l.bF)(v,{modelValue:r.versionForm.name,"onUpdate:modelValue":t[2]||(t[2]=function(e){return r.versionForm.name=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width","error"]),[[i.aG,r.editFlag||r.deleteFlag]]),(0,l.bF)(I,{label:"面向年级","label-width":r.formLabelWidth,prop:"enrollYear",error:r.C_ErrorMsg_editVersion_enrollYear},{default:(0,l.k6)((function(){return[(0,l.bF)(v,{modelValue:r.versionForm.enrollYear,"onUpdate:modelValue":t[3]||(t[3]=function(e){return r.versionForm.enrollYear=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width","error"]),(0,l.bF)(I,{label:"修订年份","label-width":r.formLabelWidth,prop:"reviseYear",error:r.C_ErrorMsg_editVersion_reviseYear},{default:(0,l.k6)((function(){return[(0,l.bF)(v,{modelValue:r.versionForm.reviseYear,"onUpdate:modelValue":t[4]||(t[4]=function(e){return r.versionForm.reviseYear=e}),autocomplete:"off"},null,8,["modelValue"])]})),_:1},8,["label-width","error"])]})),_:1},8,["model","rules"])]})),_:1},8,["modelValue"])],64)}const cb={name:"Version",components:(ob={request:Q,ElTooltip:ue.R7,ElIcon:de.tk,ElInput:he.WK,ElForm:fe.US,ElButton:me.S2,ElTable:pe.Up,ElMessage:G.nk,ElMessageBox:P.s,Back:ee.kcb,FolderChecked:ee.KHk,InfoFilled:ee.N_H,Loading:ee.Rhj,Search:ee.vji,Close:ee.bm,Plus:ee.FWt,Delete:ee.epd,ElDialog:be.kZ,ref:ce.KR,reactive:ce.Kh},(0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)((0,$.A)(ob,"Delete",ee.epd),"Edit",ee.ffu),"HeaderSearch",ne),"addBtn",le),"MoreFilled",ee.yGC),"ElDropdown",ge.dW),"ArrowDown",ee.yd$),"Document",ee.yoT),"ElTag",ke.u),"Avatar",ee.euF),(0,$.A)((0,$.A)((0,$.A)((0,$.A)(ob,"DocumentChecked",ee.Fmj),"User",ee.KJW),"CircleClose",ee.R$5),"Collection",ee.pMc)),data:function(){var e=this,t=function(t,o,n){if(""===o)e.C_ErrorMsg_editVersion_name="请输入版本名称";else{var r=/^\d{4}版$/;r.test(o)?(e.nameFlag=!0,e.enrollYearFlag&&e.nameFlag&&e.reviseYearFlag?e.submitFlag=!0:e.submitFlag=!1):e.C_ErrorMsg_editVersion_name="请输入正确版本名称格式 例如：2020版"}console.log(e.nameFlag,e.enrollYearFlag,e.reviseYearFlag)},o=function(t,o,n){if(""===o)e.C_ErrorMsg_editVersion_enrollYear="请输入年份";else{var r=/^[1-9]\d{3}$/,a=/^\d+$/;a.test(o)?r.test(o)?(e.enrollYearFlag=!0,e.enrollYearFlag&&e.nameFlag&&e.reviseYearFlag?e.submitFlag=!0:e.submitFlag=!1):e.C_ErrorMsg_editVersion_enrollYear="请输入正确年份格式 例如：2020 ":e.C_ErrorMsg_editVersion_enrollYear="请输入数字"}console.log(e.nameFlag,e.enrollYearFlag,e.reviseYearFlag)},n=function(t,o,n){if(""===o)e.C_ErrorMsg_editVersion_reviseYear="请输入年份";else{var r=/^[1-9]\d{3}$/,a=/^\d+$/;a.test(o)?r.test(o)?(e.reviseYearFlag=!0,e.enrollYearFlag&&e.nameFlag&&e.reviseYearFlag?e.submitFlag=!0:e.submitFlag=!1):e.C_ErrorMsg_editVersion_reviseYear="请输入正确年份格式 例如：2020 ":e.C_ErrorMsg_editVersion_reviseYear="请输入数字"}console.log(e.nameFlag,e.enrollYearFlag,e.reviseYearFlag)};return{formLabelWidth:"140px",submitFlag:!1,nameFlag:!1,enrollYearFlag:!1,reviseYearFlag:!1,addFlag:!1,editFlag:!1,deleteFlag:!1,versions:[],versionLabel:[],currentVersion:"",versionForm:{name:"",enrollYear:"",reviseYear:"",versionId:""},C_ErrorMsg_editVersion_name:"",C_ErrorMsg_editVersion_enrollYear:"",C_ErrorMsg_editVersion_reviseYear:"",editVersionRules:{name:[{validator:t,trigger:"blur"}],enrollYear:[{validator:o,trigger:"blur"}],reviseYear:[{validator:n,trigger:"blur"}]},showEditVersionDailogFlag:!1}},mounted:function(){this.getDictionary()},methods:{goEdit:function(e){this.editFlag=!0,this.deleteFlag=!1,this.addFlag=!1,this.nameFlag=!0,this.selectVersion(e),this.showEditVersionDailogFlag=!0},addVersion:function(){var e=this,t=this;return Q({url:"/detail/version",method:"post",data:{enrollYear:t.versionForm.enrollYear,reviseYear:t.versionForm.reviseYear,versionName:t.versionForm.name}}).then((function(o){console.log("edit version res:",o),"SUCCESS"==o.code&&((0,G.nk)({type:"success",message:"新建成功",duration:1500}),t.showEditVersionDailogFlag=!1,t.versionForm={name:"",enrollYear:"",reviseYear:"",versionId:""},e.getDictionary())}))["catch"]((function(e){console.log("edit version res error:",e),(0,G.nk)({type:"error",message:"新建失败",duration:1500})}))},editVersion:function(){var e=this,t=this;return Q({url:"/detail/version",method:"put",data:{enrollYear:t.versionForm.enrollYear,reviseYear:t.versionForm.reviseYear,versionName:t.versionForm.name,versionId:t.versionForm.versionId}}).then((function(o){console.log("edit version res:",o),"SUCCESS"==o.code&&((0,G.nk)({type:"success",message:"更新成功",duration:1500}),t.showEditVersionDailogFlag=!1,t.versionForm={name:"",enrollYear:"",reviseYear:"",versionId:""},e.getDictionary())}))["catch"]((function(e){console.log("edit version res error:",e),(0,G.nk)({type:"error",message:"更新失败",duration:1500})}))},deleteVersion:function(e){var t=this,o=this;console.log("row",e),P.s.confirm("是否确认删除课程大纲版本？","",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){return Q({url:"/detail/versionRemove/"+e.versionId,method:"delete"}).then((function(e){console.log("delete version res:",e),204===e&&((0,G.nk)({type:"success",message:"删除成功",duration:1500}),t.$store.state.course.baseCourseVersionId==o.versionForm.versionId&&t.$store.commit("course/setbaseCourseVersionId",""),o.showEditVersionDailogFlag=!1,o.versionForm={name:"",enrollYear:"",reviseYear:"",versionId:""},t.getDictionary())}))["catch"]((function(e){console.log("edit version res error:",e),(0,G.nk)({type:"error",message:"删除失败",duration:1500})}))}))["catch"]((function(e){console.log("e",e)}))},cancelVersionForm:function(){this.addFlag=!1,this.deleteFlag=!1,this.editFlag=!1,this.versionForm={name:"",enrollYear:"",reviseYear:"",versionId:""},this.C_ErrorMsg_editVersion_name="",this.C_ErrorMsg_editVersion_enrollYear="",this.C_ErrorMsg_editVersion_reviseYear="",this.nameFlag=!1,this.enrollYearFlag=!1,this.reviseYearFlag=!1},selectVersion:function(e){console.log("row",e);var t,o=(0,Qt.A)(this.versions);try{for(o.s();!(t=o.n()).done;){var n=t.value;n["versionId"]==e.versionId&&(this.versionForm.name=n["label"],this.versionForm.enrollYear=n["enrollYear"],this.versionForm.reviseYear=n["reviseYear"],this.versionForm.versionId=n["versionId"])}}catch(err){o.e(err)}finally{o.f()}console.log("name:",this.versionForm.name,"enrollYear:",this.versionForm.enrollYear,"reviseYear:",this.versionForm.reviseYear)},getDictionary:function(){var e=this;return this.versions=[],this.versionLabel=[],Q({url:"detail/versionList",method:"get"}).then((function(t){console.log("versionList",t),"SUCCESS"==t.code&&(t.data.forEach((function(t){var o={label:t.versionName,enrollYear:t.enrollYear,reviseYear:t.reviseYear,versionId:t.versionId};e.versions.push(o),e.versionLabel.push(t.versionName)})),e.currentVersion=e.versionLabel[e.currentVersionValue-1])}))["catch"]((function(e){console.log("error:",e)}))}}},ub=(0,h.A)(cb,[["render",lb],["__scopeId","data-v-93003cbc"]]),db=ub;var hb=(0,y.aE)({history:(0,y.LA)(),routes:[{path:"",component:Td},{path:"/login",component:Td},{path:"/index",component:ya,children:[{path:"/baseCourse",component:hs,meta:{isMajor:!1},name:"BaseCourse"},{path:"/class",component:Ys,meta:{isMajor:!1},name:"Class"},{path:"/teacher",name:"Teacher",component:wi,meta:{isMajor:!1}},{path:"/major",name:"Major",component:ci,meta:{isMajor:!1}},{path:"/departmentSetting",redirect:"/version",component:bi,name:"DepartmentSetting",meta:{isMajor:!1},children:[{name:"TemplateList",path:"/templateList",component:Od,meta:{isMajor:!1}},{name:"Version",path:"/version",component:db,meta:{isMajor:!1}}]},{path:"/addTeacher",component:Oi,meta:{isMajor:!1}},{path:"/batchCourseAdd",component:Ji,meta:{isMajor:!1}},{path:"/batchClassAdd",component:rl,meta:{isMajor:!1}},{path:"/baseCourseDetail",component:jl,meta:{isMajor:!1}},{path:"/baseCourseIndicators",component:Zc,meta:{isMajor:!1}},{path:"/baseCourseIndicatorsEdit",component:Su,meta:{isMajor:!1}},{path:"/baseCourseObjectives",component:oc,meta:{isMajor:!1}},{path:"/baseCourseObjectivesEdit",component:zu,meta:{isMajor:!1}},{path:"/templateManage",component:id,meta:{isMajor:!1}},{path:"/baseCourseActivities",name:"baseCourseActivities",component:Ic,meta:{isMajor:!1}},{path:"/baseCourseAnalysis",name:"baseCourseAnalysis",component:Tc,meta:{isMajor:!1}},{path:"/paperAnalysis",name:"paperAnalysis",component:yd,meta:{isMajor:!1}},{name:"Goal",path:"/goal",component:jo,meta:{isMajor:!0}},{path:"/edit",component:Ho,meta:{isMajor:!0}},{name:"Courses",path:"/courses",component:to,meta:{isMajor:!0}},{name:"CourseDetail",path:"/courseDetail",component:Ar,meta:{isMajor:!0}},{name:"Achieve",path:"/achieve",component:Ft,meta:{isMajor:!0}},{name:"Student",path:"/student",component:_e,meta:{isMajor:!0}},{name:"BaseAddStudent",path:"/baseAddStudent",component:Ue,meta:{isMajor:!0}},{name:"Manage",path:"/manage",component:tn,meta:{isMajor:!0}},{name:"Setting",path:"/setting",component:On,meta:{isMajor:!0}},{path:"/addTeacher",component:Oi},{name:"TemplateEdit",path:"/templateEdit",component:rh,meta:{isMajor:!1}},{name:"Workbook",path:"/workbook",component:Oh,meta:{isMajor:!1}},{name:"WorkbookPresent",path:"/workbookPresent",component:Xh,meta:{isMajor:!1}}]},{path:"/teacherIndex",component:Hh,children:[{name:"TeacherClasses",path:"/teacherClasses",component:uf},{name:"TeacherClass",path:"/teacherClass",component:Lf},{name:"Students",path:"/students",component:Wf},{name:"AddScore",path:"/addScore",component:Zf},{name:"Score",path:"/score",component:km},{name:"Objectives",path:"/objectives",component:Lm},{name:"ObjectivesEdit",path:"/objectivesEdit",component:Hm},{name:"examAnalysis",path:"/examAnalysis",component:cp}]},{path:"/principalIndex",component:fp,children:[{name:"principalClass",path:"/principalClass",component:zp},{name:"principalBaseCourseDetail",path:"/principalBaseCourseDetail",component:$p}]},{path:"/webAdminIndex",component:Kp,children:[{name:"Schools",path:"/schools",component:tb}]}]});const fb=hb;var mb=o(18965),pb=o(42453);mb.A.component("upload",Qd);var bb=(0,i.Ef)(m).use(I).use(fb).use(p.A,{locale:b.A}).use(mb.A).use(Gd.Ay).use(pb.Ay).component("upload",Qd).provide("$baseURL","https://jxjk.hdu.edu.cn/prod-api/").mount("#app"),gb=function(e,t){var o=null;return function(){var n=this,r=arguments;clearTimeout(o),o=setTimeout((function(){e.apply(n,r)}),t)}},kb=window.ResizeObserver;window.ResizeObserver=function(e){function t(e){return(0,r.A)(this,t),e=gb(e,16),(0,a.A)(this,t,[e])}return(0,s.A)(t,e),(0,n.A)(t)}(kb),bb.$.appContext.components.ElDialog.props.closeOnClickModal["default"]=!1;var vb=!1;console.log=function(e){return function(){vb&&e.apply(this,arguments)}}(console.log)},86400:()=>{}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(a.exports,a,a.exports,o),a.loaded=!0,a.exports}o.m=e,(()=>{var e=[];o.O=(t,n,r,a)=>{if(!n){var s=1/0;for(u=0;u<e.length;u++){for(var[n,r,a]=e[u],i=!0,l=0;l<n.length;l++)(!1&a||s>=a)&&Object.keys(o.O).every((e=>o.O[e](n[l])))?n.splice(l--,1):(i=!1,a<s&&(s=a));if(i){e.splice(u--,1);var c=r();void 0!==c&&(t=c)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,r,a]}})(),(()=>{o.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return o.d(t,{a:t}),t}})(),(()=>{o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}})(),(()=>{o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{o.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e)})(),(()=>{var e={524:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var r,a,[s,i,l]=n,c=0;if(s.some((t=>0!==e[t]))){for(r in i)o.o(i,r)&&(o.m[r]=i[r]);if(l)var u=l(o)}for(t&&t(n);c<s.length;c++)a=s[c],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(u)},n=self["webpackChunkvdemo"]=self["webpackChunkvdemo"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var n=o.O(void 0,[504],(()=>o(18082)));n=o.O(n)})();
//# sourceMappingURL=app.4d4a7abe.js.map